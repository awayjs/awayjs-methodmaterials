require=function e(t,o,i){function n(s,a){if(!o[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var d=o[s]={exports:{}};t[s][0].call(d.exports,function(e){var o=t[s][1][e];return n(o?o:e)},d,d.exports,e,t,o,i)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({"awayjs-methodmaterials/lib/TriangleMaterialMode":[function(e,t){var o=function(){function e(){}return e.SINGLE_PASS="singlePass",e.MULTI_PASS="multiPass",e}();t.exports=o},{}],"awayjs-methodmaterials/lib/TriangleMethodMaterial":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/geom/ColorTransform"),n=e("awayjs-core/lib/textures/Texture2DBase"),r=e("awayjs-display/lib/base/BlendMode"),s=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker"),a=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),h=e("awayjs-renderergl/lib/materials/TriangleMaterialBase"),p=e("awayjs-methodmaterials/lib/TriangleMaterialMode"),d=e("awayjs-methodmaterials/lib/methods/AmbientBasicMethod"),l=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"),u=e("awayjs-methodmaterials/lib/methods/NormalBasicMethod"),c=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod"),m=e("awayjs-methodmaterials/lib/passes/MaterialPassMode"),g=e("awayjs-methodmaterials/lib/passes/TriangleMethodPass"),f=function(e){function t(t,o,i,r){void 0===t&&(t=null),void 0===o&&(o=null),void 0===i&&(i=!1),void 0===r&&(r=!1),e.call(this),this._alphaBlending=!1,this._alpha=1,this._ambientMethod=new d,this._diffuseMethod=new l,this._normalMethod=new u,this._specularMethod=new c,this._depthCompareMode=a.LESS_EQUAL,this._materialMode=p.SINGLE_PASS,t instanceof n?(this.texture=t,this.smooth=null==o?!0:!1,this.repeat=i,this.mipmap=r):(this.color=null==t?16777215:Number(t),this.alpha=null==o?1:Number(o))}return o(t,e),Object.defineProperty(t.prototype,"materialMode",{get:function(){return this._materialMode},set:function(e){this._materialMode!=e&&(this._materialMode=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode!=e&&(this._depthCompareMode=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e>1?e=1:0>e&&(e=0),this._alpha!=e&&(this._alpha=e,null==this._colorTransform&&(this._colorTransform=new i),this._colorTransform.alphaMultiplier=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._screenPass.colorTransform},set:function(e){this._screenPass.colorTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseTexture",{get:function(){return this._diffuseMethod.texture},set:function(e){this._diffuseMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(e){this._ambientMethod!=e&&(e&&this._ambientMethod&&e.copyFrom(this._ambientMethod),this._ambientMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(e){this._shadowMethod!=e&&(e&&this._shadowMethod&&e.copyFrom(this._shadowMethod),this._shadowMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(e){this._diffuseMethod!=e&&(e&&this._diffuseMethod&&e.copyFrom(this._diffuseMethod),this._diffuseMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(e){this._specularMethod!=e&&(e&&this._specularMethod&&e.copyFrom(this._specularMethod),this._specularMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(e){this._normalMethod!=e&&(e&&this._normalMethod&&e.copyFrom(this._normalMethod),this._normalMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),t.prototype.addEffectMethod=function(e){null==this._screenPass&&(this._screenPass=new g),this._screenPass.addEffectMethod(e),this._pInvalidateScreenPasses()},Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._screenPass?this._screenPass.numEffectMethods:0},enumerable:!0,configurable:!0}),t.prototype.hasEffectMethod=function(e){return this._screenPass?this._screenPass.hasEffectMethod(e):!1},t.prototype.getEffectMethodAt=function(e){return null==this._screenPass?null:this._screenPass.getEffectMethodAt(e)},t.prototype.addEffectMethodAt=function(e,t){null==this._screenPass&&(this._screenPass=new g),this._screenPass.addEffectMethodAt(e,t),this._pInvalidatePasses()},t.prototype.removeEffectMethod=function(e){null!=this._screenPass&&(this._screenPass.removeEffectMethod(e),0==this._screenPass.numEffectMethods&&this._pInvalidatePasses())},Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._normalMethod.normalMap},set:function(e){this._normalMethod.normalMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMap",{get:function(){return this._specularMethod.texture},set:function(e){this._specularMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this._specularMethod.gloss},set:function(e){this._specularMethod.gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambientMethod.ambient},set:function(e){this._ambientMethod.ambient=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._specularMethod.specular},set:function(e){this._specularMethod.specular=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._diffuseMethod.ambientColor},set:function(e){this._diffuseMethod.ambientColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseMethod.diffuseColor},set:function(e){this._diffuseMethod.diffuseColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularMethod.specularColor},set:function(e){this._specularMethod.specularColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){this._alphaBlending!=e&&(this._alphaBlending=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),t.prototype._iUpdateMaterial=function(){if(this._pScreenPassesInvalid){if(this._pScreenPassesInvalid=!1,this.initPasses(),this.setBlendAndCompareModes(),this._pClearScreenPasses(),this._materialMode==p.MULTI_PASS&&(this._casterLightPass&&this._pAddScreenPass(this._casterLightPass),this._nonCasterLightPasses))for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pAddScreenPass(this._nonCasterLightPasses[e]);this._screenPass&&this._pAddScreenPass(this._screenPass)}},t.prototype.initPasses=function(){0==this.numLights||this.numEffectMethods>0||this._materialMode==p.SINGLE_PASS?this.initEffectPass():this._screenPass&&this.removeEffectPass(),this._shadowMethod&&this._materialMode==p.MULTI_PASS?this.initCasterLightPass():this._casterLightPass&&this.removeCasterLightPass(),this.numNonCasters>0&&this._materialMode==p.MULTI_PASS?this.initNonCasterLightPasses():this._nonCasterLightPasses&&this.removeNonCasterLightPasses()},t.prototype.setBlendAndCompareModes=function(){var e=Boolean(this._casterLightPass||this._screenPass);if(this._casterLightPass&&(this._casterLightPass.forceSeparateMVP=e,this._casterLightPass.setBlendMode(r.NORMAL),this._casterLightPass.depthCompareMode=this._depthCompareMode),this._nonCasterLightPasses){var t=0;this._casterLightPass||(this._nonCasterLightPasses[0].forceSeparateMVP=e,this._nonCasterLightPasses[0].setBlendMode(r.NORMAL),this._nonCasterLightPasses[0].depthCompareMode=this._depthCompareMode,t=1);for(var o=t;o<this._nonCasterLightPasses.length;++o)this._nonCasterLightPasses[o].forceSeparateMVP=e,this._nonCasterLightPasses[o].setBlendMode(r.ADD),this._nonCasterLightPasses[o].depthCompareMode=a.LESS_EQUAL}this._casterLightPass||this._nonCasterLightPasses?(this._pRequiresBlending=!1,this._screenPass&&(this._screenPass.passMode=m.EFFECTS,this._screenPass.depthCompareMode=a.LESS_EQUAL,this._screenPass.setBlendMode(r.LAYER),this._screenPass.forceSeparateMVP=e)):this._screenPass&&(this._pRequiresBlending=this._pBlendMode!=r.NORMAL||this._alphaBlending||this._colorTransform&&this._colorTransform.alphaMultiplier<1,this._screenPass.passMode=m.SUPER_SHADER,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.colorTransform=this._colorTransform,this._screenPass.setBlendMode(this._pBlendMode==r.NORMAL&&this._pRequiresBlending?r.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1)},t.prototype.initCasterLightPass=function(){null==this._casterLightPass&&(this._casterLightPass=new g(m.LIGHTING)),this._casterLightPass.lightPicker=new s([this._shadowMethod.castingLight]),this._casterLightPass.shadowMethod=this._shadowMethod,this._casterLightPass.diffuseMethod=this._diffuseMethod,this._casterLightPass.ambientMethod=this._ambientMethod,this._casterLightPass.normalMethod=this._normalMethod,this._casterLightPass.specularMethod=this._specularMethod},t.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose(),this._pRemoveScreenPass(this._casterLightPass),this._casterLightPass=null},t.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var e,t=this._pLightPicker.numDirectionalLights,o=this._pLightPicker.numPointLights,i=this._pLightPicker.numLightProbes,n=0,r=0,s=0;for(this._casterLightPass||(t+=this._pLightPicker.numCastingDirectionalLights,o+=this._pLightPicker.numCastingPointLights),this._nonCasterLightPasses=new Array;t>n||o>r||i>s;)e=new g(m.LIGHTING),e.includeCasters=null==this._shadowMethod,e.directionalLightsOffset=n,e.pointLightsOffset=r,e.lightProbesOffset=s,e.lightPicker=this._pLightPicker,e.diffuseMethod=this._diffuseMethod,e.ambientMethod=this._ambientMethod,e.normalMethod=this._normalMethod,e.specularMethod=this._specularMethod,this._nonCasterLightPasses.push(e),n+=e.iNumDirectionalLights,r+=e.iNumPointLights,s+=e.iNumLightProbes},t.prototype.removeNonCasterLightPasses=function(){if(this._nonCasterLightPasses){for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pRemoveScreenPass(this._nonCasterLightPasses[e]);this._nonCasterLightPasses=null}},t.prototype.removeEffectPass=function(){this._screenPass.ambientMethod!=this._ambientMethod&&this._screenPass.ambientMethod.dispose(),this._screenPass.diffuseMethod!=this._diffuseMethod&&this._screenPass.diffuseMethod.dispose(),this._screenPass.specularMethod!=this._specularMethod&&this._screenPass.specularMethod.dispose(),this._screenPass.normalMethod!=this._normalMethod&&this._screenPass.normalMethod.dispose(),this._pRemoveScreenPass(this._screenPass),this._screenPass=null},t.prototype.initEffectPass=function(){null==this._screenPass&&(this._screenPass=new g),this._materialMode==p.SINGLE_PASS?(this._screenPass.ambientMethod=this._ambientMethod,this._screenPass.diffuseMethod=this._diffuseMethod,this._screenPass.specularMethod=this._specularMethod,this._screenPass.normalMethod=this._normalMethod,this._screenPass.shadowMethod=this._shadowMethod):this._materialMode==p.MULTI_PASS&&(this._screenPass.ambientMethod=0==this.numLights?this._ambientMethod:null,this._screenPass.preserveAlpha=!1,this._screenPass.normalMethod=this._normalMethod)},Object.defineProperty(t.prototype,"numLights",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights+this._pLightPicker.numCastingDirectionalLights+this._pLightPicker.numCastingPointLights:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numNonCasters",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights:0},enumerable:!0,configurable:!0}),t}(h);t.exports=f},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-core/lib/textures/Texture2DBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":void 0,"awayjs-methodmaterials/lib/TriangleMaterialMode":void 0,"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":void 0,"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":void 0,"awayjs-methodmaterials/lib/methods/NormalBasicMethod":void 0,"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":void 0,"awayjs-methodmaterials/lib/passes/MaterialPassMode":void 0,"awayjs-methodmaterials/lib/passes/TriangleMethodPass":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialBase":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-methodmaterials/lib/data/MethodVO":[function(e,t){var o=function(){function e(e){this.useMethod=!0,this.method=e}return e.prototype.reset=function(){this.method.iReset(),this.texturesIndex=-1,this.vertexConstantsIndex=-1,this.fragmentConstantsIndex=-1,this.needsProjection=!1,this.needsView=!1,this.needsNormals=!1,this.needsTangents=!1,this.needsUV=!1,this.needsSecondaryUV=!1,this.needsGlobalVertexPos=!1,this.needsGlobalFragmentPos=!1},e}();t.exports=o},{}],"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),s=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),a=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase"),h=function(e){function t(){e.call(this),this._color=16777215,this._alpha=1,this._colorR=1,this._colorG=1,this._colorB=1,this._ambient=1}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsUV=Boolean(null!=e.texture)},t.prototype.iInitConstants=function(e,t){t.needsUV||(this._color=e.color,this.updateColor())},Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambient},set:function(e){this._ambient!=e&&(this._ambient=e,this.updateColor())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!=e&&(this._alpha=e,this.updateColor())},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(e){},t.prototype.iGetFragmentCode=function(e,t,o,i,n){var r,a="";if(t.needsUV){if(r=i.getFreeTextureReg(),t.texturesIndex=r.index,a+=s.getTex2DSampleCode(o,n,r,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping),e.alphaThreshold>0){var h=i.getFreeFragmentConstant();t.fragmentConstantsIndex=4*h.index,a+="sub "+o+".w, "+o+".w, "+h+".x\nkil "+o+".w\nadd "+o+".w, "+o+".w, "+h+".x\n"}}else r=i.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*r.index,a+="mov "+o+", "+r+"\n";return a},t.prototype.iActivate=function(e,t,o){if(t.needsUV)o.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?n.LINEAR:n.NEAREST,e.useMipmapping?i.MIPLINEAR:i.MIPNONE),o.activateTexture(t.texturesIndex,e.texture),e.alphaThreshold>0&&(e.fragmentConstantData[t.fragmentConstantsIndex]=e.alphaThreshold);else{var s=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[s]=this._colorR,a[s+1]=this._colorG,a[s+2]=this._colorB,a[s+3]=this._alpha}},t.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._ambient,this._colorG=(this._color>>8&255)/255*this._ambient,this._colorB=(255&this._color)/255*this._ambient},t}(a);t.exports=h},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/AmbientBasicMethod"),r=function(e){function t(t){e.call(this),this._cubeTexture=t}return o(t,e),t.prototype.iInitVO=function(t,o){e.prototype.iInitVO.call(this,t,o),o.needsNormals=!0},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i),i.activateCubeTexture(o.texturesIndex,this._cubeTexture)},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s,a="",h=n.getFreeTextureReg();return t.texturesIndex=h.index,a+=i.getTexCubeSampleCode(o,h,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,r.normalFragment),s=n.getFreeFragmentConstant(),t.fragmentConstantsIndex=s.index,a+="add "+o+".xyz, "+o+".xyz, "+s+".xyz\n"},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),s=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),a=e("awayjs-methodmaterials/lib/methods/LightingMethodBase"),h=function(e){function t(){e.call(this),this._multiply=!0,this._diffuseColor=16777215,this._ambientColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._ambientR=1,this._ambientG=1,this._ambientB=1}return o(t,e),t.prototype.iIsUsed=function(e){return e.numLights?!0:!1},Object.defineProperty(t.prototype,"multiply",{get:function(){return this._multiply},set:function(e){this._multiply!=e&&(this._multiply=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture,t.needsNormals=e.numLights>0},t.prototype.generateMip=function(e){this._pUseTexture&&e.activateTexture(0,this._texture)},Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor!=e&&(this._diffuseColor=e,this.updateDiffuse())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(e){this._ambientColor!=e&&(this._ambientColor=e,this.updateAmbient())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._pUseTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._texture=null},t.prototype.copyFrom=function(e){var t=e;this.texture=t.texture,this.multiply=t.multiply,this.diffuseColor=t.diffuseColor,this.ambientColor=t.ambientColor},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pTotalLightColorReg=null,this._pDiffuseInputRegister=null},t.prototype.iGetFragmentPreLightingCode=function(e,t,o){var i="";return this._pIsFirstLight=!0,this._pTotalLightColorReg=o.getFreeFragmentVectorTemp(),o.addFragmentTempUsages(this._pTotalLightColorReg,1),i},t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){var s,a="";return this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1)),a+="dp3 "+s+".x, "+o+", "+r.normalFragment+"\nmax "+s+".w, "+s+".x, "+r.commons+".y\n",e.usesLightFallOff&&(a+="mul "+s+".w, "+s+".w, "+o+".w\n"),null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,s,n,r)),a+="mul "+s+", "+s+".w, "+i+"\n",this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t.prototype.iGetFragmentCodePerProbe=function(e,t,o,i,n,r){var s,a="";return this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1)),a+="tex "+s+", "+r.normalFragment+", "+o+" <cube,linear,miplinear>\nmul "+s+".xyz, "+s+".xyz, "+i+"\n",null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,s,n,r)),this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t.prototype.iGetFragmentPostLightingCode=function(e,t,o,i,n){var r,a="";n.shadowTarget&&(a+=this.pApplyShadow(e,t,i,n)),r=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(r,1);var h=i.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*h.index,this._pUseTexture?(this._pDiffuseInputRegister=i.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,a+=s.getTex2DSampleCode(r,n,this._pDiffuseInputRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)):(this._pDiffuseInputRegister=i.getFreeFragmentConstant(),a+="mov "+r+", "+this._pDiffuseInputRegister+"\n"),a+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\nmul "+r+".xyz, "+r+", "+this._pTotalLightColorReg+"\n",a+=this._multiply?"add "+r+".xyz, "+r+", "+h+"\nmul "+o+".xyz, "+o+", "+r+"\n":"mul "+o+".xyz, "+o+", "+h+"\nmul "+this._pTotalLightColorReg+".xyz, "+o+", "+this._pTotalLightColorReg+"\nsub "+o+".xyz, "+o+", "+this._pTotalLightColorReg+"\nadd "+o+".xyz, "+o+", "+r+"\n",i.removeFragmentTempUsage(this._pTotalLightColorReg),i.removeFragmentTempUsage(r),a},t.prototype.pApplyShadow=function(e,t,o,i){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+i.shadowTarget+".w\n"},t.prototype.iActivate=function(e,t,o){if(this._pUseTexture)o.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?n.LINEAR:n.NEAREST,e.useMipmapping?i.MIPLINEAR:i.MIPNONE),o.activateTexture(t.texturesIndex,this._texture);else{var s=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[s+4]=this._diffuseR,a[s+5]=this._diffuseG,a[s+6]=this._diffuseB,a[s+7]=1}},t.prototype.updateDiffuse=function(){this._diffuseR=(this._diffuseColor>>16&255)/255,this._diffuseG=(this._diffuseColor>>8&255)/255,this._diffuseB=(255&this._diffuseColor)/255},t.prototype.updateAmbient=function(){this._ambientR=(this._ambientColor>>16&255)/255,this._ambientG=(this._ambientColor>>8&255)/255,this._ambientB=(255&this._ambientColor)/255},t.prototype.iSetRenderState=function(e,t){if(e.numLights>0){var o=t.fragmentConstantsIndex,i=e.fragmentConstantData;i[o]=e.ambientR*this._ambientR,i[o+1]=e.ambientG*this._ambientG,i[o+2]=e.ambientB*this._ambientB,i[o+3]=1}},t}(a);t.exports=h},{"awayjs-methodmaterials/lib/methods/LightingMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseCelMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod"),n=function(e){function t(t,o){var i=this;void 0===t&&(t=3),void 0===o&&(o=null),e.call(this,null,o),this._smoothness=.1,this.baseMethod._iModulateMethod=function(e,t,o,n,r){return i.clampDiffuse(e,t,o,n,r)},this._levels=t}return o(t,e),t.prototype.iInitConstants=function(t,o){var i=t.fragmentConstantData,n=o.secondaryFragmentConstantsIndex;e.prototype.iInitConstants.call(this,t,o),i[n+1]=1,i[n+2]=0},Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},set:function(e){this._levels=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},t.prototype.iGetFragmentPreLightingCode=function(t,o,i,n){return this._dataReg=i.getFreeFragmentConstant(),o.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,o,i,n)},t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=t.fragmentConstantData,r=o.secondaryFragmentConstantsIndex;n[r]=this._levels,n[r+3]=this._smoothness},t.prototype.clampDiffuse=function(e,t,o){return"mul "+o+".w, "+o+".w, "+this._dataReg+".x\nfrc "+o+".z, "+o+".w\nsub "+o+".y, "+o+".w, "+o+".z\nmov "+o+".x, "+this._dataReg+".x\nsub "+o+".x, "+o+".x, "+this._dataReg+".y\nrcp "+o+".x,"+o+".x\nmul "+o+".w, "+o+".y, "+o+".x\nsub "+o+".y, "+o+".w, "+o+".x\ndiv "+o+".z, "+o+".z, "+this._dataReg+".w\nsat "+o+".z, "+o+".z\nmul "+o+".w, "+o+".w, "+o+".z\nsub "+o+".z, "+this._dataReg+".y, "+o+".z\nmul "+o+".y, "+o+".y, "+o+".z\nadd "+o+".w, "+o+".w, "+o+".y\nsat "+o+".w, "+o+".w\n"},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),n=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"),r=function(e){function t(t,o){var r=this;void 0===o&&(o=null),e.call(this),this._onShaderInvalidatedDelegate=function(e){return r.onShaderInvalidated(e)},this.pBaseMethod=o||new n,this.pBaseMethod._iModulateMethod=t,this.pBaseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return o(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(e){this.pBaseMethod!=e&&(this.pBaseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod=e,this.pBaseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){this.pBaseMethod.iInitVO(e,t)},t.prototype.iInitConstants=function(e,t){this.pBaseMethod.iInitConstants(e,t)},t.prototype.dispose=function(){this.pBaseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod.dispose()},Object.defineProperty(t.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(e){this.pBaseMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this.pBaseMethod.diffuseColor},set:function(e){this.pBaseMethod.diffuseColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this.pBaseMethod.ambientColor},set:function(e){this.pBaseMethod.ambientColor=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentPreLightingCode=function(e,t,o,i){return this.pBaseMethod.iGetFragmentPreLightingCode(e,t,o,i)},t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){var s=this.pBaseMethod.iGetFragmentCodePerLight(e,t,o,i,n,r);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,s},t.prototype.iGetFragmentCodePerProbe=function(e,t,o,i,n,r){var s=this.pBaseMethod.iGetFragmentCodePerProbe(e,t,o,i,n,r);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,s},t.prototype.iActivate=function(e,t,o){this.pBaseMethod.iActivate(e,t,o)},t.prototype.iSetRenderState=function(e,t,o,i,n){this.pBaseMethod.iSetRenderState(e,t,o,i,n)},t.prototype.iDeactivate=function(e,t,o){this.pBaseMethod.iDeactivate(e,t,o)},t.prototype.iGetVertexCode=function(e,t,o,i){return this.pBaseMethod.iGetVertexCode(e,t,o,i)},t.prototype.iGetFragmentPostLightingCode=function(e,t,o,i,n){return this.pBaseMethod.iGetFragmentPostLightingCode(e,t,o,i,n)},t.prototype.iReset=function(){this.pBaseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this.pBaseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"),r=function(e){function t(){e.call(this)}return o(t,e),t.prototype.iInitConstants=function(e,t){var o=e.fragmentConstantData,i=t.fragmentConstantsIndex;o[i]=1,o[i+1]=1/255,o[i+2]=1/65025,o[i+3]=1/16581375},t.prototype.iGetFragmentPostLightingCode=function(e,t,o,n,r){var s,a,h="";if(!this._pUseTexture)throw new Error("DiffuseDepthMethod requires texture!");return e.numLights>0&&(r.shadowTarget&&(h+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+r.shadowTarget+".w\n"),h+="add "+o+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\nsat "+o+".xyz, "+o+".xyz\n",n.removeFragmentTempUsage(this._pTotalLightColorReg)),s=e.numLights>0?n.getFreeFragmentVectorTemp():o,this._pDiffuseInputRegister=n.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,a=n.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*a.index,h+=i.getTex2DSampleCode(s,r,this._pDiffuseInputRegister,this.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"dp4 "+s+".x, "+s+", "+a+"\nmov "+s+".yz, "+s+".xx			\nmov "+s+".w, "+a+".x\nsub "+s+".xyz, "+a+".xxx, "+s+".xyz\n",0==e.numLights?h:h+="mul "+o+".xyz, "+s+".xyz, "+o+".xyz\nmov "+o+".w, "+s+".w\n"},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"),r=function(e){function t(t){e.call(this),this._gradient=t}return o(t,e),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._gradient},set:function(e){(e.hasMipmaps!=this._gradient.hasMipmaps||e.format!=this._gradient.format)&&this.iInvalidateShaderProgram(),this._gradient=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._gradientTextureRegister=null
},t.prototype.iGetFragmentPreLightingCode=function(t,o,i,n){var r=e.prototype.iGetFragmentPreLightingCode.call(this,t,o,i,n);return this._pIsFirstLight=!0,t.numLights>0&&(this._gradientTextureRegister=i.getFreeTextureReg(),o.secondaryTexturesIndex=this._gradientTextureRegister.index),r},t.prototype.iGetFragmentCodePerLight=function(e,t,o,n,r,s){var a,h="";return this._pIsFirstLight?a=this._pTotalLightColorReg:(a=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(a,1)),h+="dp3 "+a+".w, "+o+".xyz, "+s.normalFragment+".xyz\nmul "+a+".w, "+a+".w, "+s.commons+".x\nadd "+a+".w, "+a+".w, "+s.commons+".x\nmul "+a+".xyz, "+a+".w, "+o+".w\n",null!=this._iModulateMethod&&(h+=this._iModulateMethod(e,t,a,r,s)),h+=i.getTex2DSampleCode(a,s,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,a,"clamp")+"mul "+a+".xyz, "+a+".xyz, "+n+".xyz\n",this._pIsFirstLight||(h+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+a+".xyz\n",r.removeFragmentTempUsage(a)),this._pIsFirstLight=!1,h},t.prototype.pApplyShadow=function(e,t,o,n){var r=o.getFreeFragmentVectorTemp();return"mov "+r+", "+n.shadowTarget+".wwww\n"+i.getTex2DSampleCode(r,n,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,r,"clamp")+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r+"\n"},t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i),i.activateTexture(o.secondaryTexturesIndex,this._gradient)},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod"),r=function(e){function t(t,o,i,n){void 0===o&&(o="multiply"),void 0===i&&(i=!1),void 0===n&&(n=null),e.call(this,null,n),this._useSecondaryUV=i,this._lightMapTexture=t,this.blendMode=o}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightMapTexture",{get:function(){return this._lightMapTexture},set:function(e){this._lightMapTexture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,o,i){i.activateTexture(o.secondaryTexturesIndex,this._lightMapTexture),e.prototype.iActivate.call(this,t,o,i)},t.prototype.iGetFragmentPostLightingCode=function(o,n,r,s,a){var h,p=s.getFreeTextureReg(),d=s.getFreeFragmentVectorTemp();switch(n.secondaryTexturesIndex=p.index,h=i.getTex2DSampleCode(d,a,p,this._lightMapTexture,o.useSmoothTextures,o.repeatTextures,o.useMipmapping,a.secondaryUVVarying),this._blendMode){case t.MULTIPLY:h+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+d+"\n";break;case t.ADD:h+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+d+"\n"}return h+=e.prototype.iGetFragmentPostLightingCode.call(this,o,n,r,s,a)},t.MULTIPLY="multiply",t.ADD="add",t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod"),n=e("awayjs-methodmaterials/lib/passes/SingleObjectDepthPass"),r=function(e){function t(t,o,i){var r=this;void 0===t&&(t=512),void 0===o&&(o=15),void 0===i&&(i=null),e.call(this,null,i),this._translucency=1,this._scatterColor=16777215,this._scatterR=1,this._scatterG=1,this._scatterB=1,this.pBaseMethod._iModulateMethod=function(e,t,o,i,n){return r.scatterLight(e,t,o,i,n)},this._depthPass=new n,this._depthPass.textureSize=t,this._depthPass.polyOffset=o,this._scattering=.2,this._translucency=1}return o(t,e),t.prototype.iInitConstants=function(t,o){e.prototype.iInitConstants.call(this,t,o);var i=t.vertexConstantData,n=o.secondaryVertexConstantsIndex;i[n]=.5,i[n+1]=-.5,i[n+2]=0,i[n+3]=1,i=t.fragmentConstantData,n=o.secondaryFragmentConstantsIndex,i[n+3]=1,i[n+4]=1,i[n+5]=1/255,i[n+6]=1/65025,i[n+7]=1/16581375,i[n+10]=.5,i[n+11]=-.1},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._lightProjVarying=null,this._propReg=null,this._lightColorReg=null,this._colorReg=null,this._decReg=null,this._targetReg=null},Object.defineProperty(t.prototype,"scattering",{get:function(){return this._scattering},set:function(e){this._scattering=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translucency",{get:function(){return this._translucency},set:function(e){this._translucency=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(e){this._scatterColor=e,this._scatterR=(e>>16&255)/255,this._scatterG=(e>>8&255)/255,this._scatterB=(255&e)/255},enumerable:!0,configurable:!0}),t.prototype.iGetVertexCode=function(t,o,i,n){var r,s,a=e.prototype.iGetVertexCode.call(this,t,o,i,n),h=i.getFreeVertexVectorTemp();return s=i.getFreeVertexConstant(),o.secondaryVertexConstantsIndex=4*s.index,this._lightProjVarying=i.getFreeVarying(),r=i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),a+="m44 "+h+", vt0, "+r+"\ndiv "+h+".xyz, "+h+".xyz, "+h+".w\nmul "+h+".xy, "+h+".xy, "+s+".xy\nadd "+h+".xy, "+h+".xy, "+s+".xx\nmov "+this._lightProjVarying+".xyz, "+h+".xyz\nmov "+this._lightProjVarying+".w, va0.w\n"},t.prototype.iGetFragmentPreLightingCode=function(t,o,i,n){return this._colorReg=i.getFreeFragmentConstant(),this._decReg=i.getFreeFragmentConstant(),this._propReg=i.getFreeFragmentConstant(),o.secondaryFragmentConstantsIndex=4*this._colorReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,o,i,n)},t.prototype.iGetFragmentCodePerLight=function(t,o,i,n,r,s){return this._pIsFirstLight=!0,this._lightColorReg=n,e.prototype.iGetFragmentCodePerLight.call(this,t,o,i,n,r,s)},t.prototype.iGetFragmentPostLightingCode=function(t,o,i,n,r){var s=e.prototype.iGetFragmentPostLightingCode.call(this,t,o,i,n,r),a=n.getFreeFragmentVectorTemp();return s+="mul "+a+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\nmul "+a+".xyz, "+a+".xyz, "+this._colorReg+".xyz\nadd "+i+".xyz, "+i+".xyz, "+a+".xyz\n",this._targetReg!=r.viewDirFragment&&n.removeFragmentTempUsage(i),s},t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=o.secondaryFragmentConstantsIndex,r=t.fragmentConstantData;r[n]=this._scatterR,r[n+1]=this._scatterG,r[n+2]=this._scatterB,r[n+8]=this._scattering,r[n+9]=this._translucency},t.prototype.iSetRenderState=function(e,t,o,i){i.activateTexture(t.secondaryTexturesIndex,this._depthPass._iGetDepthMap(o)),this._depthPass._iGetProjection(o).copyRawDataTo(e.vertexConstantData,t.secondaryVertexConstantsIndex+4,!0)},t.prototype.scatterLight=function(e,t,o,i,n){if(!this._pIsFirstLight)return"";this._pIsFirstLight=!1;var r="",s=i.getFreeTextureReg();n.viewDirFragment?this._targetReg=n.viewDirFragment:(this._targetReg=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._targetReg,1)),t.secondaryTexturesIndex=s.index;var a=i.getFreeFragmentVectorTemp();return r+="tex "+a+", "+this._lightProjVarying+", "+s+" <2d,nearest,clamp>\ndp4 "+o+".z, "+a+", "+this._decReg+"\n",r+="sub "+o+".z, "+this._lightProjVarying+".z, "+o+".z\nsub "+o+".z, "+this._propReg+".x, "+o+".z\nmul "+o+".z, "+this._propReg+".y, "+o+".z\nsat "+o+".z, "+o+".z\nneg "+o+".y, "+o+".x\nmul "+o+".y, "+o+".y, "+this._propReg+".z\nadd "+o+".y, "+o+".y, "+this._propReg+".z\nmul "+this._targetReg+".w, "+o+".z, "+o+".y\nsub "+o+".y, "+this._colorReg+".w, "+this._targetReg+".w\nmul "+o+".w, "+o+".w, "+o+".y\n"},t}(i);t.exports=r},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":void 0,"awayjs-methodmaterials/lib/passes/SingleObjectDepthPass":void 0}],"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"),n=function(e){function t(t){void 0===t&&(t=.5),e.call(this),this.wrapFactor=t}return o(t,e),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._wrapDataRegister=null},Object.defineProperty(t.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(e){this._wrapFactor=e,this._wrapFactor=1/(e+1)},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentPreLightingCode=function(t,o,i,n){var r=e.prototype.iGetFragmentPreLightingCode.call(this,t,o,i,n);return this._pIsFirstLight=!0,this._wrapDataRegister=i.getFreeFragmentConstant(),o.secondaryFragmentConstantsIndex=4*this._wrapDataRegister.index,r},t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){var s,a="";return this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1)),a+="dp3 "+s+".x, "+o+".xyz, "+r.normalFragment+".xyz\nadd "+s+".y, "+s+".x, "+this._wrapDataRegister+".x\nmul "+s+".y, "+s+".y, "+this._wrapDataRegister+".y\nsat "+s+".w, "+s+".y\nmul "+s+".xz, "+s+".w, "+o+".wz\n",null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,o,n,r)),a+="mul "+s+", "+s+".x, "+i+"\n",this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s+".xyz\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=o.secondaryFragmentConstantsIndex,r=t.fragmentConstantData;r[n]=this._wrapFactor,r[n+1]=1/(this._wrapFactor+1)},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":void 0}],"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),r=function(e){function t(t,o){void 0===o&&(o=!1),e.call(this),this._texture=t,this._useSecondaryUV=o}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(t.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(e){this._useSecondaryUV!=e&&(this._useSecondaryUV=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,o){o.activateTexture(t.texturesIndex,this._texture)},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s=n.getFreeTextureReg(),a=n.getFreeFragmentVectorTemp(),h=this._useSecondaryUV?r.secondaryUVVarying:r.uvVarying;return t.texturesIndex=s.index,i.getTex2DSampleCode(a,r,s,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,h)+"mul "+o+", "+o+", "+a+".x\n"},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),n=function(e){function t(t){if(e.call(this),20!=t.length)throw new Error("Matrix length must be 20!");this._matrix=t}return o(t,e),Object.defineProperty(t.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(e){this._matrix=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,o,i){var n="",r=i.getFreeFragmentConstant();i.getFreeFragmentConstant(),i.getFreeFragmentConstant(),i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();t.fragmentConstantsIndex=4*r.index;var a=i.getFreeFragmentVectorTemp();return n+="m44 "+a+", "+o+", "+r+"\nadd "+o+", "+a+", "+s+"\n"},t.prototype.iActivate=function(e,t){var o=this._matrix,i=t.fragmentConstantsIndex,n=e.fragmentConstantData;n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=o[3],n[i+4]=o[5],n[i+5]=o[6],n[i+6]=o[7],n[i+7]=o[8],n[i+8]=o[10],n[i+9]=o[11],n[i+10]=o[12],n[i+11]=o[13],n[i+12]=o[15],n[i+13]=o[16],n[i+14]=o[17],n[i+15]=o[18],n[i+16]=o[4],n[i+17]=o[9],n[i+18]=o[14],n[i+19]=o[19]},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),n=function(e){function t(){e.call(this)}return o(t,e),Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(e){this._colorTransform=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,o,i){var n="",r=i.getFreeFragmentConstant(),s=i.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*r.index,n+="mul "+o+", "+o+", "+r+"\nadd "+o+", "+o+", "+s+"\n"},t.prototype.iActivate=function(e,t){var o=1/255,i=t.fragmentConstantsIndex,n=e.fragmentConstantData;n[i]=this._colorTransform.redMultiplier,n[i+1]=this._colorTransform.greenMultiplier,n[i+2]=this._colorTransform.blueMultiplier,n[i+3]=this._colorTransform.alphaMultiplier,n[i+4]=this._colorTransform.redOffset*o,n[i+5]=this._colorTransform.greenOffset*o,n[i+6]=this._colorTransform.blueOffset*o,n[i+7]=this._colorTransform.alphaOffset*o},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),r=function(e){function t(t,o){void 0===o&&(o=1),e.call(this),this._cubeTexture=t,this._alpha=o}return o(t,e),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){(e!=this._mask||e&&this._mask&&(e.hasMipmaps!=this._mask.hasMipmaps||e.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=e},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,o){e.fragmentConstantData[t.fragmentConstantsIndex]=this._alpha,o.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&o.activateTexture(t.texturesIndex+1,this._mask)},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s=n.getFreeFragmentConstant(),a=n.getFreeFragmentVectorTemp(),h="",p=n.getFreeTextureReg();t.texturesIndex=p.index,t.fragmentConstantsIndex=4*s.index,n.addFragmentTempUsages(a,1);var d=n.getFreeFragmentVectorTemp();return h+="dp3 "+a+".w, "+r.viewDirFragment+".xyz, "+r.normalFragment+".xyz\nadd "+a+".w, "+a+".w, "+a+".w\nmul "+a+".xyz, "+r.normalFragment+".xyz, "+a+".w\nsub "+a+".xyz, "+a+".xyz, "+r.viewDirFragment+".xyz\n"+i.getTexCubeSampleCode(a,p,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,a)+"sub "+d+".w, "+a+".w, fc0.x\nkil "+d+".w\nsub "+a+", "+a+", "+o+"\n",this._mask&&(h+=i.getTex2DSampleCode(d,r,n.getFreeTextureReg(),this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+a+", "+d+", "+a+"\n"),h+="mul "+a+", "+a+", "+s+".x\nadd "+o+", "+o+", "+a+"\n",n.removeFragmentTempUsage(a),h},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/EffectFogMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),n=function(e){function t(t,o,i){void 0===i&&(i=8421504),e.call(this),this._minDistance=0,this._maxDistance=1e3,this.minDistance=t,this.maxDistance=o,this.fogColor=i}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsProjection=!0},t.prototype.iInitConstants=function(e,t){var o=e.fragmentConstantData,i=t.fragmentConstantsIndex;o[i+3]=1,o[i+6]=0,o[i+7]=0},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},set:function(e){this._minDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._fogColor},set:function(e){this._fogColor=e,this._fogR=(e>>16&255)/255,this._fogG=(e>>8&255)/255,this._fogB=(255&e)/255},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t){var o=e.fragmentConstantData,i=t.fragmentConstantsIndex;o[i]=this._fogR,o[i+1]=this._fogG,o[i+2]=this._fogB,o[i+4]=this._minDistance,o[i+5]=1/(this._maxDistance-this._minDistance)},t.prototype.iGetFragmentCode=function(e,t,o,i,n){var r=i.getFreeFragmentConstant(),s=i.getFreeFragmentConstant(),a=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(a,1);var h=i.getFreeFragmentVectorTemp(),p="";return t.fragmentConstantsIndex=4*r.index,p+="sub "+h+".w, "+n.projectionFragment+".z, "+s+".x\nmul "+h+".w, "+h+".w, "+s+".y\nsat "+h+".w, "+h+".w\nsub "+a+", "+r+", "+o+"\nmul "+a+", "+a+", "+h+".w\nadd "+o+", "+o+", "+a+"\n",i.removeFragmentTempUsage(a),p},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),r=function(e){function t(t,o){void 0===o&&(o=1),e.call(this),this._fresnelPower=5,this._normalReflectance=0,this._cubeTexture=t,this._alpha=o}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1},Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){(Boolean(e)!=Boolean(this._mask)||e&&this._mask&&(e.hasMipmaps!=this._mask.hasMipmaps||e.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,o){var i=e.fragmentConstantData,n=t.fragmentConstantsIndex;i[n]=this._alpha,i[n+1]=this._normalReflectance,i[n+2]=this._fresnelPower,o.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&o.activateTexture(t.texturesIndex+1,this._mask)},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s=n.getFreeFragmentConstant(),a=n.getFreeFragmentVectorTemp(),h="",p=n.getFreeTextureReg(),d=r.viewDirFragment,l=r.normalFragment;t.texturesIndex=p.index,t.fragmentConstantsIndex=4*s.index,n.addFragmentTempUsages(a,1);var u=n.getFreeFragmentVectorTemp();if(h+="dp3 "+a+".w, "+d+".xyz, "+l+".xyz\nadd "+a+".w, "+a+".w, "+a+".w\nmul "+a+".xyz, "+l+".xyz, "+a+".w\nsub "+a+".xyz, "+a+".xyz, "+d+".xyz\n"+i.getTexCubeSampleCode(a,p,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,a)+"sub "+u+".w, "+a+".w, fc0.x\nkil "+u+".w\nsub "+a+", "+a+", "+o+"\n",h+="dp3 "+d+".w, "+d+".xyz, "+l+".xyz\nsub "+d+".w, "+s+".w, "+d+".w\npow "+d+".w, "+d+".w, "+s+".z\nsub "+l+".w, "+s+".w, "+d+".w\nmul "+l+".w, "+s+".y, "+l+".w\nadd "+d+".w, "+d+".w, "+l+".w\nmul "+d+".w, "+s+".x, "+d+".w\n",this._mask){var c=n.getFreeTextureReg();h+=i.getTex2DSampleCode(u,r,c,this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+d+".w, "+u+".x, "+d+".w\n"}return h+="mul "+a+", "+a+", "+d+".w\nadd "+o+", "+o+", "+a+"\n",n.removeFragmentTempUsage(a),h},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/EffectLightMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),r=function(e){function t(t,o,i){void 0===o&&(o="multiply"),void 0===i&&(i=!1),e.call(this),this._useSecondaryUV=i,this._texture=t,this.blendMode=o}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsUV=!this._useSecondaryUV,t.needsSecondaryUV=this._useSecondaryUV},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format)&&this.iInvalidateShaderProgram(),this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,o,i){i.activateTexture(o.texturesIndex,this._texture),e.prototype.iActivate.call(this,t,o,i)},t.prototype.iGetFragmentCode=function(e,o,n,r,s){var a,h=r.getFreeTextureReg(),p=r.getFreeFragmentVectorTemp();switch(o.texturesIndex=h.index,a=i.getTex2DSampleCode(p,s,h,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,this._useSecondaryUV?s.secondaryUVVarying:s.uvVarying),this._blendMode){case t.MULTIPLY:a+="mul "+n+", "+n+", "+p+"\n";break;case t.ADD:a+="add "+n+", "+n+", "+p+"\n"}return a},t.MULTIPLY="multiply",t.ADD="add",t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/EffectMethodBase":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/library/AssetType"),n=e("awayjs-core/lib/errors/AbstractMethodError"),r=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase"),s=function(e){function t(){e.call(this)}return o(t,e),Object.defineProperty(t.prototype,"assetType",{get:function(){return i.EFFECTS_METHOD},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(){throw new n},t}(r);t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),r=function(e){function t(t,o,i,n,r){void 0===o&&(o=.1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),e.call(this),this._dispersionR=0,this._dispersionG=0,this._dispersionB=0,this._alpha=1,this._envMap=t,this._dispersionR=i,this._dispersionG=n,this._dispersionB=r,this._useDispersion=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG),this._refractionIndex=o}return o(t,e),t.prototype.iInitConstants=function(e,t){var o=t.fragmentConstantsIndex,i=e.fragmentConstantData;i[o+4]=1,i[o+5]=0,i[o+7]=1},t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._envMap},set:function(e){this._envMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(e){this._refractionIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(e){this._dispersionR=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(e){this._dispersionG=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(e){this._dispersionB=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,o){var i=t.fragmentConstantsIndex,n=e.fragmentConstantData;n[i]=this._dispersionR+this._refractionIndex,this._useDispersion&&(n[i+1]=this._dispersionG+this._refractionIndex,n[i+2]=this._dispersionB+this._refractionIndex),n[i+3]=this._alpha,o.activateCubeTexture(t.texturesIndex,this._envMap)},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s,a,h,p=n.getFreeFragmentConstant(),d=n.getFreeFragmentConstant(),l="",u=n.getFreeTextureReg();t.texturesIndex=u.index,t.fragmentConstantsIndex=4*p.index,s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1),a=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(a,1),h=n.getFreeFragmentVectorTemp();var c=r.viewDirFragment,m=r.normalFragment;return l+="neg "+c+".xyz, "+c+".xyz\n",l+="dp3 "+h+".x, "+c+".xyz, "+m+".xyz\nmul "+h+".w, "+h+".x, "+h+".x\nsub "+h+".w, "+d+".x, "+h+".w\nmul "+h+".w, "+p+".x, "+h+".w\nmul "+h+".w, "+p+".x, "+h+".w\nsub "+h+".w, "+d+".x, "+h+".w\nsqt "+h+".y, "+h+".w\nmul "+h+".x, "+p+".x, "+h+".x\nadd "+h+".x, "+h+".x, "+h+".y\nmul "+h+".xyz, "+h+".x, "+m+".xyz\nmul "+s+", "+p+".x, "+c+"\nsub "+s+".xyz, "+s+".xyz, "+h+".xyz\nnrm "+s+".xyz, "+s+".xyz\n",l+=i.getTexCubeSampleCode(a,u,this._envMap,e.useSmoothTextures,e.useMipmapping,s)+"sub "+a+".w, "+a+".w, fc0.x	\nkil "+a+".w\n",this._useDispersion&&(l+="dp3 "+h+".x, "+c+".xyz, "+m+".xyz\nmul "+h+".w, "+h+".x, "+h+".x\nsub "+h+".w, "+d+".x, "+h+".w\nmul "+h+".w, "+p+".y, "+h+".w\nmul "+h+".w, "+p+".y, "+h+".w\nsub "+h+".w, "+d+".x, "+h+".w\nsqt "+h+".y, "+h+".w\nmul "+h+".x, "+p+".y, "+h+".x\nadd "+h+".x, "+h+".x, "+h+".y\nmul "+h+".xyz, "+h+".x, "+m+".xyz\nmul "+s+", "+p+".y, "+c+"\nsub "+s+".xyz, "+s+".xyz, "+h+".xyz\nnrm "+s+".xyz, "+s+".xyz\n",l+=i.getTexCubeSampleCode(h,u,this._envMap,e.useSmoothTextures,e.useMipmapping,s)+"mov "+a+".y, "+h+".y\n",l+="dp3 "+h+".x, "+c+".xyz, "+m+".xyz\nmul "+h+".w, "+h+".x, "+h+".x\nsub "+h+".w, "+d+".x, "+h+".w\nmul "+h+".w, "+p+".z, "+h+".w\nmul "+h+".w, "+p+".z, "+h+".w\nsub "+h+".w, "+d+".x, "+h+".w\nsqt "+h+".y, "+h+".w\nmul "+h+".x, "+p+".z, "+h+".x\nadd "+h+".x, "+h+".x, "+h+".y\nmul "+h+".xyz, "+h+".x, "+m+".xyz\nmul "+s+", "+p+".z, "+c+"\nsub "+s+".xyz, "+s+".xyz, "+h+".xyz\nnrm "+s+".xyz, "+s+".xyz\n",l+=i.getTexCubeSampleCode(h,u,this._envMap,e.useSmoothTextures,e.useMipmapping,s)+"mov "+a+".z, "+h+".z\n"),n.removeFragmentTempUsage(s),l+="sub "+a+".xyz, "+a+".xyz, "+o+".xyz\nmul "+a+".xyz, "+a+".xyz, "+p+".w\nadd "+o+".xyz, "+o+".xyz, "+a+".xyz\n",n.removeFragmentTempUsage(a),l+="neg "+c+".xyz, "+c+".xyz\n"},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/EffectRimLightMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/EffectMethodBase"),n=function(e){function t(t,o,i,n){void 0===t&&(t=16777215),void 0===o&&(o=.4),void 0===i&&(i=2),void 0===n&&(n="mix"),e.call(this),this._blendMode=n,this._strength=o,this._power=i,this.color=t}return o(t,e),t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1},t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this._colorR=(e>>16&255)/255,this._colorG=(e>>8&255)/255,this._colorB=(255&e)/255},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._strength},set:function(e){this._strength=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._power},set:function(e){this._power=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t){var o=t.fragmentConstantsIndex,i=e.fragmentConstantData;i[o]=this._colorR,i[o+1]=this._colorG,i[o+2]=this._colorB,i[o+4]=this._strength,i[o+5]=this._power},t.prototype.iGetFragmentCode=function(e,o,i,n,r){var s=n.getFreeFragmentConstant(),a=n.getFreeFragmentConstant(),h=n.getFreeFragmentVectorTemp(),p="";return o.fragmentConstantsIndex=4*s.index,p+="dp3 "+h+".x, "+r.viewDirFragment+".xyz, "+r.normalFragment+".xyz\nsat "+h+".x, "+h+".x\nsub "+h+".x, "+s+".w, "+h+".x\npow "+h+".x, "+h+".x, "+a+".y\nmul "+h+".x, "+h+".x, "+a+".x\nsub "+h+".x, "+s+".w, "+h+".x\nmul "+i+".xyz, "+i+".xyz, "+h+".x\nsub "+h+".w, "+s+".w, "+h+".x\n",p+=this._blendMode==t.ADD?"mul "+h+".xyz, "+h+".w, "+s+".xyz\nadd "+i+".xyz, "+i+".xyz, "+h+".xyz\n":this._blendMode==t.MULTIPLY?"mul "+h+".xyz, "+h+".w, "+s+".xyz\nmul "+i+".xyz, "+i+".xyz, "+h+".xyz\n":"sub "+h+".xyz, "+s+".xyz, "+i+".xyz\nmul "+h+".xyz, "+h+".xyz, "+h+".w\nadd "+i+".xyz, "+i+".xyz, "+h+".xyz\n"
},t.ADD="add",t.MULTIPLY="multiply",t.MIX="mix",t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/LightingMethodBase":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase"),n=function(e){function t(){e.call(this)}return o(t,e),t.prototype.iGetFragmentPreLightingCode=function(){return""},t.prototype.iGetFragmentCodePerLight=function(){return""},t.prototype.iGetFragmentCodePerProbe=function(){return""},t.prototype.iGetFragmentPostLightingCode=function(){return""},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/NormalBasicMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),s=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),a=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase"),h=function(e){function t(){e.call(this)}return o(t,e),t.prototype.iIsUsed=function(e){return this._useTexture&&e.normalDependencies?!0:!1},t.prototype.iInitVO=function(e,t){t.needsUV=this._useTexture},t.prototype.iOutputsTangentNormals=function(){return!0},t.prototype.copyFrom=function(e){var t=e;null!=t.normalMap&&(this.normalMap=t.normalMap)},Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._useTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._useTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pNormalTextureRegister=null},t.prototype.dispose=function(){this._texture&&(this._texture=null)},t.prototype.iActivate=function(e,t,o){t.texturesIndex>=0&&(o.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?n.LINEAR:n.NEAREST,e.useMipmapping?i.MIPLINEAR:i.MIPNONE),o.activateTexture(t.texturesIndex,this._texture))},t.prototype.iGetFragmentCode=function(e,t,o,i,n){return this._pNormalTextureRegister=i.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,s.getTex2DSampleCode(o,n,this._pNormalTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"sub "+o+".xyz, "+o+".xyz, "+n.commons+".xxx\nnrm "+o+".xyz, "+o+"\n"},t}(a);t.exports=h},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-methodmaterials/lib/methods/NormalHeightMapMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/NormalBasicMethod"),r=function(e){function t(t,o,i,n){e.call(this),this.normalMap=t,this._worldXYRatio=o/i,this._worldXZRatio=n/i}return o(t,e),t.prototype.iInitConstants=function(e,t){var o=t.fragmentConstantsIndex,i=e.fragmentConstantData;i[o]=1/this.normalMap.width,i[o+1]=1/this.normalMap.height,i[o+2]=0,i[o+3]=1,i[o+4]=this._worldXYRatio,i[o+5]=this._worldXZRatio},Object.defineProperty(t.prototype,"tangentSpace",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(t){e.prototype.copyFrom.call(this,t),this._worldXYRatio=t._worldXYRatio,this._worldXZRatio=t._worldXZRatio},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s=n.getFreeFragmentVectorTemp(),a=n.getFreeFragmentConstant(),h=n.getFreeFragmentConstant();return this._pNormalTextureRegister=n.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*a.index,i.getTex2DSampleCode(o,r,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,r.uvVarying,"clamp")+"add "+s+", "+r.uvVarying+", "+a+".xzzz\n"+i.getTex2DSampleCode(s,r,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s,"clamp")+"sub "+o+".x, "+o+".x, "+s+".x\nadd "+s+", "+r.uvVarying+", "+a+".zyzz\n"+i.getTex2DSampleCode(s,r,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s,"clamp")+"sub "+o+".z, "+o+".z, "+s+".x\nmov "+o+".y, "+a+".w\nmul "+o+".xz, "+o+".xz, "+h+".xy\nnrm "+o+".xyz, "+o+".xyz\n"},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/NormalBasicMethod":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),n=e("awayjs-methodmaterials/lib/methods/NormalBasicMethod"),r=function(e){function t(t,o){e.call(this),this._useSecondNormalMap=!1,this._water1OffsetX=0,this._water1OffsetY=0,this._water2OffsetX=0,this._water2OffsetY=0,this.normalMap=t,this.secondaryNormalMap=o}return o(t,e),t.prototype.iInitConstants=function(e,t){var o=t.fragmentConstantsIndex,i=e.fragmentConstantData;i[o]=.5,i[o+1]=0,i[o+2]=0,i[o+3]=1},t.prototype.iInitVO=function(t,o){e.prototype.iInitVO.call(this,t,o),this._useSecondNormalMap=this.normalMap!=this.secondaryNormalMap},Object.defineProperty(t.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(e){this._water1OffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(e){this._water1OffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(e){this._water2OffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(e){this._water2OffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryNormalMap",{get:function(){return this._texture2},set:function(e){this._texture2=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._normalTextureRegister2=null},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._texture2=null},t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=t.fragmentConstantData,r=o.fragmentConstantsIndex;n[r+4]=this._water1OffsetX,n[r+5]=this._water1OffsetY,n[r+6]=this._water2OffsetX,n[r+7]=this._water2OffsetY,this._useSecondNormalMap&&i.activateTexture(o.texturesIndex+1,this._texture2)},t.prototype.iGetFragmentCode=function(e,t,o,n,r){var s=n.getFreeFragmentVectorTemp(),a=n.getFreeFragmentConstant(),h=n.getFreeFragmentConstant();return this._pNormalTextureRegister=n.getFreeTextureReg(),this._normalTextureRegister2=this._useSecondNormalMap?n.getFreeTextureReg():this._pNormalTextureRegister,t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*a.index,"add "+s+", "+r.uvVarying+", "+h+".xyxy\n"+i.getTex2DSampleCode(o,r,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s)+"add "+s+", "+r.uvVarying+", "+h+".zwzw\n"+i.getTex2DSampleCode(s,r,this._normalTextureRegister2,this._texture2,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s)+"add "+o+", "+o+", "+s+"		\nmul "+o+", "+o+", "+a+".x	\nsub "+o+".xyz, "+o+".xyz, "+r.commons+".xxx	\nnrm "+o+".xyz, "+o+".xyz							\n"},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/NormalBasicMethod":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0}],"awayjs-methodmaterials/lib/methods/ShadingMethodBase":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/library/NamedAssetBase"),n=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),r=function(e){function t(){e.call(this)}return o(t,e),t.prototype.iIsUsed=function(){return!0},t.prototype.iInitVO=function(){},t.prototype.iInitConstants=function(){},t.prototype.iUsesTangentSpace=function(){return!0},t.prototype.dispose=function(){},t.prototype.iReset=function(){this.iCleanCompilationData()},t.prototype.iCleanCompilationData=function(){},t.prototype.iGetVertexCode=function(){return""},t.prototype.iGetFragmentCode=function(){return null},t.prototype.iActivate=function(){},t.prototype.iSetRenderState=function(){},t.prototype.iDeactivate=function(){},t.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new n(n.SHADER_INVALIDATED))},t.prototype.copyFrom=function(){},t}(i);t.exports=r},{"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0}],"awayjs-methodmaterials/lib/methods/ShadowCascadeMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/events/Event"),n=e("awayjs-display/lib/entities/DirectionalLight"),r=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),s=e("awayjs-methodmaterials/lib/data/MethodVO"),a=e("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase"),h=function(e){function t(t){var o=this;if(e.call(this,t.castingLight),this._baseMethod=t,!(this._pCastingLight instanceof n))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");if(this._cascadeShadowMapper=this._pCastingLight.shadowMapper,!this._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");this._cascadeShadowMapper.addEventListener(i.CHANGE,function(e){return o.onCascadeChange(e)}),this._baseMethod.addEventListener(r.SHADER_INVALIDATED,function(e){return o.onShaderInvalidated(e)})}return o(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){var t=this;this._baseMethod!=e&&(this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)}),this._baseMethod=e,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)}),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){var o=new s(this._baseMethod);this._baseMethod.iInitVO(e,o),t.needsGlobalVertexPos=!0,t.needsProjection=!0},t.prototype.iInitConstants=function(e,t){var o=e.fragmentConstantData,i=e.vertexConstantData,n=t.fragmentConstantsIndex;o[n]=1,o[n+1]=1/255,o[n+2]=1/65025,o[n+3]=1/16581375,o[n+6]=.5,o[n+7]=-.5,n=t.vertexConstantsIndex,i[n]=.5,i[n+1]=-.5,i[n+2]=0},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._cascadeProjections=null,this._depthMapCoordVaryings=null},t.prototype.iGetVertexCode=function(e,t,o,i){var n="",r=o.getFreeVertexConstant();this.initProjectionsRegs(o),t.vertexConstantsIndex=4*r.index;for(var s=o.getFreeVertexVectorTemp(),a=0;a<this._cascadeShadowMapper.numCascades;++a)n+="m44 "+s+", "+i.globalPositionVertex+", "+this._cascadeProjections[a]+"\nadd "+this._depthMapCoordVaryings[a]+", "+s+", "+r+".zzwz\n";return n},t.prototype.initProjectionsRegs=function(e){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades),this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var t=0;t<this._cascadeShadowMapper.numCascades;++t)this._depthMapCoordVaryings[t]=e.getFreeVarying(),this._cascadeProjections[t]=e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant()},t.prototype.iGetFragmentCode=function(e,t,o,i,n){var r,s=this._cascadeShadowMapper.numCascades,a=i.getFreeTextureReg(),h=i.getFreeFragmentConstant(),p=i.getFreeFragmentConstant(),d=i.getFreeFragmentConstant(),l=Array(d+".x",d+".y",d+".z",d+".w");t.fragmentConstantsIndex=4*h.index,t.texturesIndex=a.index;var u=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(u,1);var c=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(c,1),r="mov "+c+", "+this._depthMapCoordVaryings[s-1]+"\n";for(var m=s-2;m>=0;--m){var g=this._depthMapCoordVaryings[m];r+="slt "+u+".z, "+n.projectionFragment+".z, "+l[m]+"\n";var f=i.getFreeFragmentVectorTemp();r+="sub "+f+", "+g+", "+c+"\nmul "+f+", "+f+", "+u+".z\nadd "+c+", "+c+", "+f+"\n"}return i.removeFragmentTempUsage(u),r+="div "+c+", "+c+", "+c+".w\nmul "+c+".xy, "+c+".xy, "+p+".zw\nadd "+c+".xy, "+c+".xy, "+p+".zz\n",r+=this._baseMethod._iGetCascadeFragmentCode(e,t,h,a,c,o,i,n)+"add "+o+".w, "+o+".w, "+p+".y\n",i.removeFragmentTempUsage(c),r},t.prototype.iActivate=function(e,t,o){o.activateTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap);var i=e.vertexConstantData,n=t.vertexConstantsIndex;e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var r=this._cascadeShadowMapper.numCascades;n+=4;for(var s=0;r>s;++s)this._cascadeShadowMapper.getDepthProjections(s).copyRawDataTo(i,n,!0),n+=16;var a=e.fragmentConstantData,h=t.fragmentConstantsIndex;a[h+5]=1-this._pAlpha;var p=this._cascadeShadowMapper._iNearPlaneDistances;h+=8;for(var d=0;r>d;++d)a[h+d]=p[d];this._baseMethod.iActivateForCascade(e,t,o)},t.prototype.iSetRenderState=function(){},t.prototype.onCascadeChange=function(){this.iInvalidateShaderProgram()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=h},{"awayjs-core/lib/events/Event":void 0,"awayjs-display/lib/entities/DirectionalLight":void 0,"awayjs-methodmaterials/lib/data/MethodVO":void 0,"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0}],"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/base/BitmapData"),n=e("awayjs-core/lib/textures/BitmapTexture"),r=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase"),s=function(e){function t(o,i,n){void 0===i&&(i=4),void 0===n&&(n=1),e.call(this,o),this._depthMapSize=this._pCastingLight.shadowMapper.depthMapSize,this.numSamples=i,this.range=n,++t._grainUsages,t._grainTexture||this.initGrainTexture()}return o(t,e),Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>24&&(this._numSamples=24),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(t,o){e.prototype.iInitVO.call(this,t,o),o.needsProjection=!0},t.prototype.iInitConstants=function(t,o){e.prototype.iInitConstants.call(this,t,o);var i=t.fragmentConstantData,n=o.fragmentConstantsIndex;i[n+8]=1/this._numSamples},Object.defineProperty(t.prototype,"range",{get:function(){return 2*this._range},set:function(e){this._range=e/2},enumerable:!0,configurable:!0}),t.prototype.initGrainTexture=function(){t._grainBitmapData=new i(64,64,!1);for(var e,o,r=new Array,s=4096,a=1/(this._depthMapSize*this._range),h=0;s>h;++h)e=2*(Math.random()-.5),o=2*(Math.random()-.5),0>e?e-=a:e+=a,0>o?o-=a:o+=a,e>1?e=1:-1>e&&(e=-1),o>1?o=1:-1>o&&(o=-1),r[h]=Math.floor(255*(.5*e+.5))<<16|Math.floor(255*(.5*o+.5))<<8;t._grainBitmapData.setVector(t._grainBitmapData.rect,r),t._grainTexture=new n(t._grainBitmapData)},t.prototype.dispose=function(){0==--t._grainUsages&&(t._grainTexture.dispose(),t._grainBitmapData.dispose(),t._grainTexture=null)},t.prototype.iActivate=function(o,i,n){e.prototype.iActivate.call(this,o,i,n);var r=o.fragmentConstantData,s=i.fragmentConstantsIndex;r[s+9]=(n.width-1)/63,r[s+10]=(n.height-1)/63,r[s+11]=2*this._range/this._depthMapSize,n.activateTexture(i.texturesIndex+1,t._grainTexture)},t.prototype._pGetPlanarFragmentCode=function(e,t,o,i){var n=o.getFreeTextureReg(),r=o.getFreeFragmentConstant(),s=(o.getFreeFragmentConstant(),o.getFreeFragmentConstant());return e.fragmentConstantsIndex=4*r.index,e.texturesIndex=n.index,this.getSampleCode(s,n,r,t,o,i)},t.prototype.getSampleCode=function(e,t,o,i,n,r){var s="",a=n.getFreeTextureReg(),h=n.getFreeFragmentVectorTemp(),p=this._numSamples;n.addFragmentTempUsages(h,1);var d=n.getFreeFragmentVectorTemp(),l=r.projectionFragment;for(s+="div "+h+", "+l+", "+l+".w\nmul "+h+".xy, "+h+".xy, "+e+".yz\n";p>0;)s+=p==this._numSamples?"tex "+h+", "+h+", "+a+" <2d,nearest,repeat,mipnone>\n":"tex "+h+", "+h+".zwxy, "+a+" <2d,nearest,repeat,mipnone>\n",s+="sub "+h+".zw, "+h+".xy, fc0.xx\nmul "+h+".zw, "+h+".zw, "+e+".w\n",s+=p==this._numSamples?"add "+h+".xy, "+h+".zw, "+this._pDepthMapCoordReg+".xy\ntex "+d+", "+h+", "+t+" <2d,nearest,clamp,mipnone>\ndp4 "+d+".z, "+d+", "+o+"\nslt "+i+".w, "+this._pDepthMapCoordReg+".z, "+d+".z\n":this.addSample(h,t,o,i,n),p>4&&(s+="add "+h+".xy, "+h+".xy, "+h+".zw\n"+this.addSample(h,t,o,i,n)),p>1&&(s+="sub "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+h+".zw\n"+this.addSample(h,t,o,i,n)),p>5&&(s+="sub "+h+".xy, "+h+".xy, "+h+".zw\n"+this.addSample(h,t,o,i,n)),p>2&&(s+="neg "+h+".w, "+h+".w\n",s+="add "+h+".xy, "+h+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(h,t,o,i,n)),p>6&&(s+="add "+h+".xy, "+h+".xy, "+h+".wz\n"+this.addSample(h,t,o,i,n)),p>3&&(s+="sub "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+h+".wz\n"+this.addSample(h,t,o,i,n)),p>7&&(s+="sub "+h+".xy, "+h+".xy, "+h+".wz\n"+this.addSample(h,t,o,i,n)),p-=8;return n.removeFragmentTempUsage(h),s+="mul "+i+".w, "+i+".w, "+e+".x\n"},t.prototype.addSample=function(e,t,o,i,n){var r=n.getFreeFragmentVectorTemp();return"tex "+r+", "+e+", "+t+" <2d,nearest,clamp,mipnone>\ndp4 "+r+".z, "+r+", "+o+"\nslt "+r+".z, "+this._pDepthMapCoordReg+".z, "+r+".z\nadd "+i+".w, "+i+".w, "+r+".z\n"},t.prototype.iActivateForCascade=function(e,o,i){var n=e.fragmentConstantData,r=o.secondaryFragmentConstantsIndex;n[r]=1/this._numSamples,n[r+1]=(i.width-1)/63,n[r+2]=(i.height-1)/63,n[r+3]=2*this._range/this._depthMapSize,i.activateTexture(o.texturesIndex+1,t._grainTexture)},t.prototype._iGetCascadeFragmentCode=function(e,t,o,i,n,r,s,a){this._pDepthMapCoordReg=n;var h=s.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*h.index,this.getSampleCode(h,i,o,r,s,a)},t}(r);t.exports=s},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/textures/BitmapTexture":void 0,"awayjs-methodmaterials/lib/methods/ShadowMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase"),n=function(e){function t(t){e.call(this,t)}return o(t,e),t.prototype.iInitConstants=function(t,o){e.prototype.iInitConstants.call(this,t,o);var i=t.fragmentConstantData,n=o.fragmentConstantsIndex;i[n+8]=.5;var r=this.castingLight.shadowMapper.depthMapSize;i[n+9]=r,i[n+10]=1/r},t.prototype._pGetPlanarFragmentCode=function(e,t,o){var i=o.getFreeTextureReg(),n=o.getFreeFragmentConstant(),r=o.getFreeFragmentConstant();r=r;var s,a=o.getFreeFragmentConstant(),h=o.getFreeFragmentVectorTemp(),p="";return e.fragmentConstantsIndex=4*n.index,o.addFragmentTempUsages(h,1),s=o.getFreeFragmentVectorTemp(),o.addFragmentTempUsages(s,1),p+="mov "+s+", "+this._pDepthMapCoordReg+"\ntex "+h+", "+this._pDepthMapCoordReg+", "+i+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+n+"\nslt "+s+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\nadd "+s+".x, "+this._pDepthMapCoordReg+".x, "+a+".z\ntex "+h+", "+s+", "+i+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+n+"\nslt "+s+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\nmul "+h+".x, "+this._pDepthMapCoordReg+".x, "+a+".y\nfrc "+h+".x, "+h+".x\nsub "+s+".w, "+s+".w, "+s+".z\nmul "+s+".w, "+s+".w, "+h+".x\nadd "+t+".w, "+s+".z, "+s+".w\nmov "+s+".x, "+this._pDepthMapCoordReg+".x\nadd "+s+".y, "+this._pDepthMapCoordReg+".y, "+a+".z\ntex "+h+", "+s+", "+i+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+n+"\nslt "+s+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\nadd "+s+".x, "+this._pDepthMapCoordReg+".x, "+a+".z\ntex "+h+", "+s+", "+i+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+n+"\nslt "+s+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\nmul "+h+".x, "+this._pDepthMapCoordReg+".x, "+a+".y\nfrc "+h+".x, "+h+".x\nsub "+s+".w, "+s+".w, "+s+".z\nmul "+s+".w, "+s+".w, "+h+".x\nadd "+s+".w, "+s+".z, "+s+".w\nmul "+h+".x, "+this._pDepthMapCoordReg+".y, "+a+".y\nfrc "+h+".x, "+h+".x\nsub "+s+".w, "+s+".w, "+t+".w\nmul "+s+".w, "+s+".w, "+h+".x\nadd "+t+".w, "+t+".w, "+s+".w\n",o.removeFragmentTempUsage(h),o.removeFragmentTempUsage(s),e.texturesIndex=i.index,p},t.prototype.iActivateForCascade=function(e,t){var o=this.castingLight.shadowMapper.depthMapSize,i=t.secondaryFragmentConstantsIndex,n=e.fragmentConstantData;n[i]=o,n[i+1]=1/o},t.prototype._iGetCascadeFragmentCode=function(e,t,o,i,n,r,s){var a,h=s.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=4*h.index;var p=s.getFreeFragmentVectorTemp();s.addFragmentTempUsages(p,1);var d=s.getFreeFragmentVectorTemp();return s.addFragmentTempUsages(d,1),a="tex "+p+", "+n+", "+i+" <2d, nearest, clamp>\ndp4 "+p+".z, "+p+", "+o+"\nslt "+d+".x, "+n+".z, "+p+".z\nadd "+n+".x, "+n+".x, "+h+".y\ntex "+p+", "+n+", "+i+" <2d, nearest, clamp>\ndp4 "+p+".z, "+p+", "+o+"\nslt "+d+".z, "+n+".z, "+p+".z\nadd "+n+".y, "+n+".y, "+h+".y\ntex "+p+", "+n+", "+i+" <2d, nearest, clamp>\ndp4 "+p+".z, "+p+", "+o+"\nslt "+d+".w, "+n+".z, "+p+".z\nsub "+n+".x, "+n+".x, "+h+".y\ntex "+p+", "+n+", "+i+" <2d, nearest, clamp>\ndp4 "+p+".z, "+p+", "+o+"\nslt "+d+".y, "+n+".z, "+p+".z\nmul "+p+".xy, "+n+".xy, "+h+".x\nfrc "+p+".xy, "+p+".xy\nsub "+n+", "+d+".xyzw, "+d+".zwxy\nmul "+n+", "+n+", "+p+".x\nadd "+d+".xy, "+d+".xy, "+n+".zw\nsub "+d+".y, "+d+".y, "+d+".x\nmul "+d+".y, "+d+".y, "+p+".y\nadd "+r+".w, "+d+".x, "+d+".y\n",s.removeFragmentTempUsage(p),s.removeFragmentTempUsage(d),a},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/ShadowHardMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase"),n=function(e){function t(t){e.call(this,t)}return o(t,e),t.prototype._pGetPlanarFragmentCode=function(e,t,o){var i=o.getFreeTextureReg(),n=o.getFreeFragmentConstant(),r=(o.getFreeFragmentConstant(),o.getFreeFragmentVectorTemp()),s="";return e.fragmentConstantsIndex=4*n.index,e.texturesIndex=i.index,s+="tex "+r+", "+this._pDepthMapCoordReg+", "+i+" <2d, nearest, clamp>\ndp4 "+r+".z, "+r+", "+n+"\nslt "+t+".w, "+this._pDepthMapCoordReg+".z, "+r+".z\n"},t.prototype._pGetPointFragmentCode=function(e,t,o,i){var n=o.getFreeTextureReg(),r=o.getFreeFragmentConstant(),s=o.getFreeFragmentConstant(),a=o.getFreeFragmentConstant(),h=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(h,1);var p=o.getFreeFragmentVectorTemp(),d="";return e.fragmentConstantsIndex=4*r.index,e.texturesIndex=n.index,d+="sub "+p+", "+i.globalPositionVarying+", "+a+"\ndp3 "+p+".w, "+p+".xyz, "+p+".xyz\nmul "+p+".w, "+p+".w, "+a+".w\nnrm "+p+".xyz, "+p+".xyz\ntex "+h+", "+p+", "+n+" <cube, nearest, clamp>\ndp4 "+h+".z, "+h+", "+r+"\nadd "+t+".w, "+p+".w, "+s+".x\nslt "+t+".w, "+t+".w, "+h+".z\n",o.removeFragmentTempUsage(h),d},t.prototype._iGetCascadeFragmentCode=function(e,t,o,i,n,r,s){var a=s.getFreeFragmentVectorTemp();return"tex "+a+", "+n+", "+i+" <2d, nearest, clamp>\ndp4 "+a+".z, "+a+", "+o+"\nslt "+r+".w, "+n+".z, "+a+".z\n"},t.prototype.iActivateForCascade=function(){},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/library/AssetType"),n=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase"),r=function(e){function t(t){e.call(this),this._pEpsilon=.02,this._pAlpha=1,this._pCastingLight=t,t.castsShadows=!0,this._pShadowMapper=t.shadowMapper}return o(t,e),Object.defineProperty(t.prototype,"assetType",{get:function(){return i.SHADOW_MAP_METHOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._pAlpha},set:function(e){this._pAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(e){this._pEpsilon=e},enumerable:!0,configurable:!0}),t}(n);t.exports=r},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/ShadowMethodBase":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-display/lib/entities/PointLight"),r=e("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase"),s=function(e){function t(t){this._pUsePoint=t instanceof n,e.call(this,t)}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsView=!0,t.needsGlobalVertexPos=!0,t.needsGlobalFragmentPos=this._pUsePoint,t.needsNormals=e.numLights>0},t.prototype.iInitConstants=function(e,t){var o=e.fragmentConstantData,i=e.vertexConstantData,n=t.fragmentConstantsIndex;o[n]=1,o[n+1]=1/255,o[n+2]=1/65025,o[n+3]=1/16581375,o[n+6]=0,o[n+7]=1,this._pUsePoint&&(o[n+8]=0,o[n+9]=0,o[n+10]=0,o[n+11]=1),n=t.vertexConstantsIndex,-1!=n&&(i[n]=.5,i[n+1]=.5,i[n+2]=0,i[n+3]=1)},Object.defineProperty(t.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(e){this._pDepthMapCoordReg=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pDepthMapCoordReg=null},t.prototype.iGetVertexCode=function(e,t,o,i){return this._pUsePoint?this._pGetPointVertexCode(t,o,i):this.pGetPlanarVertexCode(t,o,i)},t.prototype._pGetPointVertexCode=function(e){return e.vertexConstantsIndex=-1,""},t.prototype.pGetPlanarVertexCode=function(e,t,o){var i="",n=t.getFreeVertexVectorTemp(),r=t.getFreeVertexConstant(),s=t.getFreeVertexConstant();return t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),this._pDepthMapCoordReg=t.getFreeVarying(),e.vertexConstantsIndex=4*r.index,i+="m44 "+n+", "+o.globalPositionVertex+", "+s+"\ndiv "+n+", "+n+", "+n+".w\nmul "+n+".xy, "+n+".xy, "+r+".xy\nadd "+this._pDepthMapCoordReg+", "+n+", "+r+".xxwz\n"},t.prototype.iGetFragmentCode=function(e,t,o,i,n){var r=this._pUsePoint?this._pGetPointFragmentCode(t,o,i,n):this._pGetPlanarFragmentCode(t,o,i,n);return r+="add "+o+".w, "+o+".w, fc"+(t.fragmentConstantsIndex/4+1)+".y\nsat "+o+".w, "+o+".w\n"},t.prototype._pGetPlanarFragmentCode=function(){throw new i},t.prototype._pGetPointFragmentCode=function(){throw new i},t.prototype.iSetRenderState=function(e,t){this._pUsePoint||this._pShadowMapper.iDepthProjection.copyRawDataTo(e.vertexConstantData,t.vertexConstantsIndex+4,!0)},t.prototype._iGetCascadeFragmentCode=function(){throw new Error("This shadow method is incompatible with cascade shadows")},t.prototype.iActivate=function(e,t,o){var i=e.fragmentConstantData,n=t.fragmentConstantsIndex;if(this._pUsePoint?i[n+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2):e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon),i[n+5]=1-this._pAlpha,this._pUsePoint){var r=this._pCastingLight.scenePosition;i[n+8]=r.x,i[n+9]=r.y,i[n+10]=r.z;var s=this._pCastingLight.fallOff;i[n+11]=1/(2*s*s)}this._pUsePoint||o.activateRenderTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap)},t.prototype.iActivateForCascade=function(){throw new Error("This shadow method is incompatible with cascade shadows")},t}(r);t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-display/lib/entities/PointLight":void 0,"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/ShadowNearMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),n=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase"),r=function(e){function t(t,o){var n=this;if(void 0===o&&(o=.1),e.call(this,t.castingLight),this._onShaderInvalidatedDelegate=function(e){return n.onShaderInvalidated(e)},this._baseMethod=t,this._fadeRatio=o,this._nearShadowMapper=this._pCastingLight.shadowMapper,!this._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");this._baseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return o(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){this._baseMethod!=e&&(this._baseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=e,this._baseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitConstants=function(t,o){e.prototype.iInitConstants.call(this,t,o),this._baseMethod.iInitConstants(t,o);var i=t.fragmentConstantData,n=o.secondaryFragmentConstantsIndex;i[n+2]=0,i[n+3]=1},t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t),t.needsProjection=!0},t.prototype.dispose=function(){this._baseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(e){this._baseMethod.alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(e){this._baseMethod.epsilon=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(e){this._fadeRatio=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,o,i,n){var r=this._baseMethod.iGetFragmentCode(e,t,o,i,n),s=i.getFreeFragmentConstant(),a=i.getFreeFragmentSingleTemp();return t.secondaryFragmentConstantsIndex=4*s.index,r+="abs "+a+", "+n.projectionFragment+".w\nsub "+a+", "+a+", "+s+".x\nmul "+a+", "+a+", "+s+".y\nsat "+a+", "+a+"\nsub "+a+", "+s+".w,"+a+"\nsub "+o+".w, "+s+".w,"+o+".w\nmul "+o+".w, "+o+".w, "+a+"\nsub "+o+".w, "+s+".w,"+o+".w\n"},t.prototype.iActivate=function(e,t,o){this._baseMethod.iActivate(e,t,o)},t.prototype.iDeactivate=function(e,t,o){this._baseMethod.iDeactivate(e,t,o)},t.prototype.iSetRenderState=function(e,t,o,i,n){var r=n.projection.near,s=n.projection.far-r,a=this._nearShadowMapper.coverageRatio,h=a*(1-this._fadeRatio);
a=r+a*s,h=r+h*s;var p=e.fragmentConstantData,d=t.secondaryFragmentConstantsIndex;p[d]=h,p[d+1]=1/(a-h),this._baseMethod.iSetRenderState(e,t,o,i,n)},t.prototype.iGetVertexCode=function(e,t,o,i){return this._baseMethod.iGetVertexCode(e,t,o,i)},t.prototype.iReset=function(){this._baseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0}],"awayjs-methodmaterials/lib/methods/ShadowSoftMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/geom/PoissonLookup"),n=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase"),r=function(e){function t(t,o,i){void 0===o&&(o=5),void 0===i&&(i=1),e.call(this,t),this._range=1,this.numSamples=o,this.range=i}return o(t,e),Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>32&&(this._numSamples=32),this._offsets=i.getDistribution(this._numSamples),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e},enumerable:!0,configurable:!0}),t.prototype.iInitConstants=function(t,o){e.prototype.iInitConstants.call(this,t,o),t.fragmentConstantData[o.fragmentConstantsIndex+8]=1/this._numSamples,t.fragmentConstantData[o.fragmentConstantsIndex+9]=0},t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);for(var n=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize,r=t.fragmentConstantData,s=o.fragmentConstantsIndex+10,a=this._numSamples<<1,h=0;a>h;++h)r[s+h]=this._offsets[h]*n},t.prototype._pGetPlanarFragmentCode=function(e,t,o){var i=o.getFreeTextureReg(),n=o.getFreeFragmentConstant(),r=(o.getFreeFragmentConstant(),o.getFreeFragmentConstant());return e.fragmentConstantsIndex=4*n.index,e.texturesIndex=i.index,this.getSampleCode(o,i,n,t,r)},t.prototype.addSample=function(e,t,o,i,n){var r=n.getFreeFragmentVectorTemp();return"tex "+r+", "+e+", "+t+" <2d,nearest,clamp>\ndp4 "+r+".z, "+r+", "+o+"\nslt "+e+".w, "+this._pDepthMapCoordReg+".z, "+r+".z\nadd "+i+".w, "+i+".w, "+e+".w\n"},t.prototype.iActivateForCascade=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=this._range/this._pCastingLight.shadowMapper.depthMapSize,r=t.fragmentConstantData,s=o.secondaryFragmentConstantsIndex,a=this._numSamples<<1;r[s]=1/this._numSamples,r[s+1]=0,s+=2;for(var h=0;a>h;++h)r[s+h]=this._offsets[h]*n;a%4==0&&(r[s+a]=0,r[s+a+1]=0)},t.prototype._iGetCascadeFragmentCode=function(e,t,o,i,n,r,s){this._pDepthMapCoordReg=n;var a=s.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*a.index,this.getSampleCode(s,i,o,r,a)},t.prototype.getSampleCode=function(e,t,o,i,n){var r,s,a=new Array(n+".zw");r=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(r,1);for(var h=e.getFreeFragmentVectorTemp(),p=this._numSamples>>1,d=0;p>d;++d){var l=e.getFreeFragmentConstant();a.push(l+".xy"),a.push(l+".zw")}for(d=0;d<this._numSamples;++d)0==d?s="add "+r+", "+this._pDepthMapCoordReg+", "+n+".zwyy\ntex "+h+", "+r+", "+t+" <2d,nearest,clamp>\ndp4 "+h+".z, "+h+", "+o+"\nslt "+i+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n":s+="add "+r+".xy, "+this._pDepthMapCoordReg+".xy, "+a[d]+"\n"+this.addSample(r,t,o,i,e);return e.removeFragmentTempUsage(r),s+="mul "+i+".w, "+i+".w, "+n+".x\n"},t}(n);t.exports=r},{"awayjs-core/lib/geom/PoissonLookup":void 0,"awayjs-methodmaterials/lib/methods/ShadowMethodBase":void 0}],"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod"),n=function(e){function t(){e.call(this)}return o(t,e),t.prototype.iInitVO=function(e,t){t.needsTangents=!0,t.needsView=!0},t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){var s,a="";return this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1)),a+="nrm "+s+".xyz, "+r.tangentVarying+".xyz\ndp3 "+s+".w, "+s+".xyz, "+o+".xyz\ndp3 "+s+".z, "+s+".xyz, "+r.viewDirFragment+".xyz\n",a+="sin "+s+".x, "+s+".w\nsin "+s+".y, "+s+".z\nmul "+s+".x, "+s+".x, "+s+".y\ncos "+s+".z, "+s+".z\ncos "+s+".w, "+s+".w\nmul "+s+".w, "+s+".w, "+s+".z\nsub "+s+".w, "+s+".x, "+s+".w\n",a+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+s+".w, "+s+".w, "+this._pSpecularTexData+".w\n":"pow "+s+".w, "+s+".w, "+this._pSpecularDataRegister+".w\n",a+="mul "+s+".w, "+s+".w, "+o+".w\n",null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,s,n,r)),a+="mul "+s+".xyz, "+i+".xyz, "+s+".w\n",this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s+".xyz\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":void 0}],"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),r=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),s=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),a=e("awayjs-methodmaterials/lib/methods/LightingMethodBase"),h=function(e){function t(){e.call(this),this._gloss=50,this._specular=1,this._specularColor=16777215,this._iSpecularR=1,this._iSpecularG=1,this._iSpecularB=1}return o(t,e),t.prototype.iIsUsed=function(e){return e.numLights?!0:!1},t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture,t.needsNormals=e.numLights>0,t.needsView=e.numLights>0},Object.defineProperty(t.prototype,"gloss",{get:function(){return this._gloss},set:function(e){this._gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._specular},set:function(e){e!=this._specular&&(this._specular=e,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularColor},set:function(e){this._specularColor!=e&&((0==this._specularColor||0==e)&&this.iInvalidateShaderProgram(),this._specularColor=e,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._pUseTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(e){var t=e,o=t;this.texture=o.texture,this.specular=o.specular,this.specularColor=o.specularColor,this.gloss=o.gloss},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pTotalLightColorReg=null,this._pSpecularTextureRegister=null,this._pSpecularTexData=null,this._pSpecularDataRegister=null},t.prototype.iGetFragmentPreLightingCode=function(e,t,o,i){var n="";return this._pIsFirstLight=!0,this._pSpecularDataRegister=o.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*this._pSpecularDataRegister.index,this._pUseTexture?(this._pSpecularTexData=o.getFreeFragmentVectorTemp(),o.addFragmentTempUsages(this._pSpecularTexData,1),this._pSpecularTextureRegister=o.getFreeTextureReg(),t.texturesIndex=this._pSpecularTextureRegister.index,n=s.getTex2DSampleCode(this._pSpecularTexData,i,this._pSpecularTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)):this._pSpecularTextureRegister=null,this._pTotalLightColorReg=o.getFreeFragmentVectorTemp(),o.addFragmentTempUsages(this._pTotalLightColorReg,1),n},t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){var s,a="";this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1));var h=r.viewDirFragment,p=r.normalFragment;return a+="add "+s+", "+o+", "+h+"\nnrm "+s+".xyz, "+s+"\ndp3 "+s+".w, "+p+", "+s+"\nsat "+s+".w, "+s+".w\n",a+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+s+".w, "+s+".w, "+this._pSpecularTexData+".w\n":"pow "+s+".w, "+s+".w, "+this._pSpecularDataRegister+".w\n",e.usesLightFallOff&&(a+="mul "+s+".w, "+s+".w, "+o+".w\n"),null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,s,n,r)),a+="mul "+s+".xyz, "+i+", "+s+".w\n",this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t.prototype.iGetFragmentCodePerProbe=function(e,t,o,i,n,r){var s,a="";this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1));var h=r.normalFragment,p=r.viewDirFragment;return a+="dp3 "+s+".w, "+h+", "+p+"\nadd "+s+".w, "+s+".w, "+s+".w\nmul "+s+", "+s+".w, "+h+"\nsub "+s+", "+s+", "+p+"\ntex "+s+", "+s+", "+o+" <cube,"+(e.useSmoothTextures?"linear":"nearest")+",miplinear>\nmul "+s+".xyz, "+s+", "+i+"\n",null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,s,n,r)),this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t.prototype.iGetFragmentPostLightingCode=function(e,t,o,i,n){var r="";return n.shadowTarget&&(r+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n.shadowTarget+".w\n"),this._pUseTexture&&(r+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n",i.removeFragmentTempUsage(this._pSpecularTexData)),r+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\nadd "+o+".xyz, "+o+", "+this._pTotalLightColorReg+"\n",i.removeFragmentTempUsage(this._pTotalLightColorReg),r},t.prototype.iActivate=function(e,t,o){this._pUseTexture&&(o.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?r.REPEAT:r.CLAMP,e.useSmoothTextures?n.LINEAR:n.NEAREST,e.useMipmapping?i.MIPLINEAR:i.MIPNONE),o.activateTexture(t.texturesIndex,this._texture));var s=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[s]=this._iSpecularR,a[s+1]=this._iSpecularG,a[s+2]=this._iSpecularB,a[s+3]=this._gloss},t.prototype.updateSpecular=function(){this._iSpecularR=(this._specularColor>>16&255)/255*this._specular,this._iSpecularG=(this._specularColor>>8&255)/255*this._specular,this._iSpecularB=(255&this._specularColor)/255*this._specular},t}(a);t.exports=h},{"awayjs-methodmaterials/lib/methods/LightingMethodBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-methodmaterials/lib/methods/SpecularCelMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod"),n=function(e){function t(t,o){var i=this;void 0===t&&(t=.5),void 0===o&&(o=null),e.call(this,null,o),this._smoothness=.1,this._specularCutOff=.1,this.baseMethod._iModulateMethod=function(e,t,o,n,r){return i.clampSpecular(e,t,o,n,r)},this._specularCutOff=t}return o(t,e),Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(e){this._specularCutOff=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=o.secondaryFragmentConstantsIndex,r=t.fragmentConstantData;r[n]=this._smoothness,r[n+1]=this._specularCutOff},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},t.prototype.clampSpecular=function(e,t,o){return"sub "+o+".y, "+o+".w, "+this._dataReg+".y\ndiv "+o+".y, "+o+".y, "+this._dataReg+".x\nsat "+o+".y, "+o+".y\nsge "+o+".w, "+o+".w, "+this._dataReg+".y\nmul "+o+".w, "+o+".w, "+o+".y\n"},t.prototype.iGetFragmentPreLightingCode=function(t,o,i,n){return this._dataReg=i.getFreeFragmentConstant(),o.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,o,i,n)},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":void 0}],"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),n=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod"),r=function(e){function t(t,o){var r=this;void 0===o&&(o=null),e.call(this),this._onShaderInvalidatedDelegate=function(e){return r.onShaderInvalidated(e)},this._baseMethod=o||new n,this._baseMethod._iModulateMethod=t,this._baseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return o(t,e),t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t)},t.prototype.iInitConstants=function(e,t){this._baseMethod.iInitConstants(e,t)},Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){this._baseMethod!=e&&(this._baseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=e,this._baseMethod.addEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(e){this._baseMethod.gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._baseMethod.specular},set:function(e){this._baseMethod.specular=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._baseMethod.removeEventListener(i.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod.dispose()},Object.defineProperty(t.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(e){this._baseMethod.texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,o){this._baseMethod.iActivate(e,t,o)},t.prototype.iSetRenderState=function(e,t,o,i,n){this._baseMethod.iSetRenderState(e,t,o,i,n)},t.prototype.iDeactivate=function(e,t,o){this._baseMethod.iDeactivate(e,t,o)},t.prototype.iGetVertexCode=function(e,t,o,i){return this._baseMethod.iGetVertexCode(e,t,o,i)},t.prototype.iGetFragmentPreLightingCode=function(e,t,o,i){return this._baseMethod.iGetFragmentPreLightingCode(e,t,o,i)},t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){return this._baseMethod.iGetFragmentCodePerLight(e,t,o,i,n,r)},t.prototype.iGetFragmentCodePerProbe=function(e,t,o,i,n,r){return this._baseMethod.iGetFragmentCodePerProbe(e,t,o,i,n,r)},t.prototype.iGetFragmentPostLightingCode=function(e,t,o,i,n){return this._baseMethod.iGetFragmentPostLightingCode(e,t,o,i,n)},t.prototype.iReset=function(){this._baseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(n);t.exports=r},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0}],"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod"),n=function(e){function t(t,o){var i=this;void 0===t&&(t=!0),void 0===o&&(o=null),e.call(this,null,o),this._fresnelPower=5,this._normalReflectance=.028,this.baseMethod._iModulateMethod=function(e,t,o,n,r){return i.modulateSpecular(e,t,o,n,r)},this._incidentLight=!t}return o(t,e),t.prototype.iInitConstants=function(e,t){var o=t.secondaryFragmentConstantsIndex;e.fragmentConstantData[o+2]=1,e.fragmentConstantData[o+3]=0},Object.defineProperty(t.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(e){this._incidentLight==e&&(this._incidentLight=!e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,o,i){e.prototype.iActivate.call(this,t,o,i);var n=t.fragmentConstantData,r=o.secondaryFragmentConstantsIndex;n[r]=this._normalReflectance,n[r+1]=this._fresnelPower},t.prototype.iGetFragmentPreLightingCode=function(t,o,i,n){return this._dataReg=i.getFreeFragmentConstant(),console.log("SpecularFresnelMethod","iGetFragmentPreLightingCode",this._dataReg),o.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,o,i,n)},t.prototype.modulateSpecular=function(e,t,o,i,n){var r;return r="dp3 "+o+".y, "+n.viewDirFragment+".xyz, "+(this._incidentLight?o:n.normalFragment)+".xyz\nsub "+o+".y, "+this._dataReg+".z, "+o+".y\npow "+o+".x, "+o+".y, "+this._dataReg+".y\nsub "+o+".y, "+this._dataReg+".z, "+o+".y\nmul "+o+".y, "+this._dataReg+".x, "+o+".y\nadd "+o+".y, "+o+".x, "+o+".y\nmul "+o+".w, "+o+".w, "+o+".y\n",console.log("SpecularFresnelMethod","modulateSpecular",r),r},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":void 0}],"awayjs-methodmaterials/lib/methods/SpecularPhongMethod":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod"),n=function(e){function t(){e.call(this)}return o(t,e),t.prototype.iGetFragmentCodePerLight=function(e,t,o,i,n,r){var s,a="";this._pIsFirstLight?s=this._pTotalLightColorReg:(s=n.getFreeFragmentVectorTemp(),n.addFragmentTempUsages(s,1));var h=r.viewDirFragment,p=r.normalFragment;return a+="dp3 "+s+".w, "+o+", "+p+"\nadd "+s+".w, "+s+".w, "+s+".w\nmul "+s+".xyz, "+p+", "+s+".w\nsub "+s+".xyz, "+s+", "+o+"\nadd "+s+".w, "+s+".w, "+r.commons+".w\nsat "+s+".w, "+s+".w\nmul "+s+".xyz, "+s+", "+s+".w\ndp3 "+s+".w, "+s+", "+h+"\nsat "+s+".w, "+s+".w\n",a+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+s+".w, "+s+".w, "+this._pSpecularTexData+".w\n":"pow "+s+".w, "+s+".w, "+this._pSpecularDataRegister+".w\n",e.usesLightFallOff&&(a+="mul "+s+".w, "+s+".w, "+o+".w\n"),null!=this._iModulateMethod&&(a+=this._iModulateMethod(e,t,s,n,r)),a+="mul "+s+".xyz, "+i+".xyz, "+s+".w\n",this._pIsFirstLight||(a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s+".xyz\n",n.removeFragmentTempUsage(s)),this._pIsFirstLight=!1,a},t}(i);t.exports=n},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":void 0}],"awayjs-methodmaterials/lib/passes/MaterialPassMode":[function(e,t){var o=function(){function e(){}return e.EFFECTS=1,e.LIGHTING=2,e.SUPER_SHADER=3,e}();t.exports=o},{}],"awayjs-methodmaterials/lib/passes/SingleObjectDepthPass":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-core/lib/geom/Matrix3D"),n=e("awayjs-core/lib/textures/RenderTexture"),r=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),a=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),h=function(e){function t(){e.call(this),this._textureSize=512,this._polyOffset=Array(15,0,0,0),this._projectionTexturesInvalid=!0}return o(t,e),Object.defineProperty(t.prototype,"textureSize",{get:function(){return this._textureSize},set:function(e){this._textureSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(e){this._polyOffset[0]=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){if(this._textures){for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=null}},t.prototype.updateProjectionTextures=function(){if(this._textures)for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=new Object,this._projections=new Object,this._projectionTexturesInvalid=!1},t.prototype._iGetVertexCode=function(){var e;return e="mul vt7, vt1, vc4.x	\nadd vt7, vt7, vt0\nmov vt7.w, vt0.w\n",e+="m44 vt2, vt7, vc0\nmov op, vt2\n",e+="div v0, vt2, vt2.w\n"},t.prototype._iGetFragmentCode=function(){var e="";return e+="mul ft0, fc0, v0.z\nfrc ft0, ft0\nmul ft1, ft0.yzww, fc1\nsub ft0, ft0, ft1\nmov oc, ft0\n"},t.prototype._iGetDepthMap=function(e){return this._textures[e.materialOwner.id]},t.prototype._iGetProjection=function(e){return this._projections[e.materialOwner.id]},t.prototype._iRender=function(e,t,o,a){var h,p,d,l=o.context,u=this._pLightPicker.allPickedLights,c=t.materialOwner.id;this._textures[c]||(this._textures[c]=new n(this._textureSize,this._textureSize)),this._projections[c]||(this._projections[c]=new i),p=u.length,d=u[0],h=d.iGetObjectProjectionMatrix(t.sourceEntity,a,this._projections[c]),o.setRenderTarget(this._textures[c],!0),l.clear(1,1,1),l.setProgramConstantsFromMatrix(s.VERTEX,0,h,!0),l.setProgramConstantsFromArray(s.FRAGMENT,0,this._enc,2),o.activateBuffer(0,t.getVertexData(r.POSITION_DATA),t.getVertexOffset(r.POSITION_DATA),r.POSITION_FORMAT),o.activateBuffer(1,t.getVertexData(r.NORMAL_DATA),t.getVertexOffset(r.NORMAL_DATA),r.NORMAL_FORMAT),l.drawTriangles(o.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},t.prototype._iActivate=function(t,o,i){this._projectionTexturesInvalid&&this.updateProjectionTextures(),e.prototype._iActivate.call(this,t,o,i),o.context.setProgramConstantsFromArray(s.VERTEX,4,this._polyOffset,1)},t}(a);t.exports=h},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-methodmaterials/lib/passes/TriangleMethodPass":[function(e,t){var o=this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);o.prototype=t.prototype,e.prototype=new o},i=e("awayjs-renderergl/lib/compilation/ShaderLightingObject"),n=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),r=e("awayjs-renderergl/lib/compilation/ShaderObjectBase"),s=e("awayjs-renderergl/lib/passes/LightingPassGLBase"),a=e("awayjs-methodmaterials/lib/data/MethodVO"),h=e("awayjs-methodmaterials/lib/methods/EffectColorTransformMethod"),p=e("awayjs-methodmaterials/lib/passes/MaterialPassMode"),d=function(e){function t(t){var o=this;void 0===t&&(t=3),e.call(this),this._pNumLights=0,this._includeCasters=!0,this._maxLights=3,this._iMethodVOs=new Array,this._numEffectDependencies=0,this._passMode=t,this._onShaderInvalidatedDelegate=function(e){return o.onShaderInvalidated(e)}}return o(t,e),Object.defineProperty(t.prototype,"passMode",{get:function(){return this._passMode},set:function(e){this._passMode=e,this._pInvalidatePass()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(e){this._includeCasters!=e&&(this._includeCasters=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),t.prototype.createShaderObject=function(e){return this._pLightPicker&&this.passMode&p.LIGHTING?new i(e):new r(e)},t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);for(var o=this._iMethodVOs.length,i=0;o>i;++i)this._iMethodVOs[i].method.iInitConstants(t,this._iMethodVOs[i])},Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(e){e?(null==this.colorTransformMethod&&(this.colorTransformMethod=new h),this.colorTransformMethod.colorTransform=e):e||this.colorTransformMethod&&(this.colorTransformMethod=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTransformMethod",{get:function(){return this._iColorTransformMethodVO?this._iColorTransformMethodVO.method:null},set:function(e){this._iColorTransformMethodVO&&this._iColorTransformMethodVO.method==e||(this._iColorTransformMethodVO&&(this._removeDependency(this._iColorTransformMethodVO),this._iColorTransformMethodVO=null),e&&(this._iColorTransformMethodVO=new a(e),this._addDependency(this._iColorTransformMethodVO)))},enumerable:!0,configurable:!0}),t.prototype.pUpdateLights=function(){var e=this._pNumDirectionalLights,t=this._pNumPointLights,o=this._pNumLightProbes;this._pLightPicker&&this._passMode&p.LIGHTING?(this._pNumDirectionalLights=this.calculateNumDirectionalLights(this._pLightPicker.numDirectionalLights),this._pNumPointLights=this.calculateNumPointLights(this._pLightPicker.numPointLights),this._pNumLightProbes=this.calculateNumProbes(this._pLightPicker.numLightProbes),this._includeCasters&&(this._pNumDirectionalLights+=this._pLightPicker.numCastingDirectionalLights,this._pNumPointLights+=this._pLightPicker.numCastingPointLights)):(this._pNumDirectionalLights=0,this._pNumPointLights=0,this._pNumLightProbes=0),this._pNumLights=this._pNumDirectionalLights+this._pNumPointLights,(e!=this._pNumDirectionalLights||t!=this._pNumPointLights||o!=this._pNumLightProbes)&&this._pInvalidatePass()},t.prototype._removeDependency=function(e,t){void 0===t&&(t=!1);var o=this._iMethodVOs.indexOf(e);t||this._numEffectDependencies--,e.method.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iMethodVOs.splice(o,1),this._pInvalidatePass()},t.prototype._addDependency=function(e,t,o){void 0===t&&(t=!1),void 0===o&&(o=-1),e.method.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),t?(-1!=o?this._iMethodVOs.splice(o+this._iMethodVOs.length-this._numEffectDependencies,0,e):this._iMethodVOs.push(e),this._numEffectDependencies++):this._iMethodVOs.splice(this._iMethodVOs.length-this._numEffectDependencies,0,e),this._pInvalidatePass()},t.prototype.addEffectMethod=function(e){this._addDependency(new a(e),!0)},Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:!0,configurable:!0}),t.prototype.hasEffectMethod=function(e){return null!=this.getDependencyForMethod(e)},t.prototype.getEffectMethodAt=function(e){return 0>e||e>this._numEffectDependencies-1?null:this._iMethodVOs[e+this._iMethodVOs.length-this._numEffectDependencies].method},t.prototype.addEffectMethodAt=function(e,t){this._addDependency(new a(e),!0,t)},t.prototype.removeEffectMethod=function(e){var t=this.getDependencyForMethod(e);null!=t&&this._removeDependency(t,!0)},t.prototype.getDependencyForMethod=function(e){for(var t=this._iMethodVOs.length,o=0;t>o;++o)if(this._iMethodVOs[o].method==e)return this._iMethodVOs[o];return null},Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._iNormalMethodVO?this._iNormalMethodVO.method:null},set:function(e){this._iNormalMethodVO&&this._iNormalMethodVO.method==e||(this._iNormalMethodVO&&(this._removeDependency(this._iNormalMethodVO),this._iNormalMethodVO=null),e&&(this._iNormalMethodVO=new a(e),this._addDependency(this._iNormalMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._iAmbientMethodVO?this._iAmbientMethodVO.method:null},set:function(e){this._iAmbientMethodVO&&this._iAmbientMethodVO.method==e||(this._iAmbientMethodVO&&(this._removeDependency(this._iAmbientMethodVO),this._iAmbientMethodVO=null),e&&(this._iAmbientMethodVO=new a(e),this._addDependency(this._iAmbientMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._iShadowMethodVO?this._iShadowMethodVO.method:null},set:function(e){this._iShadowMethodVO&&this._iShadowMethodVO.method==e||(this._iShadowMethodVO&&(this._removeDependency(this._iShadowMethodVO),this._iShadowMethodVO=null),e&&(this._iShadowMethodVO=new a(e),this._addDependency(this._iShadowMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethodVO?this._iDiffuseMethodVO.method:null},set:function(e){this._iDiffuseMethodVO&&this._iDiffuseMethodVO.method==e||(this._iDiffuseMethodVO&&(this._removeDependency(this._iDiffuseMethodVO),this._iDiffuseMethodVO=null),e&&(this._iDiffuseMethodVO=new a(e),this._addDependency(this._iDiffuseMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._iSpecularMethodVO?this._iSpecularMethodVO.method:null},set:function(e){this._iSpecularMethodVO&&this._iSpecularMethodVO.method==e||(this._iSpecularMethodVO&&(this._removeDependency(this._iSpecularMethodVO),this._iSpecularMethodVO=null),e&&(this._iSpecularMethodVO=new a(e),this._addDependency(this._iSpecularMethodVO)))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(e.prototype.dispose.call(this);this._iMethodVOs.length;)this._removeDependency(this._iMethodVOs[0]);this._iMethodVOs=null},t.prototype.onShaderInvalidated=function(){this._pInvalidatePass()},t.prototype._iActivate=function(t,o,i){e.prototype._iActivate.call(this,t,o,i);for(var n,r=this._iMethodVOs.length,s=0;r>s;++s)n=this._iMethodVOs[s],n.useMethod&&n.method.iActivate(t.shaderObject,n,o.stage)},t.prototype.setRenderState=function(t,o,i,n,r){e.prototype.setRenderState.call(this,t,o,i,n,r);for(var s,a=this._iMethodVOs.length,h=0;a>h;++h)s=this._iMethodVOs[h],s.useMethod&&s.method.iSetRenderState(t.shaderObject,s,o,i,n)},t.prototype._iDeactivate=function(t,o){e.prototype._iDeactivate.call(this,t,o);for(var i,n=this._iMethodVOs.length,r=0;n>r;++r)i=this._iMethodVOs[r],i.useMethod&&i.method.iDeactivate(t.shaderObject,i,o.stage)},t.prototype._iIncludeDependencies=function(t){t.usesFragmentAnimation=Boolean(this._passMode==p.SUPER_SHADER),!t.usesTangentSpace&&t.numPointLights>0&&t.usesLights&&(t.globalPosDependencies++,Boolean(this._passMode&p.EFFECTS)&&(t.usesGlobalPosFragment=!0));var o,i=this._iMethodVOs.length;for(o=0;i>o;++o)this.setupAndCountDependencies(t,this._iMethodVOs[o]);for(o=0;i>o;++o)this._iMethodVOs[o].useMethod=this._iMethodVOs[o].method.iIsUsed(t);e.prototype._iIncludeDependencies.call(this,t)},t.prototype.setupAndCountDependencies=function(e,t){t.reset(),t.method.iInitVO(e,t),t.needsProjection&&e.projectionDependencies++,t.needsGlobalVertexPos?(e.globalPosDependencies++,t.needsGlobalFragmentPos&&(e.usesGlobalPosFragment=!0)):t.needsGlobalFragmentPos&&(e.globalPosDependencies++,e.usesGlobalPosFragment=!0),t.needsNormals&&e.normalDependencies++,t.needsTangents&&e.tangentDependencies++,t.needsView&&e.viewDirDependencies++,t.needsUV&&e.uvDependencies++,t.needsSecondaryUV&&e.secondaryUVDependencies++
},t.prototype._iGetPreLightingVertexCode=function(e,t,o){var i="";return this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod&&(i+=this._iAmbientMethodVO.method.iGetVertexCode(e,this._iAmbientMethodVO,t,o)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(i+=this._iDiffuseMethodVO.method.iGetVertexCode(e,this._iDiffuseMethodVO,t,o)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(i+=this._iSpecularMethodVO.method.iGetVertexCode(e,this._iSpecularMethodVO,t,o)),i},t.prototype._iGetPreLightingFragmentCode=function(e,t,o){var i="";return this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod&&(i+=this._iAmbientMethodVO.method.iGetFragmentCode(e,this._iAmbientMethodVO,o.shadedTarget,t,o),this._iAmbientMethodVO.needsNormals&&t.removeFragmentTempUsage(o.normalFragment),this._iAmbientMethodVO.needsView&&t.removeFragmentTempUsage(o.viewDirFragment)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(i+=this._iDiffuseMethodVO.method.iGetFragmentPreLightingCode(e,this._iDiffuseMethodVO,t,o)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(i+=this._iSpecularMethodVO.method.iGetFragmentPreLightingCode(e,this._iSpecularMethodVO,t,o)),i},t.prototype._iGetPerLightDiffuseFragmentCode=function(e,t,o,i,n){return this._iDiffuseMethodVO.method.iGetFragmentCodePerLight(e,this._iDiffuseMethodVO,t,o,i,n)},t.prototype._iGetPerLightSpecularFragmentCode=function(e,t,o,i,n){return this._iSpecularMethodVO.method.iGetFragmentCodePerLight(e,this._iSpecularMethodVO,t,o,i,n)},t.prototype._iGetPerProbeDiffuseFragmentCode=function(e,t,o,i,n){return this._iDiffuseMethodVO.method.iGetFragmentCodePerProbe(e,this._iDiffuseMethodVO,t,o,i,n)},t.prototype._iGetPerProbeSpecularFragmentCode=function(e,t,o,i,n){return this._iSpecularMethodVO.method.iGetFragmentCodePerProbe(e,this._iSpecularMethodVO,t,o,i,n)},t.prototype._iGetPostLightingVertexCode=function(e,t,o){var i="";return this._iShadowMethodVO&&(i+=this._iShadowMethodVO.method.iGetVertexCode(e,this._iShadowMethodVO,t,o)),i},t.prototype._iGetPostLightingFragmentCode=function(e,t,o){var i="";return e.useAlphaPremultiplied&&this._pEnableBlending&&(i+="add "+o.shadedTarget+".w, "+o.shadedTarget+".w, "+o.commons+".z\ndiv "+o.shadedTarget+".xyz, "+o.shadedTarget+", "+o.shadedTarget+".w\nsub "+o.shadedTarget+".w, "+o.shadedTarget+".w, "+o.commons+".z\nsat "+o.shadedTarget+".xyz, "+o.shadedTarget+"\n"),this._iShadowMethodVO&&(i+=this._iShadowMethodVO.method.iGetFragmentCode(e,this._iShadowMethodVO,o.shadowTarget,t,o)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(i+=this._iDiffuseMethodVO.method.iGetFragmentPostLightingCode(e,this._iDiffuseMethodVO,o.shadedTarget,t,o),this._iDiffuseMethodVO.needsNormals&&t.removeFragmentTempUsage(o.normalFragment),this._iDiffuseMethodVO.needsView&&t.removeFragmentTempUsage(o.viewDirFragment)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(i+=this._iSpecularMethodVO.method.iGetFragmentPostLightingCode(e,this._iSpecularMethodVO,o.shadedTarget,t,o),this._iSpecularMethodVO.needsNormals&&t.removeFragmentTempUsage(o.normalFragment),this._iSpecularMethodVO.needsView&&t.removeFragmentTempUsage(o.viewDirFragment)),this._iShadowMethodVO&&t.removeFragmentTempUsage(o.shadowTarget),i},t.prototype._pUsesTangentSpace=function(e){if(e.usesProbes)return!1;for(var t,o=this._iMethodVOs.length,i=0;o>i;++i)if(t=this._iMethodVOs[i],t.useMethod&&!t.method.iUsesTangentSpace())return!1;return!0},t.prototype._pOutputsTangentNormals=function(){return this._iNormalMethodVO.method.iOutputsTangentNormals()},t.prototype._pOutputsNormals=function(){return this._iNormalMethodVO&&this._iNormalMethodVO.useMethod},t.prototype._iGetNormalVertexCode=function(e,t,o){return this._iNormalMethodVO.method.iGetVertexCode(e,this._iNormalMethodVO,t,o)},t.prototype._iGetNormalFragmentCode=function(e,t,o){var i=this._iNormalMethodVO.method.iGetFragmentCode(e,this._iNormalMethodVO,o.normalFragment,t,o);return this._iNormalMethodVO.needsView&&t.removeFragmentTempUsage(o.viewDirFragment),(this._iNormalMethodVO.needsGlobalFragmentPos||this._iNormalMethodVO.needsGlobalVertexPos)&&t.removeVertexTempUsage(o.globalPositionVertex),i},t.prototype._iGetVertexCode=function(e,t,o){for(var i,n="",r=this._iMethodVOs.length,s=r-this._numEffectDependencies;r>s;s++)i=this._iMethodVOs[s],i.useMethod&&(n+=i.method.iGetVertexCode(e,i,t,o),(i.needsGlobalVertexPos||i.needsGlobalFragmentPos)&&t.removeVertexTempUsage(o.globalPositionVertex));return this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod&&(n+=this._iColorTransformMethodVO.method.iGetVertexCode(e,this._iColorTransformMethodVO,t,o)),n},t.prototype._iGetFragmentCode=function(e,t,o){var i,n="";this.preserveAlpha&&this._numEffectDependencies>0&&(i=t.getFreeFragmentSingleTemp(),t.addFragmentTempUsages(i,1),n+="mov "+i+", "+o.shadedTarget+".w\n");for(var r,s=this._iMethodVOs.length,a=s-this._numEffectDependencies;s>a;a++)r=this._iMethodVOs[a],r.useMethod&&(n+=r.method.iGetFragmentCode(e,r,o.shadedTarget,t,o),r.needsNormals&&t.removeFragmentTempUsage(o.normalFragment),r.needsView&&t.removeFragmentTempUsage(o.viewDirFragment));return this.preserveAlpha&&this._numEffectDependencies>0&&(n+="mov "+o.shadedTarget+".w, "+i+"\n",t.removeFragmentTempUsage(i)),this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod&&(n+=this._iColorTransformMethodVO.method.iGetFragmentCode(e,this._iColorTransformMethodVO,o.shadedTarget,t,o)),n},t.prototype._iUsesShadows=function(){return Boolean(this._iShadowMethodVO||this.lightPicker.castingDirectionalLights.length>0||this.lightPicker.castingPointLights.length>0)},t.prototype._iUsesSpecular=function(){return Boolean(this._iSpecularMethodVO)},t.prototype.calculateNumDirectionalLights=function(e){return Math.min(e-this.directionalLightsOffset,this._maxLights)},t.prototype.calculateNumPointLights=function(e){var t=this._maxLights-this._pNumDirectionalLights;return Math.min(e-this.pointLightsOffset,t)},t.prototype.calculateNumProbes=function(e){var t=0;return Math.min(e-this.lightProbesOffset,4/t|0)},t}(s);t.exports=d},{"awayjs-methodmaterials/lib/data/MethodVO":void 0,"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":void 0,"awayjs-methodmaterials/lib/passes/MaterialPassMode":void 0,"awayjs-renderergl/lib/compilation/ShaderLightingObject":void 0,"awayjs-renderergl/lib/compilation/ShaderObjectBase":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0,"awayjs-renderergl/lib/passes/LightingPassGLBase":void 0}]},{},[]);
//# sourceMappingURL=awayjs-methodmaterials.min.js.map