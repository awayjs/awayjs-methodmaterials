require=function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var h=typeof require=="function"&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){var r=t[a][1][e];return n(r?r:e)},u,u.exports,e,t,r,i)}return r[a].exports}var o=typeof require=="function"&&require;for(var a=0;a<i.length;a++)n(i[a]);return n}({"awayjs-methodmaterials/lib/MethodMaterialMode":[function(e,t,r){var i=function(){function e(){}e.SINGLE_PASS="singlePass";e.MULTI_PASS="multiPass";return e}();t.exports=i},{}],"awayjs-methodmaterials/lib/MethodMaterial":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/textures/Texture2DBase");var o=e("awayjs-display/lib/materials/MaterialBase");var a=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var s=e("awayjs-methodmaterials/lib/methods/AmbientBasicMethod");var h=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var d=e("awayjs-methodmaterials/lib/methods/NormalBasicMethod");var u=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var p=e("awayjs-methodmaterials/lib/MethodMaterialMode");var l=function(e){i(t,e);function t(t,r,i,o){if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=false}if(o===void 0){o=true}e.call(this);this._effectMethods=new Array;this._ambientMethod=new s;this._diffuseMethod=new h;this._normalMethod=new d;this._specularMethod=new u;this._depthCompareMode=a.LESS_EQUAL;this._mode=p.SINGLE_PASS;if(t instanceof n){this.texture=t;this.smooth=r==null?true:false;this.repeat=i;this.mipmap=o}else{this.color=t==null?16777215:Number(t);this.alpha=r==null?1:Number(r)}}Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){if(this._mode==e)return;this._mode=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){if(this._depthCompareMode==e)return;this._depthCompareMode=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseTexture",{get:function(){return this._diffuseMethod.texture},set:function(e){this._diffuseMethod.texture=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(e){if(this._ambientMethod==e)return;if(e&&this._ambientMethod)e.copyFrom(this._ambientMethod);this._ambientMethod=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(e){if(this._shadowMethod==e)return;if(e&&this._shadowMethod)e.copyFrom(this._shadowMethod);this._shadowMethod=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(e){if(this._diffuseMethod==e)return;if(e&&this._diffuseMethod)e.copyFrom(this._diffuseMethod);this._diffuseMethod=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(e){if(this._specularMethod==e)return;if(e&&this._specularMethod)e.copyFrom(this._specularMethod);this._specularMethod=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(e){if(this._normalMethod==e)return;if(e&&this._normalMethod)e.copyFrom(this._normalMethod);this._normalMethod=e;this._pInvalidateRenderObject()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._effectMethods.length},enumerable:true,configurable:true});t.prototype.addEffectMethod=function(e){this._effectMethods.push(e);this._pInvalidateRenderObject()};t.prototype.getEffectMethodAt=function(e){return this._effectMethods[e]};t.prototype.addEffectMethodAt=function(e,t){this._effectMethods.splice(t,0,e);this._pInvalidateRenderObject()};t.prototype.removeEffectMethod=function(e){this._effectMethods.splice(this._effectMethods.indexOf(e),1);this._pInvalidateRenderObject()};Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._normalMethod.normalMap},set:function(e){this._normalMethod.normalMap=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularMap",{get:function(){return this._specularMethod.texture},set:function(e){this._specularMethod.texture=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"gloss",{get:function(){return this._specularMethod.gloss},set:function(e){this._specularMethod.gloss=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambientMethod.ambient},set:function(e){this._ambientMethod.ambient=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specular",{get:function(){return this._specularMethod.specular},set:function(e){this._specularMethod.specular=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._diffuseMethod.ambientColor},set:function(e){this._diffuseMethod.ambientColor=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseMethod.diffuseColor},set:function(e){this._diffuseMethod.diffuseColor=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularMethod.specularColor},set:function(e){this._specularMethod.specularColor=e},enumerable:true,configurable:true});t.prototype.getRenderObject=function(e){return e.getMethodRenderObject(this)};return t}(o);t.exports=l},{"awayjs-core/lib/textures/Texture2DBase":undefined,"awayjs-display/lib/materials/MaterialBase":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":undefined,"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":undefined,"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":undefined,"awayjs-methodmaterials/lib/methods/NormalBasicMethod":undefined,"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-methodmaterials/lib/compilation/RenderMethodMaterialObject":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/base/BlendMode");var o=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker");var a=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var s=e("awayjs-renderergl/lib/compilation/RenderObjectBase");var h=e("awayjs-methodmaterials/lib/passes/MethodPassMode");var d=e("awayjs-methodmaterials/lib/passes/MethodPass");var u=e("awayjs-methodmaterials/lib/MethodMaterialMode");var p=function(e){i(t,e);function t(t,r,i,n){e.call(this,t,r,i,n);this._material=r}Object.defineProperty(t.prototype,"numLights",{get:function(){return this._material.lightPicker?this._material.lightPicker.numLightProbes+this._material.lightPicker.numDirectionalLights+this._material.lightPicker.numPointLights+this._material.lightPicker.numCastingDirectionalLights+this._material.lightPicker.numCastingPointLights:0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numNonCasters",{get:function(){return this._material.lightPicker?this._material.lightPicker.numLightProbes+this._material.lightPicker.numDirectionalLights+this._material.lightPicker.numPointLights:0},enumerable:true,configurable:true});t.prototype._pUpdateRenderObject=function(){e.prototype._pUpdateRenderObject.call(this);this.initPasses();this.setBlendAndCompareModes();this._pClearScreenPasses();if(this._material.mode==u.MULTI_PASS){if(this._casterLightPass)this._pAddScreenPass(this._casterLightPass);if(this._nonCasterLightPasses)for(var t=0;t<this._nonCasterLightPasses.length;++t)this._pAddScreenPass(this._nonCasterLightPasses[t])}if(this._screenPass)this._pAddScreenPass(this._screenPass)};t.prototype.initPasses=function(){if(this.numLights==0||this._material.numEffectMethods>0||this._material.mode==u.SINGLE_PASS)this.initEffectPass();else if(this._screenPass)this.removeEffectPass();if(this._material.shadowMethod&&this._material.mode==u.MULTI_PASS)this.initCasterLightPass();else if(this._casterLightPass)this.removeCasterLightPass();if(this.numNonCasters>0&&this._material.mode==u.MULTI_PASS)this.initNonCasterLightPasses();else if(this._nonCasterLightPasses)this.removeNonCasterLightPasses()};t.prototype.setBlendAndCompareModes=function(){var e=Boolean(this._casterLightPass||this._screenPass);if(this._casterLightPass){this._casterLightPass.forceSeparateMVP=e;this._casterLightPass.setBlendMode(n.NORMAL);this._casterLightPass.depthCompareMode=this._material.depthCompareMode}if(this._nonCasterLightPasses){var t=0;if(!this._casterLightPass){this._nonCasterLightPasses[0].forceSeparateMVP=e;this._nonCasterLightPasses[0].setBlendMode(n.NORMAL);this._nonCasterLightPasses[0].depthCompareMode=this._material.depthCompareMode;t=1}for(var r=t;r<this._nonCasterLightPasses.length;++r){this._nonCasterLightPasses[r].forceSeparateMVP=e;this._nonCasterLightPasses[r].setBlendMode(n.ADD);this._nonCasterLightPasses[r].depthCompareMode=a.LESS_EQUAL}}if(this._casterLightPass||this._nonCasterLightPasses){this._pRequiresBlending=false;if(this._screenPass){this._screenPass.mode=h.EFFECTS;this._screenPass.depthCompareMode=a.LESS_EQUAL;this._screenPass.setBlendMode(n.LAYER);this._screenPass.forceSeparateMVP=e}}else if(this._screenPass){this._pRequiresBlending=this._material.blendMode!=n.NORMAL||this._material.alphaBlending||this._material.colorTransform&&this._material.colorTransform.alphaMultiplier<1;this._screenPass.mode=h.SUPER_SHADER;this._screenPass.depthCompareMode=this._material.depthCompareMode;this._screenPass.preserveAlpha=this._pRequiresBlending;this._screenPass.colorTransform=this._material.colorTransform;this._screenPass.setBlendMode(this._material.blendMode==n.NORMAL&&this._pRequiresBlending?n.LAYER:this._material.blendMode);this._screenPass.forceSeparateMVP=false}};t.prototype.initCasterLightPass=function(){if(this._casterLightPass==null)this._casterLightPass=new d(h.LIGHTING,this,this._material,this._renderableClass,this._stage);this._casterLightPass.lightPicker=new o([this._material.shadowMethod.castingLight]);this._casterLightPass.shadowMethod=this._material.shadowMethod;this._casterLightPass.diffuseMethod=this._material.diffuseMethod;this._casterLightPass.ambientMethod=this._material.ambientMethod;this._casterLightPass.normalMethod=this._material.normalMethod;this._casterLightPass.specularMethod=this._material.specularMethod};t.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose();this._pRemoveScreenPass(this._casterLightPass);this._casterLightPass=null};t.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var e;var t=this._material.lightPicker.numDirectionalLights;var r=this._material.lightPicker.numPointLights;var i=this._material.lightPicker.numLightProbes;var n=0;var o=0;var a=0;if(!this._casterLightPass){t+=this._material.lightPicker.numCastingDirectionalLights;r+=this._material.lightPicker.numCastingPointLights}this._nonCasterLightPasses=new Array;while(n<t||o<r||a<i){e=new d(h.LIGHTING,this,this._material,this._renderableClass,this._stage);e.includeCasters=this._material.shadowMethod==null;e.directionalLightsOffset=n;e.pointLightsOffset=o;e.lightProbesOffset=a;e.lightPicker=this._material.lightPicker;e.diffuseMethod=this._material.diffuseMethod;e.ambientMethod=this._material.ambientMethod;e.normalMethod=this._material.normalMethod;e.specularMethod=this._material.specularMethod;this._nonCasterLightPasses.push(e);n+=e.numDirectionalLights;o+=e.numPointLights;a+=e.numLightProbes}};t.prototype.removeNonCasterLightPasses=function(){if(!this._nonCasterLightPasses)return;for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pRemoveScreenPass(this._nonCasterLightPasses[e]);this._nonCasterLightPasses=null};t.prototype.removeEffectPass=function(){if(this._screenPass.ambientMethod!=this._material.ambientMethod)this._screenPass.ambientMethod.dispose();if(this._screenPass.diffuseMethod!=this._material.diffuseMethod)this._screenPass.diffuseMethod.dispose();if(this._screenPass.specularMethod!=this._material.specularMethod)this._screenPass.specularMethod.dispose();if(this._screenPass.normalMethod!=this._material.normalMethod)this._screenPass.normalMethod.dispose();this._pRemoveScreenPass(this._screenPass);this._screenPass=null};t.prototype.initEffectPass=function(){if(this._screenPass==null)this._screenPass=new d(h.SUPER_SHADER,this,this._material,this._renderableClass,this._stage);if(this._material.mode==u.SINGLE_PASS){this._screenPass.ambientMethod=this._material.ambientMethod;this._screenPass.diffuseMethod=this._material.diffuseMethod;this._screenPass.specularMethod=this._material.specularMethod;this._screenPass.normalMethod=this._material.normalMethod;this._screenPass.shadowMethod=this._material.shadowMethod}else if(this._material.mode==u.MULTI_PASS){if(this.numLights==0){this._screenPass.ambientMethod=this._material.ambientMethod}else{this._screenPass.ambientMethod=null}this._screenPass.preserveAlpha=false;this._screenPass.normalMethod=this._material.normalMethod}var e=0;var t;var r=Math.max(this._material.numEffectMethods,this._screenPass.numEffectMethods);while(e<r){t=this._material.getEffectMethodAt(e);if(t!=this._screenPass.getEffectMethodAt(e)){this._screenPass.removeEffectMethodAt(e);if(t!=null){if(e<this._screenPass.numEffectMethods)this._screenPass.addEffectMethodAt(t,e);else this._screenPass.addEffectMethod(t)}}e++}};t.prototype.dispose=function(){e.prototype.dispose.call(this)};t.id="method";return t}(s);t.exports=p},{"awayjs-core/lib/base/BlendMode":undefined,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":undefined,"awayjs-methodmaterials/lib/passes/MethodPass":undefined,"awayjs-methodmaterials/lib/passes/MethodPassMode":undefined,"awayjs-renderergl/lib/compilation/RenderObjectBase":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-methodmaterials/lib/data/MethodVO":[function(e,t,r){var i=function(){function e(e){this.useMethod=true;this.method=e}e.prototype.reset=function(){this.method.iReset();this.texturesIndex=-1;this.vertexConstantsIndex=-1;this.fragmentConstantsIndex=-1;this.needsProjection=false;this.needsView=false;this.needsNormals=false;this.needsTangents=false;this.needsUV=false;this.needsSecondaryUV=false;this.needsGlobalVertexPos=false;this.needsGlobalFragmentPos=false};return e}();t.exports=i},{}],"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var a=function(e){i(t,e);function t(){e.call(this);this._color=16777215;this._alpha=1;this._colorR=1;this._colorG=1;this._colorB=1;this._ambient=1}t.prototype.iInitVO=function(e,t){t.needsUV=Boolean(e.texture!=null)};t.prototype.iInitConstants=function(e,t){if(!t.needsUV){this._color=e.color;this.updateColor()}};Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambient},set:function(e){if(this._ambient==e)return;this._ambient=e;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){if(this._alpha==e)return;this._alpha=e;this.updateColor()},enumerable:true,configurable:true});t.prototype.copyFrom=function(e){var t=e;var r=t};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a="";var s;if(t.needsUV){s=i.getFreeTextureReg();t.texturesIndex=s.index;a+=n.getTex2DSampleCode(r,o,s,e.texture,e.useSmoothTextures,e.repeatTextures,false);if(e.alphaThreshold>0){var h=i.getFreeFragmentConstant();t.fragmentConstantsIndex=h.index*4;a+="sub "+r+".w, "+r+".w, "+h+".x\n"+"kil "+r+".w\n"+"add "+r+".w, "+r+".w, "+h+".x\n"}}else{s=i.getFreeFragmentConstant();t.fragmentConstantsIndex=s.index*4;a+="mov "+r+", "+s+"\n"}return a};t.prototype.iActivate=function(e,t,r){if(t.needsUV){r.activateTexture(t.texturesIndex,e.texture,e.repeatTextures,e.useSmoothTextures,e.useMipmapping);if(e.alphaThreshold>0)e.fragmentConstantData[t.fragmentConstantsIndex]=e.alphaThreshold}else{var i=t.fragmentConstantsIndex;var n=e.fragmentConstantData;n[i]=this._colorR;n[i+1]=this._colorG;n[i+2]=this._colorB;n[i+3]=this._alpha}};t.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._ambient;this._colorG=(this._color>>8&255)/255*this._ambient;this._colorB=(this._color&255)/255*this._ambient};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/AmbientBasicMethod");var a=function(e){i(t,e);function t(t){e.call(this);this._cubeTexture=t}t.prototype.iInitVO=function(t,r){e.prototype.iInitVO.call(this,t,r);r.needsNormals=true};Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:true,configurable:true});t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);i.activateCubeTexture(r.texturesIndex,this._cubeTexture,t.useSmoothTextures,t.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a="";var s;var h=i.getFreeTextureReg();t.texturesIndex=h.index;a+=n.getTexCubeSampleCode(r,h,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,o.normalFragment);s=i.getFreeFragmentConstant();t.fragmentConstantsIndex=s.index;a+="add "+r+".xyz, "+r+".xyz, "+s+".xyz\n";return a};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/LightingMethodBase");var a=function(e){i(t,e);function t(){e.call(this);this._multiply=true;this._diffuseColor=16777215;this._ambientColor=16777215;this._diffuseR=1;this._diffuseG=1;this._diffuseB=1;this._ambientR=1;this._ambientG=1;this._ambientB=1}t.prototype.iIsUsed=function(e){if(!e.numLights)return false;return true};Object.defineProperty(t.prototype,"multiply",{get:function(){return this._multiply},set:function(e){if(this._multiply==e)return;this._multiply=e;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture;t.needsNormals=e.numLights>0};t.prototype.generateMip=function(e){if(this._pUseTexture)e.activateTexture(0,this._texture,true,true,true)};Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){if(this._diffuseColor==e)return;this._diffuseColor=e;this.updateDiffuse()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(e){if(this._ambientColor==e)return;this._ambientColor=e;this.updateAmbient()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=e!=null;if(t!=this._pUseTexture||e&&this._texture&&e.format!=this._texture.format)this.iInvalidateShaderProgram();this._pUseTexture=t;this._texture=e},enumerable:true,configurable:true});t.prototype.dispose=function(){this._texture=null};t.prototype.copyFrom=function(e){var t=e;this.texture=t.texture;this.multiply=t.multiply;this.diffuseColor=t.diffuseColor;this.ambientColor=t.ambientColor};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._pTotalLightColorReg=null;this._pDiffuseInputRegister=null};t.prototype.iGetFragmentPreLightingCode=function(e,t,r,i){var n="";this._pIsFirstLight=true;this._pTotalLightColorReg=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(this._pTotalLightColorReg,1);return n};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight){s=this._pTotalLightColorReg}else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}a+="dp3 "+s+".x, "+r+", "+o.normalFragment+"\n"+"max "+s+".w, "+s+".x, "+o.commons+".y\n";if(e.usesLightFallOff)a+="mul "+s+".w, "+s+".w, "+r+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,s,n,o);a+="mul "+s+", "+s+".w, "+i+"\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};t.prototype.iGetFragmentCodePerProbe=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight){s=this._pTotalLightColorReg}else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}a+="tex "+s+", "+o.normalFragment+", "+r+" <cube,linear,miplinear>\n"+"mul "+s+".xyz, "+s+".xyz, "+i+"\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,s,n,o);if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};t.prototype.iGetFragmentPostLightingCode=function(e,t,r,i,o){var a="";var s;var h;if(o.shadowTarget)a+=this.pApplyShadow(e,t,i,o);s=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(s,1);var d=i.getFreeFragmentConstant();t.fragmentConstantsIndex=d.index*4;if(this._pUseTexture){this._pDiffuseInputRegister=i.getFreeTextureReg();t.texturesIndex=this._pDiffuseInputRegister.index;a+=n.getTex2DSampleCode(s,o,this._pDiffuseInputRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)}else{this._pDiffuseInputRegister=i.getFreeFragmentConstant();a+="mov "+s+", "+this._pDiffuseInputRegister+"\n"}a+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\n"+"mul "+s+".xyz, "+s+", "+this._pTotalLightColorReg+"\n";if(this._multiply){a+="add "+s+".xyz, "+s+", "+d+"\n"+"mul "+r+".xyz, "+r+", "+s+"\n"}else{a+="mul "+r+".xyz, "+r+", "+d+"\n"+"mul "+this._pTotalLightColorReg+".xyz, "+r+", "+this._pTotalLightColorReg+"\n"+"sub "+r+".xyz, "+r+", "+this._pTotalLightColorReg+"\n"+"add "+r+".xyz, "+r+", "+s+"\n"}i.removeFragmentTempUsage(this._pTotalLightColorReg);i.removeFragmentTempUsage(s);return a};t.prototype.pApplyShadow=function(e,t,r,i){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+i.shadowTarget+".w\n"};t.prototype.iActivate=function(e,t,r){if(this._pUseTexture){r.activateTexture(t.texturesIndex,this._texture,e.repeatTextures,e.useSmoothTextures,e.useMipmapping)}else{var i=t.fragmentConstantsIndex;var n=e.fragmentConstantData;n[i+4]=this._diffuseR;n[i+5]=this._diffuseG;n[i+6]=this._diffuseB;n[i+7]=1}};t.prototype.updateDiffuse=function(){this._diffuseR=(this._diffuseColor>>16&255)/255;this._diffuseG=(this._diffuseColor>>8&255)/255;this._diffuseB=(this._diffuseColor&255)/255};t.prototype.updateAmbient=function(){this._ambientR=(this._ambientColor>>16&255)/255;this._ambientG=(this._ambientColor>>8&255)/255;this._ambientB=(this._ambientColor&255)/255};t.prototype.iSetRenderState=function(e,t,r,i,n){if(e.numLights>0){var o=t.fragmentConstantsIndex;var a=e.fragmentConstantData;a[o]=e.ambientR*this._ambientR;a[o+1]=e.ambientG*this._ambientG;a[o+2]=e.ambientB*this._ambientB;a[o+3]=1}};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/LightingMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseCelMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");var o=function(e){i(t,e);function t(t,r){var i=this;if(t===void 0){t=3}if(r===void 0){r=null}e.call(this,null,r);this._smoothness=.1;this.baseMethod._iModulateMethod=function(e,t,r,n,o){return i.clampDiffuse(e,t,r,n,o)};this._levels=t}t.prototype.iInitConstants=function(t,r){var i=t.fragmentConstantData;var n=r.secondaryFragmentConstantsIndex;e.prototype.iInitConstants.call(this,t,r);i[n+1]=1;i[n+2]=0};Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},set:function(e){this._levels=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:true,configurable:true});t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._dataReg=null};t.prototype.iGetFragmentPreLightingCode=function(t,r,i,n){this._dataReg=i.getFreeFragmentConstant();r.secondaryFragmentConstantsIndex=this._dataReg.index*4;return e.prototype.iGetFragmentPreLightingCode.call(this,t,r,i,n)};t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=t.fragmentConstantData;var o=r.secondaryFragmentConstantsIndex;n[o]=this._levels;n[o+3]=this._smoothness};t.prototype.clampDiffuse=function(e,t,r,i,n){return"mul "+r+".w, "+r+".w, "+this._dataReg+".x\n"+"frc "+r+".z, "+r+".w\n"+"sub "+r+".y, "+r+".w, "+r+".z\n"+"mov "+r+".x, "+this._dataReg+".x\n"+"sub "+r+".x, "+r+".x, "+this._dataReg+".y\n"+"rcp "+r+".x,"+r+".x\n"+"mul "+r+".w, "+r+".y, "+r+".x\n"+"sub "+r+".y, "+r+".w, "+r+".x\n"+"div "+r+".z, "+r+".z, "+this._dataReg+".w\n"+"sat "+r+".z, "+r+".z\n"+"mul "+r+".w, "+r+".w, "+r+".z\n"+"sub "+r+".z, "+this._dataReg+".y, "+r+".z\n"+"mul "+r+".y, "+r+".y, "+r+".z\n"+"add "+r+".w, "+r+".w, "+r+".y\n"+"sat "+r+".w, "+r+".w\n"};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/events/ShadingMethodEvent");var o=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var a=function(e){i(t,e);function t(t,r){var i=this;if(r===void 0){r=null}e.call(this);this._onShaderInvalidatedDelegate=function(e){return i.onShaderInvalidated(e)};this.pBaseMethod=r||new o;this.pBaseMethod._iModulateMethod=t;this.pBaseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(e){if(this.pBaseMethod==e)return;this.pBaseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.pBaseMethod=e;this.pBaseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});t.prototype.iInitVO=function(e,t){this.pBaseMethod.iInitVO(e,t)};t.prototype.iInitConstants=function(e,t){this.pBaseMethod.iInitConstants(e,t)};t.prototype.dispose=function(){this.pBaseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.pBaseMethod.dispose()};Object.defineProperty(t.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(e){this.pBaseMethod.texture=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this.pBaseMethod.diffuseColor},set:function(e){this.pBaseMethod.diffuseColor=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this.pBaseMethod.ambientColor},set:function(e){this.pBaseMethod.ambientColor=e},enumerable:true,configurable:true});t.prototype.iGetFragmentPreLightingCode=function(e,t,r,i){return this.pBaseMethod.iGetFragmentPreLightingCode(e,t,r,i)};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){var a=this.pBaseMethod.iGetFragmentCodePerLight(e,t,r,i,n,o);this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg;return a};t.prototype.iGetFragmentCodePerProbe=function(e,t,r,i,n,o){var a=this.pBaseMethod.iGetFragmentCodePerProbe(e,t,r,i,n,o);this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg;return a};t.prototype.iActivate=function(e,t,r){this.pBaseMethod.iActivate(e,t,r)};t.prototype.iSetRenderState=function(e,t,r,i,n){this.pBaseMethod.iSetRenderState(e,t,r,i,n)};t.prototype.iDeactivate=function(e,t,r){this.pBaseMethod.iDeactivate(e,t,r)};t.prototype.iGetVertexCode=function(e,t,r,i){return this.pBaseMethod.iGetVertexCode(e,t,r,i)};t.prototype.iGetFragmentPostLightingCode=function(e,t,r,i,n){return this.pBaseMethod.iGetFragmentPostLightingCode(e,t,r,i,n)};t.prototype.iReset=function(){this.pBaseMethod.iReset()};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this.pBaseMethod.iCleanCompilationData()};t.prototype.onShaderInvalidated=function(e){this.iInvalidateShaderProgram()};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var a=function(e){i(t,e);function t(){e.call(this)}t.prototype.iInitConstants=function(e,t){var r=e.fragmentConstantData;var i=t.fragmentConstantsIndex;r[i]=1;r[i+1]=1/255;r[i+2]=1/65025;r[i+3]=1/16581375};t.prototype.iGetFragmentPostLightingCode=function(e,t,r,i,o){var a="";var s;var h;if(!this._pUseTexture)throw new Error("DiffuseDepthMethod requires texture!");if(e.numLights>0){if(o.shadowTarget)a+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o.shadowTarget+".w\n";a+="add "+r+".xyz, "+this._pTotalLightColorReg+".xyz, "+r+".xyz\n"+"sat "+r+".xyz, "+r+".xyz\n";i.removeFragmentTempUsage(this._pTotalLightColorReg)}s=e.numLights>0?i.getFreeFragmentVectorTemp():r;this._pDiffuseInputRegister=i.getFreeTextureReg();t.texturesIndex=this._pDiffuseInputRegister.index;h=i.getFreeFragmentConstant();t.fragmentConstantsIndex=h.index*4;a+=n.getTex2DSampleCode(s,o,this._pDiffuseInputRegister,this.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"dp4 "+s+".x, "+s+", "+h+"\n"+"mov "+s+".yz, "+s+".xx			\n"+"mov "+s+".w, "+h+".x\n"+"sub "+s+".xyz, "+h+".xxx, "+s+".xyz\n";if(e.numLights==0)return a;a+="mul "+r+".xyz, "+s+".xyz, "+r+".xyz\n"+"mov "+r+".w, "+s+".w\n";return a};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];
function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var a=function(e){i(t,e);function t(t){e.call(this);this._gradient=t}Object.defineProperty(t.prototype,"gradient",{get:function(){return this._gradient},set:function(e){if(e.format!=this._gradient.format)this.iInvalidateShaderProgram();this._gradient=e},enumerable:true,configurable:true});t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._gradientTextureRegister=null};t.prototype.iGetFragmentPreLightingCode=function(t,r,i,n){var o=e.prototype.iGetFragmentPreLightingCode.call(this,t,r,i,n);this._pIsFirstLight=true;if(t.numLights>0){this._gradientTextureRegister=i.getFreeTextureReg();r.secondaryTexturesIndex=this._gradientTextureRegister.index}return o};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,o,a){var s="";var h;if(this._pIsFirstLight)h=this._pTotalLightColorReg;else{h=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(h,1)}s+="dp3 "+h+".w, "+r+".xyz, "+a.normalFragment+".xyz\n"+"mul "+h+".w, "+h+".w, "+a.commons+".x\n"+"add "+h+".w, "+h+".w, "+a.commons+".x\n"+"mul "+h+".xyz, "+h+".w, "+r+".w\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(e,t,h,o,a);s+=n.getTex2DSampleCode(h,a,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,h,"clamp")+"mul "+h+".xyz, "+h+".xyz, "+i+".xyz\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+h+".xyz\n";o.removeFragmentTempUsage(h)}this._pIsFirstLight=false;return s};t.prototype.pApplyShadow=function(e,t,r,i){var o=r.getFreeFragmentVectorTemp();return"mov "+o+", "+i.shadowTarget+".wwww\n"+n.getTex2DSampleCode(o,i,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o,"clamp")+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+o+"\n"};t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);i.activateTexture(r.secondaryTexturesIndex,this._gradient,t.repeatTextures,t.useSmoothTextures,t.useMipmapping)};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");var a=function(e){i(t,e);function t(t,r,i,n){if(r===void 0){r="multiply"}if(i===void 0){i=false}if(n===void 0){n=null}e.call(this,null,n);this._useSecondaryUV=i;this._lightMapTexture=t;this.blendMode=r}t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV;t.needsUV=!this._useSecondaryUV};Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");if(this._blendMode==e)return;this._blendMode=e;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lightMapTexture",{get:function(){return this._lightMapTexture},set:function(e){this._lightMapTexture=e},enumerable:true,configurable:true});t.prototype.iActivate=function(t,r,i){i.activateTexture(r.secondaryTexturesIndex,this._lightMapTexture,t.repeatTextures,t.useSmoothTextures,t.useMipmapping);e.prototype.iActivate.call(this,t,r,i)};t.prototype.iGetFragmentPostLightingCode=function(r,i,o,a,s){var h;var d=a.getFreeTextureReg();var u=a.getFreeFragmentVectorTemp();i.secondaryTexturesIndex=d.index;h=n.getTex2DSampleCode(u,s,d,this._lightMapTexture,r.useSmoothTextures,r.repeatTextures,r.useMipmapping,s.secondaryUVVarying);switch(this._blendMode){case t.MULTIPLY:h+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+u+"\n";break;case t.ADD:h+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+u+"\n";break}h+=e.prototype.iGetFragmentPostLightingCode.call(this,r,i,o,a,s);return h};t.MULTIPLY="multiply";t.ADD="add";return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");var o=function(e){i(t,e);function t(t,r,i){var n=this;if(t===void 0){t=512}if(r===void 0){r=15}if(i===void 0){i=null}e.call(this,null,i);this._translucency=1;this._scatterColor=16777215;this._scatterR=1;this._scatterG=1;this._scatterB=1;this.pBaseMethod._iModulateMethod=function(e,t,r,i,o){return n.scatterLight(e,t,r,i,o)};this._scattering=.2;this._translucency=1}t.prototype.iInitConstants=function(t,r){e.prototype.iInitConstants.call(this,t,r);var i=t.vertexConstantData;var n=r.secondaryVertexConstantsIndex;i[n]=.5;i[n+1]=-.5;i[n+2]=0;i[n+3]=1;i=t.fragmentConstantData;n=r.secondaryFragmentConstantsIndex;i[n+3]=1;i[n+4]=1;i[n+5]=1/255;i[n+6]=1/65025;i[n+7]=1/16581375;i[n+10]=.5;i[n+11]=-.1};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._lightProjVarying=null;this._propReg=null;this._lightColorReg=null;this._colorReg=null;this._decReg=null;this._targetReg=null};Object.defineProperty(t.prototype,"scattering",{get:function(){return this._scattering},set:function(e){this._scattering=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"translucency",{get:function(){return this._translucency},set:function(e){this._translucency=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(e){this._scatterColor=e;this._scatterR=(e>>16&255)/255;this._scatterG=(e>>8&255)/255;this._scatterB=(e&255)/255},enumerable:true,configurable:true});t.prototype.iGetVertexCode=function(t,r,i,n){var o=e.prototype.iGetVertexCode.call(this,t,r,i,n);var a;var s;var h=i.getFreeVertexVectorTemp();s=i.getFreeVertexConstant();r.secondaryVertexConstantsIndex=s.index*4;this._lightProjVarying=i.getFreeVarying();a=i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();o+="m44 "+h+", vt0, "+a+"\n"+"div "+h+".xyz, "+h+".xyz, "+h+".w\n"+"mul "+h+".xy, "+h+".xy, "+s+".xy\n"+"add "+h+".xy, "+h+".xy, "+s+".xx\n"+"mov "+this._lightProjVarying+".xyz, "+h+".xyz\n"+"mov "+this._lightProjVarying+".w, va0.w\n";return o};t.prototype.iGetFragmentPreLightingCode=function(t,r,i,n){this._colorReg=i.getFreeFragmentConstant();this._decReg=i.getFreeFragmentConstant();this._propReg=i.getFreeFragmentConstant();r.secondaryFragmentConstantsIndex=this._colorReg.index*4;return e.prototype.iGetFragmentPreLightingCode.call(this,t,r,i,n)};t.prototype.iGetFragmentCodePerLight=function(t,r,i,n,o,a){this._pIsFirstLight=true;this._lightColorReg=n;return e.prototype.iGetFragmentCodePerLight.call(this,t,r,i,n,o,a)};t.prototype.iGetFragmentPostLightingCode=function(t,r,i,n,o){var a=e.prototype.iGetFragmentPostLightingCode.call(this,t,r,i,n,o);var s=n.getFreeFragmentVectorTemp();a+="mul "+s+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\n"+"mul "+s+".xyz, "+s+".xyz, "+this._colorReg+".xyz\n"+"add "+i+".xyz, "+i+".xyz, "+s+".xyz\n";if(this._targetReg!=o.viewDirFragment)n.removeFragmentTempUsage(i);return a};t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=r.secondaryFragmentConstantsIndex;var o=t.fragmentConstantData;o[n]=this._scatterR;o[n+1]=this._scatterG;o[n+2]=this._scatterB;o[n+8]=this._scattering;o[n+9]=this._translucency};t.prototype.iSetRenderState=function(e,t,r,i,n){i.activateTexture(t.secondaryTexturesIndex,this._depthPass._iGetDepthMap(r),e.repeatTextures,e.useSmoothTextures,e.useMipmapping);this._depthPass._iGetProjection(r).copyRawDataTo(e.vertexConstantData,t.secondaryVertexConstantsIndex+4,true)};t.prototype.scatterLight=function(e,t,r,i,n){if(!this._pIsFirstLight)return"";this._pIsFirstLight=false;var o="";var a=i.getFreeTextureReg();if(n.viewDirFragment){this._targetReg=n.viewDirFragment}else{this._targetReg=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(this._targetReg,1)}t.secondaryTexturesIndex=a.index;var s=i.getFreeFragmentVectorTemp();o+="tex "+s+", "+this._lightProjVarying+", "+a+" <2d,nearest,clamp>\n"+"dp4 "+r+".z, "+s+", "+this._decReg+"\n";o+="sub "+r+".z, "+this._lightProjVarying+".z, "+r+".z\n"+"sub "+r+".z, "+this._propReg+".x, "+r+".z\n"+"mul "+r+".z, "+this._propReg+".y, "+r+".z\n"+"sat "+r+".z, "+r+".z\n"+"neg "+r+".y, "+r+".x\n"+"mul "+r+".y, "+r+".y, "+this._propReg+".z\n"+"add "+r+".y, "+r+".y, "+this._propReg+".z\n"+"mul "+this._targetReg+".w, "+r+".z, "+r+".y\n"+"sub "+r+".y, "+this._colorReg+".w, "+this._targetReg+".w\n"+"mul "+r+".w, "+r+".w, "+r+".y\n";return o};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var o=function(e){i(t,e);function t(t){if(t===void 0){t=.5}e.call(this);this.wrapFactor=t}t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._wrapDataRegister=null};Object.defineProperty(t.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(e){this._wrapFactor=e;this._wrapFactor=1/(e+1)},enumerable:true,configurable:true});t.prototype.iGetFragmentPreLightingCode=function(t,r,i,n){var o=e.prototype.iGetFragmentPreLightingCode.call(this,t,r,i,n);this._pIsFirstLight=true;this._wrapDataRegister=i.getFreeFragmentConstant();r.secondaryFragmentConstantsIndex=this._wrapDataRegister.index*4;return o};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight){s=this._pTotalLightColorReg}else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}a+="dp3 "+s+".x, "+r+".xyz, "+o.normalFragment+".xyz\n"+"add "+s+".y, "+s+".x, "+this._wrapDataRegister+".x\n"+"mul "+s+".y, "+s+".y, "+this._wrapDataRegister+".y\n"+"sat "+s+".w, "+s+".y\n"+"mul "+s+".xz, "+s+".w, "+r+".wz\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,r,n,o);a+="mul "+s+", "+s+".x, "+i+"\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s+".xyz\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=r.secondaryFragmentConstantsIndex;var o=t.fragmentConstantData;o[n]=this._wrapFactor;o[n+1]=1/(this._wrapFactor+1)};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":undefined}],"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var a=function(e){i(t,e);function t(t,r){if(r===void 0){r=false}e.call(this);this._texture=t;this._useSecondaryUV=r}t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV;t.needsUV=!this._useSecondaryUV};Object.defineProperty(t.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(e){if(this._useSecondaryUV==e)return;this._useSecondaryUV=e;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){r.activateTexture(t.texturesIndex,this._texture,e.repeatTextures,e.useSmoothTextures,e.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a=i.getFreeTextureReg();var s=i.getFreeFragmentVectorTemp();var h=this._useSecondaryUV?o.secondaryUVVarying:o.uvVarying;t.texturesIndex=a.index;return n.getTex2DSampleCode(s,o,a,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,h)+"mul "+r+", "+r+", "+s+".x\n"};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(e){i(t,e);function t(t){e.call(this);if(t.length!=20)throw new Error("Matrix length must be 20!");this._matrix=t}Object.defineProperty(t.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(e){this._matrix=e},enumerable:true,configurable:true});t.prototype.iGetFragmentCode=function(e,t,r,i,n){var o="";var a=i.getFreeFragmentConstant();i.getFreeFragmentConstant();i.getFreeFragmentConstant();i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();t.fragmentConstantsIndex=a.index*4;var h=i.getFreeFragmentVectorTemp();o+="m44 "+h+", "+r+", "+a+"\n"+"add "+r+", "+h+", "+s+"\n";return o};t.prototype.iActivate=function(e,t,r){var i=this._matrix;var n=t.fragmentConstantsIndex;var o=e.fragmentConstantData;o[n]=i[0];o[n+1]=i[1];o[n+2]=i[2];o[n+3]=i[3];o[n+4]=i[5];o[n+5]=i[6];o[n+6]=i[7];o[n+7]=i[8];o[n+8]=i[10];o[n+9]=i[11];o[n+10]=i[12];o[n+11]=i[13];o[n+12]=i[15];o[n+13]=i[16];o[n+14]=i[17];o[n+15]=i[18];o[n+16]=i[4];o[n+17]=i[9];o[n+18]=i[14];o[n+19]=i[19]};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(e){i(t,e);function t(){e.call(this)}Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(e){this._colorTransform=e},enumerable:true,configurable:true});t.prototype.iGetFragmentCode=function(e,t,r,i,n){var o="";var a=i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();t.fragmentConstantsIndex=a.index*4;o+="mul "+r+", "+r+", "+a+"\n"+"add "+r+", "+r+", "+s+"\n";return o};t.prototype.iActivate=function(e,t,r){var i=1/255;var n=t.fragmentConstantsIndex;var o=e.fragmentConstantData;o[n]=this._colorTransform.redMultiplier;o[n+1]=this._colorTransform.greenMultiplier;o[n+2]=this._colorTransform.blueMultiplier;o[n+3]=this._colorTransform.alphaMultiplier;o[n+4]=this._colorTransform.redOffset*i;o[n+5]=this._colorTransform.greenOffset*i;o[n+6]=this._colorTransform.blueOffset*i;o[n+7]=this._colorTransform.alphaOffset*i};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var a=function(e){i(t,e);function t(t,r){if(r===void 0){r=1}e.call(this);this._cubeTexture=t;this._alpha=r}Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){if(e!=this._mask||e&&this._mask&&e.format!=this._mask.format)this.iInvalidateShaderProgram();this._mask=e},enumerable:true,configurable:true});t.prototype.iInitVO=function(e,t){t.needsNormals=true;t.needsView=true;t.needsUV=this._mask!=null};Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:true,configurable:true});t.prototype.dispose=function(){};Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){e.fragmentConstantData[t.fragmentConstantsIndex]=this._alpha;r.activateCubeTexture(t.texturesIndex,this._cubeTexture,e.useSmoothTextures,e.useMipmapping);if(this._mask)r.activateTexture(t.texturesIndex+1,this._mask,e.repeatTextures,e.useSmoothTextures,e.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a=i.getFreeFragmentConstant();var s=i.getFreeFragmentVectorTemp();var h="";var d=i.getFreeTextureReg();t.texturesIndex=d.index;t.fragmentConstantsIndex=a.index*4;i.addFragmentTempUsages(s,1);var u=i.getFreeFragmentVectorTemp();h+="dp3 "+s+".w, "+o.viewDirFragment+".xyz, "+o.normalFragment+".xyz\n"+"add "+s+".w, "+s+".w, "+s+".w\n"+"mul "+s+".xyz, "+o.normalFragment+".xyz, "+s+".w\n"+"sub "+s+".xyz, "+s+".xyz, "+o.viewDirFragment+".xyz\n"+n.getTexCubeSampleCode(s,d,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,s)+"sub "+u+".w, "+s+".w, fc0.x\n"+"kil "+u+".w\n"+"sub "+s+", "+s+", "+r+"\n";if(this._mask)h+=n.getTex2DSampleCode(u,o,i.getFreeTextureReg(),this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+s+", "+u+", "+s+"\n";h+="mul "+s+", "+s+", "+a+".x\n"+"add "+r+", "+r+", "+s+"\n";i.removeFragmentTempUsage(s);return h};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/EffectFogMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(e){i(t,e);function t(t,r,i){if(i===void 0){i=8421504}e.call(this);this._minDistance=0;this._maxDistance=1e3;this.minDistance=t;this.maxDistance=r;this.fogColor=i}t.prototype.iInitVO=function(e,t){t.needsProjection=true};t.prototype.iInitConstants=function(e,t){var r=e.fragmentConstantData;var i=t.fragmentConstantsIndex;r[i+3]=1;r[i+6]=0;r[i+7]=0};Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},set:function(e){this._minDistance=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._fogColor},set:function(e){this._fogColor=e;this._fogR=(e>>16&255)/255;this._fogG=(e>>8&255)/255;this._fogB=(e&255)/255},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){var i=e.fragmentConstantData;var n=t.fragmentConstantsIndex;i[n]=this._fogR;i[n+1]=this._fogG;i[n+2]=this._fogB;i[n+4]=this._minDistance;i[n+5]=1/(this._maxDistance-this._minDistance)};t.prototype.iGetFragmentCode=function(e,t,r,i,n){var o=i.getFreeFragmentConstant();var a=i.getFreeFragmentConstant();var s=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(s,1);var h=i.getFreeFragmentVectorTemp();var d="";t.fragmentConstantsIndex=o.index*4;d+="sub "+h+".w, "+n.projectionFragment+".z, "+a+".x\n"+"mul "+h+".w, "+h+".w, "+a+".y\n"+"sat "+h+".w, "+h+".w\n"+"sub "+s+", "+o+", "+r+"\n"+"mul "+s+", "+s+", "+h+".w\n"+"add "+r+", "+r+", "+s+"\n";i.removeFragmentTempUsage(s);return d};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var a=function(e){i(t,e);function t(t,r){if(r===void 0){r=1}e.call(this);this._fresnelPower=5;this._normalReflectance=0;this._cubeTexture=t;this._alpha=r}t.prototype.iInitVO=function(e,t){t.needsNormals=true;t.needsView=true;t.needsUV=this._mask!=null};t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1};Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){if(Boolean(e)!=Boolean(this._mask)||e&&this._mask&&e.format!=this._mask.format){this.iInvalidateShaderProgram()}this._mask=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){var i=e.fragmentConstantData;var n=t.fragmentConstantsIndex;i[n]=this._alpha;i[n+1]=this._normalReflectance;i[n+2]=this._fresnelPower;r.activateCubeTexture(t.texturesIndex,this._cubeTexture,e.useSmoothTextures,e.useMipmapping);if(this._mask)r.activateTexture(t.texturesIndex+1,this._mask,e.repeatTextures,e.useSmoothTextures,e.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a=i.getFreeFragmentConstant();var s=i.getFreeFragmentVectorTemp();var h="";var d=i.getFreeTextureReg();var u=o.viewDirFragment;var p=o.normalFragment;t.texturesIndex=d.index;t.fragmentConstantsIndex=a.index*4;i.addFragmentTempUsages(s,1);var l=i.getFreeFragmentVectorTemp();h+="dp3 "+s+".w, "+u+".xyz, "+p+".xyz\n"+"add "+s+".w, "+s+".w, "+s+".w\n"+"mul "+s+".xyz, "+p+".xyz, "+s+".w\n"+"sub "+s+".xyz, "+s+".xyz, "+u+".xyz\n"+n.getTexCubeSampleCode(s,d,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,s)+"sub "+l+".w, "+s+".w, fc0.x\n"+"kil "+l+".w\n"+"sub "+s+", "+s+", "+r+"\n";h+="dp3 "+u+".w, "+u+".xyz, "+p+".xyz\n"+"sub "+u+".w, "+a+".w, "+u+".w\n"+"pow "+u+".w, "+u+".w, "+a+".z\n"+"sub "+p+".w, "+a+".w, "+u+".w\n"+"mul "+p+".w, "+a+".y, "+p+".w\n"+"add "+u+".w, "+u+".w, "+p+".w\n"+"mul "+u+".w, "+a+".x, "+u+".w\n";if(this._mask){var m=i.getFreeTextureReg();h+=n.getTex2DSampleCode(l,o,m,this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+u+".w, "+l+".x, "+u+".w\n"}h+="mul "+s+", "+s+", "+u+".w\n"+"add "+r+", "+r+", "+s+"\n";i.removeFragmentTempUsage(s);return h};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/EffectLightMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var a=function(e){i(t,e);function t(t,r,i){if(r===void 0){r="multiply"}if(i===void 0){i=false}e.call(this);this._useSecondaryUV=i;this._texture=t;this.blendMode=r}t.prototype.iInitVO=function(e,t){t.needsUV=!this._useSecondaryUV;t.needsSecondaryUV=this._useSecondaryUV};Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");if(this._blendMode==e)return;this._blendMode=e;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){if(e.format!=this._texture.format)this.iInvalidateShaderProgram();this._texture=e},enumerable:true,configurable:true});t.prototype.iActivate=function(t,r,i){i.activateTexture(r.texturesIndex,this._texture,t.repeatTextures,t.useSmoothTextures,t.useMipmapping);e.prototype.iActivate.call(this,t,r,i)};t.prototype.iGetFragmentCode=function(e,r,i,o,a){var s;var h=o.getFreeTextureReg();var d=o.getFreeFragmentVectorTemp();r.texturesIndex=h.index;s=n.getTex2DSampleCode(d,a,h,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,this._useSecondaryUV?a.secondaryUVVarying:a.uvVarying);switch(this._blendMode){case t.MULTIPLY:s+="mul "+i+", "+i+", "+d+"\n";break;case t.ADD:s+="add "+i+", "+i+", "+d+"\n";break}return s};t.MULTIPLY="multiply";t.ADD="add";return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/EffectMethodBase":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/library/AssetType");var o=e("awayjs-core/lib/errors/AbstractMethodError");var a=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var s=function(e){i(t,e);function t(){e.call(this)}Object.defineProperty(t.prototype,"assetType",{get:function(){return n.EFFECTS_METHOD},enumerable:true,configurable:true});t.prototype.iGetFragmentCode=function(e,t,r,i,n){throw new o;return""};return t}(a);t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AssetType":undefined,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var a=function(e){i(t,e);function t(t,r,i,n,o){if(r===void 0){r=.1}if(i===void 0){i=0}if(n===void 0){n=0}if(o===void 0){o=0}e.call(this);this._dispersionR=0;this._dispersionG=0;this._dispersionB=0;this._alpha=1;this._envMap=t;this._dispersionR=i;this._dispersionG=n;this._dispersionB=o;this._useDispersion=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._refractionIndex=r}t.prototype.iInitConstants=function(e,t){var r=t.fragmentConstantsIndex;var i=e.fragmentConstantData;i[r+4]=1;i[r+5]=0;i[r+7]=1};t.prototype.iInitVO=function(e,t){t.needsNormals=true;t.needsView=true};Object.defineProperty(t.prototype,"envMap",{get:function(){return this._envMap},set:function(e){this._envMap=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(e){this._refractionIndex=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(e){this._dispersionR=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=t){this.iInvalidateShaderProgram();this._useDispersion=t}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(e){this._dispersionG=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=t){this.iInvalidateShaderProgram();this._useDispersion=t}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(e){this._dispersionB=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=t){this.iInvalidateShaderProgram();this._useDispersion=t}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){var i=t.fragmentConstantsIndex;var n=e.fragmentConstantData;n[i]=this._dispersionR+this._refractionIndex;if(this._useDispersion){n[i+1]=this._dispersionG+this._refractionIndex;n[i+2]=this._dispersionB+this._refractionIndex}n[i+3]=this._alpha;r.activateCubeTexture(t.texturesIndex,this._envMap,e.useSmoothTextures,e.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a=i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();var h="";var d=i.getFreeTextureReg();var u;var p;var l;t.texturesIndex=d.index;t.fragmentConstantsIndex=a.index*4;u=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(u,1);p=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(p,1);l=i.getFreeFragmentVectorTemp();var m=o.viewDirFragment;var c=o.normalFragment;h+="neg "+m+".xyz, "+m+".xyz\n";h+="dp3 "+l+".x, "+m+".xyz, "+c+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+a+".x, "+l+".w\n"+"mul "+l+".w, "+a+".x, "+l+".w\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+a+".x, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+c+".xyz\n"+"mul "+u+", "+a+".x, "+m+"\n"+"sub "+u+".xyz, "+u+".xyz, "+l+".xyz\n"+"nrm "+u+".xyz, "+u+".xyz\n";h+=n.getTexCubeSampleCode(p,d,this._envMap,e.useSmoothTextures,e.useMipmapping,u)+"sub "+p+".w, "+p+".w, fc0.x	\n"+"kil "+p+".w\n";if(this._useDispersion){h+="dp3 "+l+".x, "+m+".xyz, "+c+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+a+".y, "+l+".w\n"+"mul "+l+".w, "+a+".y, "+l+".w\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+a+".y, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+c+".xyz\n"+"mul "+u+", "+a+".y, "+m+"\n"+"sub "+u+".xyz, "+u+".xyz, "+l+".xyz\n"+"nrm "+u+".xyz, "+u+".xyz\n";h+=n.getTexCubeSampleCode(l,d,this._envMap,e.useSmoothTextures,e.useMipmapping,u)+"mov "+p+".y, "+l+".y\n";h+="dp3 "+l+".x, "+m+".xyz, "+c+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+a+".z, "+l+".w\n"+"mul "+l+".w, "+a+".z, "+l+".w\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+a+".z, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+c+".xyz\n"+"mul "+u+", "+a+".z, "+m+"\n"+"sub "+u+".xyz, "+u+".xyz, "+l+".xyz\n"+"nrm "+u+".xyz, "+u+".xyz\n";h+=n.getTexCubeSampleCode(l,d,this._envMap,e.useSmoothTextures,e.useMipmapping,u)+"mov "+p+".z, "+l+".z\n"}i.removeFragmentTempUsage(u);h+="sub "+p+".xyz, "+p+".xyz, "+r+".xyz\n"+"mul "+p+".xyz, "+p+".xyz, "+a+".w\n"+"add "+r+".xyz, "+r+".xyz, "+p+".xyz\n";i.removeFragmentTempUsage(p);h+="neg "+m+".xyz, "+m+".xyz\n";return h};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/EffectRimLightMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(e){i(t,e);function t(t,r,i,n){if(t===void 0){t=16777215}if(r===void 0){r=.4}if(i===void 0){i=2}if(n===void 0){n="mix"}e.call(this);this._blendMode=n;this._strength=r;
this._power=i;this.color=t}t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1};t.prototype.iInitVO=function(e,t){t.needsNormals=true;t.needsView=true};Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(this._blendMode==e)return;this._blendMode=e;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e;this._colorR=(e>>16&255)/255;this._colorG=(e>>8&255)/255;this._colorB=(e&255)/255},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"strength",{get:function(){return this._strength},set:function(e){this._strength=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"power",{get:function(){return this._power},set:function(e){this._power=e},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){var i=t.fragmentConstantsIndex;var n=e.fragmentConstantData;n[i]=this._colorR;n[i+1]=this._colorG;n[i+2]=this._colorB;n[i+4]=this._strength;n[i+5]=this._power};t.prototype.iGetFragmentCode=function(e,r,i,n,o){var a=n.getFreeFragmentConstant();var s=n.getFreeFragmentConstant();var h=n.getFreeFragmentVectorTemp();var d="";r.fragmentConstantsIndex=a.index*4;d+="dp3 "+h+".x, "+o.viewDirFragment+".xyz, "+o.normalFragment+".xyz\n"+"sat "+h+".x, "+h+".x\n"+"sub "+h+".x, "+a+".w, "+h+".x\n"+"pow "+h+".x, "+h+".x, "+s+".y\n"+"mul "+h+".x, "+h+".x, "+s+".x\n"+"sub "+h+".x, "+a+".w, "+h+".x\n"+"mul "+i+".xyz, "+i+".xyz, "+h+".x\n"+"sub "+h+".w, "+a+".w, "+h+".x\n";if(this._blendMode==t.ADD){d+="mul "+h+".xyz, "+h+".w, "+a+".xyz\n"+"add "+i+".xyz, "+i+".xyz, "+h+".xyz\n"}else if(this._blendMode==t.MULTIPLY){d+="mul "+h+".xyz, "+h+".w, "+a+".xyz\n"+"mul "+i+".xyz, "+i+".xyz, "+h+".xyz\n"}else{d+="sub "+h+".xyz, "+a+".xyz, "+i+".xyz\n"+"mul "+h+".xyz, "+h+".xyz, "+h+".w\n"+"add "+i+".xyz, "+i+".xyz, "+h+".xyz\n"}return d};t.ADD="add";t.MULTIPLY="multiply";t.MIX="mix";return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/LightingMethodBase":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var o=function(e){i(t,e);function t(){e.call(this)}t.prototype.iGetFragmentPreLightingCode=function(e,t,r,i){return""};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){return""};t.prototype.iGetFragmentCodePerProbe=function(e,t,r,i,n,o){return""};t.prototype.iGetFragmentPostLightingCode=function(e,t,r,i,n){return""};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/NormalBasicMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var a=function(e){i(t,e);function t(){e.call(this)}t.prototype.iIsUsed=function(e){if(!this._useTexture||!e.normalDependencies)return false;return true};t.prototype.iInitVO=function(e,t){t.needsUV=this._useTexture};t.prototype.iOutputsTangentNormals=function(){return true};t.prototype.copyFrom=function(e){var t=e;var r=e;if(r.normalMap!=null)this.normalMap=r.normalMap};Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._texture},set:function(e){var t=e!=null;if(t!=this._useTexture||e&&this._texture&&e.format!=this._texture.format)this.iInvalidateShaderProgram();this._useTexture=t;this._texture=e},enumerable:true,configurable:true});t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._pNormalTextureRegister=null};t.prototype.dispose=function(){if(this._texture)this._texture=null};t.prototype.iActivate=function(e,t,r){if(t.texturesIndex>=0)r.activateTexture(t.texturesIndex,this._texture,e.repeatTextures,e.useSmoothTextures,e.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){this._pNormalTextureRegister=i.getFreeTextureReg();t.texturesIndex=this._pNormalTextureRegister.index;return n.getTex2DSampleCode(r,o,this._pNormalTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"sub "+r+".xyz, "+r+".xyz, "+o.commons+".xxx\n"+"nrm "+r+".xyz, "+r+"\n"};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/NormalHeightMapMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/NormalBasicMethod");var a=function(e){i(t,e);function t(t,r,i,n){e.call(this);this.normalMap=t;this._worldXYRatio=r/i;this._worldXZRatio=n/i}t.prototype.iInitConstants=function(e,t){var r=t.fragmentConstantsIndex;var i=e.fragmentConstantData;i[r]=1/this.normalMap.width;i[r+1]=1/this.normalMap.height;i[r+2]=0;i[r+3]=1;i[r+4]=this._worldXYRatio;i[r+5]=this._worldXZRatio};Object.defineProperty(t.prototype,"tangentSpace",{get:function(){return false},enumerable:true,configurable:true});t.prototype.copyFrom=function(t){e.prototype.copyFrom.call(this,t);this._worldXYRatio=t._worldXYRatio;this._worldXZRatio=t._worldXZRatio};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a=i.getFreeFragmentVectorTemp();var s=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();this._pNormalTextureRegister=i.getFreeTextureReg();t.texturesIndex=this._pNormalTextureRegister.index;t.fragmentConstantsIndex=s.index*4;return n.getTex2DSampleCode(r,o,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o.uvVarying,"clamp")+"add "+a+", "+o.uvVarying+", "+s+".xzzz\n"+n.getTex2DSampleCode(a,o,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,a,"clamp")+"sub "+r+".x, "+r+".x, "+a+".x\n"+"add "+a+", "+o.uvVarying+", "+s+".zyzz\n"+n.getTex2DSampleCode(a,o,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,a,"clamp")+"sub "+r+".z, "+r+".z, "+a+".x\n"+"mov "+r+".y, "+s+".w\n"+"mul "+r+".xz, "+r+".xz, "+h+".xy\n"+"nrm "+r+".xyz, "+r+".xyz\n"};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/NormalBasicMethod":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/NormalBasicMethod");var a=function(e){i(t,e);function t(t,r){e.call(this);this._useSecondNormalMap=false;this._water1OffsetX=0;this._water1OffsetY=0;this._water2OffsetX=0;this._water2OffsetY=0;this.normalMap=t;this.secondaryNormalMap=r}t.prototype.iInitConstants=function(e,t){var r=t.fragmentConstantsIndex;var i=e.fragmentConstantData;i[r]=.5;i[r+1]=0;i[r+2]=0;i[r+3]=1};t.prototype.iInitVO=function(t,r){e.prototype.iInitVO.call(this,t,r);this._useSecondNormalMap=this.normalMap!=this.secondaryNormalMap};Object.defineProperty(t.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(e){this._water1OffsetX=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(e){this._water1OffsetY=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(e){this._water2OffsetX=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(e){this._water2OffsetY=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"secondaryNormalMap",{get:function(){return this._texture2},set:function(e){this._texture2=e},enumerable:true,configurable:true});t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._normalTextureRegister2=null};t.prototype.dispose=function(){e.prototype.dispose.call(this);this._texture2=null};t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=t.fragmentConstantData;var o=r.fragmentConstantsIndex;n[o+4]=this._water1OffsetX;n[o+5]=this._water1OffsetY;n[o+6]=this._water2OffsetX;n[o+7]=this._water2OffsetY;if(this._useSecondNormalMap)i.activateTexture(r.texturesIndex+1,this._texture2,t.repeatTextures,t.useSmoothTextures,t.useMipmapping)};t.prototype.iGetFragmentCode=function(e,t,r,i,o){var a=i.getFreeFragmentVectorTemp();var s=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();this._pNormalTextureRegister=i.getFreeTextureReg();this._normalTextureRegister2=this._useSecondNormalMap?i.getFreeTextureReg():this._pNormalTextureRegister;t.texturesIndex=this._pNormalTextureRegister.index;t.fragmentConstantsIndex=s.index*4;return"add "+a+", "+o.uvVarying+", "+h+".xyxy\n"+n.getTex2DSampleCode(r,o,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,a)+"add "+a+", "+o.uvVarying+", "+h+".zwzw\n"+n.getTex2DSampleCode(a,o,this._normalTextureRegister2,this._texture2,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,a)+"add "+r+", "+r+", "+a+"		\n"+"mul "+r+", "+r+", "+s+".x	\n"+"sub "+r+".xyz, "+r+".xyz, "+o.commons+".xxx	\n"+"nrm "+r+".xyz, "+r+".xyz							\n"};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/NormalBasicMethod":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/ShadingMethodBase":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/library/NamedAssetBase");var o=e("awayjs-renderergl/lib/events/ShadingMethodEvent");var a=function(e){i(t,e);function t(){e.call(this)}t.prototype.iIsUsed=function(e){return true};t.prototype.iInitVO=function(e,t){};t.prototype.iInitConstants=function(e,t){};t.prototype.iUsesTangentSpace=function(){return true};t.prototype.dispose=function(){};t.prototype.iReset=function(){this.iCleanCompilationData()};t.prototype.iCleanCompilationData=function(){};t.prototype.iGetVertexCode=function(e,t,r,i){return""};t.prototype.iGetFragmentCode=function(e,t,r,i,n){return null};t.prototype.iActivate=function(e,t,r){};t.prototype.iSetRenderState=function(e,t,r,i,n){};t.prototype.iDeactivate=function(e,t,r){};t.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new o(o.SHADER_INVALIDATED))};t.prototype.copyFrom=function(e){};return t}(n);t.exports=a},{"awayjs-core/lib/library/NamedAssetBase":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/ShadowCascadeMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/events/Event");var o=e("awayjs-display/lib/entities/DirectionalLight");var a=e("awayjs-renderergl/lib/events/ShadingMethodEvent");var s=e("awayjs-methodmaterials/lib/data/MethodVO");var h=e("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");var d=function(e){i(t,e);function t(t){var r=this;e.call(this,t.castingLight);this._baseMethod=t;if(!(this._pCastingLight instanceof o))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");this._cascadeShadowMapper=this._pCastingLight.shadowMapper;if(!this._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");this._cascadeShadowMapper.addEventListener(n.CHANGE,function(e){return r.onCascadeChange(e)});this._baseMethod.addEventListener(a.SHADER_INVALIDATED,function(e){return r.onShaderInvalidated(e)})}Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){var t=this;if(this._baseMethod==e)return;this._baseMethod.removeEventListener(a.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)});this._baseMethod=e;this._baseMethod.addEventListener(a.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)});this.iInvalidateShaderProgram()},enumerable:true,configurable:true});t.prototype.iInitVO=function(e,t){var r=new s(this._baseMethod);this._baseMethod.iInitVO(e,r);t.needsGlobalVertexPos=true;t.needsProjection=true};t.prototype.iInitConstants=function(e,t){var r=e.fragmentConstantData;var i=e.vertexConstantData;var n=t.fragmentConstantsIndex;r[n]=1;r[n+1]=1/255;r[n+2]=1/65025;r[n+3]=1/16581375;r[n+6]=.5;r[n+7]=-.5;n=t.vertexConstantsIndex;i[n]=.5;i[n+1]=-.5;i[n+2]=0};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._cascadeProjections=null;this._depthMapCoordVaryings=null};t.prototype.iGetVertexCode=function(e,t,r,i){var n="";var o=r.getFreeVertexConstant();this.initProjectionsRegs(r);t.vertexConstantsIndex=o.index*4;var a=r.getFreeVertexVectorTemp();for(var s=0;s<this._cascadeShadowMapper.numCascades;++s){n+="m44 "+a+", "+i.globalPositionVertex+", "+this._cascadeProjections[s]+"\n"+"add "+this._depthMapCoordVaryings[s]+", "+a+", "+o+".zzwz\n"}return n};t.prototype.initProjectionsRegs=function(e){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades);this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var t=0;t<this._cascadeShadowMapper.numCascades;++t){this._depthMapCoordVaryings[t]=e.getFreeVarying();this._cascadeProjections[t]=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant()}};t.prototype.iGetFragmentCode=function(e,t,r,i,n){var o=this._cascadeShadowMapper.numCascades;var a=i.getFreeTextureReg();var s=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();var d=i.getFreeFragmentConstant();var u=Array(d+".x",d+".y",d+".z",d+".w");var p;t.fragmentConstantsIndex=s.index*4;t.texturesIndex=a.index;var l=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(l,1);var m=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(m,1);p="mov "+m+", "+this._depthMapCoordVaryings[o-1]+"\n";for(var c=o-2;c>=0;--c){var f=this._depthMapCoordVaryings[c];p+="slt "+l+".z, "+n.projectionFragment+".z, "+u[c]+"\n";var g=i.getFreeFragmentVectorTemp();p+="sub "+g+", "+f+", "+m+"\n"+"mul "+g+", "+g+", "+l+".z\n"+"add "+m+", "+m+", "+g+"\n"}i.removeFragmentTempUsage(l);p+="div "+m+", "+m+", "+m+".w\n"+"mul "+m+".xy, "+m+".xy, "+h+".zw\n"+"add "+m+".xy, "+m+".xy, "+h+".zz\n";p+=this._baseMethod._iGetCascadeFragmentCode(e,t,s,a,m,r,i,n)+"add "+r+".w, "+r+".w, "+h+".y\n";i.removeFragmentTempUsage(m);return p};t.prototype.iActivate=function(e,t,r){r.activateTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap,e.repeatTextures,e.useSmoothTextures,e.useMipmapping);var i=e.vertexConstantData;var n=t.vertexConstantsIndex;e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var o=this._cascadeShadowMapper.numCascades;n+=4;for(var a=0;a<o;++a){this._cascadeShadowMapper.getDepthProjections(a).copyRawDataTo(i,n,true);n+=16}var s=e.fragmentConstantData;var h=t.fragmentConstantsIndex;s[h+5]=1-this._pAlpha;var d=this._cascadeShadowMapper._iNearPlaneDistances;h+=8;for(var u=0;u<o;++u)s[h+u]=d[u];this._baseMethod.iActivateForCascade(e,t,r)};t.prototype.iSetRenderState=function(e,t,r,i,n){};t.prototype.onCascadeChange=function(e){this.iInvalidateShaderProgram()};t.prototype.onShaderInvalidated=function(e){this.iInvalidateShaderProgram()};return t}(h);t.exports=d},{"awayjs-core/lib/events/Event":undefined,"awayjs-display/lib/entities/DirectionalLight":undefined,"awayjs-methodmaterials/lib/data/MethodVO":undefined,"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/base/BitmapData");var o=e("awayjs-core/lib/textures/BitmapTexture");var a=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var s=function(e){i(t,e);function t(r,i,n){if(i===void 0){i=4}if(n===void 0){n=1}e.call(this,r);this._depthMapSize=this._pCastingLight.shadowMapper.depthMapSize;this.numSamples=i;this.range=n;++t._grainUsages;if(!t._grainTexture)this.initGrainTexture()}Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e;if(this._numSamples<1)this._numSamples=1;else if(this._numSamples>24)this._numSamples=24;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});t.prototype.iInitVO=function(t,r){e.prototype.iInitVO.call(this,t,r);r.needsProjection=true};t.prototype.iInitConstants=function(t,r){e.prototype.iInitConstants.call(this,t,r);var i=t.fragmentConstantData;var n=r.fragmentConstantsIndex;i[n+8]=1/this._numSamples};Object.defineProperty(t.prototype,"range",{get:function(){return this._range*2},set:function(e){this._range=e/2},enumerable:true,configurable:true});t.prototype.initGrainTexture=function(){t._grainBitmapData=new n(64,64,false);var e=new Array;var r=4096;var i=1/(this._depthMapSize*this._range);var a,s;for(var h=0;h<r;++h){a=2*(Math.random()-.5);s=2*(Math.random()-.5);if(a<0)a-=i;else a+=i;if(s<0)s-=i;else s+=i;if(a>1)a=1;else if(a<-1)a=-1;if(s>1)s=1;else if(s<-1)s=-1;e[h]=Math.floor((a*.5+.5)*255)<<16|Math.floor((s*.5+.5)*255)<<8}t._grainBitmapData.setArray(t._grainBitmapData.rect,e);t._grainTexture=new o(t._grainBitmapData)};t.prototype.dispose=function(){if(--t._grainUsages==0){t._grainTexture.dispose();t._grainBitmapData.dispose();t._grainTexture=null}};t.prototype.iActivate=function(r,i,n){e.prototype.iActivate.call(this,r,i,n);var o=r.fragmentConstantData;var a=i.fragmentConstantsIndex;o[a+9]=(n.width-1)/63;o[a+10]=(n.height-1)/63;o[a+11]=2*this._range/this._depthMapSize;n.activateTexture(i.texturesIndex+1,t._grainTexture,r.repeatTextures,r.useSmoothTextures,r.useMipmapping)};t.prototype._pGetPlanarFragmentCode=function(e,t,r,i){var n=r.getFreeTextureReg();var o=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var s=r.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;e.texturesIndex=n.index;return this.getSampleCode(s,n,o,t,r,i)};t.prototype.getSampleCode=function(e,t,r,i,n,o){var a="";var s=n.getFreeTextureReg();var h=n.getFreeFragmentVectorTemp();var d=this._numSamples;n.addFragmentTempUsages(h,1);var u=n.getFreeFragmentVectorTemp();var p=o.projectionFragment;a+="div "+h+", "+p+", "+p+".w\n"+"mul "+h+".xy, "+h+".xy, "+e+".yz\n";while(d>0){if(d==this._numSamples)a+="tex "+h+", "+h+", "+s+" <2d,nearest,repeat,mipnone>\n";else a+="tex "+h+", "+h+".zwxy, "+s+" <2d,nearest,repeat,mipnone>\n";a+="sub "+h+".zw, "+h+".xy, fc0.xx\n"+"mul "+h+".zw, "+h+".zw, "+e+".w\n";if(d==this._numSamples){a+="add "+h+".xy, "+h+".zw, "+this._pDepthMapCoordReg+".xy\n"+"tex "+u+", "+h+", "+t+" <2d,nearest,clamp,mipnone>\n"+"dp4 "+u+".z, "+u+", "+r+"\n"+"slt "+i+".w, "+this._pDepthMapCoordReg+".z, "+u+".z\n"}else{a+=this.addSample(h,t,r,i,n)}if(d>4)a+="add "+h+".xy, "+h+".xy, "+h+".zw\n"+this.addSample(h,t,r,i,n);if(d>1)a+="sub "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+h+".zw\n"+this.addSample(h,t,r,i,n);if(d>5)a+="sub "+h+".xy, "+h+".xy, "+h+".zw\n"+this.addSample(h,t,r,i,n);if(d>2){a+="neg "+h+".w, "+h+".w\n";a+="add "+h+".xy, "+h+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(h,t,r,i,n)}if(d>6)a+="add "+h+".xy, "+h+".xy, "+h+".wz\n"+this.addSample(h,t,r,i,n);if(d>3)a+="sub "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+h+".wz\n"+this.addSample(h,t,r,i,n);if(d>7)a+="sub "+h+".xy, "+h+".xy, "+h+".wz\n"+this.addSample(h,t,r,i,n);d-=8}n.removeFragmentTempUsage(h);a+="mul "+i+".w, "+i+".w, "+e+".x\n";return a};t.prototype.addSample=function(e,t,r,i,n){var o=n.getFreeFragmentVectorTemp();return"tex "+o+", "+e+", "+t+" <2d,nearest,clamp,mipnone>\n"+"dp4 "+o+".z, "+o+", "+r+"\n"+"slt "+o+".z, "+this._pDepthMapCoordReg+".z, "+o+".z\n"+"add "+i+".w, "+i+".w, "+o+".z\n"};t.prototype.iActivateForCascade=function(e,r,i){var n=e.fragmentConstantData;var o=r.secondaryFragmentConstantsIndex;n[o]=1/this._numSamples;n[o+1]=(i.width-1)/63;n[o+2]=(i.height-1)/63;n[o+3]=2*this._range/this._depthMapSize;i.activateTexture(r.texturesIndex+1,t._grainTexture,e.repeatTextures,e.useSmoothTextures,e.useMipmapping)};t.prototype._iGetCascadeFragmentCode=function(e,t,r,i,n,o,a,s){this._pDepthMapCoordReg=n;var h=a.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=h.index*4;return this.getSampleCode(h,i,r,o,a,s)};return t}(a);t.exports=s},{"awayjs-core/lib/base/BitmapData":undefined,"awayjs-core/lib/textures/BitmapTexture":undefined,"awayjs-methodmaterials/lib/methods/ShadowMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var o=function(e){i(t,e);function t(t){e.call(this,t)}t.prototype.iInitConstants=function(t,r){e.prototype.iInitConstants.call(this,t,r);var i=t.fragmentConstantData;var n=r.fragmentConstantsIndex;i[n+8]=.5;var o=this.castingLight.shadowMapper.depthMapSize;i[n+9]=o;i[n+10]=1/o};t.prototype._pGetPlanarFragmentCode=function(e,t,r,i){var n=r.getFreeTextureReg();var o=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();a=a;var s=r.getFreeFragmentConstant();var h=r.getFreeFragmentVectorTemp();var d;var u="";e.fragmentConstantsIndex=o.index*4;r.addFragmentTempUsages(h,1);d=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(d,1);u+="mov "+d+", "+this._pDepthMapCoordReg+"\n"+"tex "+h+", "+this._pDepthMapCoordReg+", "+n+" <2d, nearest, clamp>\n"+"dp4 "+h+".z, "+h+", "+o+"\n"+"slt "+d+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"add "+d+".x, "+this._pDepthMapCoordReg+".x, "+s+".z\n"+"tex "+h+", "+d+", "+n+" <2d, nearest, clamp>\n"+"dp4 "+h+".z, "+h+", "+o+"\n"+"slt "+d+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".x, "+s+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+d+".w, "+d+".w, "+d+".z\n"+"mul "+d+".w, "+d+".w, "+h+".x\n"+"add "+t+".w, "+d+".z, "+d+".w\n"+"mov "+d+".x, "+this._pDepthMapCoordReg+".x\n"+"add "+d+".y, "+this._pDepthMapCoordReg+".y, "+s+".z\n"+"tex "+h+", "+d+", "+n+" <2d, nearest, clamp>\n"+"dp4 "+h+".z, "+h+", "+o+"\n"+"slt "+d+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"add "+d+".x, "+this._pDepthMapCoordReg+".x, "+s+".z\n"+"tex "+h+", "+d+", "+n+" <2d, nearest, clamp>\n"+"dp4 "+h+".z, "+h+", "+o+"\n"+"slt "+d+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".x, "+s+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+d+".w, "+d+".w, "+d+".z\n"+"mul "+d+".w, "+d+".w, "+h+".x\n"+"add "+d+".w, "+d+".z, "+d+".w\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".y, "+s+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+d+".w, "+d+".w, "+t+".w\n"+"mul "+d+".w, "+d+".w, "+h+".x\n"+"add "+t+".w, "+t+".w, "+d+".w\n";r.removeFragmentTempUsage(h);r.removeFragmentTempUsage(d);e.texturesIndex=n.index;return u};t.prototype.iActivateForCascade=function(e,t,r){var i=this.castingLight.shadowMapper.depthMapSize;var n=t.secondaryFragmentConstantsIndex;var o=e.fragmentConstantData;o[n]=i;o[n+1]=1/i};t.prototype._iGetCascadeFragmentCode=function(e,t,r,i,n,o,a,s){var h;var d=a.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=d.index*4;var u=a.getFreeFragmentVectorTemp();a.addFragmentTempUsages(u,1);var p=a.getFreeFragmentVectorTemp();a.addFragmentTempUsages(p,1);h="tex "+u+", "+n+", "+i+" <2d, nearest, clamp>\n"+"dp4 "+u+".z, "+u+", "+r+"\n"+"slt "+p+".x, "+n+".z, "+u+".z\n"+"add "+n+".x, "+n+".x, "+d+".y\n"+"tex "+u+", "+n+", "+i+" <2d, nearest, clamp>\n"+"dp4 "+u+".z, "+u+", "+r+"\n"+"slt "+p+".z, "+n+".z, "+u+".z\n"+"add "+n+".y, "+n+".y, "+d+".y\n"+"tex "+u+", "+n+", "+i+" <2d, nearest, clamp>\n"+"dp4 "+u+".z, "+u+", "+r+"\n"+"slt "+p+".w, "+n+".z, "+u+".z\n"+"sub "+n+".x, "+n+".x, "+d+".y\n"+"tex "+u+", "+n+", "+i+" <2d, nearest, clamp>\n"+"dp4 "+u+".z, "+u+", "+r+"\n"+"slt "+p+".y, "+n+".z, "+u+".z\n"+"mul "+u+".xy, "+n+".xy, "+d+".x\n"+"frc "+u+".xy, "+u+".xy\n"+"sub "+n+", "+p+".xyzw, "+p+".zwxy\n"+"mul "+n+", "+n+", "+u+".x\n"+"add "+p+".xy, "+p+".xy, "+n+".zw\n"+"sub "+p+".y, "+p+".y, "+p+".x\n"+"mul "+p+".y, "+p+".y, "+u+".y\n"+"add "+o+".w, "+p+".x, "+p+".y\n";a.removeFragmentTempUsage(u);a.removeFragmentTempUsage(p);return h};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/ShadowHardMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var o=function(e){i(t,e);function t(t){e.call(this,t)}t.prototype._pGetPlanarFragmentCode=function(e,t,r,i){var n=r.getFreeTextureReg();var o=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var s=r.getFreeFragmentVectorTemp();var h="";e.fragmentConstantsIndex=o.index*4;e.texturesIndex=n.index;h+="tex "+s+", "+this._pDepthMapCoordReg+", "+n+" <2d, nearest, clamp>\n"+"dp4 "+s+".z, "+s+", "+o+"\n"+"slt "+t+".w, "+this._pDepthMapCoordReg+".z, "+s+".z\n";return h};t.prototype._pGetPointFragmentCode=function(e,t,r,i){var n=r.getFreeTextureReg();var o=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var s=r.getFreeFragmentConstant();var h=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(h,1);var d=r.getFreeFragmentVectorTemp();var u="";e.fragmentConstantsIndex=o.index*4;e.texturesIndex=n.index;u+="sub "+d+", "+i.globalPositionVarying+", "+s+"\n"+"dp3 "+d+".w, "+d+".xyz, "+d+".xyz\n"+"mul "+d+".w, "+d+".w, "+s+".w\n"+"nrm "+d+".xyz, "+d+".xyz\n"+"tex "+h+", "+d+", "+n+" <cube, nearest, clamp>\n"+"dp4 "+h+".z, "+h+", "+o+"\n"+"add "+t+".w, "+d+".w, "+a+".x\n"+"slt "+t+".w, "+t+".w, "+h+".z\n";r.removeFragmentTempUsage(h);return u};t.prototype._iGetCascadeFragmentCode=function(e,t,r,i,n,o,a,s){var h=a.getFreeFragmentVectorTemp();return"tex "+h+", "+n+", "+i+" <2d, nearest, clamp>\n"+"dp4 "+h+".z, "+h+", "+r+"\n"+"slt "+o+".w, "+n+".z, "+h+".z\n"};t.prototype.iActivateForCascade=function(e,t,r){};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/library/AssetType");var o=e("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var a=function(e){i(t,e);function t(t){e.call(this);this._pEpsilon=.02;this._pAlpha=1;this._pCastingLight=t;t.castsShadows=true;this._pShadowMapper=t.shadowMapper}Object.defineProperty(t.prototype,"assetType",{get:function(){return n.SHADOW_MAP_METHOD},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._pAlpha},set:function(e){this._pAlpha=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(e){this._pEpsilon=e},enumerable:true,configurable:true});return t}(o);t.exports=a},{"awayjs-core/lib/library/AssetType":undefined,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/ShadowMethodBase":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/errors/AbstractMethodError");var o=e("awayjs-display/lib/entities/PointLight");var a=e("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");var s=function(e){i(t,e);function t(t){this._pUsePoint=t instanceof o;e.call(this,t)}t.prototype.iInitVO=function(e,t){t.needsView=true;t.needsGlobalVertexPos=true;t.needsGlobalFragmentPos=this._pUsePoint;t.needsNormals=e.numLights>0};t.prototype.iInitConstants=function(e,t){var r=e.fragmentConstantData;var i=e.vertexConstantData;var n=t.fragmentConstantsIndex;r[n]=1;r[n+1]=1/255;r[n+2]=1/65025;r[n+3]=1/16581375;r[n+6]=0;r[n+7]=1;if(this._pUsePoint){r[n+8]=0;r[n+9]=0;r[n+10]=0;r[n+11]=1}n=t.vertexConstantsIndex;if(n!=-1){i[n]=.5;i[n+1]=.5;i[n+2]=0;i[n+3]=1}};Object.defineProperty(t.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(e){this._pDepthMapCoordReg=e},enumerable:true,configurable:true});t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._pDepthMapCoordReg=null};t.prototype.iGetVertexCode=function(e,t,r,i){return this._pUsePoint?this._pGetPointVertexCode(t,r,i):this.pGetPlanarVertexCode(t,r,i)};t.prototype._pGetPointVertexCode=function(e,t,r){e.vertexConstantsIndex=-1;return""};t.prototype.pGetPlanarVertexCode=function(e,t,r){var i="";var n=t.getFreeVertexVectorTemp();var o=t.getFreeVertexConstant();var a=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();this._pDepthMapCoordReg=t.getFreeVarying();e.vertexConstantsIndex=o.index*4;i+="m44 "+n+", "+r.globalPositionVertex+", "+a+"\n"+"div "+n+", "+n+", "+n+".w\n"+"mul "+n+".xy, "+n+".xy, "+o+".xy\n"+"add "+this._pDepthMapCoordReg+", "+n+", "+o+".xxwz\n";return i};t.prototype.iGetFragmentCode=function(e,t,r,i,n){var o=this._pUsePoint?this._pGetPointFragmentCode(t,r,i,n):this._pGetPlanarFragmentCode(t,r,i,n);o+="add "+r+".w, "+r+".w, fc"+(t.fragmentConstantsIndex/4+1)+".y\n"+"sat "+r+".w, "+r+".w\n";return o};t.prototype._pGetPlanarFragmentCode=function(e,t,r,i){throw new n;return""};t.prototype._pGetPointFragmentCode=function(e,t,r,i){throw new n;return""};t.prototype.iSetRenderState=function(e,t,r,i,n){if(!this._pUsePoint)this._pShadowMapper.iDepthProjection.copyRawDataTo(e.vertexConstantData,t.vertexConstantsIndex+4,true)};t.prototype._iGetCascadeFragmentCode=function(e,t,r,i,n,o,a,s){throw new Error("This shadow method is incompatible with cascade shadows")};t.prototype.iActivate=function(e,t,r){var i=e.fragmentConstantData;var n=t.fragmentConstantsIndex;if(this._pUsePoint)i[n+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2);else e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon);i[n+5]=1-this._pAlpha;if(this._pUsePoint){var o=this._pCastingLight.scenePosition;i[n+8]=o.x;i[n+9]=o.y;i[n+10]=o.z;var a=this._pCastingLight.fallOff;i[n+11]=1/(2*a*a)}if(!this._pUsePoint)r.activateRenderTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap)};t.prototype.iActivateForCascade=function(e,t,r){throw new Error("This shadow method is incompatible with cascade shadows")};return t}(a);t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-display/lib/entities/PointLight":undefined,"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/ShadowNearMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];
function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/events/ShadingMethodEvent");var o=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var a=function(e){i(t,e);function t(t,r){var i=this;if(r===void 0){r=.1}e.call(this,t.castingLight);this._onShaderInvalidatedDelegate=function(e){return i.onShaderInvalidated(e)};this._baseMethod=t;this._fadeRatio=r;this._nearShadowMapper=this._pCastingLight.shadowMapper;if(!this._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");this._baseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){if(this._baseMethod==e)return;this._baseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod=e;this._baseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});t.prototype.iInitConstants=function(t,r){e.prototype.iInitConstants.call(this,t,r);this._baseMethod.iInitConstants(t,r);var i=t.fragmentConstantData;var n=r.secondaryFragmentConstantsIndex;i[n+2]=0;i[n+3]=1};t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t);t.needsProjection=true};t.prototype.dispose=function(){this._baseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)};Object.defineProperty(t.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(e){this._baseMethod.alpha=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(e){this._baseMethod.epsilon=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(e){this._fadeRatio=e},enumerable:true,configurable:true});t.prototype.iGetFragmentCode=function(e,t,r,i,n){var o=this._baseMethod.iGetFragmentCode(e,t,r,i,n);var a=i.getFreeFragmentConstant();var s=i.getFreeFragmentSingleTemp();t.secondaryFragmentConstantsIndex=a.index*4;o+="abs "+s+", "+n.projectionFragment+".w\n"+"sub "+s+", "+s+", "+a+".x\n"+"mul "+s+", "+s+", "+a+".y\n"+"sat "+s+", "+s+"\n"+"sub "+s+", "+a+".w,"+s+"\n"+"sub "+r+".w, "+a+".w,"+r+".w\n"+"mul "+r+".w, "+r+".w, "+s+"\n"+"sub "+r+".w, "+a+".w,"+r+".w\n";return o};t.prototype.iActivate=function(e,t,r){this._baseMethod.iActivate(e,t,r)};t.prototype.iDeactivate=function(e,t,r){this._baseMethod.iDeactivate(e,t,r)};t.prototype.iSetRenderState=function(e,t,r,i,n){var o=n.projection.near;var a=n.projection.far-o;var s=this._nearShadowMapper.coverageRatio;var h=s*(1-this._fadeRatio);s=o+s*a;h=o+h*a;var d=e.fragmentConstantData;var u=t.secondaryFragmentConstantsIndex;d[u]=h;d[u+1]=1/(s-h);this._baseMethod.iSetRenderState(e,t,r,i,n)};t.prototype.iGetVertexCode=function(e,t,r,i){return this._baseMethod.iGetVertexCode(e,t,r,i)};t.prototype.iReset=function(){this._baseMethod.iReset()};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};t.prototype.onShaderInvalidated=function(e){this.iInvalidateShaderProgram()};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/ShadowSoftMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/geom/PoissonLookup");var o=e("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var a=function(e){i(t,e);function t(t,r,i){if(r===void 0){r=5}if(i===void 0){i=1}e.call(this,t);this._range=1;this.numSamples=r;this.range=i}Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e;if(this._numSamples<1)this._numSamples=1;else if(this._numSamples>32)this._numSamples=32;this._offsets=n.getDistribution(this._numSamples);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e},enumerable:true,configurable:true});t.prototype.iInitConstants=function(t,r){e.prototype.iInitConstants.call(this,t,r);t.fragmentConstantData[r.fragmentConstantsIndex+8]=1/this._numSamples;t.fragmentConstantData[r.fragmentConstantsIndex+9]=0};t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize;var o=t.fragmentConstantData;var a=r.fragmentConstantsIndex+10;var s=this._numSamples<<1;for(var h=0;h<s;++h)o[a+h]=this._offsets[h]*n};t.prototype._pGetPlanarFragmentCode=function(e,t,r,i){var n=r.getFreeTextureReg();var o=r.getFreeFragmentConstant();var a=r.getFreeFragmentConstant();var s=r.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;e.texturesIndex=n.index;return this.getSampleCode(r,n,o,t,s)};t.prototype.addSample=function(e,t,r,i,n){var o=n.getFreeFragmentVectorTemp();return"tex "+o+", "+e+", "+t+" <2d,nearest,clamp>\n"+"dp4 "+o+".z, "+o+", "+r+"\n"+"slt "+e+".w, "+this._pDepthMapCoordReg+".z, "+o+".z\n"+"add "+i+".w, "+i+".w, "+e+".w\n"};t.prototype.iActivateForCascade=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=this._range/this._pCastingLight.shadowMapper.depthMapSize;var o=t.fragmentConstantData;var a=r.secondaryFragmentConstantsIndex;var s=this._numSamples<<1;o[a]=1/this._numSamples;o[a+1]=0;a+=2;for(var h=0;h<s;++h)o[a+h]=this._offsets[h]*n;if(s%4==0){o[a+s]=0;o[a+s+1]=0}};t.prototype._iGetCascadeFragmentCode=function(e,t,r,i,n,o,a,s){this._pDepthMapCoordReg=n;var h=a.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=h.index*4;return this.getSampleCode(a,i,r,o,h)};t.prototype.getSampleCode=function(e,t,r,i,n){var o;var a;var s=new Array(n+".zw");o=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(o,1);var h=e.getFreeFragmentVectorTemp();var d=this._numSamples>>1;for(var u=0;u<d;++u){var p=e.getFreeFragmentConstant();s.push(p+".xy");s.push(p+".zw")}for(u=0;u<this._numSamples;++u){if(u==0){a="add "+o+", "+this._pDepthMapCoordReg+", "+n+".zwyy\n"+"tex "+h+", "+o+", "+t+" <2d,nearest,clamp>\n"+"dp4 "+h+".z, "+h+", "+r+"\n"+"slt "+i+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"}else{a+="add "+o+".xy, "+this._pDepthMapCoordReg+".xy, "+s[u]+"\n"+this.addSample(o,t,r,i,e)}}e.removeFragmentTempUsage(o);a+="mul "+i+".w, "+i+".w, "+n+".x\n";return a};return t}(o);t.exports=a},{"awayjs-core/lib/geom/PoissonLookup":undefined,"awayjs-methodmaterials/lib/methods/ShadowMethodBase":undefined}],"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var o=function(e){i(t,e);function t(){e.call(this)}t.prototype.iInitVO=function(e,t){t.needsTangents=true;t.needsView=true};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight)s=this._pTotalLightColorReg;else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}a+="nrm "+s+".xyz, "+o.tangentVarying+".xyz\n"+"dp3 "+s+".w, "+s+".xyz, "+r+".xyz\n"+"dp3 "+s+".z, "+s+".xyz, "+o.viewDirFragment+".xyz\n";a+="sin "+s+".x, "+s+".w\n"+"sin "+s+".y, "+s+".z\n"+"mul "+s+".x, "+s+".x, "+s+".y\n"+"cos "+s+".z, "+s+".z\n"+"cos "+s+".w, "+s+".w\n"+"mul "+s+".w, "+s+".w, "+s+".z\n"+"sub "+s+".w, "+s+".x, "+s+".w\n";if(this._pUseTexture){a+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+s+".w, "+s+".w, "+this._pSpecularTexData+".w\n"}else a+="pow "+s+".w, "+s+".w, "+this._pSpecularDataRegister+".w\n";a+="mul "+s+".w, "+s+".w, "+r+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,s,n,o);a+="mul "+s+".xyz, "+i+".xyz, "+s+".w\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s+".xyz\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":undefined}],"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var o=e("awayjs-methodmaterials/lib/methods/LightingMethodBase");var a=function(e){i(t,e);function t(){e.call(this);this._gloss=50;this._specular=1;this._specularColor=16777215;this._iSpecularR=1;this._iSpecularG=1;this._iSpecularB=1}t.prototype.iIsUsed=function(e){if(!e.numLights)return false;return true};t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture;t.needsNormals=e.numLights>0;t.needsView=e.numLights>0};Object.defineProperty(t.prototype,"gloss",{get:function(){return this._gloss},set:function(e){this._gloss=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specular",{get:function(){return this._specular},set:function(e){if(e==this._specular)return;this._specular=e;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularColor},set:function(e){if(this._specularColor==e)return;if(this._specularColor==0||e==0)this.iInvalidateShaderProgram();this._specularColor=e;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=e!=null;if(t!=this._pUseTexture||e&&this._texture&&e.format!=this._texture.format)this.iInvalidateShaderProgram();this._pUseTexture=t;this._texture=e},enumerable:true,configurable:true});t.prototype.copyFrom=function(e){var t=e;var r=e;var i=r;this.texture=i.texture;this.specular=i.specular;this.specularColor=i.specularColor;this.gloss=i.gloss};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._pTotalLightColorReg=null;this._pSpecularTextureRegister=null;this._pSpecularTexData=null;this._pSpecularDataRegister=null};t.prototype.iGetFragmentPreLightingCode=function(e,t,r,i){var o="";this._pIsFirstLight=true;this._pSpecularDataRegister=r.getFreeFragmentConstant();t.fragmentConstantsIndex=this._pSpecularDataRegister.index*4;if(this._pUseTexture){this._pSpecularTexData=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(this._pSpecularTexData,1);this._pSpecularTextureRegister=r.getFreeTextureReg();t.texturesIndex=this._pSpecularTextureRegister.index;o=n.getTex2DSampleCode(this._pSpecularTexData,i,this._pSpecularTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)}else{this._pSpecularTextureRegister=null}this._pTotalLightColorReg=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(this._pTotalLightColorReg,1);return o};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight){s=this._pTotalLightColorReg}else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}var h=o.viewDirFragment;var d=o.normalFragment;a+="add "+s+", "+r+", "+h+"\n"+"nrm "+s+".xyz, "+s+"\n"+"dp3 "+s+".w, "+d+", "+s+"\n"+"sat "+s+".w, "+s+".w\n";if(this._pUseTexture){a+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+s+".w, "+s+".w, "+this._pSpecularTexData+".w\n"}else{a+="pow "+s+".w, "+s+".w, "+this._pSpecularDataRegister+".w\n"}if(e.usesLightFallOff)a+="mul "+s+".w, "+s+".w, "+r+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,s,n,o);a+="mul "+s+".xyz, "+i+", "+s+".w\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};t.prototype.iGetFragmentCodePerProbe=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight){s=this._pTotalLightColorReg}else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}var h=o.normalFragment;var d=o.viewDirFragment;a+="dp3 "+s+".w, "+h+", "+d+"\n"+"add "+s+".w, "+s+".w, "+s+".w\n"+"mul "+s+", "+s+".w, "+h+"\n"+"sub "+s+", "+s+", "+d+"\n"+"tex "+s+", "+s+", "+r+" <cube,"+(e.useSmoothTextures?"linear":"nearest")+",miplinear>\n"+"mul "+s+".xyz, "+s+", "+i+"\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,s,n,o);if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};t.prototype.iGetFragmentPostLightingCode=function(e,t,r,i,n){var o="";if(n.shadowTarget)o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n.shadowTarget+".w\n";if(this._pUseTexture){o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n";i.removeFragmentTempUsage(this._pSpecularTexData)}o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\n"+"add "+r+".xyz, "+r+", "+this._pTotalLightColorReg+"\n";i.removeFragmentTempUsage(this._pTotalLightColorReg);return o};t.prototype.iActivate=function(e,t,r){if(t.texturesIndex>=0)r.activateTexture(t.texturesIndex,this._texture,e.repeatTextures,e.useSmoothTextures,e.useMipmapping);var i=t.fragmentConstantsIndex;var n=e.fragmentConstantData;n[i]=this._iSpecularR;n[i+1]=this._iSpecularG;n[i+2]=this._iSpecularB;n[i+3]=this._gloss};t.prototype.updateSpecular=function(){this._iSpecularR=(this._specularColor>>16&255)/255*this._specular;this._iSpecularG=(this._specularColor>>8&255)/255*this._specular;this._iSpecularB=(this._specularColor&255)/255*this._specular};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/LightingMethodBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined}],"awayjs-methodmaterials/lib/methods/SpecularCelMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod");var o=function(e){i(t,e);function t(t,r){var i=this;if(t===void 0){t=.5}if(r===void 0){r=null}e.call(this,null,r);this._smoothness=.1;this._specularCutOff=.1;this.baseMethod._iModulateMethod=function(e,t,r,n,o){return i.clampSpecular(e,t,r,n,o)};this._specularCutOff=t}Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(e){this._specularCutOff=e},enumerable:true,configurable:true});t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=r.secondaryFragmentConstantsIndex;var o=t.fragmentConstantData;o[n]=this._smoothness;o[n+1]=this._specularCutOff};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._dataReg=null};t.prototype.clampSpecular=function(e,t,r,i,n){return"sub "+r+".y, "+r+".w, "+this._dataReg+".y\n"+"div "+r+".y, "+r+".y, "+this._dataReg+".x\n"+"sat "+r+".y, "+r+".y\n"+"sge "+r+".w, "+r+".w, "+this._dataReg+".y\n"+"mul "+r+".w, "+r+".w, "+r+".y\n"};t.prototype.iGetFragmentPreLightingCode=function(t,r,i,n){this._dataReg=i.getFreeFragmentConstant();r.secondaryFragmentConstantsIndex=this._dataReg.index*4;return e.prototype.iGetFragmentPreLightingCode.call(this,t,r,i,n)};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":undefined}],"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/events/ShadingMethodEvent");var o=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var a=function(e){i(t,e);function t(t,r){var i=this;if(r===void 0){r=null}e.call(this);this._onShaderInvalidatedDelegate=function(e){return i.onShaderInvalidated(e)};this._baseMethod=r||new o;this._baseMethod._iModulateMethod=t;this._baseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t)};t.prototype.iInitConstants=function(e,t){this._baseMethod.iInitConstants(e,t)};Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){if(this._baseMethod==e)return;this._baseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod=e;this._baseMethod.addEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(e){this._baseMethod.gloss=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specular",{get:function(){return this._baseMethod.specular},set:function(e){this._baseMethod.specular=e},enumerable:true,configurable:true});t.prototype.dispose=function(){this._baseMethod.removeEventListener(n.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod.dispose()};Object.defineProperty(t.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(e){this._baseMethod.texture=e},enumerable:true,configurable:true});t.prototype.iActivate=function(e,t,r){this._baseMethod.iActivate(e,t,r)};t.prototype.iSetRenderState=function(e,t,r,i,n){this._baseMethod.iSetRenderState(e,t,r,i,n)};t.prototype.iDeactivate=function(e,t,r){this._baseMethod.iDeactivate(e,t,r)};t.prototype.iGetVertexCode=function(e,t,r,i){return this._baseMethod.iGetVertexCode(e,t,r,i)};t.prototype.iGetFragmentPreLightingCode=function(e,t,r,i){return this._baseMethod.iGetFragmentPreLightingCode(e,t,r,i)};t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){return this._baseMethod.iGetFragmentCodePerLight(e,t,r,i,n,o)};t.prototype.iGetFragmentCodePerProbe=function(e,t,r,i,n,o){return this._baseMethod.iGetFragmentCodePerProbe(e,t,r,i,n,o)};t.prototype.iGetFragmentPostLightingCode=function(e,t,r,i,n){return this._baseMethod.iGetFragmentPostLightingCode(e,t,r,i,n)};t.prototype.iReset=function(){this._baseMethod.iReset()};t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};t.prototype.onShaderInvalidated=function(e){this.iInvalidateShaderProgram()};return t}(o);t.exports=a},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod");var o=function(e){i(t,e);function t(t,r){var i=this;if(t===void 0){t=true}if(r===void 0){r=null}e.call(this,null,r);this._fresnelPower=5;this._normalReflectance=.028;this.baseMethod._iModulateMethod=function(e,t,r,n,o){return i.modulateSpecular(e,t,r,n,o)};this._incidentLight=!t}t.prototype.iInitConstants=function(e,t){var r=t.secondaryFragmentConstantsIndex;e.fragmentConstantData[r+2]=1;e.fragmentConstantData[r+3]=0};Object.defineProperty(t.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(e){if(this._incidentLight!=e)return;this._incidentLight=!e;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:true,configurable:true});t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this);this._dataReg=null};Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:true,configurable:true});t.prototype.iActivate=function(t,r,i){e.prototype.iActivate.call(this,t,r,i);var n=t.fragmentConstantData;var o=r.secondaryFragmentConstantsIndex;n[o]=this._normalReflectance;n[o+1]=this._fresnelPower};t.prototype.iGetFragmentPreLightingCode=function(t,r,i,n){this._dataReg=i.getFreeFragmentConstant();r.secondaryFragmentConstantsIndex=this._dataReg.index*4;return e.prototype.iGetFragmentPreLightingCode.call(this,t,r,i,n)};t.prototype.modulateSpecular=function(e,t,r,i,n){var o;o="dp3 "+r+".y, "+n.viewDirFragment+".xyz, "+(this._incidentLight?r:n.normalFragment)+".xyz\n"+"sub "+r+".y, "+this._dataReg+".z, "+r+".y\n"+"pow "+r+".x, "+r+".y, "+this._dataReg+".y\n"+"sub "+r+".y, "+this._dataReg+".z, "+r+".y\n"+"mul "+r+".y, "+this._dataReg+".x, "+r+".y\n"+"add "+r+".y, "+r+".x, "+r+".y\n"+"mul "+r+".w, "+r+".w, "+r+".y\n";return o};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":undefined}],"awayjs-methodmaterials/lib/methods/SpecularPhongMethod":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var o=function(e){i(t,e);function t(){e.call(this)}t.prototype.iGetFragmentCodePerLight=function(e,t,r,i,n,o){var a="";var s;if(this._pIsFirstLight){s=this._pTotalLightColorReg}else{s=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(s,1)}var h=o.viewDirFragment;var d=o.normalFragment;a+="dp3 "+s+".w, "+r+", "+d+"\n"+"add "+s+".w, "+s+".w, "+s+".w\n"+"mul "+s+".xyz, "+d+", "+s+".w\n"+"sub "+s+".xyz, "+s+", "+r+"\n"+"add "+s+".w, "+s+".w, "+o.commons+".w\n"+"sat "+s+".w, "+s+".w\n"+"mul "+s+".xyz, "+s+", "+s+".w\n"+"dp3 "+s+".w, "+s+", "+h+"\n"+"sat "+s+".w, "+s+".w\n";if(this._pUseTexture){a+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+s+".w, "+s+".w, "+this._pSpecularTexData+".w\n"}else a+="pow "+s+".w, "+s+".w, "+this._pSpecularDataRegister+".w\n";if(e.usesLightFallOff)a+="mul "+s+".w, "+s+".w, "+r+".w\n";if(this._iModulateMethod!=null)a+=this._iModulateMethod(e,t,s,n,o);a+="mul "+s+".xyz, "+i+".xyz, "+s+".w\n";if(!this._pIsFirstLight){a+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s+".xyz\n";n.removeFragmentTempUsage(s)}this._pIsFirstLight=false;return a};return t}(n);t.exports=o},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":undefined}],"awayjs-methodmaterials/lib/passes/MethodPassMode":[function(e,t,r){var i=function(){function e(){}e.EFFECTS=1;e.LIGHTING=2;e.SUPER_SHADER=3;return e}();t.exports=i},{}],"awayjs-methodmaterials/lib/passes/MethodPass":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/events/Event");var o=e("awayjs-display/lib/materials/LightSources");var a=e("awayjs-renderergl/lib/compilation/ShaderLightingObject");var s=e("awayjs-renderergl/lib/events/ShadingMethodEvent");var h=e("awayjs-renderergl/lib/compilation/ShaderObjectBase");var d=e("awayjs-renderergl/lib/passes/RenderPassBase");var u=e("awayjs-methodmaterials/lib/data/MethodVO");var p=e("awayjs-methodmaterials/lib/methods/EffectColorTransformMethod");var l=e("awayjs-methodmaterials/lib/passes/MethodPassMode");var m=function(e){i(t,e);function t(t,r,i,n,o){var a=this;e.call(this,r,i,n,o);this._maxLights=3;this._mode=3;this._includeCasters=true;this._iMethodVOs=new Array;this._numEffectDependencies=0;this.numDirectionalLights=0;this.numPointLights=0;this.numLightProbes=0;this.pointLightsOffset=0;this.directionalLightsOffset=0;this.lightProbesOffset=0;this._mode=t;this._material=i;this._onLightsChangeDelegate=function(e){return a.onLightsChange(e)};this._onMethodInvalidatedDelegate=function(e){return a.onMethodInvalidated(e)};this.lightPicker=i.lightPicker;if(this._shader==null)this._updateShader()}Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){if(this._mode==e)return;this._mode=e;this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(e){if(this._includeCasters==e)return;this._includeCasters=e;this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lightPicker",{get:function(){return this._lightPicker},set:function(e){if(this._lightPicker)this._lightPicker.removeEventListener(n.CHANGE,this._onLightsChangeDelegate);this._lightPicker=e;if(this._lightPicker)this._lightPicker.addEventListener(n.CHANGE,this._onLightsChangeDelegate);this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"enableLightFallOff",{get:function(){return this._material.enableLightFallOff},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseLightSources",{get:function(){return this._material.diffuseLightSources},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularLightSources",{get:function(){return this._material.specularLightSources},enumerable:true,configurable:true});t.prototype._updateShader=function(){if((this.numDirectionalLights||this.numPointLights||this.numLightProbes)&&!(this._shader instanceof a)){if(this._shader!=null)this._shader.dispose();this._shader=new a(this._renderableClass,this,this._stage)}else if(!(this._shader instanceof h)){if(this._shader!=null)this._shader.dispose();this._shader=new h(this._renderableClass,this,this._stage)}};t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var r=this._iMethodVOs.length;for(var i=0;i<r;++i)this._iMethodVOs[i].method.iInitConstants(t,this._iMethodVOs[i])};Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(e){if(e){if(this.colorTransformMethod==null)this.colorTransformMethod=new p;this.colorTransformMethod.colorTransform=e}else if(!e){if(this.colorTransformMethod)this.colorTransformMethod=null}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"colorTransformMethod",{get:function(){return this._iColorTransformMethodVO?this._iColorTransformMethodVO.method:null},set:function(e){if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.method==e)return;if(this._iColorTransformMethodVO){this._removeDependency(this._iColorTransformMethodVO);this._iColorTransformMethodVO=null}if(e){this._iColorTransformMethodVO=new u(e);this._addDependency(this._iColorTransformMethodVO)}},enumerable:true,configurable:true});t.prototype._removeDependency=function(e,t){if(t===void 0){t=false}var r=this._iMethodVOs.indexOf(e);if(!t)this._numEffectDependencies--;e.method.removeEventListener(s.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);this._iMethodVOs.splice(r,1);this.invalidatePass()};t.prototype._addDependency=function(e,t,r){if(t===void 0){t=false}if(r===void 0){r=-1}e.method.addEventListener(s.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);if(t){if(r!=-1)this._iMethodVOs.splice(r+this._iMethodVOs.length-this._numEffectDependencies,0,e);else this._iMethodVOs.push(e);this._numEffectDependencies++}else{this._iMethodVOs.splice(this._iMethodVOs.length-this._numEffectDependencies,0,e)}this.invalidatePass()};t.prototype.addEffectMethod=function(e){this._addDependency(new u(e),true)};Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:true,configurable:true});t.prototype.hasEffectMethod=function(e){return this.getDependencyForMethod(e)!=null};t.prototype.getEffectMethodAt=function(e){if(e<0||e>this._numEffectDependencies-1)return null;return this._iMethodVOs[e+this._iMethodVOs.length-this._numEffectDependencies].method};t.prototype.addEffectMethodAt=function(e,t){this._addDependency(new u(e),true,t)};t.prototype.removeEffectMethod=function(e){var t=this.getDependencyForMethod(e);if(t!=null)this._removeDependency(t,true)};t.prototype.removeEffectMethodAt=function(e){if(e<0||e>this._numEffectDependencies-1)return;var t=this._iMethodVOs[e+this._iMethodVOs.length-this._numEffectDependencies];if(t!=null)this._removeDependency(t,true)};t.prototype.getDependencyForMethod=function(e){var t=this._iMethodVOs.length;for(var r=0;r<t;++r)if(this._iMethodVOs[r].method==e)return this._iMethodVOs[r];return null};Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._iNormalMethodVO?this._iNormalMethodVO.method:null},set:function(e){if(this._iNormalMethodVO&&this._iNormalMethodVO.method==e)return;if(this._iNormalMethodVO){this._removeDependency(this._iNormalMethodVO);this._iNormalMethodVO=null}if(e){this._iNormalMethodVO=new u(e);this._addDependency(this._iNormalMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._iAmbientMethodVO?this._iAmbientMethodVO.method:null},set:function(e){if(this._iAmbientMethodVO&&this._iAmbientMethodVO.method==e)return;if(this._iAmbientMethodVO){this._removeDependency(this._iAmbientMethodVO);this._iAmbientMethodVO=null}if(e){this._iAmbientMethodVO=new u(e);this._addDependency(this._iAmbientMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._iShadowMethodVO?this._iShadowMethodVO.method:null},set:function(e){if(this._iShadowMethodVO&&this._iShadowMethodVO.method==e)return;if(this._iShadowMethodVO){this._removeDependency(this._iShadowMethodVO);this._iShadowMethodVO=null}if(e){this._iShadowMethodVO=new u(e);this._addDependency(this._iShadowMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethodVO?this._iDiffuseMethodVO.method:null},set:function(e){if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.method==e)return;if(this._iDiffuseMethodVO){this._removeDependency(this._iDiffuseMethodVO);this._iDiffuseMethodVO=null}if(e){this._iDiffuseMethodVO=new u(e);this._addDependency(this._iDiffuseMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._iSpecularMethodVO?this._iSpecularMethodVO.method:null},set:function(e){if(this._iSpecularMethodVO&&this._iSpecularMethodVO.method==e)return;if(this._iSpecularMethodVO){this._removeDependency(this._iSpecularMethodVO);this._iSpecularMethodVO=null}if(e){this._iSpecularMethodVO=new u(e);this._addDependency(this._iSpecularMethodVO)}},enumerable:true,configurable:true});t.prototype.dispose=function(){e.prototype.dispose.call(this);if(this._lightPicker)this._lightPicker.removeEventListener(n.CHANGE,this._onLightsChangeDelegate);while(this._iMethodVOs.length)this._removeDependency(this._iMethodVOs[0]);this._iMethodVOs=null};t.prototype.onMethodInvalidated=function(e){this.invalidatePass()};t.prototype._iActivate=function(t){e.prototype._iActivate.call(this,t);var r;var i=this._iMethodVOs.length;for(var n=0;n<i;++n){r=this._iMethodVOs[n];if(r.useMethod)r.method.iActivate(this._shader,r,this._stage)}};t.prototype._iRender=function(t,r,i){e.prototype._iRender.call(this,t,r,i);var n;var o=this._iMethodVOs.length;for(var a=0;a<o;++a){n=this._iMethodVOs[a];if(n.useMethod)n.method.iSetRenderState(this._shader,n,t,this._stage,r)
}};t.prototype._iDeactivate=function(){e.prototype._iDeactivate.call(this);var t;var r=this._iMethodVOs.length;for(var i=0;i<r;++i){t=this._iMethodVOs[i];if(t.useMethod)t.method.iDeactivate(this._shader,t,this._stage)}};t.prototype._iIncludeDependencies=function(t){e.prototype._iIncludeDependencies.call(this,t);t.usesFragmentAnimation=Boolean(this._mode==l.SUPER_SHADER);if(!t.usesTangentSpace&&this.numPointLights>0&&t.usesLights){t.globalPosDependencies++;if(Boolean(this._mode&l.EFFECTS))t.usesGlobalPosFragment=true}var r;var i=this._iMethodVOs.length;for(r=0;r<i;++r)this.setupAndCountDependencies(t,this._iMethodVOs[r]);for(r=0;r<i;++r)this._iMethodVOs[r].useMethod=this._iMethodVOs[r].method.iIsUsed(t)};t.prototype.setupAndCountDependencies=function(e,t){t.reset();t.method.iInitVO(e,t);if(t.needsProjection)e.projectionDependencies++;if(t.needsGlobalVertexPos){e.globalPosDependencies++;if(t.needsGlobalFragmentPos)e.usesGlobalPosFragment=true}else if(t.needsGlobalFragmentPos){e.globalPosDependencies++;e.usesGlobalPosFragment=true}if(t.needsNormals)e.normalDependencies++;if(t.needsTangents)e.tangentDependencies++;if(t.needsView)e.viewDirDependencies++;if(t.needsUV)e.uvDependencies++;if(t.needsSecondaryUV)e.secondaryUVDependencies++};t.prototype._iGetPreLightingVertexCode=function(e,t,r){var i="";if(this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod)i+=this._iAmbientMethodVO.method.iGetVertexCode(e,this._iAmbientMethodVO,t,r);if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod)i+=this._iDiffuseMethodVO.method.iGetVertexCode(e,this._iDiffuseMethodVO,t,r);if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod)i+=this._iSpecularMethodVO.method.iGetVertexCode(e,this._iSpecularMethodVO,t,r);return i};t.prototype._iGetPreLightingFragmentCode=function(e,t,r){var i="";if(this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod){i+=this._iAmbientMethodVO.method.iGetFragmentCode(e,this._iAmbientMethodVO,r.shadedTarget,t,r);if(this._iAmbientMethodVO.needsNormals)t.removeFragmentTempUsage(r.normalFragment);if(this._iAmbientMethodVO.needsView)t.removeFragmentTempUsage(r.viewDirFragment)}if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod)i+=this._iDiffuseMethodVO.method.iGetFragmentPreLightingCode(e,this._iDiffuseMethodVO,t,r);if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod)i+=this._iSpecularMethodVO.method.iGetFragmentPreLightingCode(e,this._iSpecularMethodVO,t,r);return i};t.prototype._iGetPerLightDiffuseFragmentCode=function(e,t,r,i,n){return this._iDiffuseMethodVO.method.iGetFragmentCodePerLight(e,this._iDiffuseMethodVO,t,r,i,n)};t.prototype._iGetPerLightSpecularFragmentCode=function(e,t,r,i,n){return this._iSpecularMethodVO.method.iGetFragmentCodePerLight(e,this._iSpecularMethodVO,t,r,i,n)};t.prototype._iGetPerProbeDiffuseFragmentCode=function(e,t,r,i,n){return this._iDiffuseMethodVO.method.iGetFragmentCodePerProbe(e,this._iDiffuseMethodVO,t,r,i,n)};t.prototype._iGetPerProbeSpecularFragmentCode=function(e,t,r,i,n){return this._iSpecularMethodVO.method.iGetFragmentCodePerProbe(e,this._iSpecularMethodVO,t,r,i,n)};t.prototype._iGetPostLightingVertexCode=function(e,t,r){var i="";if(this._iShadowMethodVO)i+=this._iShadowMethodVO.method.iGetVertexCode(e,this._iShadowMethodVO,t,r);return i};t.prototype._iGetPostLightingFragmentCode=function(e,t,r){var i="";if(e.useAlphaPremultiplied&&this._pEnableBlending){i+="add "+r.shadedTarget+".w, "+r.shadedTarget+".w, "+r.commons+".z\n"+"div "+r.shadedTarget+".xyz, "+r.shadedTarget+", "+r.shadedTarget+".w\n"+"sub "+r.shadedTarget+".w, "+r.shadedTarget+".w, "+r.commons+".z\n"+"sat "+r.shadedTarget+".xyz, "+r.shadedTarget+"\n"}if(this._iShadowMethodVO)i+=this._iShadowMethodVO.method.iGetFragmentCode(e,this._iShadowMethodVO,r.shadowTarget,t,r);if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod){i+=this._iDiffuseMethodVO.method.iGetFragmentPostLightingCode(e,this._iDiffuseMethodVO,r.shadedTarget,t,r);if(this._iDiffuseMethodVO.needsNormals)t.removeFragmentTempUsage(r.normalFragment);if(this._iDiffuseMethodVO.needsView)t.removeFragmentTempUsage(r.viewDirFragment)}if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod){i+=this._iSpecularMethodVO.method.iGetFragmentPostLightingCode(e,this._iSpecularMethodVO,r.shadedTarget,t,r);if(this._iSpecularMethodVO.needsNormals)t.removeFragmentTempUsage(r.normalFragment);if(this._iSpecularMethodVO.needsView)t.removeFragmentTempUsage(r.viewDirFragment)}if(this._iShadowMethodVO)t.removeFragmentTempUsage(r.shadowTarget);return i};t.prototype._pUsesTangentSpace=function(e){if(e.usesProbes)return false;var t;var r=this._iMethodVOs.length;for(var i=0;i<r;++i){t=this._iMethodVOs[i];if(t.useMethod&&!t.method.iUsesTangentSpace())return false}return true};t.prototype._pOutputsTangentNormals=function(e){return this._iNormalMethodVO.method.iOutputsTangentNormals()};t.prototype._pOutputsNormals=function(e){return this._iNormalMethodVO&&this._iNormalMethodVO.useMethod};t.prototype._iGetNormalVertexCode=function(e,t,r){return this._iNormalMethodVO.method.iGetVertexCode(e,this._iNormalMethodVO,t,r)};t.prototype._iGetNormalFragmentCode=function(e,t,r){var i=this._iNormalMethodVO.method.iGetFragmentCode(e,this._iNormalMethodVO,r.normalFragment,t,r);if(this._iNormalMethodVO.needsView)t.removeFragmentTempUsage(r.viewDirFragment);if(this._iNormalMethodVO.needsGlobalFragmentPos||this._iNormalMethodVO.needsGlobalVertexPos)t.removeVertexTempUsage(r.globalPositionVertex);return i};t.prototype._iGetVertexCode=function(e,t,r){var i="";var n;var o=this._iMethodVOs.length;for(var a=o-this._numEffectDependencies;a<o;a++){n=this._iMethodVOs[a];if(n.useMethod){i+=n.method.iGetVertexCode(e,n,t,r);if(n.needsGlobalVertexPos||n.needsGlobalFragmentPos)t.removeVertexTempUsage(r.globalPositionVertex)}}if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod)i+=this._iColorTransformMethodVO.method.iGetVertexCode(e,this._iColorTransformMethodVO,t,r);return i};t.prototype._iGetFragmentCode=function(e,t,r){var i="";var n;if(this.preserveAlpha&&this._numEffectDependencies>0){n=t.getFreeFragmentSingleTemp();t.addFragmentTempUsages(n,1);i+="mov "+n+", "+r.shadedTarget+".w\n"}var o;var a=this._iMethodVOs.length;for(var s=a-this._numEffectDependencies;s<a;s++){o=this._iMethodVOs[s];if(o.useMethod){i+=o.method.iGetFragmentCode(e,o,r.shadedTarget,t,r);if(o.needsNormals)t.removeFragmentTempUsage(r.normalFragment);if(o.needsView)t.removeFragmentTempUsage(r.viewDirFragment)}}if(this.preserveAlpha&&this._numEffectDependencies>0){i+="mov "+r.shadedTarget+".w, "+n+"\n";t.removeFragmentTempUsage(n)}if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod)i+=this._iColorTransformMethodVO.method.iGetFragmentCode(e,this._iColorTransformMethodVO,r.shadedTarget,t,r);return i};t.prototype._iUsesShadows=function(e){return Boolean(this._iShadowMethodVO&&(this._lightPicker.castingDirectionalLights.length>0||this._lightPicker.castingPointLights.length>0))};t.prototype._iUsesSpecular=function(e){return Boolean(this._iSpecularMethodVO)};t.prototype._iUsesDiffuse=function(e){return Boolean(this._iDiffuseMethodVO)};t.prototype.onLightsChange=function(e){this._updateLights()};t.prototype._updateLights=function(){var e=this.numDirectionalLights;var t=this.numPointLights;var r=this.numLightProbes;if(this._lightPicker&&this._mode&l.LIGHTING){this.numDirectionalLights=this.calculateNumDirectionalLights(this._lightPicker.numDirectionalLights);this.numPointLights=this.calculateNumPointLights(this._lightPicker.numPointLights);this.numLightProbes=this.calculateNumProbes(this._lightPicker.numLightProbes);if(this._includeCasters){this.numDirectionalLights+=this._lightPicker.numCastingDirectionalLights;this.numPointLights+=this._lightPicker.numCastingPointLights}}else{this.numDirectionalLights=0;this.numPointLights=0;this.numLightProbes=0}if(e!=this.numDirectionalLights||t!=this.numPointLights||r!=this.numLightProbes){this._updateShader();this.invalidatePass()}};t.prototype.calculateNumDirectionalLights=function(e){return Math.min(e-this.directionalLightsOffset,this._maxLights)};t.prototype.calculateNumPointLights=function(e){var t=this._maxLights-this.numDirectionalLights;return Math.min(e-this.pointLightsOffset,t)};t.prototype.calculateNumProbes=function(e){var t=0;if((this.specularLightSources&o.PROBES)!=0)++t;if((this.diffuseLightSources&o.PROBES)!=0)++t;return Math.min(e-this.lightProbesOffset,4/t|0)};return t}(d);t.exports=m},{"awayjs-core/lib/events/Event":undefined,"awayjs-display/lib/materials/LightSources":undefined,"awayjs-methodmaterials/lib/data/MethodVO":undefined,"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":undefined,"awayjs-methodmaterials/lib/passes/MethodPassMode":undefined,"awayjs-renderergl/lib/compilation/ShaderLightingObject":undefined,"awayjs-renderergl/lib/compilation/ShaderObjectBase":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined,"awayjs-renderergl/lib/passes/RenderPassBase":undefined}],"awayjs-methodmaterials/lib/passes/SingleObjectDepthPass":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-core/lib/geom/Matrix3D");var o=e("awayjs-core/lib/textures/RenderTexture");var a=e("awayjs-display/lib/base/TriangleSubGeometry");var s=e("awayjs-stagegl/lib/base/ContextGLProgramType");var h=e("awayjs-renderergl/lib/passes/RenderPassBase");var d=function(e){i(t,e);function t(t,r,i,n){e.call(this,t,r,i,n);this._textureSize=512;this._polyOffset=Array(15,0,0,0);this._projectionTexturesInvalid=true}Object.defineProperty(t.prototype,"textureSize",{get:function(){return this._textureSize},set:function(e){this._textureSize=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(e){this._polyOffset[0]=e},enumerable:true,configurable:true});t.prototype.dispose=function(){if(this._textures){for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=null}};t.prototype.updateProjectionTextures=function(){if(this._textures){for(var e in this._textures){var t=this._textures[e];t.dispose()}}this._textures=new Object;this._projections=new Object;this._projectionTexturesInvalid=false};t.prototype._iGetVertexCode=function(){var e;e="mul vt7, vt1, vc4.x	\n"+"add vt7, vt7, vt0\n"+"mov vt7.w, vt0.w\n";e+="m44 vt2, vt7, vc0\n"+"mov op, vt2\n";e+="div v0, vt2, vt2.w\n";return e};t.prototype._iGetFragmentCode=function(e,t,r){var i="";i+="mul ft0, fc0, v0.z\n"+"frc ft0, ft0\n"+"mul ft1, ft0.yzww, fc1\n"+"sub ft0, ft0, ft1\n"+"mov oc, ft0\n";return i};t.prototype._iGetDepthMap=function(e){return this._textures[e.renderableOwner.id]};t.prototype._iGetProjection=function(e){return this._projections[e.renderableOwner.id]};t.prototype._iRender=function(e,t,r){var i;var h=this._stage.context;var d;var u;var p=this._renderObjectOwner.lightPicker.allPickedLights;var l=e.renderableOwner.id;if(!this._textures[l])this._textures[l]=new o(this._textureSize,this._textureSize);if(!this._projections[l])this._projections[l]=new n;d=p.length;u=p[0];i=u.iGetObjectProjectionMatrix(e.sourceEntity,t,this._projections[l]);this._stage.setRenderTarget(this._textures[l],true);h.clear(1,1,1);h.setProgramConstantsFromMatrix(s.VERTEX,0,i,true);h.setProgramConstantsFromArray(s.FRAGMENT,0,this._enc,2);this._stage.activateBuffer(0,e.getVertexData(a.POSITION_DATA),e.getVertexOffset(a.POSITION_DATA),a.POSITION_FORMAT);this._stage.activateBuffer(1,e.getVertexData(a.NORMAL_DATA),e.getVertexOffset(a.NORMAL_DATA),a.NORMAL_FORMAT);h.drawTriangles(this._stage.getIndexBuffer(e.getIndexData()),0,e.numTriangles)};t.prototype._iActivate=function(t){if(this._projectionTexturesInvalid)this.updateProjectionTextures();e.prototype._iActivate.call(this,t);this._stage.context.setProgramConstantsFromArray(s.VERTEX,4,this._polyOffset,1)};return t}(h);t.exports=d},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/textures/RenderTexture":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/passes/RenderPassBase":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-methodmaterials/lib/pool/MethodRenderablePool":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/pool/RenderablePoolBase");var o=e("awayjs-renderergl/lib/compilation/RenderObjectPool");var a=e("awayjs-methodmaterials/lib/compilation/RenderMethodMaterialObject");var s=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._methodMaterialRenderObjectPool=new o(a,this._renderableClass,this._stage)}t.prototype.getMethodRenderObject=function(e){return this._methodMaterialRenderObjectPool.getItem(e)};t.getPool=function(e,r){var i=n._pools[r.stageIndex]||(n._pools[r.stageIndex]=new Object);return i[e.id]||(i[e.id]=new t(e,r))};return t}(n);t.exports=s},{"awayjs-methodmaterials/lib/compilation/RenderMethodMaterialObject":undefined,"awayjs-renderergl/lib/compilation/RenderObjectPool":undefined,"awayjs-renderergl/lib/pool/RenderablePoolBase":undefined}],"awayjs-methodmaterials/lib/pool/MethodRendererPool":[function(e,t,r){var i=this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i};var n=e("awayjs-renderergl/lib/pool/BillboardRenderable");var o=e("awayjs-renderergl/lib/pool/LineSegmentRenderable");var a=e("awayjs-renderergl/lib/pool/LineSubMeshRenderable");var s=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable");var h=e("awayjs-renderergl/lib/pool/RendererPoolBase");var d=e("awayjs-methodmaterials/lib/pool/MethodRenderablePool");var u=function(e){i(t,e);function t(t){e.call(this,t)}t.prototype._pUpdatePool=function(){this._billboardRenderablePool=d.getPool(n,this._pStage);this._lineSegmentRenderablePool=d.getPool(o,this._pStage);this._triangleSubMeshRenderablePool=d.getPool(s,this._pStage);this._lineSubMeshRenderablePool=d.getPool(a,this._pStage)};return t}(h);t.exports=u},{"awayjs-methodmaterials/lib/pool/MethodRenderablePool":undefined,"awayjs-renderergl/lib/pool/BillboardRenderable":undefined,"awayjs-renderergl/lib/pool/LineSegmentRenderable":undefined,"awayjs-renderergl/lib/pool/LineSubMeshRenderable":undefined,"awayjs-renderergl/lib/pool/RendererPoolBase":undefined,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":undefined}]},{},[]);
//# sourceMappingURL=awayjs-methodmaterials.min.js.map