require=function t(e,a,i){function r(s,n){if(!a[s]){if(!e[s]){var h=typeof require=="function"&&require;if(!n&&h)return h(s,!0);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=a[s]={exports:{}};e[s][0].call(l.exports,function(t){var a=e[s][1][t];return r(a?a:t)},l,l.exports,t,e,a,i)}return a[s].exports}var o=typeof require=="function"&&require;for(var s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,a){"use strict";var i=t("awayjs-methodmaterials/lib/data");a.data=i;var r=t("awayjs-methodmaterials/lib/methods");a.methods=r;var o=t("awayjs-methodmaterials/lib/surfaces");a.surfaces=o;var s=t("awayjs-methodmaterials/lib/MethodMaterial");a.MethodMaterial=s.default;var n=t("awayjs-methodmaterials/lib/MethodMaterialMode");a.MethodMaterialMode=n.default;var h=t("awayjs-renderergl/lib/surfaces/SurfacePool");h.default.registerAbstraction(o.GL_MethodMaterialSurface,s.default)},{"awayjs-methodmaterials/lib/MethodMaterial":"awayjs-methodmaterials/lib/MethodMaterial","awayjs-methodmaterials/lib/MethodMaterialMode":"awayjs-methodmaterials/lib/MethodMaterialMode","awayjs-methodmaterials/lib/data":"awayjs-methodmaterials/lib/data","awayjs-methodmaterials/lib/methods":"awayjs-methodmaterials/lib/methods","awayjs-methodmaterials/lib/surfaces":"awayjs-methodmaterials/lib/surfaces","awayjs-renderergl/lib/surfaces/SurfacePool":undefined}],"awayjs-methodmaterials/lib/MethodMaterialMode":[function(t,e,a){"use strict";var i=function(){function t(){}t.SINGLE_PASS="singlePass";t.MULTI_PASS="multiPass";return t}();Object.defineProperty(a,"__esModule",{value:true});a.default=i},{}],"awayjs-methodmaterials/lib/MethodMaterial":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/image/Image2D");var o=t("awayjs-display/lib/materials/MaterialBase");var s=t("awayjs-display/lib/textures/Single2DTexture");var n=t("awayjs-stagegl/lib/base/ContextGLCompareMode");var h=t("awayjs-methodmaterials/lib/MethodMaterialMode");var d=t("awayjs-methodmaterials/lib/methods/AmbientBasicMethod");var l=t("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var u=t("awayjs-methodmaterials/lib/methods/NormalBasicMethod");var p=t("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var m=function(t){i(e,t);function e(e,a){if(e===void 0){e=null}if(a===void 0){a=1}t.call(this,e,a);this._effectMethods=new Array;this._ambientMethod=new d.default;this._diffuseMethod=new l.default;this._normalMethod=new u.default;this._specularMethod=new p.default;this._depthCompareMode=n.default.LESS_EQUAL;this._mode=h.default.SINGLE_PASS;this._ambientMethod.iAddOwner(this);this._diffuseMethod.iAddOwner(this);this._normalMethod.iAddOwner(this);this._specularMethod.iAddOwner(this);if(e instanceof r.default)this._ambientMethod.texture=new s.default}Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){if(this._mode==t)return;this._mode=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(t){if(this._depthCompareMode==t)return;this._depthCompareMode=t;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"diffuseTexture",{get:function(){return this._diffuseMethod.texture},set:function(t){this._diffuseMethod.texture=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(t){if(this._ambientMethod==t)return;if(this._ambientMethod)this._ambientMethod.iRemoveOwner(this);this._ambientMethod=t;if(this._ambientMethod)this._ambientMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(t){if(this._shadowMethod==t)return;if(this._shadowMethod)this._shadowMethod.iRemoveOwner(this);this._shadowMethod=t;if(this._shadowMethod)this._shadowMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(t){if(this._diffuseMethod==t)return;if(this._diffuseMethod)this._diffuseMethod.iRemoveOwner(this);this._diffuseMethod=t;if(this._diffuseMethod)this._diffuseMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(t){if(this._specularMethod==t)return;if(this._specularMethod)this._specularMethod.iRemoveOwner(this);this._specularMethod=t;if(this._specularMethod)this._specularMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(t){if(this._normalMethod==t)return;if(this._normalMethod)this._normalMethod.iRemoveOwner(this);this._normalMethod=t;if(this._normalMethod)this._normalMethod.iAddOwner(this);this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numEffectMethods",{get:function(){return this._effectMethods.length},enumerable:true,configurable:true});e.prototype.addEffectMethod=function(t){t.iAddOwner(this);this._effectMethods.push(t);this.invalidate()};e.prototype.getEffectMethodAt=function(t){return this._effectMethods[t]};e.prototype.addEffectMethodAt=function(t,e){t.iAddOwner(this);this._effectMethods.splice(e,0,t);this.invalidate()};e.prototype.removeEffectMethod=function(t){t.iRemoveOwner(this);this._effectMethods.splice(this._effectMethods.indexOf(t),1);this.invalidate()};e.assetType="[materials MethodMaterial]";return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=m},{"awayjs-core/lib/image/Image2D":undefined,"awayjs-display/lib/materials/MaterialBase":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":"awayjs-methodmaterials/lib/MethodMaterialMode","awayjs-methodmaterials/lib/methods/AmbientBasicMethod":"awayjs-methodmaterials/lib/methods/AmbientBasicMethod","awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod","awayjs-methodmaterials/lib/methods/NormalBasicMethod":"awayjs-methodmaterials/lib/methods/NormalBasicMethod","awayjs-methodmaterials/lib/methods/SpecularBasicMethod":"awayjs-methodmaterials/lib/methods/SpecularBasicMethod","awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-methodmaterials/lib/data/MethodVO":[function(t,e,a){"use strict";var i=function(){function t(t,e){this.useMethod=true;this.method=t;this.pass=e}t.prototype.reset=function(){this.method.iReset();this.vertexConstantsIndex=-1;this.secondaryVertexConstantsIndex=-1;this.fragmentConstantsIndex=-1;this.secondaryFragmentConstantsIndex=-1;this.needsProjection=false;this.needsView=false;this.needsNormals=false;this.needsTangents=false;this.needsGlobalVertexPos=false;this.needsGlobalFragmentPos=false};return t}();Object.defineProperty(a,"__esModule",{value:true});a.default=i},{}],"awayjs-methodmaterials/lib/data":[function(t,e,a){"use strict";var i=t("awayjs-methodmaterials/lib/data/MethodVO");a.MethodVO=i.default},{"awayjs-methodmaterials/lib/data/MethodVO":"awayjs-methodmaterials/lib/data/MethodVO"}],"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var s=function(t){i(e,t);function e(){t.call(this);this._alpha=1;this._colorR=1;this._colorG=1;this._colorB=1;this._strength=1}e.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new r.default(r.default.CLEAR,this._texture));e.textureGL=null}};e.prototype.iInitConstants=function(t,e){if(!e.textureGL){this._color=t.numLights?16777215:e.pass._surface.style.color;this.updateColor()}};Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){if(this._strength==t)return;this._strength=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._alpha==t)return;this._alpha=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.copyFrom=function(t){var e=t;var a=e};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";if(e.textureGL){o+=e.textureGL._iGetFragmentCode(a,i,r,r.uvVarying);if(t.alphaThreshold>0){var s=i.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;o+="sub "+a+".w, "+a+".w, "+s+".x\n"+"kil "+a+".w\n"+"add "+a+".w, "+a+".w, "+s+".x\n"}}else{var n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=n.index*4;o+="mov "+a+", "+n+"\n"}return o};e.prototype.iActivate=function(t,e,a){if(e.textureGL){e.textureGL.activate(e.pass._render);if(t.alphaThreshold>0)t.fragmentConstantData[e.fragmentConstantsIndex]=t.alphaThreshold}else{var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=this._colorR;r[i+1]=this._colorG;r[i+2]=this._colorB;r[i+3]=this._alpha}};e.prototype.iSetRenderState=function(t,e,a,i,r){if(e.textureGL)e.textureGL._setRenderState(a)};e.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._strength;this._colorG=(this._color>>8&255)/255*this._strength;this._colorB=(this._color&255)/255*this._strength};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase"}],"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-methodmaterials/lib/methods/AmbientBasicMethod");var s=function(t){i(e,t);function e(){t.call(this)}e.prototype.iInitVO=function(t,e){e.needsNormals=true;if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new r.default(r.default.CLEAR,this._texture));e.textureGL=null}};e.prototype.iGetFragmentCode=function(t,e,a,i,r){return this._texture?e.textureGL._iGetFragmentCode(a,i,r,r.normalFragment):""};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":"awayjs-methodmaterials/lib/methods/AmbientBasicMethod"}],"awayjs-methodmaterials/lib/methods/CurveBasicMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var s=function(t){i(e,t);function e(){t.call(this);this._color=16777215;this._alpha=1;this._colorR=1;this._colorG=1;this._colorB=1;this._ambient=1}e.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new r.default(r.default.CLEAR,this._texture));e.textureGL=null}};e.prototype.iInitConstants=function(t,e){if(!e.textureGL){this._color=e.pass._surface.style.color;this.updateColor()}};Object.defineProperty(e.prototype,"ambient",{get:function(){return this._ambient},set:function(t){if(this._ambient==t)return;this._ambient=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._alpha==t)return;this._alpha=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.copyFrom=function(t){var e=t;var a=e};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";var s;if(e.textureGL){o+=e.textureGL._iGetFragmentCode(a,i,r,r.uvVarying);if(t.alphaThreshold>0){var n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=n.index*4;o+="sub "+a+".w, "+a+".w, "+n+".x\n"+"kil "+a+".w\n"+"add "+a+".w, "+a+".w, "+n+".x\n"}}else{s=i.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;o+="mov "+a+", "+s+"\n"}o="mov "+a+", "+r.uvVarying+"\n";return o};e.prototype.iActivate=function(t,e,a){if(e.textureGL){e.textureGL.activate(e.pass._render);if(t.alphaThreshold>0)t.fragmentConstantData[e.fragmentConstantsIndex]=t.alphaThreshold}else{var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=this._colorR;r[i+1]=this._colorG;r[i+2]=this._colorB;r[i+3]=this._alpha}};e.prototype.iSetRenderState=function(t,e,a,i,r){if(e.textureGL)e.textureGL._setRenderState(a)};e.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._ambient;this._colorG=(this._color>>8&255)/255*this._ambient;this._colorB=(this._color&255)/255*this._ambient};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase"}],"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-methodmaterials/lib/methods/LightingMethodBase");var s=function(t){i(e,t);function e(){t.call(this);this._multiply=true;this._ambientColorR=1;this._ambientColorG=1;this._ambientColorB=1;this._color=16777215;this._colorR=1;this._colorG=1;this._colorB=1}e.prototype.iIsUsed=function(t){if(!t.numLights)return false;return true};Object.defineProperty(e.prototype,"multiply",{get:function(){return this._multiply},set:function(t){if(this._multiply==t)return;this._multiply=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new r.default(r.default.CLEAR,null));e.textureGL=null}if(t.numLights>0){t.usesCommonData=true;e.needsNormals=true}};e.prototype.iInitConstants=function(t,e){if(t.numLights>0){this._ambientColor=e.pass._surface.style.color;this.updateAmbientColor()}else{this._ambientColor=null}};Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){if(this._color==t)return;this._color=t;this.updateColor()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.dispose=function(){this._texture=null};e.prototype.copyFrom=function(t){var e=t;this.texture=e.texture;this.multiply=e.multiply;this.color=e.color};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._pTotalLightColorReg=null};e.prototype.iGetFragmentPreLightingCode=function(t,e,a,i){var r="";this._pIsFirstLight=true;a.addFragmentTempUsages(this._pTotalLightColorReg=a.getFreeFragmentVectorTemp(),1);return r};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight){n=this._pTotalLightColorReg}else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}s+="dp3 "+n+".x, "+a+", "+o.normalFragment+"\n"+"max "+n+".w, "+n+".x, "+o.commons+".y\n";if(t.usesLightFallOff)s+="mul "+n+".w, "+n+".w, "+a+".w\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);s+="mul "+n+", "+n+".w, "+i+"\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};e.prototype.iGetFragmentCodePerProbe=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight){n=this._pTotalLightColorReg}else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}s+="tex "+n+", "+o.normalFragment+", "+a+" <cube,linear,miplinear>\n"+"mul "+n+".xyz, "+n+".xyz, "+i+"\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};e.prototype.iGetFragmentPostLightingCode=function(t,e,a,i,r){var o="";var s;var n;if(r.shadowTarget)o+=this.pApplyShadow(t,e,i,r);i.addFragmentTempUsages(s=i.getFreeFragmentVectorTemp(),1);var h=i.getFreeFragmentConstant();e.fragmentConstantsIndex=h.index*4;if(this._texture){o+=e.textureGL._iGetFragmentCode(s,i,r,r.uvVarying)}else{var d=i.getFreeFragmentConstant();o+="mov "+s+", "+d+"\n"}o+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\n"+"mul "+s+".xyz, "+s+", "+this._pTotalLightColorReg+"\n";if(this._multiply){o+="add "+s+".xyz, "+s+", "+h+"\n"+"mul "+a+".xyz, "+a+", "+s+"\n"}else if(this._texture){o+="mul "+a+".xyz, "+a+", "+h+"\n"+"mul "+this._pTotalLightColorReg+".xyz, "+a+", "+this._pTotalLightColorReg+"\n"+"sub "+a+".xyz, "+a+", "+this._pTotalLightColorReg+"\n"+"add "+a+".xyz, "+a+", "+s+"\n"}else{o+="mul "+this._pTotalLightColorReg+".xyz, "+h+", "+this._pTotalLightColorReg+"\n"+"sub "+this._pTotalLightColorReg+".xyz, "+h+", "+this._pTotalLightColorReg+"\n"+"add "+s+".xyz, "+s+", "+this._pTotalLightColorReg+"\n"+"mul "+a+".xyz, "+a+", "+s+"\n"}i.removeFragmentTempUsage(this._pTotalLightColorReg);i.removeFragmentTempUsage(s);return o};e.prototype.pApplyShadow=function(t,e,a,i){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+i.shadowTarget+".w\n"};e.prototype.iActivate=function(t,e,a){if(this._texture){e.textureGL.activate(e.pass._render)}else{var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;if(this._multiply){r[i+4]=this._colorR*this._ambientColorR;r[i+5]=this._colorG*this._ambientColorG;r[i+6]=this._colorB*this._ambientColorB}else{r[i+4]=this._colorR;r[i+5]=this._colorG;r[i+6]=this._colorB}r[i+7]=1}};e.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255;this._colorG=(this._color>>8&255)/255;this._colorB=(this._color&255)/255};e.prototype.updateAmbientColor=function(){this._ambientColorR=(this._ambientColor>>16&255)/255;this._ambientColorG=(this._ambientColor>>8&255)/255;this._ambientColorB=(this._ambientColor&255)/255};e.prototype.iSetRenderState=function(t,e,a,i,r){if(this._texture)e.textureGL._setRenderState(a);var o=e.fragmentConstantsIndex;var s=t.fragmentConstantData;s[o]=t.ambientR*this._ambientColorR;s[o+1]=t.ambientG*this._ambientColorG;s[o+2]=t.ambientB*this._ambientColorB;s[o+3]=1};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-methodmaterials/lib/methods/LightingMethodBase":"awayjs-methodmaterials/lib/methods/LightingMethodBase"}],"awayjs-methodmaterials/lib/methods/DiffuseCelMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");var o=function(t){i(e,t);function e(e,a){var i=this;if(e===void 0){e=3}if(a===void 0){a=null}t.call(this,null,a);this._smoothness=.1;this.baseMethod._iModulateMethod=function(t,e,a,r,o){return i.clampDiffuse(t,e,a,r,o)};this._levels=e}e.prototype.iInitConstants=function(e,a){var i=e.fragmentConstantData;var r=a.secondaryFragmentConstantsIndex;t.prototype.iInitConstants.call(this,e,a);i[r+1]=1;i[r+2]=0};Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},set:function(t){this._levels=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:true,configurable:true});e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._dataReg=null};e.prototype.iGetFragmentPreLightingCode=function(e,a,i,r){this._dataReg=i.getFreeFragmentConstant();a.secondaryFragmentConstantsIndex=this._dataReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,a,i,r)};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=e.fragmentConstantData;var o=a.secondaryFragmentConstantsIndex;r[o]=this._levels;r[o+3]=this._smoothness};e.prototype.clampDiffuse=function(t,e,a,i,r){return"mul "+a+".w, "+a+".w, "+this._dataReg+".x\n"+"frc "+a+".z, "+a+".w\n"+"sub "+a+".y, "+a+".w, "+a+".z\n"+"mov "+a+".x, "+this._dataReg+".x\n"+"sub "+a+".x, "+a+".x, "+this._dataReg+".y\n"+"rcp "+a+".x,"+a+".x\n"+"mul "+a+".w, "+a+".y, "+a+".x\n"+"sub "+a+".y, "+a+".w, "+a+".x\n"+"div "+a+".z, "+a+".z, "+this._dataReg+".w\n"+"sat "+a+".z, "+a+".z\n"+"mul "+a+".w, "+a+".w, "+a+".z\n"+"sub "+a+".z, "+this._dataReg+".y, "+a+".z\n"+"mul "+a+".y, "+a+".y, "+a+".z\n"+"add "+a+".w, "+a+".w, "+a+".y\n"+"sat "+a+".w, "+a+".w\n"};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod"}],"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-renderergl/lib/events/ShadingMethodEvent");var o=t("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var s=function(t){i(e,t);function e(e,a){var i=this;if(a===void 0){a=null}t.call(this);this._onShaderInvalidatedDelegate=function(t){return i.onShaderInvalidated(t)};this.pBaseMethod=a||new o.default;this.pBaseMethod._iModulateMethod=e;this.pBaseMethod.addEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}Object.defineProperty(e.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(t){if(this.pBaseMethod==t)return;this.pBaseMethod.removeEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.pBaseMethod=t;this.pBaseMethod.addEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iInitVO=function(t,e){this.pBaseMethod.iInitVO(t,e)};e.prototype.iInitConstants=function(t,e){this.pBaseMethod.iInitConstants(t,e)};e.prototype.iAddOwner=function(e){t.prototype.iAddOwner.call(this,e);this.pBaseMethod.iAddOwner(e)};e.prototype.iRemoveOwner=function(e){t.prototype.iRemoveOwner.call(this,e);this.pBaseMethod.iRemoveOwner(e)};e.prototype.dispose=function(){this.pBaseMethod.removeEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.pBaseMethod.dispose()};Object.defineProperty(e.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(t){this.pBaseMethod.texture=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"color",{get:function(){return this.pBaseMethod.color},set:function(t){this.pBaseMethod.color=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"multiply",{get:function(){return this.pBaseMethod.multiply},set:function(t){this.pBaseMethod.multiply=t},enumerable:true,configurable:true});e.prototype.iGetFragmentPreLightingCode=function(t,e,a,i){return this.pBaseMethod.iGetFragmentPreLightingCode(t,e,a,i)};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s=this.pBaseMethod.iGetFragmentCodePerLight(t,e,a,i,r,o);this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg;return s};e.prototype.iGetFragmentCodePerProbe=function(t,e,a,i,r,o){var s=this.pBaseMethod.iGetFragmentCodePerProbe(t,e,a,i,r,o);this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg;return s};e.prototype.iActivate=function(t,e,a){this.pBaseMethod.iActivate(t,e,a)};e.prototype.iSetRenderState=function(t,e,a,i,r){this.pBaseMethod.iSetRenderState(t,e,a,i,r)};e.prototype.iDeactivate=function(t,e,a){this.pBaseMethod.iDeactivate(t,e,a)};e.prototype.iGetVertexCode=function(t,e,a,i){return this.pBaseMethod.iGetVertexCode(t,e,a,i)};e.prototype.iGetFragmentPostLightingCode=function(t,e,a,i,r){return this.pBaseMethod.iGetFragmentPostLightingCode(t,e,a,i,r)};e.prototype.iReset=function(){this.pBaseMethod.iReset()};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this.pBaseMethod.iCleanCompilationData()};e.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod","awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var o=function(t){i(e,t);function e(){t.call(this)}e.prototype.iInitConstants=function(t,e){var a=t.fragmentConstantData;var i=e.fragmentConstantsIndex;a[i]=1;a[i+1]=1/255;a[i+2]=1/65025;a[i+3]=1/16581375};e.prototype.iGetFragmentPostLightingCode=function(t,e,a,i,r){var o="";var s;var n;if(!this._texture)throw new Error("DiffuseDepthMethod requires texture!");if(t.numLights>0){if(r.shadowTarget)o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+r.shadowTarget+".w\n";o+="add "+a+".xyz, "+this._pTotalLightColorReg+".xyz, "+a+".xyz\n"+"sat "+a+".xyz, "+a+".xyz\n";i.removeFragmentTempUsage(this._pTotalLightColorReg);i.addFragmentTempUsages(s=i.getFreeFragmentVectorTemp(),1)}else{s=a}n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=n.index*4;o+=e.textureGL._iGetFragmentCode(s,i,r,r.uvVarying)+"dp4 "+s+".x, "+s+", "+n+"\n"+"mov "+s+".yz, "+s+".xx			\n"+"mov "+s+".w, "+n+".x\n"+"sub "+s+".xyz, "+n+".xxx, "+s+".xyz\n";if(t.numLights==0)return o;o+="mul "+a+".xyz, "+s+".xyz, "+a+".xyz\n"+"mov "+a+".w, "+s+".w\n";if(t.numLights>0)i.removeFragmentTempUsage(s);return o};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"}],"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var o=function(t){i(e,t);function e(e){t.call(this);this._gradient=e;if(this._gradient)this.iAddTexture(this._gradient)}e.prototype.iInitVO=function(e,a){t.prototype.iInitVO.call(this,e,a);a.secondaryTextureGL=e.getAbstraction(this._gradient)};Object.defineProperty(e.prototype,"gradient",{get:function(){return this._gradient},set:function(t){if(this._gradient==t)return;if(this._gradient)this.iRemoveTexture(this._gradient);this._gradient=t;if(this._gradient)this.iAddTexture(this._gradient);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this)};e.prototype.iGetFragmentPreLightingCode=function(e,a,i,r){var o=t.prototype.iGetFragmentPreLightingCode.call(this,e,a,i,r);this._pIsFirstLight=true;return o};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight)n=this._pTotalLightColorReg;else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}s+="dp3 "+n+".w, "+a+".xyz, "+o.normalFragment+".xyz\n"+"mul "+n+".w, "+n+".w, "+o.commons+".x\n"+"add "+n+".w, "+n+".w, "+o.commons+".x\n"+"mul "+n+".xyz, "+n+".w, "+a+".w\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);s+=e.secondaryTextureGL._iGetFragmentCode(n,r,o,n)+"mul "+n+".xyz, "+n+".xyz, "+i+".xyz\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};e.prototype.pApplyShadow=function(t,e,a,i){var r=a.getFreeFragmentVectorTemp();return"mov "+r+", "+i.shadowTarget+".wwww\n"+e.secondaryTextureGL._iGetFragmentCode(r,a,i,i.uvVarying)+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r+"\n"};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);a.secondaryTextureGL.activate(a.pass._render)};e.prototype.iSetRenderState=function(e,a,i,r,o){t.prototype.iSetRenderState.call(this,e,a,i,r,o);if(e.numLights>0)a.secondaryTextureGL._setRenderState(i)};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"}],"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");var o=function(t){i(e,t);function e(e,a,i,r){if(a===void 0){a="multiply"}if(i===void 0){i=false}if(r===void 0){r=null}t.call(this,null,r);this._useSecondaryUV=i;this._lightMap=e;this.blendMode=a;if(this._lightMap)this.iAddTexture(this._lightMap)}e.prototype.iInitVO=function(t,e){e.secondaryTextureGL=t.getAbstraction(this._lightMap);if(this._useSecondaryUV)t.secondaryUVDependencies++;else t.uvDependencies++};Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(t!=e.ADD&&t!=e.MULTIPLY)throw new Error("Unknown blendmode!");if(this._blendMode==t)return;this._blendMode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lightMap",{get:function(){return this._lightMap},set:function(t){
if(this._lightMap==t)return;if(this._lightMap)this.iRemoveTexture(this._lightMap);this._lightMap=t;if(this._lightMap)this.iAddTexture(this._lightMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){if(this._useSecondaryUV==t)return;this._useSecondaryUV=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iGetFragmentPostLightingCode=function(a,i,r,o,s){var n;var h=o.getFreeFragmentVectorTemp();n=i.secondaryTextureGL._iGetFragmentCode(h,o,s,this._useSecondaryUV?s.secondaryUVVarying:s.uvVarying);switch(this._blendMode){case e.MULTIPLY:n+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+h+"\n";break;case e.ADD:n+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+h+"\n";break}n+=t.prototype.iGetFragmentPostLightingCode.call(this,a,i,r,o,s);return n};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);a.secondaryTextureGL.activate(a.pass._render)};e.prototype.iSetRenderState=function(e,a,i,r,o){t.prototype.iSetRenderState.call(this,e,a,i,r,o);a.secondaryTextureGL._setRenderState(i)};e.MULTIPLY="multiply";e.ADD="add";return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod"}],"awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");var o=function(t){i(e,t);function e(e,a,i){var r=this;if(e===void 0){e=512}if(a===void 0){a=15}if(i===void 0){i=null}t.call(this,null,i);this._translucency=1;this._scatterColor=16777215;this._scatterR=1;this._scatterG=1;this._scatterB=1;this.pBaseMethod._iModulateMethod=function(t,e,a,i,o){return r.scatterLight(t,e,a,i,o)};this._scattering=.2;this._translucency=1}e.prototype.iInitConstants=function(e,a){t.prototype.iInitConstants.call(this,e,a);var i=e.vertexConstantData;var r=a.secondaryVertexConstantsIndex;i[r]=.5;i[r+1]=-.5;i[r+2]=0;i[r+3]=1;i=e.fragmentConstantData;r=a.secondaryFragmentConstantsIndex;i[r+3]=1;i[r+4]=1;i[r+5]=1/255;i[r+6]=1/65025;i[r+7]=1/16581375;i[r+10]=.5;i[r+11]=-.1};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._lightProjVarying=null;this._propReg=null;this._lightColorReg=null;this._colorReg=null;this._decReg=null;this._targetReg=null};Object.defineProperty(e.prototype,"scattering",{get:function(){return this._scattering},set:function(t){this._scattering=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"translucency",{get:function(){return this._translucency},set:function(t){this._translucency=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(t){this._scatterColor=t;this._scatterR=(t>>16&255)/255;this._scatterG=(t>>8&255)/255;this._scatterB=(t&255)/255},enumerable:true,configurable:true});e.prototype.iGetVertexCode=function(e,a,i,r){var o=t.prototype.iGetVertexCode.call(this,e,a,i,r);var s;var n;var h=i.getFreeVertexVectorTemp();n=i.getFreeVertexConstant();a.secondaryVertexConstantsIndex=n.index*4;this._lightProjVarying=i.getFreeVarying();s=i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();i.getFreeVertexConstant();o+="m44 "+h+", vt0, "+s+"\n"+"div "+h+".xyz, "+h+".xyz, "+h+".w\n"+"mul "+h+".xy, "+h+".xy, "+n+".xy\n"+"add "+h+".xy, "+h+".xy, "+n+".xx\n"+"mov "+this._lightProjVarying+".xyz, "+h+".xyz\n"+"mov "+this._lightProjVarying+".w, va0.w\n";return o};e.prototype.iGetFragmentPreLightingCode=function(e,a,i,r){this._colorReg=i.getFreeFragmentConstant();this._decReg=i.getFreeFragmentConstant();this._propReg=i.getFreeFragmentConstant();a.secondaryFragmentConstantsIndex=this._colorReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,a,i,r)};e.prototype.iGetFragmentCodePerLight=function(e,a,i,r,o,s){this._pIsFirstLight=true;this._lightColorReg=r;return t.prototype.iGetFragmentCodePerLight.call(this,e,a,i,r,o,s)};e.prototype.iGetFragmentPostLightingCode=function(e,a,i,r,o){var s=t.prototype.iGetFragmentPostLightingCode.call(this,e,a,i,r,o);var n=r.getFreeFragmentVectorTemp();s+="mul "+n+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\n"+"mul "+n+".xyz, "+n+".xyz, "+this._colorReg+".xyz\n"+"add "+i+".xyz, "+i+".xyz, "+n+".xyz\n";if(this._targetReg!=o.viewDirFragment)r.removeFragmentTempUsage(i);return s};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=a.secondaryFragmentConstantsIndex;var o=e.fragmentConstantData;o[r]=this._scatterR;o[r+1]=this._scatterG;o[r+2]=this._scatterB;o[r+8]=this._scattering;o[r+9]=this._translucency};e.prototype.iSetRenderState=function(t,e,a,i,r){e.secondaryTextureGL=t.getAbstraction(this._depthPass._iGetDepthMap(a));e.secondaryTextureGL._setRenderState(a);this._depthPass._iGetProjection(a).copyRawDataTo(t.vertexConstantData,e.secondaryVertexConstantsIndex+4,true)};e.prototype.scatterLight=function(t,e,a,i,r){if(!this._pIsFirstLight)return"";this._pIsFirstLight=false;var o="";if(r.viewDirFragment)this._targetReg=r.viewDirFragment;else i.addFragmentTempUsages(this._targetReg=i.getFreeFragmentVectorTemp(),1);var s=i.getFreeFragmentVectorTemp();o+=e.secondaryTextureGL._iGetFragmentCode(s,i,r,this._lightProjVarying)+"dp4 "+a+".z, "+s+", "+this._decReg+"\n";o+="sub "+a+".z, "+this._lightProjVarying+".z, "+a+".z\n"+"sub "+a+".z, "+this._propReg+".x, "+a+".z\n"+"mul "+a+".z, "+this._propReg+".y, "+a+".z\n"+"sat "+a+".z, "+a+".z\n"+"neg "+a+".y, "+a+".x\n"+"mul "+a+".y, "+a+".y, "+this._propReg+".z\n"+"add "+a+".y, "+a+".y, "+this._propReg+".z\n"+"mul "+this._targetReg+".w, "+a+".z, "+a+".y\n"+"sub "+a+".y, "+this._colorReg+".w, "+this._targetReg+".w\n"+"mul "+a+".w, "+a+".w, "+a+".y\n";return o};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod"}],"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");var o=function(t){i(e,t);function e(e){if(e===void 0){e=.5}t.call(this);this.wrapFactor=e}e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._wrapDataRegister=null};Object.defineProperty(e.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(t){this._wrapFactor=t;this._wrapFactor=1/(t+1)},enumerable:true,configurable:true});e.prototype.iGetFragmentPreLightingCode=function(e,a,i,r){var o=t.prototype.iGetFragmentPreLightingCode.call(this,e,a,i,r);this._pIsFirstLight=true;this._wrapDataRegister=i.getFreeFragmentConstant();a.secondaryFragmentConstantsIndex=this._wrapDataRegister.index*4;return o};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight){n=this._pTotalLightColorReg}else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}s+="dp3 "+n+".x, "+a+".xyz, "+o.normalFragment+".xyz\n"+"add "+n+".y, "+n+".x, "+this._wrapDataRegister+".x\n"+"mul "+n+".y, "+n+".y, "+this._wrapDataRegister+".y\n"+"sat "+n+".w, "+n+".y\n"+"mul "+n+".xz, "+n+".w, "+a+".wz\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,a,r,o);s+="mul "+n+", "+n+".x, "+i+"\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=a.secondaryFragmentConstantsIndex;var o=e.fragmentConstantData;o[r]=this._wrapFactor;o[r+1]=1/(this._wrapFactor+1)};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod"}],"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e,a){if(a===void 0){a=false}t.call(this);this._texture=e;this._useSecondaryUV=a;if(this._texture)this.iAddTexture(this._texture)}e.prototype.iInitVO=function(t,e){e.textureGL=t.getAbstraction(this._texture);if(this._useSecondaryUV)t.secondaryUVDependencies++;else t.uvDependencies++};Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){if(this._useSecondaryUV==t)return;this._useSecondaryUV=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(o,i,r,this._useSecondaryUV?r.secondaryUVVarying:r.uvVarying)+"mul "+a+", "+a+", "+o+".x\n"};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);a.textureGL.activate(a.pass._render)};e.prototype.iSetRenderState=function(t,e,a,i,r){e.textureGL._setRenderState(a)};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e){t.call(this);if(e.length!=20)throw new Error("Matrix length must be 20!");this._matrix=e}Object.defineProperty(e.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(t){this._matrix=t},enumerable:true,configurable:true});e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentConstant();i.getFreeFragmentConstant();i.getFreeFragmentConstant();i.getFreeFragmentConstant();var n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;var h=i.getFreeFragmentVectorTemp();o+="m44 "+h+", "+a+", "+s+"\n"+"add "+a+", "+h+", "+n+"\n";return o};e.prototype.iActivate=function(t,e,a){var i=this._matrix;var r=e.fragmentConstantsIndex;var o=t.fragmentConstantData;o[r]=i[0];o[r+1]=i[1];o[r+2]=i[2];o[r+3]=i[3];o[r+4]=i[5];o[r+5]=i[6];o[r+6]=i[7];o[r+7]=i[8];o[r+8]=i[10];o[r+9]=i[11];o[r+10]=i[12];o[r+11]=i[13];o[r+12]=i[15];o[r+13]=i[16];o[r+14]=i[17];o[r+15]=i[18];o[r+16]=i[4];o[r+17]=i[9];o[r+18]=i[14];o[r+19]=i[19]};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(){t.call(this)}Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){this._colorTransform=t},enumerable:true,configurable:true});e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentConstant();var n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;o+="mul "+a+", "+a+", "+s+"\n"+"add "+a+", "+a+", "+n+"\n";return o};e.prototype.iActivate=function(t,e,a){var i=1/255;var r=e.fragmentConstantsIndex;var o=t.fragmentConstantData;o[r]=this._colorTransform.redMultiplier;o[r+1]=this._colorTransform.greenMultiplier;o[r+2]=this._colorTransform.blueMultiplier;o[r+3]=this._colorTransform.alphaMultiplier;o[r+4]=this._colorTransform.redOffset*i;o[r+5]=this._colorTransform.greenOffset*i;o[r+6]=this._colorTransform.blueOffset*i;o[r+7]=this._colorTransform.alphaOffset*i};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e,a){if(a===void 0){a=1}t.call(this);this._envMap=e;this._alpha=a;if(this._envMap)this.iAddTexture(this._envMap)}Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(t==this._mask)return;if(this._mask)this.iRemoveTexture(this._mask);this._mask=t;if(this._mask)this.iAddTexture(this._mask);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true;if(this._envMap)e.textureGL=t.getAbstraction(this._envMap);if(this._mask){e.secondaryTextureGL=t.getAbstraction(this._mask);t.uvDependencies++}};Object.defineProperty(e.prototype,"envMap",{get:function(){return this._envMap},set:function(t){if(this._envMap==t)return;if(this._envMap)this.iRemoveTexture(this._envMap);this._envMap=t;if(this._envMap)this.iAddTexture(this._envMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.dispose=function(){};Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});e.prototype.iActivate=function(t,e,a){t.fragmentConstantData[e.fragmentConstantsIndex]=this._alpha;e.textureGL.activate(e.pass._render);if(this._mask)e.secondaryTextureGL.activate(e.pass._render)};e.prototype.iSetRenderState=function(t,e,a,i,r){e.textureGL._setRenderState(a);if(this._mask)e.secondaryTextureGL._setRenderState(a)};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentConstant();var s="";e.fragmentConstantsIndex=o.index*4;var n=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(n,1);var h=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(h,1);s+="dp3 "+n+".w, "+r.viewDirFragment+".xyz, "+r.normalFragment+".xyz\n"+"add "+n+".w, "+n+".w, "+n+".w\n"+"mul "+n+".xyz, "+r.normalFragment+".xyz, "+n+".w\n"+"sub "+n+".xyz, "+n+".xyz, "+r.viewDirFragment+".xyz\n"+e.textureGL._iGetFragmentCode(n,i,r,n)+"sub "+h+".w, "+n+".w, fc0.x\n"+"kil "+h+".w\n"+"sub "+n+", "+n+", "+a+"\n";if(this._mask){s+=e.secondaryTextureGL._iGetFragmentCode(h,i,r,r.uvVarying)+"mul "+n+", "+h+", "+n+"\n"}s+="mul "+n+", "+n+", "+o+".x\n"+"add "+a+", "+a+", "+n+"\n";i.removeFragmentTempUsage(n);i.removeFragmentTempUsage(h);return s};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectFogMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e,a,i){if(i===void 0){i=8421504}t.call(this);this._minDistance=0;this._maxDistance=1e3;this.minDistance=e;this.maxDistance=a;this.fogColor=i}e.prototype.iInitVO=function(t,e){e.needsProjection=true};e.prototype.iInitConstants=function(t,e){var a=t.fragmentConstantData;var i=e.fragmentConstantsIndex;a[i+3]=1;a[i+6]=0;a[i+7]=0};Object.defineProperty(e.prototype,"minDistance",{get:function(){return this._minDistance},set:function(t){this._minDistance=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fogColor",{get:function(){return this._fogColor},set:function(t){this._fogColor=t;this._fogR=(t>>16&255)/255;this._fogG=(t>>8&255)/255;this._fogB=(t&255)/255},enumerable:true,configurable:true});e.prototype.iActivate=function(t,e,a){var i=t.fragmentConstantData;var r=e.fragmentConstantsIndex;i[r]=this._fogR;i[r+1]=this._fogG;i[r+2]=this._fogB;i[r+4]=this._minDistance;i[r+5]=1/(this._maxDistance-this._minDistance)};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();var n=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(n,1);var h=i.getFreeFragmentVectorTemp();var d="";e.fragmentConstantsIndex=o.index*4;d+="sub "+h+".w, "+r.projectionFragment+".z, "+s+".x\n"+"mul "+h+".w, "+h+".w, "+s+".y\n"+"sat "+h+".w, "+h+".w\n"+"sub "+n+", "+o+", "+a+"\n"+"mul "+n+", "+n+", "+h+".w\n"+"add "+a+", "+a+", "+n+"\n";i.removeFragmentTempUsage(n);return d};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e,a){if(a===void 0){a=1}t.call(this);this._fresnelPower=5;this._normalReflectance=0;this._envMap=e;this._alpha=a;if(this._envMap)this.iAddTexture(this._envMap)}e.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true;e.textureGL=t.getAbstraction(this._envMap);if(this._mask!=null){e.secondaryTextureGL=t.getAbstraction(this._mask);t.uvDependencies++}};e.prototype.iInitConstants=function(t,e){t.fragmentConstantData[e.fragmentConstantsIndex+3]=1};Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask==t)return;if(this._mask)this.iRemoveTexture(this._mask);this._mask=t;if(this._mask)this.iAddTexture(this._mask);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"envMap",{get:function(){return this._envMap},set:function(t){if(this._envMap==t)return;if(this._envMap)this.iRemoveTexture(this._envMap);this._envMap=t;if(this._envMap)this.iAddTexture(this._envMap)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance=t},enumerable:true,configurable:true});e.prototype.iActivate=function(t,e,a){var i=t.fragmentConstantData;var r=e.fragmentConstantsIndex;i[r]=this._alpha;i[r+1]=this._normalReflectance;i[r+2]=this._fresnelPower;e.textureGL.activate(e.pass._render);if(this._mask)e.secondaryTextureGL.activate(e.pass._render)};e.prototype.iSetRenderState=function(t,e,a,i,r){e.textureGL._setRenderState(a);if(this._mask)e.secondaryTextureGL._setRenderState(a)};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentConstant();var s="";var n=r.viewDirFragment;var h=r.normalFragment;e.fragmentConstantsIndex=o.index*4;var d=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(d,1);var l=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(l,1);s+="dp3 "+d+".w, "+n+".xyz, "+h+".xyz\n"+"add "+d+".w, "+d+".w, "+d+".w\n"+"mul "+d+".xyz, "+h+".xyz, "+d+".w\n"+"sub "+d+".xyz, "+d+".xyz, "+n+".xyz\n"+e.textureGL._iGetFragmentCode(d,i,r,d)+"sub "+l+".w, "+d+".w, fc0.x\n"+"kil "+l+".w\n"+"sub "+d+", "+d+", "+a+"\n";s+="dp3 "+n+".w, "+n+".xyz, "+h+".xyz\n"+"sub "+n+".w, "+o+".w, "+n+".w\n"+"pow "+n+".w, "+n+".w, "+o+".z\n"+"sub "+h+".w, "+o+".w, "+n+".w\n"+"mul "+h+".w, "+o+".y, "+h+".w\n"+"add "+n+".w, "+n+".w, "+h+".w\n"+"mul "+n+".w, "+o+".x, "+n+".w\n";if(this._mask){s+=e.secondaryTextureGL._iGetFragmentCode(l,i,r,r.uvVarying)+"mul "+n+".w, "+l+".x, "+n+".w\n"}s+="mul "+d+", "+d+", "+n+".w\n"+"add "+a+", "+a+", "+d+"\n";i.removeFragmentTempUsage(d);i.removeFragmentTempUsage(l);return s};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectLightMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(a,i,r){if(i===void 0){i="multiply"}if(r===void 0){r=false}t.call(this);if(i!=e.ADD&&i!=e.MULTIPLY)throw new Error("Unknown blendmode!");this._lightMap=a;this._blendMode=i;this._useSecondaryUV=r;if(this._lightMap)this.iAddTexture(this._lightMap)}e.prototype.iInitVO=function(t,e){e.textureGL=t.getAbstraction(this._lightMap);if(this._useSecondaryUV)t.secondaryUVDependencies++;else t.uvDependencies++};Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(this._blendMode==t)return;if(t!=e.ADD&&t!=e.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lightMap",{get:function(){return this._lightMap},set:function(t){if(this._lightMap==t)return;if(this._lightMap)this.iRemoveTexture(this._lightMap);this._lightMap=t;if(this._lightMap)this.iAddTexture(this._lightMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){if(this._useSecondaryUV==t)return;this._useSecondaryUV=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iGetFragmentCode=function(t,a,i,r,o){var s;var n=r.getFreeFragmentVectorTemp();s=a.secondaryTextureGL._iGetFragmentCode(n,r,o,this._useSecondaryUV?o.secondaryUVVarying:o.uvVarying);switch(this._blendMode){case e.MULTIPLY:s+="mul "+i+", "+i+", "+n+"\n";break;case e.ADD:s+="add "+i+", "+i+", "+n+"\n";break}return s};e.prototype.iActivate=function(t,e,a){e.textureGL.activate(e.pass._render)};e.prototype.iSetRenderState=function(t,e,a,i,r){e.textureGL._setRenderState(a)};e.MULTIPLY="multiply";e.ADD="add";return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectMethodBase":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/errors/AbstractMethodError");var o=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var s=function(t){i(e,t);function e(){t.call(this)}Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:true,configurable:true});e.prototype.iGetFragmentCode=function(t,e,a,i,o){throw new r.default};e.assetType="[asset EffectMethod]";return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e,a,i,r,o){if(a===void 0){a=.1}if(i===void 0){i=0}if(r===void 0){r=0}if(o===void 0){o=0}t.call(this);this._dispersionR=0;this._dispersionG=0;this._dispersionB=0;this._alpha=1;this._envMap=e;this._dispersionR=i;this._dispersionG=r;this._dispersionB=o;this._useDispersion=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._refractionIndex=a;if(this._envMap)this.iAddTexture(this._envMap)}e.prototype.iInitConstants=function(t,e){var a=e.fragmentConstantsIndex;var i=t.fragmentConstantData;i[a+4]=1;i[a+5]=0;i[a+7]=1};e.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true;e.textureGL=t.getAbstraction(this._envMap)};Object.defineProperty(e.prototype,"envMap",{get:function(){return this._envMap},set:function(t){if(this._envMap==t)return;if(this._envMap)this.iRemoveTexture(this._envMap);this._envMap=t;if(this._envMap)this.iAddTexture(this._envMap)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(t){this._refractionIndex=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(t){this._dispersionR=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=e){this.iInvalidateShaderProgram();this._useDispersion=e}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(t){this._dispersionG=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=e){this.iInvalidateShaderProgram();this._useDispersion=e}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(t){this._dispersionB=t;var e=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);if(this._useDispersion!=e){this.iInvalidateShaderProgram();this._useDispersion=e}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:true,configurable:true});e.prototype.iActivate=function(t,e,a){var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=this._dispersionR+this._refractionIndex;if(this._useDispersion){r[i+1]=this._dispersionG+this._refractionIndex;r[i+2]=this._dispersionB+this._refractionIndex}r[i+3]=this._alpha;e.textureGL.activate(e.pass._render)};e.prototype.iSetRenderState=function(t,e,a,i,r){e.textureGL._setRenderState(a)};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();var n="";var h;var d;var l;e.fragmentConstantsIndex=o.index*4;h=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(h,1);d=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(d,1);l=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(l,1);var u=r.viewDirFragment;var p=r.normalFragment;n+="neg "+u+".xyz, "+u+".xyz\n";n+="dp3 "+l+".x, "+u+".xyz, "+p+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+o+".x, "+l+".w\n"+"mul "+l+".w, "+o+".x, "+l+".w\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+o+".x, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+p+".xyz\n"+"mul "+h+", "+o+".x, "+u+"\n"+"sub "+h+".xyz, "+h+".xyz, "+l+".xyz\n"+"nrm "+h+".xyz, "+h+".xyz\n"+e.textureGL._iGetFragmentCode(d,i,r,h)+"sub "+d+".w, "+d+".w, fc0.x	\n"+"kil "+d+".w\n";if(this._useDispersion){n+="dp3 "+l+".x, "+u+".xyz, "+p+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+o+".y, "+l+".w\n"+"mul "+l+".w, "+o+".y, "+l+".w\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+o+".y, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+p+".xyz\n"+"mul "+h+", "+o+".y, "+u+"\n"+"sub "+h+".xyz, "+h+".xyz, "+l+".xyz\n"+"nrm "+h+".xyz, "+h+".xyz\n"+e.textureGL._iGetFragmentCode(l,i,r,h)+"mov "+d+".y, "+l+".y\n";n+="dp3 "+l+".x, "+u+".xyz, "+p+".xyz\n"+"mul "+l+".w, "+l+".x, "+l+".x\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"mul "+l+".w, "+o+".z, "+l+".w\n"+"mul "+l+".w, "+o+".z, "+l+".w\n"+"sub "+l+".w, "+s+".x, "+l+".w\n"+"sqt "+l+".y, "+l+".w\n"+"mul "+l+".x, "+o+".z, "+l+".x\n"+"add "+l+".x, "+l+".x, "+l+".y\n"+"mul "+l+".xyz, "+l+".x, "+p+".xyz\n"+"mul "+h+", "+o+".z, "+u+"\n"+"sub "+h+".xyz, "+h+".xyz, "+l+".xyz\n"+"nrm "+h+".xyz, "+h+".xyz\n"+e.textureGL._iGetFragmentCode(l,i,r,h)+"mov "+d+".z, "+l+".z\n"}n+="sub "+d+".xyz, "+d+".xyz, "+a+".xyz\n"+"mul "+d+".xyz, "+d+".xyz, "+o+".w\n"+"add "+a+".xyz, "+a+".xyz, "+d+".xyz\n";i.removeFragmentTempUsage(l);i.removeFragmentTempUsage(h);i.removeFragmentTempUsage(d);n+="neg "+u+".xyz, "+u+".xyz\n";return n};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/EffectRimLightMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");var o=function(t){i(e,t);function e(e,a,i,r){if(e===void 0){e=16777215}if(a===void 0){a=.4}if(i===void 0){i=2}if(r===void 0){r="mix"}t.call(this);this._blendMode=r;this._strength=a;this._power=i;this.color=e}e.prototype.iInitConstants=function(t,e){t.fragmentConstantData[e.fragmentConstantsIndex+3]=1};e.prototype.iInitVO=function(t,e){e.needsNormals=true;e.needsView=true};Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(this._blendMode==t)return;this._blendMode=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t;this._colorR=(t>>16&255)/255;this._colorG=(t>>8&255)/255;this._colorB=(t&255)/255},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"power",{get:function(){return this._power},
set:function(t){this._power=t},enumerable:true,configurable:true});e.prototype.iActivate=function(t,e,a){var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=this._colorR;r[i+1]=this._colorG;r[i+2]=this._colorB;r[i+4]=this._strength;r[i+5]=this._power};e.prototype.iGetFragmentCode=function(t,a,i,r,o){var s=r.getFreeFragmentConstant();var n=r.getFreeFragmentConstant();var h=r.getFreeFragmentVectorTemp();var d="";a.fragmentConstantsIndex=s.index*4;d+="dp3 "+h+".x, "+o.viewDirFragment+".xyz, "+o.normalFragment+".xyz\n"+"sat "+h+".x, "+h+".x\n"+"sub "+h+".x, "+s+".w, "+h+".x\n"+"pow "+h+".x, "+h+".x, "+n+".y\n"+"mul "+h+".x, "+h+".x, "+n+".x\n"+"sub "+h+".x, "+s+".w, "+h+".x\n"+"mul "+i+".xyz, "+i+".xyz, "+h+".x\n"+"sub "+h+".w, "+s+".w, "+h+".x\n";if(this._blendMode==e.ADD){d+="mul "+h+".xyz, "+h+".w, "+s+".xyz\n"+"add "+i+".xyz, "+i+".xyz, "+h+".xyz\n"}else if(this._blendMode==e.MULTIPLY){d+="mul "+h+".xyz, "+h+".w, "+s+".xyz\n"+"mul "+i+".xyz, "+i+".xyz, "+h+".xyz\n"}else{d+="sub "+h+".xyz, "+s+".xyz, "+i+".xyz\n"+"mul "+h+".xyz, "+h+".xyz, "+h+".w\n"+"add "+i+".xyz, "+i+".xyz, "+h+".xyz\n"}return d};e.ADD="add";e.MULTIPLY="multiply";e.MIX="mix";return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase"}],"awayjs-methodmaterials/lib/methods/LightingMethodBase":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var o=function(t){i(e,t);function e(){t.call(this)}e.prototype.iGetFragmentPreLightingCode=function(t,e,a,i){return""};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){return""};e.prototype.iGetFragmentCodePerProbe=function(t,e,a,i,r,o){return""};e.prototype.iGetFragmentPostLightingCode=function(t,e,a,i,r){return""};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase"}],"awayjs-methodmaterials/lib/methods/NormalBasicMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var o=function(t){i(e,t);function e(e){if(e===void 0){e=null}t.call(this);this._texture=e;if(this._texture)this.iAddTexture(this._texture)}e.prototype.iIsUsed=function(t){if(this._texture&&t.normalDependencies)return true;return false};e.prototype.iInitVO=function(t,e){if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}};e.prototype.iOutputsTangentNormals=function(){return true};e.prototype.copyFrom=function(t){var e=t;var a=t;if(a.texture!=null)this.texture=a.texture};Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.dispose=function(){if(this._texture)this._texture=null};e.prototype.iActivate=function(t,e,a){if(this._texture)e.textureGL.activate(e.pass._render)};e.prototype.iSetRenderState=function(t,e,a,i,r){if(this._texture)e.textureGL._setRenderState(a)};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";if(this._texture)o+=e.textureGL._iGetFragmentCode(a,i,r,r.uvVarying);o+="sub "+a+".xyz, "+a+".xyz, "+r.commons+".xxx\n"+"nrm "+a+".xyz, "+a+"\n";return o};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase"}],"awayjs-methodmaterials/lib/methods/NormalHeightMapMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/NormalBasicMethod");var o=function(t){i(e,t);function e(e,a,i,r){t.call(this);this.texture=e;this._worldXYRatio=a/i;this._worldXZRatio=r/i}e.prototype.iInitConstants=function(t,e){var a=e.fragmentConstantsIndex;var i=t.fragmentConstantData;i[a]=1/this.texture.image2D.width;i[a+1]=1/this.texture.image2D.height;i[a+2]=0;i[a+3]=1;i[a+4]=this._worldXYRatio;i[a+5]=this._worldXZRatio};Object.defineProperty(e.prototype,"tangentSpace",{get:function(){return false},enumerable:true,configurable:true});e.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e);this._worldXYRatio=e._worldXYRatio;this._worldXZRatio=e._worldXZRatio};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(s,1);var n=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();e.fragmentConstantsIndex=n.index*4;o+=e.textureGL._iGetFragmentCode(a,i,r,r.uvVarying)+"add "+s+", "+r.uvVarying+", "+n+".xzzz\n"+e.textureGL._iGetFragmentCode(s,i,r,s)+"sub "+a+".x, "+a+".x, "+s+".x\n"+"add "+s+", "+r.uvVarying+", "+n+".zyzz\n"+e.textureGL._iGetFragmentCode(s,i,r,s)+"sub "+a+".z, "+a+".z, "+s+".x\n"+"mov "+a+".y, "+n+".w\n"+"mul "+a+".xz, "+a+".xz, "+h+".xy\n"+"nrm "+a+".xyz, "+a+".xyz\n";i.removeFragmentTempUsage(s);return o};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/NormalBasicMethod":"awayjs-methodmaterials/lib/methods/NormalBasicMethod"}],"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/NormalBasicMethod");var o=function(t){i(e,t);function e(e,a){if(e===void 0){e=null}if(a===void 0){a=null}t.call(this,e);this._water1OffsetX=0;this._water1OffsetY=0;this._water2OffsetX=0;this._water2OffsetY=0;this._secondaryNormalMap=a;if(this._secondaryNormalMap)this.iAddTexture(this._secondaryNormalMap)}e.prototype.iInitConstants=function(t,e){var a=e.fragmentConstantsIndex;var i=t.fragmentConstantData;i[a]=.5;i[a+1]=0;i[a+2]=0;i[a+3]=1};e.prototype.iInitVO=function(e,a){t.prototype.iInitVO.call(this,e,a);if(this._secondaryNormalMap){a.secondaryTextureGL=e.getAbstraction(this._secondaryNormalMap);e.uvDependencies++}};Object.defineProperty(e.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(t){this._water1OffsetX=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(t){this._water1OffsetY=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(t){this._water2OffsetX=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(t){this._water2OffsetY=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"secondaryNormalMap",{get:function(){return this._secondaryNormalMap},set:function(t){if(this._secondaryNormalMap==t)return;if(this._secondaryNormalMap)this.iRemoveTexture(this._secondaryNormalMap);this._secondaryNormalMap=t;if(this._secondaryNormalMap)this.iAddTexture(this._secondaryNormalMap);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.dispose=function(){t.prototype.dispose.call(this);this._secondaryNormalMap=null};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=e.fragmentConstantData;var o=a.fragmentConstantsIndex;r[o+4]=this._water1OffsetX;r[o+5]=this._water1OffsetY;r[o+6]=this._water2OffsetX;r[o+7]=this._water2OffsetY;if(this._secondaryNormalMap)a.secondaryTextureGL.activate(a.pass._render)};e.prototype.iSetRenderState=function(e,a,i,r,o){t.prototype.iSetRenderState.call(this,e,a,i,r,o);if(this._secondaryNormalMap)a.secondaryTextureGL._setRenderState(i)};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(s,1);var n=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();e.fragmentConstantsIndex=n.index*4;o+="add "+s+", "+r.uvVarying+", "+h+".xyxy\n";if(this.texture)o+=e.textureGL._iGetFragmentCode(a,i,r,s);o+="add "+s+", "+r.uvVarying+", "+h+".zwzw\n";if(this._secondaryNormalMap)o+=e.secondaryTextureGL._iGetFragmentCode(s,i,r,s);o+="add "+a+", "+a+", "+s+"		\n"+"mul "+a+", "+a+", "+n+".x	\n"+"sub "+a+".xyz, "+a+".xyz, "+r.commons+".xxx	\n"+"nrm "+a+".xyz, "+a+".xyz							\n";return o};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/NormalBasicMethod":"awayjs-methodmaterials/lib/methods/NormalBasicMethod"}],"awayjs-methodmaterials/lib/methods/ShadingMethodBase":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/library/AssetBase");var o=t("awayjs-renderergl/lib/events/ShadingMethodEvent");var s=function(t){i(e,t);function e(){t.call(this);this._textures=new Array;this._owners=new Array;this._counts=new Array}Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:true,configurable:true});e.prototype.iIsUsed=function(t){return true};e.prototype.iInitVO=function(t,e){};e.prototype.iInitConstants=function(t,e){};e.prototype.iUsesTangentSpace=function(){return true};e.prototype.dispose=function(){};e.prototype.iAddOwner=function(t){var e=this._owners.indexOf(t);if(e!=-1){this._counts[e]++}else{this._owners.push(t);this._counts.push(1);var a=this._textures.length;for(var i=0;i<a;i++)t.addTexture(this._textures[i])}};e.prototype.iRemoveOwner=function(t){var e=this._owners.indexOf(t);if(this._counts[e]!=1){this._counts[e]--}else{this._owners.splice(e,1);this._counts.splice(e,1);var a=this._textures.length;for(var i=0;i<a;i++)t.removeTexture(this._textures[i])}};e.prototype.iAddTexture=function(t){this._textures.push(t);var e=this._owners.length;for(var a=0;a<e;a++)this._owners[a].addTexture(t)};e.prototype.iRemoveTexture=function(t){this._textures.splice(this._textures.indexOf(t),1);var e=this._owners.length;for(var a=0;a<e;a++)this._owners[a].removeTexture(t)};e.prototype.iReset=function(){this.iCleanCompilationData()};e.prototype.iCleanCompilationData=function(){};e.prototype.iGetVertexCode=function(t,e,a,i){return""};e.prototype.iGetFragmentCode=function(t,e,a,i,r){return null};e.prototype.iActivate=function(t,e,a){};e.prototype.iSetRenderState=function(t,e,a,i,r){};e.prototype.iDeactivate=function(t,e,a){};e.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new o.default(o.default.SHADER_INVALIDATED))};e.prototype.copyFrom=function(t){};e.assetType="[asset ShadingMethod]";return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/library/AssetBase":undefined,"awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/ShadowCascadeMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-display/lib/display/DirectionalLight");var s=t("awayjs-renderergl/lib/events/ShadingMethodEvent");var n=t("awayjs-methodmaterials/lib/data/MethodVO");var h=t("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");var d=function(t){i(e,t);function e(e){var a=this;t.call(this,e.castingLight);this._baseMethod=e;if(!(this._pCastingLight instanceof o.default))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");this._cascadeShadowMapper=this._pCastingLight.shadowMapper;if(!this._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");this._cascadeShadowMapper.addEventListener(r.default.INVALIDATE,function(t){return a.onCascadeChange(t)});this._baseMethod.addEventListener(s.default.SHADER_INVALIDATED,function(t){return a.onShaderInvalidated(t)})}Object.defineProperty(e.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){var e=this;if(this._baseMethod==t)return;this._baseMethod.removeEventListener(s.default.SHADER_INVALIDATED,function(t){return e.onShaderInvalidated(t)});this._baseMethod=t;this._baseMethod.addEventListener(s.default.SHADER_INVALIDATED,function(t){return e.onShaderInvalidated(t)});this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iInitVO=function(t,e){var a=new n.default(this._baseMethod,e.pass);this._baseMethod.iInitVO(t,a);e.needsGlobalVertexPos=true;e.needsProjection=true;e.textureGL=t.getAbstraction(this._pCastingLight.shadowMapper.depthMap)};e.prototype.iInitConstants=function(t,e){var a=t.fragmentConstantData;var i=t.vertexConstantData;var r=e.fragmentConstantsIndex;a[r]=1;a[r+1]=1/255;a[r+2]=1/65025;a[r+3]=1/16581375;a[r+6]=.5;a[r+7]=-.5;r=e.vertexConstantsIndex;i[r]=.5;i[r+1]=-.5;i[r+2]=0};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._cascadeProjections=null;this._depthMapCoordVaryings=null};e.prototype.iGetVertexCode=function(t,e,a,i){var r="";var o=a.getFreeVertexConstant();this.initProjectionsRegs(a);e.vertexConstantsIndex=o.index*4;var s=a.getFreeVertexVectorTemp();for(var n=0;n<this._cascadeShadowMapper.numCascades;++n){r+="m44 "+s+", "+i.globalPositionVertex+", "+this._cascadeProjections[n]+"\n"+"add "+this._depthMapCoordVaryings[n]+", "+s+", "+o+".zzwz\n"}return r};e.prototype.initProjectionsRegs=function(t){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades);this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var e=0;e<this._cascadeShadowMapper.numCascades;++e){this._depthMapCoordVaryings[e]=t.getFreeVarying();this._cascadeProjections[e]=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant()}};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=this._cascadeShadowMapper.numCascades;var s=i.getFreeFragmentConstant();var n=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();var d=Array(h+".x",h+".y",h+".z",h+".w");var l;e.fragmentConstantsIndex=s.index*4;var u=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(u,1);var p=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(p,1);l="mov "+p+", "+this._depthMapCoordVaryings[o-1]+"\n";for(var m=o-2;m>=0;--m){var f=this._depthMapCoordVaryings[m];l+="slt "+u+".z, "+r.projectionFragment+".z, "+d[m]+"\n";var c=i.getFreeFragmentVectorTemp();l+="sub "+c+", "+f+", "+p+"\n"+"mul "+c+", "+c+", "+u+".z\n"+"add "+p+", "+p+", "+c+"\n"}i.removeFragmentTempUsage(u);l+="div "+p+", "+p+", "+p+".w\n"+"mul "+p+".xy, "+p+".xy, "+n+".zw\n"+"add "+p+".xy, "+p+".xy, "+n+".zz\n";l+=this._baseMethod._iGetCascadeFragmentCode(t,e,s,p,a,i,r)+"add "+a+".w, "+a+".w, "+n+".y\n";i.removeFragmentTempUsage(p);return l};e.prototype.iActivate=function(t,e,a){e.textureGL.activate(e.pass._render);var i=t.vertexConstantData;var r=e.vertexConstantsIndex;t.vertexConstantData[e.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var o=this._cascadeShadowMapper.numCascades;r+=4;for(var s=0;s<o;++s){this._cascadeShadowMapper.getDepthProjections(s).copyRawDataTo(i,r,true);r+=16}var n=t.fragmentConstantData;var h=e.fragmentConstantsIndex;n[h+5]=1-this._pAlpha;var d=this._cascadeShadowMapper._iNearPlaneDistances;h+=8;for(var l=0;l<o;++l)n[h+l]=d[l];this._baseMethod.iActivateForCascade(t,e,a)};e.prototype.iSetRenderState=function(t,e,a,i,r){};e.prototype.onCascadeChange=function(t){this.iInvalidateShaderProgram()};e.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return e}(h.default);Object.defineProperty(a,"__esModule",{value:true});a.default=d},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-display/lib/display/DirectionalLight":undefined,"awayjs-methodmaterials/lib/data/MethodVO":"awayjs-methodmaterials/lib/data/MethodVO","awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase","awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/image/BitmapImage2D");var o=t("awayjs-display/lib/textures/Single2DTexture");var s=t("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var n=function(t){i(e,t);function e(a,i,r){if(i===void 0){i=4}if(r===void 0){r=1}t.call(this,a);this._depthMapSize=this._pCastingLight.shadowMapper.depthMapSize;this.numSamples=i;this.range=r;++e._grainUsages;if(!e._grainTexture)this.initGrainTexture()}Object.defineProperty(e.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){if(t<1)t=1;else if(t>24)t=24;if(this._numSamples==t)return;this._numSamples=t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iInitVO=function(a,i){t.prototype.iInitVO.call(this,a,i);i.needsProjection=true;i.secondaryTextureGL=a.getAbstraction(e._grainTexture)};e.prototype.iInitConstants=function(e,a){t.prototype.iInitConstants.call(this,e,a);var i=e.fragmentConstantData;var r=a.fragmentConstantsIndex;i[r+8]=1/this._numSamples};Object.defineProperty(e.prototype,"range",{get:function(){return this._range*2},set:function(t){this._range=t/2},enumerable:true,configurable:true});e.prototype.initGrainTexture=function(){e._grainBitmapImage2D=new r.default(64,64,false);var t=new Array;var a=4096;var i=1/(this._depthMapSize*this._range);var s,n;for(var h=0;h<a;++h){s=2*(Math.random()-.5);n=2*(Math.random()-.5);if(s<0)s-=i;else s+=i;if(n<0)n-=i;else n+=i;if(s>1)s=1;else if(s<-1)s=-1;if(n>1)n=1;else if(n<-1)n=-1;t[h]=Math.floor((s*.5+.5)*255)<<16|Math.floor((n*.5+.5)*255)<<8}e._grainBitmapImage2D.setArray(e._grainBitmapImage2D.rect,t);e._grainTexture=new o.default(e._grainBitmapImage2D)};e.prototype.dispose=function(){if(--e._grainUsages==0){e._grainTexture.dispose();e._grainBitmapImage2D.dispose();e._grainTexture=null}};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=e.fragmentConstantData;var o=a.fragmentConstantsIndex;r[o+9]=(i.width-1)/63;r[o+10]=(i.height-1)/63;r[o+11]=2*this._range/this._depthMapSize;a.secondaryTextureGL.activate(a.pass._render)};e.prototype.iSetRenderState=function(e,a,i,r,o){t.prototype.iSetRenderState.call(this,e,a,i,r,o);a.secondaryTextureGL._setRenderState(i)};e.prototype._pGetPlanarFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();var n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;return this.getSampleCode(t,e,n,o,a,i,r)};e.prototype.getSampleCode=function(t,e,a,i,r,o,s){var n="";var h=this._numSamples;var d=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(d,1);var l=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(l,1);var u=s.projectionFragment;n+="div "+d+", "+u+", "+u+".w\n"+"mul "+d+".xy, "+d+".xy, "+a+".yz\n";while(h>0){if(h==this._numSamples){n+=e.secondaryTextureGL._iGetFragmentCode(d,o,s,d)}else{n+="mov "+l+", "+d+".zwxy \n"+e.secondaryTextureGL._iGetFragmentCode(d,o,s,l)}n+="sub "+d+".zw, "+d+".xy, fc0.xx\n"+"mul "+d+".zw, "+d+".zw, "+a+".w\n";if(h==this._numSamples){n+="add "+d+".xy, "+d+".zw, "+this._pDepthMapCoordReg+".xy\n"+e.textureGL._iGetFragmentCode(l,o,s,d)+"dp4 "+l+".z, "+l+", "+i+"\n"+"slt "+r+".w, "+this._pDepthMapCoordReg+".z, "+l+".z\n"}else{n+=this.addSample(t,e,d,i,r,o,s)}if(h>4)n+="add "+d+".xy, "+d+".xy, "+d+".zw\n"+this.addSample(t,e,d,i,r,o,s);if(h>1)n+="sub "+d+".xy, "+this._pDepthMapCoordReg+".xy, "+d+".zw\n"+this.addSample(t,e,d,i,r,o,s);if(h>5)n+="sub "+d+".xy, "+d+".xy, "+d+".zw\n"+this.addSample(t,e,d,i,r,o,s);if(h>2){n+="neg "+d+".w, "+d+".w\n";n+="add "+d+".xy, "+d+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(t,e,d,i,r,o,s)}if(h>6)n+="add "+d+".xy, "+d+".xy, "+d+".wz\n"+this.addSample(t,e,d,i,r,o,s);if(h>3)n+="sub "+d+".xy, "+this._pDepthMapCoordReg+".xy, "+d+".wz\n"+this.addSample(t,e,d,i,r,o,s);if(h>7)n+="sub "+d+".xy, "+d+".xy, "+d+".wz\n"+this.addSample(t,e,d,i,r,o,s);h-=8}o.removeFragmentTempUsage(l);o.removeFragmentTempUsage(d);n+="mul "+r+".w, "+r+".w, "+a+".x\n";return n};e.prototype.addSample=function(t,e,a,i,r,o,s){var n=o.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(n,o,s,a)+"dp4 "+n+".z, "+n+", "+i+"\n"+"slt "+n+".z, "+this._pDepthMapCoordReg+".z, "+n+".z\n"+"add "+r+".w, "+r+".w, "+n+".z\n"};e.prototype.iActivateForCascade=function(t,e,a){var i=t.fragmentConstantData;var r=e.secondaryFragmentConstantsIndex;i[r]=1/this._numSamples;i[r+1]=(a.width-1)/63;i[r+2]=(a.height-1)/63;i[r+3]=2*this._range/this._depthMapSize;e.secondaryTextureGL.activate(e.pass._render)};e.prototype._iGetCascadeFragmentCode=function(t,e,a,i,r,o,s){this._pDepthMapCoordReg=i;var n=o.getFreeFragmentConstant();e.secondaryFragmentConstantsIndex=n.index*4;return this.getSampleCode(t,e,n,a,r,o,s)};return e}(s.default);Object.defineProperty(a,"__esModule",{value:true});a.default=n},{"awayjs-core/lib/image/BitmapImage2D":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-methodmaterials/lib/methods/ShadowMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMethodBase"}],"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var o=function(t){i(e,t);function e(e){t.call(this,e)}e.prototype.iInitConstants=function(e,a){t.prototype.iInitConstants.call(this,e,a);var i=e.fragmentConstantData;var r=a.fragmentConstantsIndex;i[r+8]=.5;var o=this.castingLight.shadowMapper.depthMapSize;i[r+9]=o;i[r+10]=1/o};e.prototype._pGetPlanarFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentConstant();i.getFreeFragmentConstant();var n=i.getFreeFragmentConstant();e.fragmentConstantsIndex=s.index*4;var h=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(h,1);var d=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(d,1);o+="mov "+d+", "+this._pDepthMapCoordReg+"\n"+e.textureGL._iGetFragmentCode(h,i,r,this._pDepthMapCoordReg)+"dp4 "+h+".z, "+h+", "+s+"\n"+"slt "+d+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"add "+d+".x, "+this._pDepthMapCoordReg+".x, "+n+".z\n"+e.textureGL._iGetFragmentCode(h,i,r,d)+"dp4 "+h+".z, "+h+", "+s+"\n"+"slt "+d+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".x, "+n+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+d+".w, "+d+".w, "+d+".z\n"+"mul "+d+".w, "+d+".w, "+h+".x\n"+"add "+a+".w, "+d+".z, "+d+".w\n"+"mov "+d+".x, "+this._pDepthMapCoordReg+".x\n"+"add "+d+".y, "+this._pDepthMapCoordReg+".y, "+n+".z\n"+e.textureGL._iGetFragmentCode(h,i,r,d)+"dp4 "+h+".z, "+h+", "+s+"\n"+"slt "+d+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"add "+d+".x, "+this._pDepthMapCoordReg+".x, "+n+".z\n"+e.textureGL._iGetFragmentCode(h,i,r,d)+"dp4 "+h+".z, "+h+", "+s+"\n"+"slt "+d+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".x, "+n+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+d+".w, "+d+".w, "+d+".z\n"+"mul "+d+".w, "+d+".w, "+h+".x\n"+"add "+d+".w, "+d+".z, "+d+".w\n"+"mul "+h+".x, "+this._pDepthMapCoordReg+".y, "+n+".y\n"+"frc "+h+".x, "+h+".x\n"+"sub "+d+".w, "+d+".w, "+a+".w\n"+"mul "+d+".w, "+d+".w, "+h+".x\n"+"add "+a+".w, "+a+".w, "+d+".w\n";i.removeFragmentTempUsage(h);i.removeFragmentTempUsage(d);return o};e.prototype.iActivateForCascade=function(t,e,a){var i=this.castingLight.shadowMapper.depthMapSize;var r=e.secondaryFragmentConstantsIndex;var o=t.fragmentConstantData;o[r]=i;o[r+1]=1/i};e.prototype._iGetCascadeFragmentCode=function(t,e,a,i,r,o,s){var n;var h=o.getFreeFragmentConstant();e.secondaryFragmentConstantsIndex=h.index*4;var d=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(d,1);var l=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(l,1);n=e.textureGL._iGetFragmentCode(d,o,s,i)+"dp4 "+d+".z, "+d+", "+a+"\n"+"slt "+l+".x, "+i+".z, "+d+".z\n"+"add "+i+".x, "+i+".x, "+h+".y\n"+e.textureGL._iGetFragmentCode(d,o,s,i)+"dp4 "+d+".z, "+d+", "+a+"\n"+"slt "+l+".z, "+i+".z, "+d+".z\n"+"add "+i+".y, "+i+".y, "+h+".y\n"+e.textureGL._iGetFragmentCode(d,o,s,i)+"dp4 "+d+".z, "+d+", "+a+"\n"+"slt "+l+".w, "+i+".z, "+d+".z\n"+"sub "+i+".x, "+i+".x, "+h+".y\n"+e.textureGL._iGetFragmentCode(d,o,s,i)+"dp4 "+d+".z, "+d+", "+a+"\n"+"slt "+l+".y, "+i+".z, "+d+".z\n"+"mul "+d+".xy, "+i+".xy, "+h+".x\n"+"frc "+d+".xy, "+d+".xy\n"+"sub "+i+", "+l+".xyzw, "+l+".zwxy\n"+"mul "+i+", "+i+", "+d+".x\n"+"add "+l+".xy, "+l+".xy, "+i+".zw\n"+"sub "+l+".y, "+l+".y, "+l+".x\n"+"mul "+l+".y, "+l+".y, "+d+".y\n"+"add "+r+".w, "+l+".x, "+l+".y\n";o.removeFragmentTempUsage(d);o.removeFragmentTempUsage(l);return n};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMethodBase"}],"awayjs-methodmaterials/lib/methods/ShadowHardMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var o=function(t){i(e,t);function e(e){t.call(this,e)}e.prototype._pGetPlanarFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentConstant();i.getFreeFragmentConstant();var n=i.getFreeFragmentVectorTemp();e.fragmentConstantsIndex=s.index*4;o+=e.textureGL._iGetFragmentCode(n,i,r,this._pDepthMapCoordReg)+"dp4 "+n+".z, "+n+", "+s+"\n"+"slt "+a+".w, "+this._pDepthMapCoordReg+".z, "+n+".z\n";return o};e.prototype._pGetPointFragmentCode=function(t,e,a,i,r){var o="";var s=i.getFreeFragmentConstant();var n=i.getFreeFragmentConstant();var h=i.getFreeFragmentConstant();var d=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(d,1);var l=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(l,1);e.fragmentConstantsIndex=s.index*4;o+="sub "+l+", "+r.globalPositionVarying+", "+h+"\n"+"dp3 "+l+".w, "+l+".xyz, "+l+".xyz\n"+"mul "+l+".w, "+l+".w, "+h+".w\n"+"nrm "+l+".xyz, "+l+".xyz\n"+e.textureGL._iGetFragmentCode(d,i,r,l)+"dp4 "+d+".z, "+d+", "+s+"\n"+"add "+a+".w, "+l+".w, "+n+".x\n"+"slt "+a+".w, "+a+".w, "+d+".z\n";i.removeFragmentTempUsage(l);i.removeFragmentTempUsage(d);return o};e.prototype._iGetCascadeFragmentCode=function(t,e,a,i,r,o,s){var n=o.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(n,o,s,i)+"dp4 "+n+".z, "+n+", "+a+"\n"+"slt "+r+".w, "+i+".z, "+n+".z\n"};e.prototype.iActivateForCascade=function(t,e,a){};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMethodBase"}],"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");var o=function(t){i(e,t);function e(e){t.call(this);this._pEpsilon=.02;this._pAlpha=1;this._pCastingLight=e;e.shadowsEnabled=true;this._pShadowMapper=e.shadowMapper;this.iAddTexture(e.shadowMapper.depthMap)}Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._pAlpha},set:function(t){this._pAlpha=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(t){this._pEpsilon=t},enumerable:true,configurable:true});e.assetType="[asset ShadowMapMethod]";return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase"}],"awayjs-methodmaterials/lib/methods/ShadowMethodBase":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/errors/AbstractMethodError");var o=t("awayjs-display/lib/display/PointLight");var s=t("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");var n=function(t){i(e,t);function e(e){t.call(this,e);this._pUsePoint=e instanceof o.default}e.prototype.iInitVO=function(t,e){e.needsView=true;e.needsGlobalVertexPos=true;e.needsGlobalFragmentPos=this._pUsePoint;e.needsNormals=t.numLights>0;e.textureGL=t.getAbstraction(this._pCastingLight.shadowMapper.depthMap)};e.prototype.iInitConstants=function(t,e){var a=t.fragmentConstantData;var i=t.vertexConstantData;var r=e.fragmentConstantsIndex;a[r]=1;a[r+1]=1/255;a[r+2]=1/65025;a[r+3]=1/16581375;a[r+6]=0;a[r+7]=1;if(this._pUsePoint){a[r+8]=0;a[r+9]=0;a[r+10]=0;a[r+11]=1}r=e.vertexConstantsIndex;if(r!=-1){i[r]=.5;i[r+1]=.5;i[r+2]=0;i[r+3]=1}};Object.defineProperty(e.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(t){this._pDepthMapCoordReg=t},enumerable:true,configurable:true});e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._pDepthMapCoordReg=null};e.prototype.iGetVertexCode=function(t,e,a,i){return this._pUsePoint?this._pGetPointVertexCode(e,a,i):this.pGetPlanarVertexCode(e,a,i)};e.prototype._pGetPointVertexCode=function(t,e,a){t.vertexConstantsIndex=-1;return""};e.prototype.pGetPlanarVertexCode=function(t,e,a){var i="";var r=e.getFreeVertexVectorTemp();var o=e.getFreeVertexConstant();var s=e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();e.getFreeVertexConstant();this._pDepthMapCoordReg=e.getFreeVarying();t.vertexConstantsIndex=o.index*4;i+="m44 "+r+", "+a.globalPositionVertex+", "+s+"\n"+"div "+r+", "+r+", "+r+".w\n"+"mul "+r+".xy, "+r+".xy, "+o+".xy\n"+"add "+this._pDepthMapCoordReg+", "+r+", "+o+".xxwz\n";return i};e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=this._pUsePoint?this._pGetPointFragmentCode(t,e,a,i,r):this._pGetPlanarFragmentCode(t,e,a,i,r);o+="add "+a+".w, "+a+".w, fc"+(e.fragmentConstantsIndex/4+1)+".y\n"+"sat "+a+".w, "+a+".w\n";return o};e.prototype._pGetPlanarFragmentCode=function(t,e,a,i,o){throw new r.default};e.prototype._pGetPointFragmentCode=function(t,e,a,i,o){throw new r.default};e.prototype.iSetRenderState=function(t,e,a,i,r){if(!this._pUsePoint)this._pShadowMapper.iDepthProjection.copyRawDataTo(t.vertexConstantData,e.vertexConstantsIndex+4,true);
e.textureGL._setRenderState(a)};e.prototype._iGetCascadeFragmentCode=function(t,e,a,i,r,o,s){throw new Error("This shadow method is incompatible with cascade shadows")};e.prototype.iActivate=function(t,e,a){var i=t.fragmentConstantData;var r=e.fragmentConstantsIndex;if(this._pUsePoint)i[r+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2);else t.vertexConstantData[e.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon);i[r+5]=1-this._pAlpha;if(this._pUsePoint){var o=this._pCastingLight.scenePosition;i[r+8]=o.x;i[r+9]=o.y;i[r+10]=o.z;var s=this._pCastingLight.fallOff;i[r+11]=1/(2*s*s)}e.textureGL.activate(e.pass._render)};e.prototype.iActivateForCascade=function(t,e,a){throw new Error("This shadow method is incompatible with cascade shadows")};return e}(s.default);Object.defineProperty(a,"__esModule",{value:true});a.default=n},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-display/lib/display/PointLight":undefined,"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase"}],"awayjs-methodmaterials/lib/methods/ShadowNearMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-renderergl/lib/events/ShadingMethodEvent");var o=t("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var s=function(t){i(e,t);function e(e,a){var i=this;if(a===void 0){a=.1}t.call(this,e.castingLight);this._onShaderInvalidatedDelegate=function(t){return i.onShaderInvalidated(t)};this._baseMethod=e;this._fadeRatio=a;this._nearShadowMapper=this._pCastingLight.shadowMapper;if(!this._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");this._baseMethod.addEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}Object.defineProperty(e.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){if(this._baseMethod==t)return;this._baseMethod.removeEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod=t;this._baseMethod.addEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.iInitConstants=function(e,a){t.prototype.iInitConstants.call(this,e,a);this._baseMethod.iInitConstants(e,a);var i=e.fragmentConstantData;var r=a.secondaryFragmentConstantsIndex;i[r+2]=0;i[r+3]=1};e.prototype.iInitVO=function(t,e){this._baseMethod.iInitVO(t,e);e.needsProjection=true};e.prototype.dispose=function(){this._baseMethod.removeEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)};Object.defineProperty(e.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(t){this._baseMethod.alpha=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(t){this._baseMethod.epsilon=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(t){this._fadeRatio=t},enumerable:true,configurable:true});e.prototype.iGetFragmentCode=function(t,e,a,i,r){var o=this._baseMethod.iGetFragmentCode(t,e,a,i,r);var s=i.getFreeFragmentConstant();var n=i.getFreeFragmentSingleTemp();e.secondaryFragmentConstantsIndex=s.index*4;o+="abs "+n+", "+r.projectionFragment+".w\n"+"sub "+n+", "+n+", "+s+".x\n"+"mul "+n+", "+n+", "+s+".y\n"+"sat "+n+", "+n+"\n"+"sub "+n+", "+s+".w,"+n+"\n"+"sub "+a+".w, "+s+".w,"+a+".w\n"+"mul "+a+".w, "+a+".w, "+n+"\n"+"sub "+a+".w, "+s+".w,"+a+".w\n";return o};e.prototype.iActivate=function(t,e,a){this._baseMethod.iActivate(t,e,a)};e.prototype.iDeactivate=function(t,e,a){this._baseMethod.iDeactivate(t,e,a)};e.prototype.iSetRenderState=function(t,e,a,i,r){var o=r.projection.near;var s=r.projection.far-o;var n=this._nearShadowMapper.coverageRatio;var h=n*(1-this._fadeRatio);n=o+n*s;h=o+h*s;var d=t.fragmentConstantData;var l=e.secondaryFragmentConstantsIndex;d[l]=h;d[l+1]=1/(n-h);this._baseMethod.iSetRenderState(t,e,a,i,r)};e.prototype.iGetVertexCode=function(t,e,a,i){return this._baseMethod.iGetVertexCode(t,e,a,i)};e.prototype.iReset=function(){this._baseMethod.iReset()};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};e.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-methodmaterials/lib/methods/ShadowMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMethodBase","awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/ShadowSoftMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/geom/PoissonLookup");var o=t("awayjs-methodmaterials/lib/methods/ShadowMethodBase");var s=function(t){i(e,t);function e(e,a,i){if(a===void 0){a=5}if(i===void 0){i=1}t.call(this,e);this._range=1;this.numSamples=a;this.range=i}Object.defineProperty(e.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){this._numSamples=t;if(this._numSamples<1)this._numSamples=1;else if(this._numSamples>32)this._numSamples=32;this._offsets=r.default.getDistribution(this._numSamples);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t},enumerable:true,configurable:true});e.prototype.iInitConstants=function(e,a){t.prototype.iInitConstants.call(this,e,a);e.fragmentConstantData[a.fragmentConstantsIndex+8]=1/this._numSamples;e.fragmentConstantData[a.fragmentConstantsIndex+9]=0};e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize;var o=e.fragmentConstantData;var s=a.fragmentConstantsIndex+10;var n=this._numSamples<<1;for(var h=0;h<n;++h)o[s+h]=this._offsets[h]*r};e.prototype._pGetPlanarFragmentCode=function(t,e,a,i,r){var o=i.getFreeFragmentConstant();i.getFreeFragmentConstant();var s=i.getFreeFragmentConstant();e.fragmentConstantsIndex=o.index*4;return this.getSampleCode(t,e,o,a,i,r,s)};e.prototype.addSample=function(t,e,a,i,r,o,s){var n=r.getFreeFragmentVectorTemp();return e.textureGL._iGetFragmentCode(n,r,o,s)+"dp4 "+n+".z, "+n+", "+a+"\n"+"slt "+s+".w, "+this._pDepthMapCoordReg+".z, "+n+".z\n"+"add "+i+".w, "+i+".w, "+s+".w\n"};e.prototype.iActivateForCascade=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=this._range/this._pCastingLight.shadowMapper.depthMapSize;var o=e.fragmentConstantData;var s=a.secondaryFragmentConstantsIndex;var n=this._numSamples<<1;o[s]=1/this._numSamples;o[s+1]=0;s+=2;for(var h=0;h<n;++h)o[s+h]=this._offsets[h]*r;if(n%4==0){o[s+n]=0;o[s+n+1]=0}};e.prototype._iGetCascadeFragmentCode=function(t,e,a,i,r,o,s){this._pDepthMapCoordReg=i;var n=o.getFreeFragmentConstant();e.secondaryFragmentConstantsIndex=n.index*4;return this.getSampleCode(t,e,a,r,o,s,n)};e.prototype.getSampleCode=function(t,e,a,i,r,o,s){var n;var h=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(h,1);var d=new Array(s+".zw");var l=this._numSamples>>1;for(var u=0;u<l;++u){var p=r.getFreeFragmentConstant();d.push(p+".xy");d.push(p+".zw")}for(u=0;u<this._numSamples;++u){if(u==0){var m=r.getFreeFragmentVectorTemp();n="add "+h+", "+this._pDepthMapCoordReg+", "+s+".zwyy\n"+e.textureGL._iGetFragmentCode(m,r,o,h)+"dp4 "+m+".z, "+m+", "+a+"\n"+"slt "+i+".w, "+this._pDepthMapCoordReg+".z, "+m+".z\n"}else{n+="add "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+d[u]+"\n"+this.addSample(t,e,a,i,r,o,h)}}r.removeFragmentTempUsage(h);n+="mul "+i+".w, "+i+".w, "+s+".x\n";return n};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/geom/PoissonLookup":undefined,"awayjs-methodmaterials/lib/methods/ShadowMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMethodBase"}],"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var o=function(t){i(e,t);function e(){t.call(this)}e.prototype.iInitVO=function(t,e){e.needsTangents=true;e.needsView=true};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight)n=this._pTotalLightColorReg;else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}s+="nrm "+n+".xyz, "+o.tangentVarying+".xyz\n"+"dp3 "+n+".w, "+n+".xyz, "+a+".xyz\n"+"dp3 "+n+".z, "+n+".xyz, "+o.viewDirFragment+".xyz\n";s+="sin "+n+".x, "+n+".w\n"+"sin "+n+".y, "+n+".z\n"+"mul "+n+".x, "+n+".x, "+n+".y\n"+"cos "+n+".z, "+n+".z\n"+"cos "+n+".w, "+n+".w\n"+"mul "+n+".w, "+n+".w, "+n+".z\n"+"sub "+n+".w, "+n+".x, "+n+".w\n";if(this.texture){s+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n"}else s+="pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n";s+="mul "+n+".w, "+n+".w, "+a+".w\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);s+="mul "+n+".xyz, "+i+".xyz, "+n+".w\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":"awayjs-methodmaterials/lib/methods/SpecularBasicMethod"}],"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-methodmaterials/lib/methods/LightingMethodBase");var s=function(t){i(e,t);function e(){t.call(this);this._gloss=50;this._strength=1;this._color=16777215;this._iSpecularR=1;this._iSpecularG=1;this._iSpecularB=1}e.prototype.iIsUsed=function(t){if(!t.numLights)return false;return true};e.prototype.iInitVO=function(t,e){e.needsNormals=t.numLights>0;e.needsView=t.numLights>0;if(this._texture){e.textureGL=t.getAbstraction(this._texture);t.uvDependencies++}else if(e.textureGL){e.textureGL.onClear(new r.default(r.default.CLEAR,null));e.textureGL=null}};Object.defineProperty(e.prototype,"gloss",{get:function(){return this._gloss},set:function(t){this._gloss=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){if(t==this._strength)return;this._strength=t;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){if(this._color==t)return;if(this._color==0||t==0)this.iInvalidateShaderProgram();this._color=t;this.updateSpecular()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(this._texture==t)return;if(this._texture)this.iRemoveTexture(this._texture);this._texture=t;if(this._texture)this.iAddTexture(this._texture);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});e.prototype.copyFrom=function(t){var e=t;var a=t;var i=a;this.texture=i.texture;this.strength=i.strength;this.color=i.color;this.gloss=i.gloss};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._pTotalLightColorReg=null;this._pSpecularTexData=null;this._pSpecularDataRegister=null};e.prototype.iGetFragmentPreLightingCode=function(t,e,a,i){var r="";this._pIsFirstLight=true;this._pSpecularDataRegister=a.getFreeFragmentConstant();e.fragmentConstantsIndex=this._pSpecularDataRegister.index*4;if(this._texture){this._pSpecularTexData=a.getFreeFragmentVectorTemp();a.addFragmentTempUsages(this._pSpecularTexData,1);r+=e.textureGL._iGetFragmentCode(this._pSpecularTexData,a,i,i.uvVarying)}this._pTotalLightColorReg=a.getFreeFragmentVectorTemp();a.addFragmentTempUsages(this._pTotalLightColorReg,1);return r};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight){n=this._pTotalLightColorReg}else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}var h=o.viewDirFragment;var d=o.normalFragment;s+="add "+n+", "+a+", "+h+"\n"+"nrm "+n+".xyz, "+n+"\n"+"dp3 "+n+".w, "+d+", "+n+"\n"+"sat "+n+".w, "+n+".w\n";if(this._texture){s+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n"}else{s+="pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n"}if(t.usesLightFallOff)s+="mul "+n+".w, "+n+".w, "+a+".w\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);s+="mul "+n+".xyz, "+i+", "+n+".w\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};e.prototype.iGetFragmentCodePerProbe=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight){n=this._pTotalLightColorReg}else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}var h=o.normalFragment;var d=o.viewDirFragment;s+="dp3 "+n+".w, "+h+", "+d+"\n"+"add "+n+".w, "+n+".w, "+n+".w\n"+"mul "+n+", "+n+".w, "+h+"\n"+"sub "+n+", "+n+", "+d+"\n"+"tex "+n+", "+n+", "+a+" <cube,"+"linear"+",miplinear>\n"+"mul "+n+".xyz, "+n+", "+i+"\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};e.prototype.iGetFragmentPostLightingCode=function(t,e,a,i,r){var o="";if(r.shadowTarget)o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r.shadowTarget+".w\n";if(this._texture){o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n";i.removeFragmentTempUsage(this._pSpecularTexData)}o+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\n"+"add "+a+".xyz, "+a+", "+this._pTotalLightColorReg+"\n";i.removeFragmentTempUsage(this._pTotalLightColorReg);return o};e.prototype.iActivate=function(t,e,a){if(this._texture)e.textureGL.activate(e.pass._render);var i=e.fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=this._iSpecularR;r[i+1]=this._iSpecularG;r[i+2]=this._iSpecularB;r[i+3]=this._gloss};e.prototype.iSetRenderState=function(t,e,a,i,r){if(this._texture)e.textureGL._setRenderState(a)};e.prototype.updateSpecular=function(){this._iSpecularR=(this._color>>16&255)/255*this._strength;this._iSpecularG=(this._color>>8&255)/255*this._strength;this._iSpecularB=(this._color&255)/255*this._strength};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-methodmaterials/lib/methods/LightingMethodBase":"awayjs-methodmaterials/lib/methods/LightingMethodBase"}],"awayjs-methodmaterials/lib/methods/SpecularCelMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod");var o=function(t){i(e,t);function e(e,a){var i=this;if(e===void 0){e=.5}if(a===void 0){a=null}t.call(this,null,a);this._smoothness=.1;this._specularCutOff=.1;this.baseMethod._iModulateMethod=function(t,e,a,r,o){return i.clampSpecular(t,e,a,r,o)};this._specularCutOff=e}Object.defineProperty(e.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(t){this._specularCutOff=t},enumerable:true,configurable:true});e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=a.secondaryFragmentConstantsIndex;var o=e.fragmentConstantData;o[r]=this._smoothness;o[r+1]=this._specularCutOff};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._dataReg=null};e.prototype.clampSpecular=function(t,e,a,i,r){return"sub "+a+".y, "+a+".w, "+this._dataReg+".y\n"+"div "+a+".y, "+a+".y, "+this._dataReg+".x\n"+"sat "+a+".y, "+a+".y\n"+"sge "+a+".w, "+a+".w, "+this._dataReg+".y\n"+"mul "+a+".w, "+a+".w, "+a+".y\n"};e.prototype.iGetFragmentPreLightingCode=function(e,a,i,r){this._dataReg=i.getFreeFragmentConstant();a.secondaryFragmentConstantsIndex=this._dataReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,a,i,r)};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod"}],"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-renderergl/lib/events/ShadingMethodEvent");var o=t("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var s=function(t){i(e,t);function e(e,a){var i=this;if(a===void 0){a=null}t.call(this);this._onShaderInvalidatedDelegate=function(t){return i.onShaderInvalidated(t)};this._baseMethod=a||new o.default;this._baseMethod._iModulateMethod=e;this._baseMethod.addEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}e.prototype.iInitVO=function(t,e){this._baseMethod.iInitVO(t,e)};e.prototype.iInitConstants=function(t,e){this._baseMethod.iInitConstants(t,e)};e.prototype.iAddOwner=function(e){t.prototype.iAddOwner.call(this,e);this._baseMethod.iAddOwner(e)};e.prototype.iRemoveOwner=function(e){t.prototype.iRemoveOwner.call(this,e);this._baseMethod.iRemoveOwner(e)};Object.defineProperty(e.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){if(this._baseMethod==t)return;this._baseMethod.removeEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod=t;this._baseMethod.addEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(t){this._baseMethod.gloss=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"strength",{get:function(){return this._baseMethod.strength},set:function(t){this._baseMethod.strength=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"color",{get:function(){return this._baseMethod.color},set:function(t){this._baseMethod.color=t},enumerable:true,configurable:true});e.prototype.dispose=function(){this._baseMethod.removeEventListener(r.default.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate);this._baseMethod.dispose()};Object.defineProperty(e.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(t){this._baseMethod.texture=t},enumerable:true,configurable:true});e.prototype.iActivate=function(t,e,a){this._baseMethod.iActivate(t,e,a)};e.prototype.iSetRenderState=function(t,e,a,i,r){this._baseMethod.iSetRenderState(t,e,a,i,r)};e.prototype.iDeactivate=function(t,e,a){this._baseMethod.iDeactivate(t,e,a)};e.prototype.iGetVertexCode=function(t,e,a,i){return this._baseMethod.iGetVertexCode(t,e,a,i)};e.prototype.iGetFragmentPreLightingCode=function(t,e,a,i){return this._baseMethod.iGetFragmentPreLightingCode(t,e,a,i)};e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){return this._baseMethod.iGetFragmentCodePerLight(t,e,a,i,r,o)};e.prototype.iGetFragmentCodePerProbe=function(t,e,a,i,r,o){return this._baseMethod.iGetFragmentCodePerProbe(t,e,a,i,r,o)};e.prototype.iGetFragmentPostLightingCode=function(t,e,a,i,r){return this._baseMethod.iGetFragmentPostLightingCode(t,e,a,i,r)};e.prototype.iReset=function(){this._baseMethod.iReset()};e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._baseMethod.iCleanCompilationData()};e.prototype.onShaderInvalidated=function(t){this.iInvalidateShaderProgram()};return e}(o.default);Object.defineProperty(a,"__esModule",{value:true});a.default=s},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":"awayjs-methodmaterials/lib/methods/SpecularBasicMethod","awayjs-renderergl/lib/events/ShadingMethodEvent":undefined}],"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod");var o=function(t){i(e,t);function e(e,a){var i=this;if(e===void 0){e=true}if(a===void 0){a=null}t.call(this,null,a);this._fresnelPower=5;this._normalReflectance=.028;this.baseMethod._iModulateMethod=function(t,e,a,r,o){return i.modulateSpecular(t,e,a,r,o)};this._incidentLight=!e}e.prototype.iInitConstants=function(t,e){var a=e.secondaryFragmentConstantsIndex;t.fragmentConstantData[a+2]=1;t.fragmentConstantData[a+3]=0};Object.defineProperty(e.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(t){if(this._incidentLight!=t)return;this._incidentLight=!t;this.iInvalidateShaderProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:true,configurable:true});e.prototype.iCleanCompilationData=function(){t.prototype.iCleanCompilationData.call(this);this._dataReg=null};Object.defineProperty(e.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance=t},enumerable:true,configurable:true});e.prototype.iActivate=function(e,a,i){t.prototype.iActivate.call(this,e,a,i);var r=e.fragmentConstantData;var o=a.secondaryFragmentConstantsIndex;r[o]=this._normalReflectance;r[o+1]=this._fresnelPower};e.prototype.iGetFragmentPreLightingCode=function(e,a,i,r){this._dataReg=i.getFreeFragmentConstant();a.secondaryFragmentConstantsIndex=this._dataReg.index*4;return t.prototype.iGetFragmentPreLightingCode.call(this,e,a,i,r)};e.prototype.modulateSpecular=function(t,e,a,i,r){var o;o="dp3 "+a+".y, "+r.viewDirFragment+".xyz, "+(this._incidentLight?a:r.normalFragment)+".xyz\n"+"sub "+a+".y, "+this._dataReg+".z, "+a+".y\n"+"pow "+a+".x, "+a+".y, "+this._dataReg+".y\n"+"sub "+a+".y, "+this._dataReg+".z, "+a+".y\n"+"mul "+a+".y, "+this._dataReg+".x, "+a+".y\n"+"add "+a+".y, "+a+".x, "+a+".y\n"+"mul "+a+".w, "+a+".w, "+a+".y\n";return o};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod"}],"awayjs-methodmaterials/lib/methods/SpecularPhongMethod":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var o=function(t){i(e,t);function e(){t.call(this)}e.prototype.iGetFragmentCodePerLight=function(t,e,a,i,r,o){var s="";var n;if(this._pIsFirstLight){n=this._pTotalLightColorReg}else{n=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(n,1)}var h=o.viewDirFragment;var d=o.normalFragment;s+="dp3 "+n+".w, "+a+", "+d+"\n"+"add "+n+".w, "+n+".w, "+n+".w\n"+"mul "+n+".xyz, "+d+", "+n+".w\n"+"sub "+n+".xyz, "+n+", "+a+"\n"+"add "+n+".w, "+n+".w, "+o.commons+".w\n"+"sat "+n+".w, "+n+".w\n"+"mul "+n+".xyz, "+n+", "+n+".w\n"+"dp3 "+n+".w, "+n+", "+h+"\n"+"sat "+n+".w, "+n+".w\n";if(this.texture){s+="mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\n"+"pow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n"}else s+="pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n";if(t.usesLightFallOff)s+="mul "+n+".w, "+n+".w, "+a+".w\n";if(this._iModulateMethod!=null)s+=this._iModulateMethod(t,e,n,r,o);s+="mul "+n+".xyz, "+i+".xyz, "+n+".w\n";if(!this._pIsFirstLight){s+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n";r.removeFragmentTempUsage(n)}this._pIsFirstLight=false;return s};return e}(r.default);Object.defineProperty(a,"__esModule",{value:true});a.default=o},{"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":"awayjs-methodmaterials/lib/methods/SpecularBasicMethod"}],"awayjs-methodmaterials/lib/methods":[function(t,e,a){"use strict";var i=t("awayjs-methodmaterials/lib/methods/AmbientBasicMethod");a.AmbientBasicMethod=i.default;var r=t("awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod");a.AmbientEnvMapMethod=r.default;var o=t("awayjs-methodmaterials/lib/methods/CurveBasicMethod");a.CurveBasicMethod=o.default;var s=t("awayjs-methodmaterials/lib/methods/DiffuseBasicMethod");a.DiffuseBasicMethod=s.default;var n=t("awayjs-methodmaterials/lib/methods/DiffuseCelMethod");a.DiffuseCelMethod=n.default;var h=t("awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod");a.DiffuseCompositeMethod=h.default;var d=t("awayjs-methodmaterials/lib/methods/DiffuseDepthMethod");a.DiffuseDepthMethod=d.default;var l=t("awayjs-methodmaterials/lib/methods/DiffuseGradientMethod");a.DiffuseGradientMethod=l.default;var u=t("awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod");a.DiffuseLightMapMethod=u.default;var p=t("awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod");a.DiffuseSubSurfaceMethod=p.default;var m=t("awayjs-methodmaterials/lib/methods/DiffuseWrapMethod");a.DiffuseWrapMethod=m.default;var f=t("awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod");a.EffectAlphaMaskMethod=f.default;var c=t("awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod");a.EffectColorMatrixMethod=c.default;var g=t("awayjs-methodmaterials/lib/methods/EffectColorTransformMethod");a.EffectColorTransformMethod=g.default;var _=t("awayjs-methodmaterials/lib/methods/EffectEnvMapMethod");a.EffectEnvMapMethod=_.default;var y=t("awayjs-methodmaterials/lib/methods/EffectFogMethod");a.EffectFogMethod=y.default;var M=t("awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod");a.EffectFresnelEnvMapMethod=M.default;var v=t("awayjs-methodmaterials/lib/methods/EffectLightMapMethod");a.EffectLightMapMethod=v.default;var b=t("awayjs-methodmaterials/lib/methods/EffectMethodBase");a.EffectMethodBase=b.default;var w=t("awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod");a.EffectRefractionEnvMapMethod=w.default;var x=t("awayjs-methodmaterials/lib/methods/EffectRimLightMethod");a.EffectRimLightMethod=x.default;var C=t("awayjs-methodmaterials/lib/methods/LightingMethodBase");a.LightingMethodBase=C.default;var j=t("awayjs-methodmaterials/lib/methods/NormalBasicMethod");a.NormalBasicMethod=j.default;var F=t("awayjs-methodmaterials/lib/methods/NormalHeightMapMethod");a.NormalHeightMapMethod=F.default;var P=t("awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod");a.NormalSimpleWaterMethod=P.default;var S=t("awayjs-methodmaterials/lib/methods/ShadingMethodBase");a.ShadingMethodBase=S.default;var L=t("awayjs-methodmaterials/lib/methods/ShadowCascadeMethod");a.ShadowCascadeMethod=L.default;var O=t("awayjs-methodmaterials/lib/methods/ShadowDitheredMethod");a.ShadowDitheredMethod=O.default;var D=t("awayjs-methodmaterials/lib/methods/ShadowFilteredMethod");a.ShadowFilteredMethod=D.default;var T=t("awayjs-methodmaterials/lib/methods/ShadowHardMethod");a.ShadowHardMethod=T.default;var V=t("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");a.ShadowMapMethodBase=V.default;var G=t("awayjs-methodmaterials/lib/methods/ShadowMethodBase");a.ShadowMethodBase=G.default;var R=t("awayjs-methodmaterials/lib/methods/ShadowNearMethod");a.ShadowNearMethod=R.default;var I=t("awayjs-methodmaterials/lib/methods/ShadowSoftMethod");a.ShadowSoftMethod=I.default;var z=t("awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod");a.SpecularAnisotropicMethod=z.default;var A=t("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");a.SpecularBasicMethod=A.default;var E=t("awayjs-methodmaterials/lib/methods/SpecularCelMethod");a.SpecularCelMethod=E.default;var B=t("awayjs-methodmaterials/lib/methods/SpecularCompositeMethod");a.SpecularCompositeMethod=B.default;var U=t("awayjs-methodmaterials/lib/methods/SpecularFresnelMethod");a.SpecularFresnelMethod=U.default;var N=t("awayjs-methodmaterials/lib/methods/SpecularPhongMethod");a.SpecularPhongMethod=N.default},{"awayjs-methodmaterials/lib/methods/AmbientBasicMethod":"awayjs-methodmaterials/lib/methods/AmbientBasicMethod","awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod":"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod","awayjs-methodmaterials/lib/methods/CurveBasicMethod":"awayjs-methodmaterials/lib/methods/CurveBasicMethod","awayjs-methodmaterials/lib/methods/DiffuseBasicMethod":"awayjs-methodmaterials/lib/methods/DiffuseBasicMethod","awayjs-methodmaterials/lib/methods/DiffuseCelMethod":"awayjs-methodmaterials/lib/methods/DiffuseCelMethod","awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod":"awayjs-methodmaterials/lib/methods/DiffuseCompositeMethod","awayjs-methodmaterials/lib/methods/DiffuseDepthMethod":"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod","awayjs-methodmaterials/lib/methods/DiffuseGradientMethod":"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod","awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod":"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod","awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod":"awayjs-methodmaterials/lib/methods/DiffuseSubSurfaceMethod","awayjs-methodmaterials/lib/methods/DiffuseWrapMethod":"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod","awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod":"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod","awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod":"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod","awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod","awayjs-methodmaterials/lib/methods/EffectEnvMapMethod":"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod","awayjs-methodmaterials/lib/methods/EffectFogMethod":"awayjs-methodmaterials/lib/methods/EffectFogMethod","awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod":"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod","awayjs-methodmaterials/lib/methods/EffectLightMapMethod":"awayjs-methodmaterials/lib/methods/EffectLightMapMethod","awayjs-methodmaterials/lib/methods/EffectMethodBase":"awayjs-methodmaterials/lib/methods/EffectMethodBase","awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod":"awayjs-methodmaterials/lib/methods/EffectRefractionEnvMapMethod",
"awayjs-methodmaterials/lib/methods/EffectRimLightMethod":"awayjs-methodmaterials/lib/methods/EffectRimLightMethod","awayjs-methodmaterials/lib/methods/LightingMethodBase":"awayjs-methodmaterials/lib/methods/LightingMethodBase","awayjs-methodmaterials/lib/methods/NormalBasicMethod":"awayjs-methodmaterials/lib/methods/NormalBasicMethod","awayjs-methodmaterials/lib/methods/NormalHeightMapMethod":"awayjs-methodmaterials/lib/methods/NormalHeightMapMethod","awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod":"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod","awayjs-methodmaterials/lib/methods/ShadingMethodBase":"awayjs-methodmaterials/lib/methods/ShadingMethodBase","awayjs-methodmaterials/lib/methods/ShadowCascadeMethod":"awayjs-methodmaterials/lib/methods/ShadowCascadeMethod","awayjs-methodmaterials/lib/methods/ShadowDitheredMethod":"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod","awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod","awayjs-methodmaterials/lib/methods/ShadowHardMethod":"awayjs-methodmaterials/lib/methods/ShadowHardMethod","awayjs-methodmaterials/lib/methods/ShadowMapMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase","awayjs-methodmaterials/lib/methods/ShadowMethodBase":"awayjs-methodmaterials/lib/methods/ShadowMethodBase","awayjs-methodmaterials/lib/methods/ShadowNearMethod":"awayjs-methodmaterials/lib/methods/ShadowNearMethod","awayjs-methodmaterials/lib/methods/ShadowSoftMethod":"awayjs-methodmaterials/lib/methods/ShadowSoftMethod","awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod":"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod","awayjs-methodmaterials/lib/methods/SpecularBasicMethod":"awayjs-methodmaterials/lib/methods/SpecularBasicMethod","awayjs-methodmaterials/lib/methods/SpecularCelMethod":"awayjs-methodmaterials/lib/methods/SpecularCelMethod","awayjs-methodmaterials/lib/methods/SpecularCompositeMethod":"awayjs-methodmaterials/lib/methods/SpecularCompositeMethod","awayjs-methodmaterials/lib/methods/SpecularFresnelMethod":"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod","awayjs-methodmaterials/lib/methods/SpecularPhongMethod":"awayjs-methodmaterials/lib/methods/SpecularPhongMethod"}],"awayjs-methodmaterials/lib/surfaces/GL_MethodMaterialSurface":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/image/BlendMode");var o=t("awayjs-display/lib/materials/lightpickers/StaticLightPicker");var s=t("awayjs-stagegl/lib/base/ContextGLCompareMode");var n=t("awayjs-renderergl/lib/surfaces/GL_SurfaceBase");var h=t("awayjs-methodmaterials/lib/MethodMaterialMode");var d=t("awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode");var l=t("awayjs-methodmaterials/lib/surfaces/passes/MethodPass");var u=function(t){i(e,t);function e(e,a,i){t.call(this,e,a,i);this._material=e}Object.defineProperty(e.prototype,"numLights",{get:function(){return this._material.lightPicker?this._material.lightPicker.numLightProbes+this._material.lightPicker.numDirectionalLights+this._material.lightPicker.numPointLights+this._material.lightPicker.numCastingDirectionalLights+this._material.lightPicker.numCastingPointLights:0},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numNonCasters",{get:function(){return this._material.lightPicker?this._material.lightPicker.numLightProbes+this._material.lightPicker.numDirectionalLights+this._material.lightPicker.numPointLights:0},enumerable:true,configurable:true});e.prototype._pUpdateRender=function(){t.prototype._pUpdateRender.call(this);this.initPasses();this.setBlendAndCompareModes();this._pClearPasses();if(this._material.mode==h.default.MULTI_PASS){if(this._casterLightPass)this._pAddPass(this._casterLightPass);if(this._nonCasterLightPasses)for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pAddPass(this._nonCasterLightPasses[e])}if(this._pass)this._pAddPass(this._pass)};e.prototype.initPasses=function(){if(this.numLights==0||this._material.numEffectMethods>0||this._material.mode==h.default.SINGLE_PASS)this.initEffectPass();else if(this._pass)this.removeEffectPass();if(this._material.shadowMethod&&this._material.mode==h.default.MULTI_PASS)this.initCasterLightPass();else if(this._casterLightPass)this.removeCasterLightPass();if(this.numNonCasters>0&&this._material.mode==h.default.MULTI_PASS)this.initNonCasterLightPasses();else if(this._nonCasterLightPasses)this.removeNonCasterLightPasses()};e.prototype.setBlendAndCompareModes=function(){var t=Boolean(this._casterLightPass||this._pass);if(this._casterLightPass){this._casterLightPass.forceSeparateMVP=t;this._casterLightPass.shader.setBlendMode(r.default.NORMAL);this._casterLightPass.shader.depthCompareMode=this._material.depthCompareMode}if(this._nonCasterLightPasses){var e=0;if(!this._casterLightPass){this._nonCasterLightPasses[0].forceSeparateMVP=t;this._nonCasterLightPasses[0].shader.setBlendMode(r.default.NORMAL);this._nonCasterLightPasses[0].shader.depthCompareMode=this._material.depthCompareMode;e=1}for(var a=e;a<this._nonCasterLightPasses.length;++a){this._nonCasterLightPasses[a].forceSeparateMVP=t;this._nonCasterLightPasses[a].shader.setBlendMode(r.default.ADD);this._nonCasterLightPasses[a].shader.depthCompareMode=s.default.LESS_EQUAL}}if(this._casterLightPass||this._nonCasterLightPasses){this._pRequiresBlending=false;if(this._pass){this._pass.mode=d.default.EFFECTS;this._pass.forceSeparateMVP=t;this._pass.shader.depthCompareMode=s.default.LESS_EQUAL;this._pass.shader.setBlendMode(r.default.LAYER)}}else if(this._pass){this._pRequiresBlending=this._material.blendMode!=r.default.NORMAL||this._material.alphaBlending||this._material.colorTransform&&this._material.colorTransform.alphaMultiplier<1;this._pass.mode=d.default.SUPER_SHADER;this._pass.preserveAlpha=this._pRequiresBlending;this._pass.forceSeparateMVP=false;this._pass.colorTransform=this._material.colorTransform;this._pass.shader.setBlendMode(this._material.blendMode==r.default.NORMAL&&this._pRequiresBlending?r.default.LAYER:this._material.blendMode);this._pass.shader.depthCompareMode=this._material.depthCompareMode}};e.prototype.initCasterLightPass=function(){if(this._casterLightPass==null)this._casterLightPass=new l.default(d.default.LIGHTING,this,this._material,this._elementsClass,this._stage);this._casterLightPass.lightPicker=new o.default([this._material.shadowMethod.castingLight]);this._casterLightPass.shadowMethod=this._material.shadowMethod;this._casterLightPass.diffuseMethod=this._material.diffuseMethod;this._casterLightPass.ambientMethod=this._material.ambientMethod;this._casterLightPass.normalMethod=this._material.normalMethod;this._casterLightPass.specularMethod=this._material.specularMethod};e.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose();this._pRemovePass(this._casterLightPass);this._casterLightPass=null};e.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var t;var e=this._material.lightPicker.numDirectionalLights;var a=this._material.lightPicker.numPointLights;var i=this._material.lightPicker.numLightProbes;var r=0;var o=0;var s=0;if(!this._casterLightPass){e+=this._material.lightPicker.numCastingDirectionalLights;a+=this._material.lightPicker.numCastingPointLights}this._nonCasterLightPasses=new Array;while(r<e||o<a||s<i){t=new l.default(d.default.LIGHTING,this,this._material,this._elementsClass,this._stage);t.includeCasters=this._material.shadowMethod==null;t.directionalLightsOffset=r;t.pointLightsOffset=o;t.lightProbesOffset=s;t.lightPicker=this._material.lightPicker;t.diffuseMethod=this._material.diffuseMethod;t.ambientMethod=this._material.ambientMethod;t.normalMethod=this._material.normalMethod;t.specularMethod=this._material.specularMethod;this._nonCasterLightPasses.push(t);r+=t.numDirectionalLights;o+=t.numPointLights;s+=t.numLightProbes}};e.prototype.removeNonCasterLightPasses=function(){if(!this._nonCasterLightPasses)return;for(var t=0;t<this._nonCasterLightPasses.length;++t)this._pRemovePass(this._nonCasterLightPasses[t]);this._nonCasterLightPasses=null};e.prototype.removeEffectPass=function(){if(this._pass.ambientMethod!=this._material.ambientMethod)this._pass.ambientMethod.dispose();if(this._pass.diffuseMethod!=this._material.diffuseMethod)this._pass.diffuseMethod.dispose();if(this._pass.specularMethod!=this._material.specularMethod)this._pass.specularMethod.dispose();if(this._pass.normalMethod!=this._material.normalMethod)this._pass.normalMethod.dispose();this._pRemovePass(this._pass);this._pass=null};e.prototype.initEffectPass=function(){if(this._pass==null)this._pass=new l.default(d.default.SUPER_SHADER,this,this._material,this._elementsClass,this._stage);if(this._material.mode==h.default.SINGLE_PASS){this._pass.ambientMethod=this._material.ambientMethod;this._pass.diffuseMethod=this._material.diffuseMethod;this._pass.specularMethod=this._material.specularMethod;this._pass.normalMethod=this._material.normalMethod;this._pass.shadowMethod=this._material.shadowMethod}else if(this._material.mode==h.default.MULTI_PASS){if(this.numLights==0){this._pass.ambientMethod=this._material.ambientMethod}else{this._pass.ambientMethod=null}this._pass.preserveAlpha=false;this._pass.normalMethod=this._material.normalMethod}var t=0;var e;var a=Math.max(this._material.numEffectMethods,this._pass.numEffectMethods);while(t<a){e=this._material.getEffectMethodAt(t);if(e!=this._pass.getEffectMethodAt(t)){this._pass.removeEffectMethodAt(t);if(e!=null){if(t<this._pass.numEffectMethods)this._pass.addEffectMethodAt(e,t);else this._pass.addEffectMethod(e)}}t++}};e.prototype.onClear=function(e){t.prototype.onClear.call(this,e)};return e}(n.default);Object.defineProperty(a,"__esModule",{value:true});a.default=u},{"awayjs-core/lib/image/BlendMode":undefined,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":"awayjs-methodmaterials/lib/MethodMaterialMode","awayjs-methodmaterials/lib/surfaces/passes/MethodPass":"awayjs-methodmaterials/lib/surfaces/passes/MethodPass","awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode":"awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode","awayjs-renderergl/lib/surfaces/GL_SurfaceBase":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode":[function(t,e,a){"use strict";var i=function(){function t(){}t.EFFECTS=1;t.LIGHTING=2;t.SUPER_SHADER=3;return t}();Object.defineProperty(a,"__esModule",{value:true});a.default=i},{}],"awayjs-methodmaterials/lib/surfaces/passes/MethodPass":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/events/AssetEvent");var o=t("awayjs-display/lib/materials/LightSources");var s=t("awayjs-renderergl/lib/shaders/LightingShader");var n=t("awayjs-renderergl/lib/events/ShadingMethodEvent");var h=t("awayjs-renderergl/lib/shaders/ShaderBase");var d=t("awayjs-renderergl/lib/surfaces/passes/PassBase");var l=t("awayjs-methodmaterials/lib/data/MethodVO");var u=t("awayjs-methodmaterials/lib/methods/EffectColorTransformMethod");var p=t("awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode");var m=function(t){i(e,t);function e(e,a,i,r,o){var s=this;t.call(this,a,i,r,o);this._maxLights=3;this._mode=3;this._includeCasters=true;this._iMethodVOs=new Array;this._numEffectDependencies=0;this.numDirectionalLights=0;this.numPointLights=0;this.numLightProbes=0;this.pointLightsOffset=0;this.directionalLightsOffset=0;this.lightProbesOffset=0;this._mode=e;this._material=i;this._onLightsChangeDelegate=function(t){return s.onLightsChange(t)};this._onMethodInvalidatedDelegate=function(t){return s.onMethodInvalidated(t)};this.lightPicker=i.lightPicker;if(this._shader==null)this._updateShader()}Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){if(this._mode==t)return;this._mode=t;this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(t){if(this._includeCasters==t)return;this._includeCasters=t;this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lightPicker",{get:function(){return this._lightPicker},set:function(t){if(this._lightPicker)this._lightPicker.removeEventListener(r.default.INVALIDATE,this._onLightsChangeDelegate);this._lightPicker=t;if(this._lightPicker)this._lightPicker.addEventListener(r.default.INVALIDATE,this._onLightsChangeDelegate);this._updateLights()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"enableLightFallOff",{get:function(){return this._material.enableLightFallOff},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"diffuseLightSources",{get:function(){return this._material.diffuseLightSources},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"specularLightSources",{get:function(){return this._material.specularLightSources},enumerable:true,configurable:true});e.prototype._updateShader=function(){if((this.numDirectionalLights||this.numPointLights||this.numLightProbes)&&!(this._shader instanceof s.default)){if(this._shader!=null)this._shader.dispose();this._shader=new s.default(this._elementsClass,this,this._stage)}else if(!(this._shader instanceof h.default)){if(this._shader!=null)this._shader.dispose();this._shader=new h.default(this._elementsClass,this,this._stage)}};e.prototype._iInitConstantData=function(e){t.prototype._iInitConstantData.call(this,e);var a=this._iMethodVOs.length;for(var i=0;i<a;++i)this._iMethodVOs[i].method.iInitConstants(e,this._iMethodVOs[i])};Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(t){if(t){if(this.colorTransformMethod==null)this.colorTransformMethod=new u.default;this.colorTransformMethod.colorTransform=t}else if(!t){if(this.colorTransformMethod)this.colorTransformMethod=null}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"colorTransformMethod",{get:function(){return this._iColorTransformMethodVO?this._iColorTransformMethodVO.method:null},set:function(t){if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.method==t)return;if(this._iColorTransformMethodVO){this._removeDependency(this._iColorTransformMethodVO);this._iColorTransformMethodVO=null}if(t){this._iColorTransformMethodVO=new l.default(t,this);this._addDependency(this._iColorTransformMethodVO)}},enumerable:true,configurable:true});e.prototype._removeDependency=function(t,e){if(e===void 0){e=false}var a=this._iMethodVOs.indexOf(t);if(!e)this._numEffectDependencies--;t.method.removeEventListener(n.default.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);this._iMethodVOs.splice(a,1);this.invalidate()};e.prototype._addDependency=function(t,e,a){if(e===void 0){e=false}if(a===void 0){a=-1}t.method.addEventListener(n.default.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);if(e){if(a!=-1)this._iMethodVOs.splice(a+this._iMethodVOs.length-this._numEffectDependencies,0,t);else this._iMethodVOs.push(t);this._numEffectDependencies++}else{this._iMethodVOs.splice(this._iMethodVOs.length-this._numEffectDependencies,0,t)}this.invalidate()};e.prototype.addEffectMethod=function(t){this._addDependency(new l.default(t,this),true)};Object.defineProperty(e.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:true,configurable:true});e.prototype.hasEffectMethod=function(t){return this.getDependencyForMethod(t)!=null};e.prototype.getEffectMethodAt=function(t){if(t<0||t>this._numEffectDependencies-1)return null;return this._iMethodVOs[t+this._iMethodVOs.length-this._numEffectDependencies].method};e.prototype.addEffectMethodAt=function(t,e){this._addDependency(new l.default(t,this),true,e)};e.prototype.removeEffectMethod=function(t){var e=this.getDependencyForMethod(t);if(e!=null)this._removeDependency(e,true)};e.prototype.removeEffectMethodAt=function(t){if(t<0||t>this._numEffectDependencies-1)return;var e=this._iMethodVOs[t+this._iMethodVOs.length-this._numEffectDependencies];if(e!=null)this._removeDependency(e,true)};e.prototype.getDependencyForMethod=function(t){var e=this._iMethodVOs.length;for(var a=0;a<e;++a)if(this._iMethodVOs[a].method==t)return this._iMethodVOs[a];return null};Object.defineProperty(e.prototype,"normalMethod",{get:function(){return this._iNormalMethodVO?this._iNormalMethodVO.method:null},set:function(t){if(this._iNormalMethodVO&&this._iNormalMethodVO.method==t)return;if(this._iNormalMethodVO){this._removeDependency(this._iNormalMethodVO);this._iNormalMethodVO=null}if(t){this._iNormalMethodVO=new l.default(t,this);this._addDependency(this._iNormalMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ambientMethod",{get:function(){return this._iAmbientMethodVO?this._iAmbientMethodVO.method:null},set:function(t){if(this._iAmbientMethodVO&&this._iAmbientMethodVO.method==t)return;if(this._iAmbientMethodVO){this._removeDependency(this._iAmbientMethodVO);this._iAmbientMethodVO=null}if(t){this._iAmbientMethodVO=new l.default(t,this);this._addDependency(this._iAmbientMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"shadowMethod",{get:function(){return this._iShadowMethodVO?this._iShadowMethodVO.method:null},set:function(t){if(this._iShadowMethodVO&&this._iShadowMethodVO.method==t)return;if(this._iShadowMethodVO){this._removeDependency(this._iShadowMethodVO);this._iShadowMethodVO=null}if(t){this._iShadowMethodVO=new l.default(t,this);this._addDependency(this._iShadowMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethodVO?this._iDiffuseMethodVO.method:null},set:function(t){if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.method==t)return;if(this._iDiffuseMethodVO){this._removeDependency(this._iDiffuseMethodVO);this._iDiffuseMethodVO=null}if(t){this._iDiffuseMethodVO=new l.default(t,this);this._addDependency(this._iDiffuseMethodVO)}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"specularMethod",{get:function(){return this._iSpecularMethodVO?this._iSpecularMethodVO.method:null},set:function(t){if(this._iSpecularMethodVO&&this._iSpecularMethodVO.method==t)return;if(this._iSpecularMethodVO){this._removeDependency(this._iSpecularMethodVO);this._iSpecularMethodVO=null}if(t){this._iSpecularMethodVO=new l.default(t,this);this._addDependency(this._iSpecularMethodVO)}},enumerable:true,configurable:true});e.prototype.dispose=function(){if(this._lightPicker)this._lightPicker.removeEventListener(r.default.INVALIDATE,this._onLightsChangeDelegate);while(this._iMethodVOs.length)this._removeDependency(this._iMethodVOs[0]);t.prototype.dispose.call(this);this._iMethodVOs=null};e.prototype.onMethodInvalidated=function(t){this.invalidate()};e.prototype._iActivate=function(e){t.prototype._iActivate.call(this,e);var a;var i=this._iMethodVOs.length;for(var r=0;r<i;++r){a=this._iMethodVOs[r];if(a.useMethod)a.method.iActivate(this._shader,a,this._stage)}};e.prototype._iRender=function(e,a,i){t.prototype._iRender.call(this,e,a,i);var r;var o=this._iMethodVOs.length;for(var s=0;s<o;++s){r=this._iMethodVOs[s];if(r.useMethod)r.method.iSetRenderState(this._shader,r,e,this._stage,a)}};e.prototype._iDeactivate=function(){t.prototype._iDeactivate.call(this);var e;var a=this._iMethodVOs.length;for(var i=0;i<a;++i){e=this._iMethodVOs[i];if(e.useMethod)e.method.iDeactivate(this._shader,e,this._stage)}};e.prototype._iIncludeDependencies=function(e){t.prototype._iIncludeDependencies.call(this,e);e.usesFragmentAnimation=Boolean(this._mode==p.default.SUPER_SHADER);if(e.useAlphaPremultiplied&&e.usesBlending)e.usesCommonData=true;var a;var i=this._iMethodVOs.length;for(a=0;a<i;++a)this.setupAndCountDependencies(e,this._iMethodVOs[a]);var r=true;var o;for(a=0;a<i;++a){o=this._iMethodVOs[a];if((o.useMethod=o.method.iIsUsed(e))&&!o.method.iUsesTangentSpace())r=false}e.outputsNormals=this._iNormalMethodVO&&this._iNormalMethodVO.useMethod;e.outputsTangentNormals=e.outputsNormals&&this._iNormalMethodVO.method.iOutputsTangentNormals();e.usesTangentSpace=e.outputsTangentNormals&&!e.usesProbes&&r;if(!e.usesTangentSpace){if(e.viewDirDependencies>0){e.globalPosDependencies++}else if(this.numPointLights>0&&e.usesLights){e.globalPosDependencies++;if(Boolean(this._mode&p.default.EFFECTS))e.usesGlobalPosFragment=true}}};e.prototype.setupAndCountDependencies=function(t,e){e.reset();e.method.iInitVO(t,e);if(e.needsProjection)t.projectionDependencies++;if(e.needsGlobalVertexPos||e.needsGlobalFragmentPos){t.globalPosDependencies++;if(e.needsGlobalFragmentPos)t.usesGlobalPosFragment=true}if(e.needsNormals)t.normalDependencies++;if(e.needsTangents)t.tangentDependencies++;if(e.needsView)t.viewDirDependencies++};e.prototype._iGetPreLightingVertexCode=function(t,e,a){var i="";if(this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod)i+=this._iAmbientMethodVO.method.iGetVertexCode(t,this._iAmbientMethodVO,e,a);if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod)i+=this._iDiffuseMethodVO.method.iGetVertexCode(t,this._iDiffuseMethodVO,e,a);if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod)i+=this._iSpecularMethodVO.method.iGetVertexCode(t,this._iSpecularMethodVO,e,a);return i};e.prototype._iGetPreLightingFragmentCode=function(t,e,a){var i="";if(this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod){i+=this._iAmbientMethodVO.method.iGetFragmentCode(t,this._iAmbientMethodVO,a.shadedTarget,e,a);if(this._iAmbientMethodVO.needsNormals)e.removeFragmentTempUsage(a.normalFragment);if(this._iAmbientMethodVO.needsView)e.removeFragmentTempUsage(a.viewDirFragment)}if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod)i+=this._iDiffuseMethodVO.method.iGetFragmentPreLightingCode(t,this._iDiffuseMethodVO,e,a);if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod)i+=this._iSpecularMethodVO.method.iGetFragmentPreLightingCode(t,this._iSpecularMethodVO,e,a);return i};e.prototype._iGetPerLightDiffuseFragmentCode=function(t,e,a,i,r){return this._iDiffuseMethodVO.method.iGetFragmentCodePerLight(t,this._iDiffuseMethodVO,e,a,i,r)};e.prototype._iGetPerLightSpecularFragmentCode=function(t,e,a,i,r){return this._iSpecularMethodVO.method.iGetFragmentCodePerLight(t,this._iSpecularMethodVO,e,a,i,r)};e.prototype._iGetPerProbeDiffuseFragmentCode=function(t,e,a,i,r){return this._iDiffuseMethodVO.method.iGetFragmentCodePerProbe(t,this._iDiffuseMethodVO,e,a,i,r)};e.prototype._iGetPerProbeSpecularFragmentCode=function(t,e,a,i,r){return this._iSpecularMethodVO.method.iGetFragmentCodePerProbe(t,this._iSpecularMethodVO,e,a,i,r)};e.prototype._iGetPostLightingVertexCode=function(t,e,a){var i="";if(this._iShadowMethodVO)i+=this._iShadowMethodVO.method.iGetVertexCode(t,this._iShadowMethodVO,e,a);return i};e.prototype._iGetPostLightingFragmentCode=function(t,e,a){var i="";if(t.useAlphaPremultiplied&&t.usesBlending){i+="add "+a.shadedTarget+".w, "+a.shadedTarget+".w, "+a.commons+".z\n"+"div "+a.shadedTarget+".xyz, "+a.shadedTarget+", "+a.shadedTarget+".w\n"+"sub "+a.shadedTarget+".w, "+a.shadedTarget+".w, "+a.commons+".z\n"+"sat "+a.shadedTarget+".xyz, "+a.shadedTarget+"\n"}if(this._iShadowMethodVO)i+=this._iShadowMethodVO.method.iGetFragmentCode(t,this._iShadowMethodVO,a.shadowTarget,e,a);if(this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod){i+=this._iDiffuseMethodVO.method.iGetFragmentPostLightingCode(t,this._iDiffuseMethodVO,a.shadedTarget,e,a);if(this._iDiffuseMethodVO.needsNormals)e.removeFragmentTempUsage(a.normalFragment);if(this._iDiffuseMethodVO.needsView)e.removeFragmentTempUsage(a.viewDirFragment)}if(this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod){i+=this._iSpecularMethodVO.method.iGetFragmentPostLightingCode(t,this._iSpecularMethodVO,a.shadedTarget,e,a);if(this._iSpecularMethodVO.needsNormals)e.removeFragmentTempUsage(a.normalFragment);if(this._iSpecularMethodVO.needsView)e.removeFragmentTempUsage(a.viewDirFragment)}if(this._iShadowMethodVO)e.removeFragmentTempUsage(a.shadowTarget);return i};e.prototype._iGetNormalVertexCode=function(t,e,a){return this._iNormalMethodVO.method.iGetVertexCode(t,this._iNormalMethodVO,e,a)};e.prototype._iGetNormalFragmentCode=function(t,e,a){var i=this._iNormalMethodVO.method.iGetFragmentCode(t,this._iNormalMethodVO,a.normalFragment,e,a);if(this._iNormalMethodVO.needsView)e.removeFragmentTempUsage(a.viewDirFragment);if(this._iNormalMethodVO.needsGlobalFragmentPos||this._iNormalMethodVO.needsGlobalVertexPos)e.removeVertexTempUsage(a.globalPositionVertex);return i};e.prototype._iGetVertexCode=function(t,e,a){var i="";var r;var o=this._iMethodVOs.length;for(var s=o-this._numEffectDependencies;s<o;s++){r=this._iMethodVOs[s];if(r.useMethod){i+=r.method.iGetVertexCode(t,r,e,a);if(r.needsGlobalVertexPos||r.needsGlobalFragmentPos)e.removeVertexTempUsage(a.globalPositionVertex)}}if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod)i+=this._iColorTransformMethodVO.method.iGetVertexCode(t,this._iColorTransformMethodVO,e,a);return i};e.prototype._iGetFragmentCode=function(t,e,a){var i="";var r;if(this.preserveAlpha&&this._numEffectDependencies>0){r=e.getFreeFragmentSingleTemp();e.addFragmentTempUsages(r,1);i+="mov "+r+", "+a.shadedTarget+".w\n"}var o;var s=this._iMethodVOs.length;for(var n=s-this._numEffectDependencies;n<s;n++){o=this._iMethodVOs[n];if(o.useMethod){i+=o.method.iGetFragmentCode(t,o,a.shadedTarget,e,a);if(o.needsNormals)e.removeFragmentTempUsage(a.normalFragment);if(o.needsView)e.removeFragmentTempUsage(a.viewDirFragment)}}if(this.preserveAlpha&&this._numEffectDependencies>0){i+="mov "+a.shadedTarget+".w, "+r+"\n";e.removeFragmentTempUsage(r)}if(this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod)i+=this._iColorTransformMethodVO.method.iGetFragmentCode(t,this._iColorTransformMethodVO,a.shadedTarget,e,a);return i};e.prototype._iUsesShadows=function(t){return Boolean(this._iShadowMethodVO&&(this._lightPicker.castingDirectionalLights.length>0||this._lightPicker.castingPointLights.length>0))};e.prototype._iUsesSpecular=function(t){return Boolean(this._iSpecularMethodVO)};e.prototype._iUsesDiffuse=function(t){return Boolean(this._iDiffuseMethodVO)};e.prototype.onLightsChange=function(t){this._updateLights()};e.prototype._updateLights=function(){var t=this.numDirectionalLights;var e=this.numPointLights;var a=this.numLightProbes;if(this._lightPicker&&this._mode&p.default.LIGHTING){this.numDirectionalLights=this.calculateNumDirectionalLights(this._lightPicker.numDirectionalLights);this.numPointLights=this.calculateNumPointLights(this._lightPicker.numPointLights);this.numLightProbes=this.calculateNumProbes(this._lightPicker.numLightProbes);if(this._includeCasters){this.numDirectionalLights+=this._lightPicker.numCastingDirectionalLights;this.numPointLights+=this._lightPicker.numCastingPointLights}}else{this.numDirectionalLights=0;this.numPointLights=0;this.numLightProbes=0}if(t!=this.numDirectionalLights||e!=this.numPointLights||a!=this.numLightProbes){this._updateShader();this.invalidate()}};e.prototype.calculateNumDirectionalLights=function(t){return Math.min(t-this.directionalLightsOffset,this._maxLights)};e.prototype.calculateNumPointLights=function(t){var e=this._maxLights-this.numDirectionalLights;return Math.min(t-this.pointLightsOffset,e)};e.prototype.calculateNumProbes=function(t){var e=0;if((this.specularLightSources&o.default.PROBES)!=0)++e;if((this.diffuseLightSources&o.default.PROBES)!=0)++e;return Math.min(t-this.lightProbesOffset,4/e|0)};return e}(d.default);Object.defineProperty(a,"__esModule",{value:true});a.default=m},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-display/lib/materials/LightSources":undefined,"awayjs-methodmaterials/lib/data/MethodVO":"awayjs-methodmaterials/lib/data/MethodVO","awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod","awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode":"awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode","awayjs-renderergl/lib/events/ShadingMethodEvent":undefined,"awayjs-renderergl/lib/shaders/LightingShader":undefined,"awayjs-renderergl/lib/shaders/ShaderBase":undefined,"awayjs-renderergl/lib/surfaces/passes/PassBase":undefined}],"awayjs-methodmaterials/lib/surfaces/passes/SingleObjectDepthPass":[function(t,e,a){"use strict";var i=this&&this.__extends||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a];function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)};var r=t("awayjs-core/lib/image/Image2D");var o=t("awayjs-core/lib/geom/Matrix3D");var s=t("awayjs-display/lib/textures/Single2DTexture");var n=t("awayjs-stagegl/lib/base/ContextGLDrawMode");var h=t("awayjs-stagegl/lib/base/ContextGLProgramType");var d=t("awayjs-renderergl/lib/surfaces/passes/PassBase");var l=function(t){i(e,t);function e(e,a,i,r){t.call(this,e,a,i,r);this._textureSize=512;this._polyOffset=new Float32Array([15,0,0,0]);this._projectionTexturesInvalid=true}Object.defineProperty(e.prototype,"textureSize",{get:function(){return this._textureSize},set:function(t){this._textureSize=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(t){this._polyOffset[0]=t},enumerable:true,configurable:true});e.prototype.dispose=function(){if(this._textures){for(var t in this._textures){var e=this._textures[t];e.dispose()}this._textures=null}};e.prototype.updateProjectionTextures=function(){if(this._textures){for(var t in this._textures){var e=this._textures[t];e.dispose()}}this._textures=new Object;this._projections=new Object;this._projectionTexturesInvalid=false};e.prototype._iGetVertexCode=function(){var t;t="mul vt7, vt1, vc4.x	\n"+"add vt7, vt7, vt0\n"+"mov vt7.w, vt0.w\n";t+="m44 vt2, vt7, vc0\n"+"mov op, vt2\n";t+="div v0, vt2, vt2.w\n";return t};e.prototype._iGetFragmentCode=function(t,e,a){var i="";i+="mul ft0, fc0, v0.z\n"+"frc ft0, ft0\n"+"mul ft1, ft0.yzww, fc1\n"+"sub ft0, ft0, ft1\n"+"mov oc, ft0\n";return i};e.prototype._iGetDepthMap=function(t){return this._textures[t.renderable.id]};e.prototype._iGetProjection=function(t){return this._projections[t.renderable.id]};e.prototype._iRender=function(t,e,a){var i;var d=this._stage.context;var l;var u;var p=this._surface.lightPicker.allPickedLights;var m=t.renderable.id;if(!this._textures[m])this._textures[m]=new s.default(new r.default(this._textureSize,this._textureSize));if(!this._projections[m])this._projections[m]=new o.default;l=p.length;u=p[0];i=u.iGetObjectProjectionMatrix(t.sourceEntity,e.sceneTransform,this._projections[m]);this._stage.setRenderTarget(this._textures[m],true);d.clear(1,1,1);d.setProgramConstantsFromMatrix(h.default.VERTEX,0,i,true);d.setProgramConstantsFromArray(h.default.FRAGMENT,0,this._enc,2);var f=t.elements;var c=this._shader._elementsPool.getAbstraction(f);c.activateVertexBufferVO(0,f.positions);c.activateVertexBufferVO(1,f.normals);c.getIndexBufferGL().draw(n.default.TRIANGLES,0,f.numElements)};e.prototype._iActivate=function(e){if(this._projectionTexturesInvalid)this.updateProjectionTextures();t.prototype._iActivate.call(this,e);this._stage.context.setProgramConstantsFromArray(h.default.VERTEX,4,this._polyOffset,1)};return e}(d.default);Object.defineProperty(a,"__esModule",{value:true});a.default=l},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/image/Image2D":undefined,
"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-renderergl/lib/surfaces/passes/PassBase":undefined,"awayjs-stagegl/lib/base/ContextGLDrawMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-methodmaterials/lib/surfaces":[function(t,e,a){"use strict";var i=t("awayjs-methodmaterials/lib/surfaces/passes/MethodPass");a.MethodPass=i.default;var r=t("awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode");a.MethodPassMode=r.default;var o=t("awayjs-methodmaterials/lib/surfaces/passes/SingleObjectDepthPass");a.SingleObjectDepthPass=o.default;var s=t("awayjs-methodmaterials/lib/surfaces/GL_MethodMaterialSurface");a.GL_MethodMaterialSurface=s.default},{"awayjs-methodmaterials/lib/surfaces/GL_MethodMaterialSurface":"awayjs-methodmaterials/lib/surfaces/GL_MethodMaterialSurface","awayjs-methodmaterials/lib/surfaces/passes/MethodPass":"awayjs-methodmaterials/lib/surfaces/passes/MethodPass","awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode":"awayjs-methodmaterials/lib/surfaces/passes/MethodPassMode","awayjs-methodmaterials/lib/surfaces/passes/SingleObjectDepthPass":"awayjs-methodmaterials/lib/surfaces/passes/SingleObjectDepthPass"}]},{},[1]);
//# sourceMappingURL=awayjs-methodmaterials.min.js.map
