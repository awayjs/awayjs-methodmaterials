var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Event = require("awayjs-core/lib/events/Event");
var DirectionalLight = require("awayjs-display/lib/entities/DirectionalLight");
var ShadingMethodEvent = require("awayjs-renderergl/lib/events/ShadingMethodEvent");
var MethodVO = require("awayjs-methodmaterials/lib/data/MethodVO");
var ShadowMapMethodBase = require("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");
/**
 * ShadowCascadeMethod is a shadow map method to apply cascade shadow mapping on materials.
 * Must be used with a DirectionalLight with a CascadeShadowMapper assigned to its shadowMapper property.
 *
 * @see away.lights.CascadeShadowMapper
 */
var ShadowCascadeMethod = (function (_super) {
    __extends(ShadowCascadeMethod, _super);
    /**
     * Creates a new ShadowCascadeMethod object.
     *
     * @param shadowMethodBase The shadow map sampling method used to sample individual cascades (fe: ShadowHardMethod, ShadowSoftMethod)
     */
    function ShadowCascadeMethod(shadowMethodBase) {
        var _this = this;
        _super.call(this, shadowMethodBase.castingLight);
        this._baseMethod = shadowMethodBase;
        if (!(this._pCastingLight instanceof DirectionalLight))
            throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");
        this._cascadeShadowMapper = this._pCastingLight.shadowMapper;
        if (!this._cascadeShadowMapper)
            throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");
        this._cascadeShadowMapper.addEventListener(Event.CHANGE, function (event) { return _this.onCascadeChange(event); });
        this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
    }
    Object.defineProperty(ShadowCascadeMethod.prototype, "baseMethod", {
        /**
         * The shadow map sampling method used to sample individual cascades. These are typically those used in conjunction
         * with a DirectionalShadowMapper.
         *
         * @see ShadowHardMethod
         * @see ShadowSoftMethod
         */
        get: function () {
            return this._baseMethod;
        },
        set: function (value) {
            var _this = this;
            if (this._baseMethod == value)
                return;
            this._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this._baseMethod = value;
            this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        var tempVO = new MethodVO(this._baseMethod);
        this._baseMethod.iInitVO(shaderObject, tempVO);
        methodVO.needsGlobalVertexPos = true;
        methodVO.needsProjection = true;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        var fragmentData = shaderObject.fragmentConstantData;
        var vertexData = shaderObject.vertexConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index] = 1.0;
        fragmentData[index + 1] = 1 / 255.0;
        fragmentData[index + 2] = 1 / 65025.0;
        fragmentData[index + 3] = 1 / 16581375.0;
        fragmentData[index + 6] = .5;
        fragmentData[index + 7] = -.5;
        index = methodVO.vertexConstantsIndex;
        vertexData[index] = .5;
        vertexData[index + 1] = -.5;
        vertexData[index + 2] = 0;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iCleanCompilationData = function () {
        _super.prototype.iCleanCompilationData.call(this);
        this._cascadeProjections = null;
        this._depthMapCoordVaryings = null;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetVertexCode = function (shaderObject, methodVO, registerCache, sharedRegisters) {
        var code = "";
        var dataReg = registerCache.getFreeVertexConstant();
        this.initProjectionsRegs(registerCache);
        methodVO.vertexConstantsIndex = dataReg.index * 4;
        var temp = registerCache.getFreeVertexVectorTemp();
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            code += "m44 " + temp + ", " + sharedRegisters.globalPositionVertex + ", " + this._cascadeProjections[i] + "\n" + "add " + this._depthMapCoordVaryings[i] + ", " + temp + ", " + dataReg + ".zzwz\n";
        }
        return code;
    };
    /**
     * Creates the registers for the cascades' projection coordinates.
     */
    ShadowCascadeMethod.prototype.initProjectionsRegs = function (registerCache) {
        this._cascadeProjections = new Array(this._cascadeShadowMapper.numCascades);
        this._depthMapCoordVaryings = new Array(this._cascadeShadowMapper.numCascades);
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            this._depthMapCoordVaryings[i] = registerCache.getFreeVarying();
            this._cascadeProjections[i] = registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
        }
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetFragmentCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var numCascades = this._cascadeShadowMapper.numCascades;
        var depthMapRegister = registerCache.getFreeTextureReg();
        var decReg = registerCache.getFreeFragmentConstant();
        var dataReg = registerCache.getFreeFragmentConstant();
        var planeDistanceReg = registerCache.getFreeFragmentConstant();
        var planeDistances = Array(planeDistanceReg + ".x", planeDistanceReg + ".y", planeDistanceReg + ".z", planeDistanceReg + ".w");
        var code;
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        methodVO.texturesIndex = depthMapRegister.index;
        var inQuad = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(inQuad, 1);
        var uvCoord = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(uvCoord, 1);
        // assume lowest partition is selected, will be overwritten later otherwise
        code = "mov " + uvCoord + ", " + this._depthMapCoordVaryings[numCascades - 1] + "\n";
        for (var i = numCascades - 2; i >= 0; --i) {
            var uvProjection = this._depthMapCoordVaryings[i];
            // calculate if in texturemap (result == 0 or 1, only 1 for a single partition)
            code += "slt " + inQuad + ".z, " + sharedRegisters.projectionFragment + ".z, " + planeDistances[i] + "\n"; // z = x > minX, w = y > minY
            var temp = registerCache.getFreeFragmentVectorTemp();
            // linearly interpolate between old and new uv coords using predicate value == conditional toggle to new value if predicate == 1 (true)
            code += "sub " + temp + ", " + uvProjection + ", " + uvCoord + "\n" + "mul " + temp + ", " + temp + ", " + inQuad + ".z\n" + "add " + uvCoord + ", " + uvCoord + ", " + temp + "\n";
        }
        registerCache.removeFragmentTempUsage(inQuad);
        code += "div " + uvCoord + ", " + uvCoord + ", " + uvCoord + ".w\n" + "mul " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zw\n" + "add " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zz\n";
        code += this._baseMethod._iGetCascadeFragmentCode(shaderObject, methodVO, decReg, depthMapRegister, uvCoord, targetReg, registerCache, sharedRegisters) + "add " + targetReg + ".w, " + targetReg + ".w, " + dataReg + ".y\n";
        registerCache.removeFragmentTempUsage(uvCoord);
        return code;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        stage.activateTexture(methodVO.texturesIndex, this._pCastingLight.shadowMapper.depthMap);
        var vertexData = shaderObject.vertexConstantData;
        var vertexIndex = methodVO.vertexConstantsIndex;
        shaderObject.vertexConstantData[methodVO.vertexConstantsIndex + 3] = -1 / (this._cascadeShadowMapper.depth * this._pEpsilon);
        var numCascades = this._cascadeShadowMapper.numCascades;
        vertexIndex += 4;
        for (var k = 0; k < numCascades; ++k) {
            this._cascadeShadowMapper.getDepthProjections(k).copyRawDataTo(vertexData, vertexIndex, true);
            vertexIndex += 16;
        }
        var fragmentData = shaderObject.fragmentConstantData;
        var fragmentIndex = methodVO.fragmentConstantsIndex;
        fragmentData[fragmentIndex + 5] = 1 - this._pAlpha;
        var nearPlaneDistances = this._cascadeShadowMapper._iNearPlaneDistances;
        fragmentIndex += 8;
        for (var i = 0; i < numCascades; ++i)
            fragmentData[fragmentIndex + i] = nearPlaneDistances[i];
        this._baseMethod.iActivateForCascade(shaderObject, methodVO, stage);
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iSetRenderState = function (shaderObject, methodVO, renderable, stage, camera) {
    };
    /**
     * Called when the shadow mappers cascade configuration changes.
     */
    ShadowCascadeMethod.prototype.onCascadeChange = function (event) {
        this.iInvalidateShaderProgram();
    };
    /**
     * Called when the base method's shader code is invalidated.
     */
    ShadowCascadeMethod.prototype.onShaderInvalidated = function (event) {
        this.iInvalidateShaderProgram();
    };
    return ShadowCascadeMethod;
})(ShadowMapMethodBase);
module.exports = ShadowCascadeMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93Q2FzY2FkZU1ldGhvZC50cyJdLCJuYW1lcyI6WyJTaGFkb3dDYXNjYWRlTWV0aG9kIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5jb25zdHJ1Y3RvciIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuYmFzZU1ldGhvZCIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUluaXRWTyIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUluaXRDb25zdGFudHMiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlDbGVhbkNvbXBpbGF0aW9uRGF0YSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUdldFZlcnRleENvZGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmluaXRQcm9qZWN0aW9uc1JlZ3MiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlHZXRGcmFnbWVudENvZGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlBY3RpdmF0ZSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaVNldFJlbmRlclN0YXRlIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5vbkNhc2NhZGVDaGFuZ2UiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLm9uU2hhZGVySW52YWxpZGF0ZWQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sS0FBSyxXQUFpQiw4QkFBOEIsQ0FBQyxDQUFDO0FBSTdELElBQU8sZ0JBQWdCLFdBQWUsOENBQThDLENBQUMsQ0FBQztBQU10RixJQUFPLGtCQUFrQixXQUFjLGlEQUFpRCxDQUFDLENBQUM7QUFRMUYsSUFBTyxRQUFRLFdBQWlCLDBDQUEwQyxDQUFDLENBQUM7QUFDNUUsSUFBTyxtQkFBbUIsV0FBYyx3REFBd0QsQ0FBQyxDQUFDO0FBR2xHLEFBTUE7Ozs7O0dBREc7SUFDRyxtQkFBbUI7SUFBU0EsVUFBNUJBLG1CQUFtQkEsVUFBNEJBO0lBT3BEQTs7OztPQUlHQTtJQUNIQSxTQVpLQSxtQkFBbUJBLENBWVpBLGdCQUFpQ0E7UUFaOUNDLGlCQW1Q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RUEsUUFBaUJBLEVBQUVBLFVBQXlCQSxFQUFFQSxLQUFXQSxFQUFFQSxNQUFhQTtJQUU5SFUsQ0FBQ0E7SUFFRFY7O09BRUdBO0lBQ0tBLDZDQUFlQSxHQUF2QkEsVUFBd0JBLEtBQVdBO1FBRWxDVyxJQUFJQSxDQUFDQSx3QkFBd0JBLEVBQUVBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUVEWDs7T0FFR0E7SUFDS0EsaURBQW1CQSxHQUEzQkEsVUFBNEJBLEtBQXdCQTtRQUVuRFksSUFBSUEsQ0FBQ0Esd0JBQXdCQSxFQUFFQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFDRlosMEJBQUNBO0FBQURBLENBblBBLEFBbVBDQSxFQW5QaUMsbUJBQW1CLEVBbVBwRDtBQUVELEFBQTZCLGlCQUFwQixtQkFBbUIsQ0FBQyIsImZpbGUiOiJtZXRob2RzL1NoYWRvd0Nhc2NhZGVNZXRob2QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEV2ZW50XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IFRleHR1cmUyREJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1RleHR1cmUyREJhc2VcIik7XG5cbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvRGlyZWN0aW9uYWxMaWdodFwiKTtcbmltcG9ydCBDYXNjYWRlU2hhZG93TWFwcGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ2FzY2FkZVNoYWRvd01hcHBlclwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcblxuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuaW1wb3J0IFNoYWRpbmdNZXRob2RFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2V2ZW50cy9TaGFkaW5nTWV0aG9kRXZlbnRcIik7XG5pbXBvcnQgU2hhZGVyTGlnaHRpbmdPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ09iamVjdFwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRGF0YVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xuaW1wb3J0IFNoYWRlckNvbXBpbGVySGVscGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvdXRpbHMvU2hhZGVyQ29tcGlsZXJIZWxwZXJcIik7XG5cbmltcG9ydCBNZXRob2RWT1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvZGF0YS9NZXRob2RWT1wiKTtcbmltcG9ydCBTaGFkb3dNYXBNZXRob2RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9tZXRob2RzL1NoYWRvd01hcE1ldGhvZEJhc2VcIik7XG5pbXBvcnQgU2hhZG93TWV0aG9kQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9tZXRob2RzL1NoYWRvd01ldGhvZEJhc2VcIik7XG5cbi8qKlxuICogU2hhZG93Q2FzY2FkZU1ldGhvZCBpcyBhIHNoYWRvdyBtYXAgbWV0aG9kIHRvIGFwcGx5IGNhc2NhZGUgc2hhZG93IG1hcHBpbmcgb24gbWF0ZXJpYWxzLlxuICogTXVzdCBiZSB1c2VkIHdpdGggYSBEaXJlY3Rpb25hbExpZ2h0IHdpdGggYSBDYXNjYWRlU2hhZG93TWFwcGVyIGFzc2lnbmVkIHRvIGl0cyBzaGFkb3dNYXBwZXIgcHJvcGVydHkuXG4gKlxuICogQHNlZSBhd2F5LmxpZ2h0cy5DYXNjYWRlU2hhZG93TWFwcGVyXG4gKi9cbmNsYXNzIFNoYWRvd0Nhc2NhZGVNZXRob2QgZXh0ZW5kcyBTaGFkb3dNYXBNZXRob2RCYXNlXG57XG5cdHByaXZhdGUgX2Jhc2VNZXRob2Q6U2hhZG93TWV0aG9kQmFzZTtcblx0cHJpdmF0ZSBfY2FzY2FkZVNoYWRvd01hcHBlcjpDYXNjYWRlU2hhZG93TWFwcGVyO1xuXHRwcml2YXRlIF9kZXB0aE1hcENvb3JkVmFyeWluZ3M6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pjtcblx0cHJpdmF0ZSBfY2FzY2FkZVByb2plY3Rpb25zOkFycmF5PFNoYWRlclJlZ2lzdGVyRWxlbWVudD47XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgU2hhZG93Q2FzY2FkZU1ldGhvZCBvYmplY3QuXG5cdCAqXG5cdCAqIEBwYXJhbSBzaGFkb3dNZXRob2RCYXNlIFRoZSBzaGFkb3cgbWFwIHNhbXBsaW5nIG1ldGhvZCB1c2VkIHRvIHNhbXBsZSBpbmRpdmlkdWFsIGNhc2NhZGVzIChmZTogU2hhZG93SGFyZE1ldGhvZCwgU2hhZG93U29mdE1ldGhvZClcblx0ICovXG5cdGNvbnN0cnVjdG9yKHNoYWRvd01ldGhvZEJhc2U6U2hhZG93TWV0aG9kQmFzZSlcblx0e1xuXHRcdHN1cGVyKHNoYWRvd01ldGhvZEJhc2UuY2FzdGluZ0xpZ2h0KTtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QgPSBzaGFkb3dNZXRob2RCYXNlO1xuXHRcdGlmICghKHRoaXMuX3BDYXN0aW5nTGlnaHQgaW5zdGFuY2VvZiBEaXJlY3Rpb25hbExpZ2h0KSlcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlNoYWRvd0Nhc2NhZGVNZXRob2QgaXMgb25seSBjb21wYXRpYmxlIHdpdGggRGlyZWN0aW9uYWxMaWdodFwiKTtcblxuXHRcdHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIgPSA8Q2FzY2FkZVNoYWRvd01hcHBlcj4gdGhpcy5fcENhc3RpbmdMaWdodC5zaGFkb3dNYXBwZXI7XG5cblx0XHRpZiAoIXRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIpXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJTaGFkb3dDYXNjYWRlTWV0aG9kIHJlcXVpcmVzIGEgbGlnaHQgdGhhdCBoYXMgYSBDYXNjYWRlU2hhZG93TWFwcGVyIGluc3RhbmNlIGFzc2lnbmVkIHRvIHNoYWRvd01hcHBlci5cIik7XG5cblx0XHR0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnQuQ0hBTkdFLCAoZXZlbnQ6RXZlbnQpID0+IHRoaXMub25DYXNjYWRlQ2hhbmdlKGV2ZW50KSk7XG5cdFx0dGhpcy5fYmFzZU1ldGhvZC5hZGRFdmVudExpc3RlbmVyKFNoYWRpbmdNZXRob2RFdmVudC5TSEFERVJfSU5WQUxJREFURUQsIChldmVudDpTaGFkaW5nTWV0aG9kRXZlbnQpID0+IHRoaXMub25TaGFkZXJJbnZhbGlkYXRlZChldmVudCkpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoZSBzaGFkb3cgbWFwIHNhbXBsaW5nIG1ldGhvZCB1c2VkIHRvIHNhbXBsZSBpbmRpdmlkdWFsIGNhc2NhZGVzLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHRob3NlIHVzZWQgaW4gY29uanVuY3Rpb25cblx0ICogd2l0aCBhIERpcmVjdGlvbmFsU2hhZG93TWFwcGVyLlxuXHQgKlxuXHQgKiBAc2VlIFNoYWRvd0hhcmRNZXRob2Rcblx0ICogQHNlZSBTaGFkb3dTb2Z0TWV0aG9kXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IGJhc2VNZXRob2QoKTpTaGFkb3dNZXRob2RCYXNlXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fYmFzZU1ldGhvZDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgYmFzZU1ldGhvZCh2YWx1ZTpTaGFkb3dNZXRob2RCYXNlKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2Jhc2VNZXRob2QgPT0gdmFsdWUpXG5cdFx0XHRyZXR1cm47XG5cblx0XHR0aGlzLl9iYXNlTWV0aG9kLnJlbW92ZUV2ZW50TGlzdGVuZXIoU2hhZGluZ01ldGhvZEV2ZW50LlNIQURFUl9JTlZBTElEQVRFRCwgKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudCkgPT4gdGhpcy5vblNoYWRlckludmFsaWRhdGVkKGV2ZW50KSk7XG5cblx0XHR0aGlzLl9iYXNlTWV0aG9kID0gdmFsdWU7XG5cblx0XHR0aGlzLl9iYXNlTWV0aG9kLmFkZEV2ZW50TGlzdGVuZXIoU2hhZGluZ01ldGhvZEV2ZW50LlNIQURFUl9JTlZBTElEQVRFRCwgKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudCkgPT4gdGhpcy5vblNoYWRlckludmFsaWRhdGVkKGV2ZW50KSk7XG5cblx0XHR0aGlzLmlJbnZhbGlkYXRlU2hhZGVyUHJvZ3JhbSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUluaXRWTyhzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPKVxuXHR7XG5cdFx0dmFyIHRlbXBWTzpNZXRob2RWTyA9IG5ldyBNZXRob2RWTyh0aGlzLl9iYXNlTWV0aG9kKTtcblx0XHR0aGlzLl9iYXNlTWV0aG9kLmlJbml0Vk8oc2hhZGVyT2JqZWN0LCB0ZW1wVk8pO1xuXG5cdFx0bWV0aG9kVk8ubmVlZHNHbG9iYWxWZXJ0ZXhQb3MgPSB0cnVlO1xuXHRcdG1ldGhvZFZPLm5lZWRzUHJvamVjdGlvbiA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpSW5pdENvbnN0YW50cyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8pXG5cdHtcblx0XHR2YXIgZnJhZ21lbnREYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XG5cdFx0dmFyIHZlcnRleERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC52ZXJ0ZXhDb25zdGFudERhdGE7XG5cdFx0dmFyIGluZGV4Om51bWJlciA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4XSA9IDEuMDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAxXSA9IDEvMjU1LjA7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4ICsgMl0gPSAxLzY1MDI1LjA7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4ICsgM10gPSAxLzE2NTgxMzc1LjA7XG5cblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyA2XSA9IC41O1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDddID0gLS41O1xuXG5cdFx0aW5kZXggPSBtZXRob2RWTy52ZXJ0ZXhDb25zdGFudHNJbmRleDtcblx0XHR2ZXJ0ZXhEYXRhW2luZGV4XSA9IC41O1xuXHRcdHZlcnRleERhdGFbaW5kZXggKyAxXSA9IC0uNTtcblx0XHR2ZXJ0ZXhEYXRhW2luZGV4ICsgMl0gPSAwO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUNsZWFuQ29tcGlsYXRpb25EYXRhKClcblx0e1xuXHRcdHN1cGVyLmlDbGVhbkNvbXBpbGF0aW9uRGF0YSgpO1xuXHRcdHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9ucyA9IG51bGw7XG5cdFx0dGhpcy5fZGVwdGhNYXBDb29yZFZhcnlpbmdzID0gbnVsbDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlHZXRWZXJ0ZXhDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XG5cdFx0dmFyIGRhdGFSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblxuXHRcdHRoaXMuaW5pdFByb2plY3Rpb25zUmVncyhyZWdpc3RlckNhY2hlKTtcblx0XHRtZXRob2RWTy52ZXJ0ZXhDb25zdGFudHNJbmRleCA9IGRhdGFSZWcuaW5kZXgqNDtcblxuXHRcdHZhciB0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleFZlY3RvclRlbXAoKTtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXM7ICsraSkge1xuXHRcdFx0Y29kZSArPSBcIm00NCBcIiArIHRlbXAgKyBcIiwgXCIgKyBzaGFyZWRSZWdpc3RlcnMuZ2xvYmFsUG9zaXRpb25WZXJ0ZXggKyBcIiwgXCIgKyB0aGlzLl9jYXNjYWRlUHJvamVjdGlvbnNbaV0gKyBcIlxcblwiICtcblx0XHRcdFx0XCJhZGQgXCIgKyB0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3NbaV0gKyBcIiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGF0YVJlZyArIFwiLnp6d3pcXG5cIjtcblx0XHR9XG5cblx0XHRyZXR1cm4gY29kZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIHRoZSByZWdpc3RlcnMgZm9yIHRoZSBjYXNjYWRlcycgcHJvamVjdGlvbiBjb29yZGluYXRlcy5cblx0ICovXG5cdHByaXZhdGUgaW5pdFByb2plY3Rpb25zUmVncyhyZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUpXG5cdHtcblx0XHR0aGlzLl9jYXNjYWRlUHJvamVjdGlvbnMgPSBuZXcgQXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pih0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLm51bUNhc2NhZGVzKTtcblx0XHR0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3MgPSBuZXcgQXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pih0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLm51bUNhc2NhZGVzKTtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXM7ICsraSkge1xuXHRcdFx0dGhpcy5fZGVwdGhNYXBDb29yZFZhcnlpbmdzW2ldID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmFyeWluZygpO1xuXHRcdFx0dGhpcy5fY2FzY2FkZVByb2plY3Rpb25zW2ldID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRcdHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XG5cdFx0XHRyZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgdGFyZ2V0UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHZhciBudW1DYXNjYWRlczpudW1iZXIgPSB0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLm51bUNhc2NhZGVzO1xuXHRcdHZhciBkZXB0aE1hcFJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVRleHR1cmVSZWcoKTtcblx0XHR2YXIgZGVjUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cdFx0dmFyIHBsYW5lRGlzdGFuY2VSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBwbGFuZURpc3RhbmNlczpBcnJheTxzdHJpbmc+ID0gQXJyYXk8c3RyaW5nPiggcGxhbmVEaXN0YW5jZVJlZyArIFwiLnhcIiwgcGxhbmVEaXN0YW5jZVJlZyArIFwiLnlcIiwgcGxhbmVEaXN0YW5jZVJlZyArIFwiLnpcIiwgcGxhbmVEaXN0YW5jZVJlZyArIFwiLndcIiApO1xuXHRcdHZhciBjb2RlOnN0cmluZztcblxuXHRcdG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBkZWNSZWcuaW5kZXgqNDtcblx0XHRtZXRob2RWTy50ZXh0dXJlc0luZGV4ID0gZGVwdGhNYXBSZWdpc3Rlci5pbmRleDtcblxuXHRcdHZhciBpblF1YWQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMoaW5RdWFkLCAxKTtcblx0XHR2YXIgdXZDb29yZDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh1dkNvb3JkLCAxKTtcblxuXHRcdC8vIGFzc3VtZSBsb3dlc3QgcGFydGl0aW9uIGlzIHNlbGVjdGVkLCB3aWxsIGJlIG92ZXJ3cml0dGVuIGxhdGVyIG90aGVyd2lzZVxuXHRcdGNvZGUgPSBcIm1vdiBcIiArIHV2Q29vcmQgKyBcIiwgXCIgKyB0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3NbbnVtQ2FzY2FkZXMgLSAxXSArIFwiXFxuXCI7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciA9IG51bUNhc2NhZGVzIC0gMjsgaSA+PSAwOyAtLWkpIHtcblx0XHRcdHZhciB1dlByb2plY3Rpb246U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gdGhpcy5fZGVwdGhNYXBDb29yZFZhcnlpbmdzW2ldO1xuXG5cdFx0XHQvLyBjYWxjdWxhdGUgaWYgaW4gdGV4dHVyZW1hcCAocmVzdWx0ID09IDAgb3IgMSwgb25seSAxIGZvciBhIHNpbmdsZSBwYXJ0aXRpb24pXG5cdFx0XHRjb2RlICs9IFwic2x0IFwiICsgaW5RdWFkICsgXCIueiwgXCIgKyBzaGFyZWRSZWdpc3RlcnMucHJvamVjdGlvbkZyYWdtZW50ICsgXCIueiwgXCIgKyBwbGFuZURpc3RhbmNlc1tpXSArIFwiXFxuXCI7IC8vIHogPSB4ID4gbWluWCwgdyA9IHkgPiBtaW5ZXG5cblx0XHRcdHZhciB0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXG5cdFx0XHQvLyBsaW5lYXJseSBpbnRlcnBvbGF0ZSBiZXR3ZWVuIG9sZCBhbmQgbmV3IHV2IGNvb3JkcyB1c2luZyBwcmVkaWNhdGUgdmFsdWUgPT0gY29uZGl0aW9uYWwgdG9nZ2xlIHRvIG5ldyB2YWx1ZSBpZiBwcmVkaWNhdGUgPT0gMSAodHJ1ZSlcblx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyB0ZW1wICsgXCIsIFwiICsgdXZQcm9qZWN0aW9uICsgXCIsIFwiICsgdXZDb29yZCArIFwiXFxuXCIgK1xuXHRcdFx0XHRcIm11bCBcIiArIHRlbXAgKyBcIiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgaW5RdWFkICsgXCIuelxcblwiICtcblx0XHRcdFx0XCJhZGQgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdXZDb29yZCArIFwiLCBcIiArIHRlbXAgKyBcIlxcblwiO1xuXHRcdH1cblxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UoaW5RdWFkKTtcblxuXHRcdGNvZGUgKz0gXCJkaXYgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdXZDb29yZCArIFwiLCBcIiArIHV2Q29vcmQgKyBcIi53XFxuXCIgK1xuXHRcdFx0XCJtdWwgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgdXZDb29yZCArIFwiLnh5LCBcIiArIGRhdGFSZWcgKyBcIi56d1xcblwiICtcblx0XHRcdFwiYWRkIFwiICsgdXZDb29yZCArIFwiLnh5LCBcIiArIHV2Q29vcmQgKyBcIi54eSwgXCIgKyBkYXRhUmVnICsgXCIuenpcXG5cIjtcblxuXHRcdGNvZGUgKz0gdGhpcy5fYmFzZU1ldGhvZC5faUdldENhc2NhZGVGcmFnbWVudENvZGUoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgZGVjUmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCB1dkNvb3JkLCB0YXJnZXRSZWcsIHJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVycykgK1xuXHRcdFx0XCJhZGQgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgZGF0YVJlZyArIFwiLnlcXG5cIjtcblxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodXZDb29yZCk7XG5cblx0XHRyZXR1cm4gY29kZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlBY3RpdmF0ZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0c3RhZ2UuYWN0aXZhdGVUZXh0dXJlKG1ldGhvZFZPLnRleHR1cmVzSW5kZXgsIDxUZXh0dXJlMkRCYXNlPiB0aGlzLl9wQ2FzdGluZ0xpZ2h0LnNoYWRvd01hcHBlci5kZXB0aE1hcCk7XG5cblx0XHR2YXIgdmVydGV4RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LnZlcnRleENvbnN0YW50RGF0YTtcblx0XHR2YXIgdmVydGV4SW5kZXg6bnVtYmVyID0gbWV0aG9kVk8udmVydGV4Q29uc3RhbnRzSW5kZXg7XG5cblx0XHRzaGFkZXJPYmplY3QudmVydGV4Q29uc3RhbnREYXRhW21ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4ICsgM10gPSAtMS8odGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5kZXB0aCp0aGlzLl9wRXBzaWxvbik7XG5cblx0XHR2YXIgbnVtQ2FzY2FkZXM6bnVtYmVyID0gdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlcztcblx0XHR2ZXJ0ZXhJbmRleCArPSA0O1xuXHRcdGZvciAodmFyIGs6bnVtYmVyID0gMDsgayA8IG51bUNhc2NhZGVzOyArK2spIHtcblx0XHRcdHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuZ2V0RGVwdGhQcm9qZWN0aW9ucyhrKS5jb3B5UmF3RGF0YVRvKHZlcnRleERhdGEsIHZlcnRleEluZGV4LCB0cnVlKTtcblx0XHRcdHZlcnRleEluZGV4ICs9IDE2O1xuXHRcdH1cblxuXHRcdHZhciBmcmFnbWVudERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgZnJhZ21lbnRJbmRleDpudW1iZXIgPSBtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4O1xuXHRcdGZyYWdtZW50RGF0YVtmcmFnbWVudEluZGV4ICsgNV0gPSAxIC0gdGhpcy5fcEFscGhhO1xuXG5cdFx0dmFyIG5lYXJQbGFuZURpc3RhbmNlczpBcnJheTxudW1iZXI+ID0gdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5faU5lYXJQbGFuZURpc3RhbmNlcztcblxuXHRcdGZyYWdtZW50SW5kZXggKz0gODtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBudW1DYXNjYWRlczsgKytpKVxuXHRcdFx0ZnJhZ21lbnREYXRhW2ZyYWdtZW50SW5kZXggKyBpXSA9IG5lYXJQbGFuZURpc3RhbmNlc1tpXTtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QuaUFjdGl2YXRlRm9yQ2FzY2FkZShzaGFkZXJPYmplY3QsIG1ldGhvZFZPLCBzdGFnZSk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpU2V0UmVuZGVyU3RhdGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCByZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBzdGFnZTpTdGFnZSwgY2FtZXJhOkNhbWVyYSlcblx0e1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIHRoZSBzaGFkb3cgbWFwcGVycyBjYXNjYWRlIGNvbmZpZ3VyYXRpb24gY2hhbmdlcy5cblx0ICovXG5cdHByaXZhdGUgb25DYXNjYWRlQ2hhbmdlKGV2ZW50OkV2ZW50KVxuXHR7XG5cdFx0dGhpcy5pSW52YWxpZGF0ZVNoYWRlclByb2dyYW0oKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiB0aGUgYmFzZSBtZXRob2QncyBzaGFkZXIgY29kZSBpcyBpbnZhbGlkYXRlZC5cblx0ICovXG5cdHByaXZhdGUgb25TaGFkZXJJbnZhbGlkYXRlZChldmVudDpTaGFkaW5nTWV0aG9kRXZlbnQpXG5cdHtcblx0XHR0aGlzLmlJbnZhbGlkYXRlU2hhZGVyUHJvZ3JhbSgpO1xuXHR9XG59XG5cbmV4cG9ydCA9IFNoYWRvd0Nhc2NhZGVNZXRob2Q7Il19