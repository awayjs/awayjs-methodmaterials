var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Event = require("awayjs-core/lib/events/Event");
var DirectionalLight = require("awayjs-display/lib/entities/DirectionalLight");
var ShadingMethodEvent = require("awayjs-renderergl/lib/events/ShadingMethodEvent");
var MethodVO = require("awayjs-methodmaterials/lib/data/MethodVO");
var ShadowMapMethodBase = require("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");
/**
 * ShadowCascadeMethod is a shadow map method to apply cascade shadow mapping on materials.
 * Must be used with a DirectionalLight with a CascadeShadowMapper assigned to its shadowMapper property.
 *
 * @see away.lights.CascadeShadowMapper
 */
var ShadowCascadeMethod = (function (_super) {
    __extends(ShadowCascadeMethod, _super);
    /**
     * Creates a new ShadowCascadeMethod object.
     *
     * @param shadowMethodBase The shadow map sampling method used to sample individual cascades (fe: ShadowHardMethod, ShadowSoftMethod)
     */
    function ShadowCascadeMethod(shadowMethodBase) {
        var _this = this;
        _super.call(this, shadowMethodBase.castingLight);
        this._baseMethod = shadowMethodBase;
        if (!(this._pCastingLight instanceof DirectionalLight))
            throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");
        this._cascadeShadowMapper = this._pCastingLight.shadowMapper;
        if (!this._cascadeShadowMapper)
            throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");
        this._cascadeShadowMapper.addEventListener(Event.CHANGE, function (event) { return _this.onCascadeChange(event); });
        this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
    }
    Object.defineProperty(ShadowCascadeMethod.prototype, "baseMethod", {
        /**
         * The shadow map sampling method used to sample individual cascades. These are typically those used in conjunction
         * with a DirectionalShadowMapper.
         *
         * @see ShadowHardMethod
         * @see ShadowSoftMethod
         */
        get: function () {
            return this._baseMethod;
        },
        set: function (value) {
            var _this = this;
            if (this._baseMethod == value)
                return;
            this._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this._baseMethod = value;
            this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        var tempVO = new MethodVO(this._baseMethod);
        this._baseMethod.iInitVO(shaderObject, tempVO);
        methodVO.needsGlobalVertexPos = true;
        methodVO.needsProjection = true;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        var fragmentData = shaderObject.fragmentConstantData;
        var vertexData = shaderObject.vertexConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index] = 1.0;
        fragmentData[index + 1] = 1 / 255.0;
        fragmentData[index + 2] = 1 / 65025.0;
        fragmentData[index + 3] = 1 / 16581375.0;
        fragmentData[index + 6] = .5;
        fragmentData[index + 7] = -.5;
        index = methodVO.vertexConstantsIndex;
        vertexData[index] = .5;
        vertexData[index + 1] = -.5;
        vertexData[index + 2] = 0;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iCleanCompilationData = function () {
        _super.prototype.iCleanCompilationData.call(this);
        this._cascadeProjections = null;
        this._depthMapCoordVaryings = null;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetVertexCode = function (shaderObject, methodVO, registerCache, sharedRegisters) {
        var code = "";
        var dataReg = registerCache.getFreeVertexConstant();
        this.initProjectionsRegs(registerCache);
        methodVO.vertexConstantsIndex = dataReg.index * 4;
        var temp = registerCache.getFreeVertexVectorTemp();
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            code += "m44 " + temp + ", " + sharedRegisters.globalPositionVertex + ", " + this._cascadeProjections[i] + "\n" + "add " + this._depthMapCoordVaryings[i] + ", " + temp + ", " + dataReg + ".zzwz\n";
        }
        return code;
    };
    /**
     * Creates the registers for the cascades' projection coordinates.
     */
    ShadowCascadeMethod.prototype.initProjectionsRegs = function (registerCache) {
        this._cascadeProjections = new Array(this._cascadeShadowMapper.numCascades);
        this._depthMapCoordVaryings = new Array(this._cascadeShadowMapper.numCascades);
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            this._depthMapCoordVaryings[i] = registerCache.getFreeVarying();
            this._cascadeProjections[i] = registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
        }
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetFragmentCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var numCascades = this._cascadeShadowMapper.numCascades;
        var depthMapRegister = registerCache.getFreeTextureReg();
        var decReg = registerCache.getFreeFragmentConstant();
        var dataReg = registerCache.getFreeFragmentConstant();
        var planeDistanceReg = registerCache.getFreeFragmentConstant();
        var planeDistances = Array(planeDistanceReg + ".x", planeDistanceReg + ".y", planeDistanceReg + ".z", planeDistanceReg + ".w");
        var code;
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        methodVO.texturesIndex = depthMapRegister.index;
        var inQuad = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(inQuad, 1);
        var uvCoord = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(uvCoord, 1);
        // assume lowest partition is selected, will be overwritten later otherwise
        code = "mov " + uvCoord + ", " + this._depthMapCoordVaryings[numCascades - 1] + "\n";
        for (var i = numCascades - 2; i >= 0; --i) {
            var uvProjection = this._depthMapCoordVaryings[i];
            // calculate if in texturemap (result == 0 or 1, only 1 for a single partition)
            code += "slt " + inQuad + ".z, " + sharedRegisters.projectionFragment + ".z, " + planeDistances[i] + "\n"; // z = x > minX, w = y > minY
            var temp = registerCache.getFreeFragmentVectorTemp();
            // linearly interpolate between old and new uv coords using predicate value == conditional toggle to new value if predicate == 1 (true)
            code += "sub " + temp + ", " + uvProjection + ", " + uvCoord + "\n" + "mul " + temp + ", " + temp + ", " + inQuad + ".z\n" + "add " + uvCoord + ", " + uvCoord + ", " + temp + "\n";
        }
        registerCache.removeFragmentTempUsage(inQuad);
        code += "div " + uvCoord + ", " + uvCoord + ", " + uvCoord + ".w\n" + "mul " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zw\n" + "add " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zz\n";
        code += this._baseMethod._iGetCascadeFragmentCode(shaderObject, methodVO, decReg, depthMapRegister, uvCoord, targetReg, registerCache, sharedRegisters) + "add " + targetReg + ".w, " + targetReg + ".w, " + dataReg + ".y\n";
        registerCache.removeFragmentTempUsage(uvCoord);
        return code;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        stage.activateTexture(methodVO.texturesIndex, this._pCastingLight.shadowMapper.depthMap, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
        var vertexData = shaderObject.vertexConstantData;
        var vertexIndex = methodVO.vertexConstantsIndex;
        shaderObject.vertexConstantData[methodVO.vertexConstantsIndex + 3] = -1 / (this._cascadeShadowMapper.depth * this._pEpsilon);
        var numCascades = this._cascadeShadowMapper.numCascades;
        vertexIndex += 4;
        for (var k = 0; k < numCascades; ++k) {
            this._cascadeShadowMapper.getDepthProjections(k).copyRawDataTo(vertexData, vertexIndex, true);
            vertexIndex += 16;
        }
        var fragmentData = shaderObject.fragmentConstantData;
        var fragmentIndex = methodVO.fragmentConstantsIndex;
        fragmentData[fragmentIndex + 5] = 1 - this._pAlpha;
        var nearPlaneDistances = this._cascadeShadowMapper._iNearPlaneDistances;
        fragmentIndex += 8;
        for (var i = 0; i < numCascades; ++i)
            fragmentData[fragmentIndex + i] = nearPlaneDistances[i];
        this._baseMethod.iActivateForCascade(shaderObject, methodVO, stage);
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iSetRenderState = function (shaderObject, methodVO, renderable, stage, camera) {
    };
    /**
     * Called when the shadow mappers cascade configuration changes.
     */
    ShadowCascadeMethod.prototype.onCascadeChange = function (event) {
        this.iInvalidateShaderProgram();
    };
    /**
     * Called when the base method's shader code is invalidated.
     */
    ShadowCascadeMethod.prototype.onShaderInvalidated = function (event) {
        this.iInvalidateShaderProgram();
    };
    return ShadowCascadeMethod;
})(ShadowMapMethodBase);
module.exports = ShadowCascadeMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93Q2FzY2FkZU1ldGhvZC50cyJdLCJuYW1lcyI6WyJTaGFkb3dDYXNjYWRlTWV0aG9kIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5jb25zdHJ1Y3RvciIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuYmFzZU1ldGhvZCIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUluaXRWTyIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUluaXRDb25zdGFudHMiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlDbGVhbkNvbXBpbGF0aW9uRGF0YSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUdldFZlcnRleENvZGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmluaXRQcm9qZWN0aW9uc1JlZ3MiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlHZXRGcmFnbWVudENvZGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlBY3RpdmF0ZSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaVNldFJlbmRlclN0YXRlIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5vbkNhc2NhZGVDaGFuZ2UiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLm9uU2hhZGVySW52YWxpZGF0ZWQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sS0FBSyxXQUFpQiw4QkFBOEIsQ0FBQyxDQUFDO0FBSTdELElBQU8sZ0JBQWdCLFdBQWUsOENBQThDLENBQUMsQ0FBQztBQU10RixJQUFPLGtCQUFrQixXQUFjLGlEQUFpRCxDQUFDLENBQUM7QUFRMUYsSUFBTyxRQUFRLFdBQWlCLDBDQUEwQyxDQUFDLENBQUM7QUFDNUUsSUFBTyxtQkFBbUIsV0FBYyx3REFBd0QsQ0FBQyxDQUFDO0FBR2xHLEFBTUE7Ozs7O0dBREc7SUFDRyxtQkFBbUI7SUFBU0EsVUFBNUJBLG1CQUFtQkEsVUFBNEJBO0lBT3BEQTs7OztPQUlHQTtJQUNIQSxTQVpLQSxtQkFBbUJBLENBWVpBLGdCQUFpQ0E7UUFaOUNDLGlCQW1Q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QUFDQSxDQUFDQTtJQUNyRUEsQ0FBQ0E7SUFFRFQ7O09BRUdBO0lBQ0lBLDZDQUFlQSxHQUF0QkEsVUFBdUJBLFlBQTZCQSxFQUFFQSxRQUFpQkEsRUFBRUEsVUFBeUJBLEVBQUVBLEtBQVdBLEVBQUVBLE1BQWFBO0lBRTlIVSxDQUFDQTtJQUVEVjs7T0FFR0E7SUFDS0EsNkNBQWVBLEdBQXZCQSxVQUF3QkEsS0FBV0E7UUFFbENXLElBQUlBLENBQUNBLHdCQUF3QkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBRURYOztPQUVHQTtJQUNLQSxpREFBbUJBLEdBQTNCQSxVQUE0QkEsS0FBd0JBO1FBRW5EWSxJQUFJQSxDQUFDQSx3QkFBd0JBLEVBQUVBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUNGWiwwQkFBQ0E7QUFBREEsQ0FuUEEsQUFtUENBLEVBblBpQyxtQkFBbUIsRUFtUHBEO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6Im1ldGhvZHMvU2hhZG93Q2FzY2FkZU1ldGhvZC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XG5pbXBvcnQgVGV4dHVyZTJEQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZTJEQmFzZVwiKTtcblxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuaW1wb3J0IENhc2NhZGVTaGFkb3dNYXBwZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvc2hhZG93bWFwcGVycy9DYXNjYWRlU2hhZG93TWFwcGVyXCIpO1xuXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XG5pbXBvcnQgU2hhZGluZ01ldGhvZEV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvZXZlbnRzL1NoYWRpbmdNZXRob2RFdmVudFwiKTtcbmltcG9ydCBTaGFkZXJMaWdodGluZ09iamVjdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0XCIpO1xuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJIZWxwZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi91dGlscy9TaGFkZXJDb21waWxlckhlbHBlclwiKTtcblxuaW1wb3J0IE1ldGhvZFZPXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9kYXRhL01ldGhvZFZPXCIpO1xuaW1wb3J0IFNoYWRvd01hcE1ldGhvZEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93TWFwTWV0aG9kQmFzZVwiKTtcbmltcG9ydCBTaGFkb3dNZXRob2RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93TWV0aG9kQmFzZVwiKTtcblxuLyoqXG4gKiBTaGFkb3dDYXNjYWRlTWV0aG9kIGlzIGEgc2hhZG93IG1hcCBtZXRob2QgdG8gYXBwbHkgY2FzY2FkZSBzaGFkb3cgbWFwcGluZyBvbiBtYXRlcmlhbHMuXG4gKiBNdXN0IGJlIHVzZWQgd2l0aCBhIERpcmVjdGlvbmFsTGlnaHQgd2l0aCBhIENhc2NhZGVTaGFkb3dNYXBwZXIgYXNzaWduZWQgdG8gaXRzIHNoYWRvd01hcHBlciBwcm9wZXJ0eS5cbiAqXG4gKiBAc2VlIGF3YXkubGlnaHRzLkNhc2NhZGVTaGFkb3dNYXBwZXJcbiAqL1xuY2xhc3MgU2hhZG93Q2FzY2FkZU1ldGhvZCBleHRlbmRzIFNoYWRvd01hcE1ldGhvZEJhc2Vcbntcblx0cHJpdmF0ZSBfYmFzZU1ldGhvZDpTaGFkb3dNZXRob2RCYXNlO1xuXHRwcml2YXRlIF9jYXNjYWRlU2hhZG93TWFwcGVyOkNhc2NhZGVTaGFkb3dNYXBwZXI7XG5cdHByaXZhdGUgX2RlcHRoTWFwQ29vcmRWYXJ5aW5nczpBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+O1xuXHRwcml2YXRlIF9jYXNjYWRlUHJvamVjdGlvbnM6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50PjtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBTaGFkb3dDYXNjYWRlTWV0aG9kIG9iamVjdC5cblx0ICpcblx0ICogQHBhcmFtIHNoYWRvd01ldGhvZEJhc2UgVGhlIHNoYWRvdyBtYXAgc2FtcGxpbmcgbWV0aG9kIHVzZWQgdG8gc2FtcGxlIGluZGl2aWR1YWwgY2FzY2FkZXMgKGZlOiBTaGFkb3dIYXJkTWV0aG9kLCBTaGFkb3dTb2Z0TWV0aG9kKVxuXHQgKi9cblx0Y29uc3RydWN0b3Ioc2hhZG93TWV0aG9kQmFzZTpTaGFkb3dNZXRob2RCYXNlKVxuXHR7XG5cdFx0c3VwZXIoc2hhZG93TWV0aG9kQmFzZS5jYXN0aW5nTGlnaHQpO1xuXG5cdFx0dGhpcy5fYmFzZU1ldGhvZCA9IHNoYWRvd01ldGhvZEJhc2U7XG5cdFx0aWYgKCEodGhpcy5fcENhc3RpbmdMaWdodCBpbnN0YW5jZW9mIERpcmVjdGlvbmFsTGlnaHQpKVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiU2hhZG93Q2FzY2FkZU1ldGhvZCBpcyBvbmx5IGNvbXBhdGlibGUgd2l0aCBEaXJlY3Rpb25hbExpZ2h0XCIpO1xuXG5cdFx0dGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlciA9IDxDYXNjYWRlU2hhZG93TWFwcGVyPiB0aGlzLl9wQ2FzdGluZ0xpZ2h0LnNoYWRvd01hcHBlcjtcblxuXHRcdGlmICghdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlcilcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlNoYWRvd0Nhc2NhZGVNZXRob2QgcmVxdWlyZXMgYSBsaWdodCB0aGF0IGhhcyBhIENhc2NhZGVTaGFkb3dNYXBwZXIgaW5zdGFuY2UgYXNzaWduZWQgdG8gc2hhZG93TWFwcGVyLlwiKTtcblxuXHRcdHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudC5DSEFOR0UsIChldmVudDpFdmVudCkgPT4gdGhpcy5vbkNhc2NhZGVDaGFuZ2UoZXZlbnQpKTtcblx0XHR0aGlzLl9iYXNlTWV0aG9kLmFkZEV2ZW50TGlzdGVuZXIoU2hhZGluZ01ldGhvZEV2ZW50LlNIQURFUl9JTlZBTElEQVRFRCwgKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudCkgPT4gdGhpcy5vblNoYWRlckludmFsaWRhdGVkKGV2ZW50KSk7XG5cdH1cblxuXHQvKipcblx0ICogVGhlIHNoYWRvdyBtYXAgc2FtcGxpbmcgbWV0aG9kIHVzZWQgdG8gc2FtcGxlIGluZGl2aWR1YWwgY2FzY2FkZXMuIFRoZXNlIGFyZSB0eXBpY2FsbHkgdGhvc2UgdXNlZCBpbiBjb25qdW5jdGlvblxuXHQgKiB3aXRoIGEgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIuXG5cdCAqXG5cdCAqIEBzZWUgU2hhZG93SGFyZE1ldGhvZFxuXHQgKiBAc2VlIFNoYWRvd1NvZnRNZXRob2Rcblx0ICovXG5cdHB1YmxpYyBnZXQgYmFzZU1ldGhvZCgpOlNoYWRvd01ldGhvZEJhc2Vcblx0e1xuXHRcdHJldHVybiB0aGlzLl9iYXNlTWV0aG9kO1xuXHR9XG5cblx0cHVibGljIHNldCBiYXNlTWV0aG9kKHZhbHVlOlNoYWRvd01ldGhvZEJhc2UpXG5cdHtcblx0XHRpZiAodGhpcy5fYmFzZU1ldGhvZCA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QucmVtb3ZlRXZlbnRMaXN0ZW5lcihTaGFkaW5nTWV0aG9kRXZlbnQuU0hBREVSX0lOVkFMSURBVEVELCAoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KSA9PiB0aGlzLm9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQpKTtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QgPSB2YWx1ZTtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QuYWRkRXZlbnRMaXN0ZW5lcihTaGFkaW5nTWV0aG9kRXZlbnQuU0hBREVSX0lOVkFMSURBVEVELCAoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KSA9PiB0aGlzLm9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQpKTtcblxuXHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpSW5pdFZPKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8pXG5cdHtcblx0XHR2YXIgdGVtcFZPOk1ldGhvZFZPID0gbmV3IE1ldGhvZFZPKHRoaXMuX2Jhc2VNZXRob2QpO1xuXHRcdHRoaXMuX2Jhc2VNZXRob2QuaUluaXRWTyhzaGFkZXJPYmplY3QsIHRlbXBWTyk7XG5cblx0XHRtZXRob2RWTy5uZWVkc0dsb2JhbFZlcnRleFBvcyA9IHRydWU7XG5cdFx0bWV0aG9kVk8ubmVlZHNQcm9qZWN0aW9uID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlJbml0Q29uc3RhbnRzKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTylcblx0e1xuXHRcdHZhciBmcmFnbWVudERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgdmVydGV4RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LnZlcnRleENvbnN0YW50RGF0YTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXhdID0gMS4wO1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDFdID0gMS8yNTUuMDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAyXSA9IDEvNjUwMjUuMDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAzXSA9IDEvMTY1ODEzNzUuMDtcblxuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDZdID0gLjU7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4ICsgN10gPSAtLjU7XG5cblx0XHRpbmRleCA9IG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4O1xuXHRcdHZlcnRleERhdGFbaW5kZXhdID0gLjU7XG5cdFx0dmVydGV4RGF0YVtpbmRleCArIDFdID0gLS41O1xuXHRcdHZlcnRleERhdGFbaW5kZXggKyAyXSA9IDA7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpQ2xlYW5Db21waWxhdGlvbkRhdGEoKVxuXHR7XG5cdFx0c3VwZXIuaUNsZWFuQ29tcGlsYXRpb25EYXRhKCk7XG5cdFx0dGhpcy5fY2FzY2FkZVByb2plY3Rpb25zID0gbnVsbDtcblx0XHR0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3MgPSBudWxsO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUdldFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXG5cdFx0dGhpcy5pbml0UHJvamVjdGlvbnNSZWdzKHJlZ2lzdGVyQ2FjaGUpO1xuXHRcdG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4ID0gZGF0YVJlZy5pbmRleCo0O1xuXG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4VmVjdG9yVGVtcCgpO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlczsgKytpKSB7XG5cdFx0XHRjb2RlICs9IFwibTQ0IFwiICsgdGVtcCArIFwiLCBcIiArIHNoYXJlZFJlZ2lzdGVycy5nbG9iYWxQb3NpdGlvblZlcnRleCArIFwiLCBcIiArIHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9uc1tpXSArIFwiXFxuXCIgK1xuXHRcdFx0XHRcImFkZCBcIiArIHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5nc1tpXSArIFwiLCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkYXRhUmVnICsgXCIuenp3elxcblwiO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgdGhlIHJlZ2lzdGVycyBmb3IgdGhlIGNhc2NhZGVzJyBwcm9qZWN0aW9uIGNvb3JkaW5hdGVzLlxuXHQgKi9cblx0cHJpdmF0ZSBpbml0UHJvamVjdGlvbnNSZWdzKHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSlcblx0e1xuXHRcdHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9ucyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMpO1xuXHRcdHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5ncyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMpO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlczsgKytpKSB7XG5cdFx0XHR0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3NbaV0gPSByZWdpc3RlckNhY2hlLmdldEZyZWVWYXJ5aW5nKCk7XG5cdFx0XHR0aGlzLl9jYXNjYWRlUHJvamVjdGlvbnNbaV0gPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRcdHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XG5cdFx0XHRyZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlHZXRGcmFnbWVudENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIG51bUNhc2NhZGVzOm51bWJlciA9IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXM7XG5cdFx0dmFyIGRlcHRoTWFwUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xuXHRcdHZhciBkZWNSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBkYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHR2YXIgcGxhbmVEaXN0YW5jZVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cdFx0dmFyIHBsYW5lRGlzdGFuY2VzOkFycmF5PHN0cmluZz4gPSBBcnJheTxzdHJpbmc+KCBwbGFuZURpc3RhbmNlUmVnICsgXCIueFwiLCBwbGFuZURpc3RhbmNlUmVnICsgXCIueVwiLCBwbGFuZURpc3RhbmNlUmVnICsgXCIuelwiLCBwbGFuZURpc3RhbmNlUmVnICsgXCIud1wiICk7XG5cdFx0dmFyIGNvZGU6c3RyaW5nO1xuXG5cdFx0bWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleCA9IGRlY1JlZy5pbmRleCo0O1xuXHRcdG1ldGhvZFZPLnRleHR1cmVzSW5kZXggPSBkZXB0aE1hcFJlZ2lzdGVyLmluZGV4O1xuXG5cdFx0dmFyIGluUXVhZDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyhpblF1YWQsIDEpO1xuXHRcdHZhciB1dkNvb3JkOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdHJlZ2lzdGVyQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKHV2Q29vcmQsIDEpO1xuXG5cdFx0Ly8gYXNzdW1lIGxvd2VzdCBwYXJ0aXRpb24gaXMgc2VsZWN0ZWQsIHdpbGwgYmUgb3ZlcndyaXR0ZW4gbGF0ZXIgb3RoZXJ3aXNlXG5cdFx0Y29kZSA9IFwibW92IFwiICsgdXZDb29yZCArIFwiLCBcIiArIHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5nc1tudW1DYXNjYWRlcyAtIDFdICsgXCJcXG5cIjtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gbnVtQ2FzY2FkZXMgLSAyOyBpID49IDA7IC0taSkge1xuXHRcdFx0dmFyIHV2UHJvamVjdGlvbjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSB0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3NbaV07XG5cblx0XHRcdC8vIGNhbGN1bGF0ZSBpZiBpbiB0ZXh0dXJlbWFwIChyZXN1bHQgPT0gMCBvciAxLCBvbmx5IDEgZm9yIGEgc2luZ2xlIHBhcnRpdGlvbilcblx0XHRcdGNvZGUgKz0gXCJzbHQgXCIgKyBpblF1YWQgKyBcIi56LCBcIiArIHNoYXJlZFJlZ2lzdGVycy5wcm9qZWN0aW9uRnJhZ21lbnQgKyBcIi56LCBcIiArIHBsYW5lRGlzdGFuY2VzW2ldICsgXCJcXG5cIjsgLy8geiA9IHggPiBtaW5YLCB3ID0geSA+IG1pbllcblxuXHRcdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cblx0XHRcdC8vIGxpbmVhcmx5IGludGVycG9sYXRlIGJldHdlZW4gb2xkIGFuZCBuZXcgdXYgY29vcmRzIHVzaW5nIHByZWRpY2F0ZSB2YWx1ZSA9PSBjb25kaXRpb25hbCB0b2dnbGUgdG8gbmV3IHZhbHVlIGlmIHByZWRpY2F0ZSA9PSAxICh0cnVlKVxuXHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHRlbXAgKyBcIiwgXCIgKyB1dlByb2plY3Rpb24gKyBcIiwgXCIgKyB1dkNvb3JkICsgXCJcXG5cIiArXG5cdFx0XHRcdFwibXVsIFwiICsgdGVtcCArIFwiLCBcIiArIHRlbXAgKyBcIiwgXCIgKyBpblF1YWQgKyBcIi56XFxuXCIgK1xuXHRcdFx0XHRcImFkZCBcIiArIHV2Q29vcmQgKyBcIiwgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdGVtcCArIFwiXFxuXCI7XG5cdFx0fVxuXG5cdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZShpblF1YWQpO1xuXG5cdFx0Y29kZSArPSBcImRpdiBcIiArIHV2Q29vcmQgKyBcIiwgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdXZDb29yZCArIFwiLndcXG5cIiArXG5cdFx0XHRcIm11bCBcIiArIHV2Q29vcmQgKyBcIi54eSwgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgZGF0YVJlZyArIFwiLnp3XFxuXCIgK1xuXHRcdFx0XCJhZGQgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgdXZDb29yZCArIFwiLnh5LCBcIiArIGRhdGFSZWcgKyBcIi56elxcblwiO1xuXG5cdFx0Y29kZSArPSB0aGlzLl9iYXNlTWV0aG9kLl9pR2V0Q2FzY2FkZUZyYWdtZW50Q29kZShzaGFkZXJPYmplY3QsIG1ldGhvZFZPLCBkZWNSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIHV2Q29vcmQsIHRhcmdldFJlZywgcmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzKSArXG5cdFx0XHRcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyBkYXRhUmVnICsgXCIueVxcblwiO1xuXG5cdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh1dkNvb3JkKTtcblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUFjdGl2YXRlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHRzdGFnZS5hY3RpdmF0ZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCwgPFRleHR1cmUyREJhc2U+IHRoaXMuX3BDYXN0aW5nTGlnaHQuc2hhZG93TWFwcGVyLmRlcHRoTWFwLCBzaGFkZXJPYmplY3QucmVwZWF0VGV4dHVyZXMsIHNoYWRlck9iamVjdC51c2VTbW9vdGhUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZU1pcG1hcHBpbmcpO1xuXG5cdFx0dmFyIHZlcnRleERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC52ZXJ0ZXhDb25zdGFudERhdGE7XG5cdFx0dmFyIHZlcnRleEluZGV4Om51bWJlciA9IG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4O1xuXG5cdFx0c2hhZGVyT2JqZWN0LnZlcnRleENvbnN0YW50RGF0YVttZXRob2RWTy52ZXJ0ZXhDb25zdGFudHNJbmRleCArIDNdID0gLTEvKHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuZGVwdGgqdGhpcy5fcEVwc2lsb24pO1xuXG5cdFx0dmFyIG51bUNhc2NhZGVzOm51bWJlciA9IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXM7XG5cdFx0dmVydGV4SW5kZXggKz0gNDtcblx0XHRmb3IgKHZhciBrOm51bWJlciA9IDA7IGsgPCBudW1DYXNjYWRlczsgKytrKSB7XG5cdFx0XHR0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLmdldERlcHRoUHJvamVjdGlvbnMoaykuY29weVJhd0RhdGFUbyh2ZXJ0ZXhEYXRhLCB2ZXJ0ZXhJbmRleCwgdHJ1ZSk7XG5cdFx0XHR2ZXJ0ZXhJbmRleCArPSAxNjtcblx0XHR9XG5cblx0XHR2YXIgZnJhZ21lbnREYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XG5cdFx0dmFyIGZyYWdtZW50SW5kZXg6bnVtYmVyID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcblx0XHRmcmFnbWVudERhdGFbZnJhZ21lbnRJbmRleCArIDVdID0gMSAtIHRoaXMuX3BBbHBoYTtcblxuXHRcdHZhciBuZWFyUGxhbmVEaXN0YW5jZXM6QXJyYXk8bnVtYmVyPiA9IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuX2lOZWFyUGxhbmVEaXN0YW5jZXM7XG5cblx0XHRmcmFnbWVudEluZGV4ICs9IDg7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbnVtQ2FzY2FkZXM7ICsraSlcblx0XHRcdGZyYWdtZW50RGF0YVtmcmFnbWVudEluZGV4ICsgaV0gPSBuZWFyUGxhbmVEaXN0YW5jZXNbaV07XG5cblx0XHR0aGlzLl9iYXNlTWV0aG9kLmlBY3RpdmF0ZUZvckNhc2NhZGUoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgc3RhZ2UpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaVNldFJlbmRlclN0YXRlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgcmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgc3RhZ2U6U3RhZ2UsIGNhbWVyYTpDYW1lcmEpXG5cdHtcblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiB0aGUgc2hhZG93IG1hcHBlcnMgY2FzY2FkZSBjb25maWd1cmF0aW9uIGNoYW5nZXMuXG5cdCAqL1xuXHRwcml2YXRlIG9uQ2FzY2FkZUNoYW5nZShldmVudDpFdmVudClcblx0e1xuXHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gdGhlIGJhc2UgbWV0aG9kJ3Mgc2hhZGVyIGNvZGUgaXMgaW52YWxpZGF0ZWQuXG5cdCAqL1xuXHRwcml2YXRlIG9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KVxuXHR7XG5cdFx0dGhpcy5pSW52YWxpZGF0ZVNoYWRlclByb2dyYW0oKTtcblx0fVxufVxuXG5leHBvcnQgPSBTaGFkb3dDYXNjYWRlTWV0aG9kOyJdfQ==