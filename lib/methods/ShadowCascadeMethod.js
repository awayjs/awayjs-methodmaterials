var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Event = require("awayjs-core/lib/events/Event");
var DirectionalLight = require("awayjs-display/lib/entities/DirectionalLight");
var ShadingMethodEvent = require("awayjs-renderergl/lib/events/ShadingMethodEvent");
var MethodVO = require("awayjs-methodmaterials/lib/data/MethodVO");
var ShadowMapMethodBase = require("awayjs-methodmaterials/lib/methods/ShadowMapMethodBase");
/**
 * ShadowCascadeMethod is a shadow map method to apply cascade shadow mapping on materials.
 * Must be used with a DirectionalLight with a CascadeShadowMapper assigned to its shadowMapper property.
 *
 * @see away.lights.CascadeShadowMapper
 */
var ShadowCascadeMethod = (function (_super) {
    __extends(ShadowCascadeMethod, _super);
    /**
     * Creates a new ShadowCascadeMethod object.
     *
     * @param shadowMethodBase The shadow map sampling method used to sample individual cascades (fe: ShadowHardMethod, ShadowSoftMethod)
     */
    function ShadowCascadeMethod(shadowMethodBase) {
        var _this = this;
        _super.call(this, shadowMethodBase.castingLight);
        this._baseMethod = shadowMethodBase;
        if (!(this._pCastingLight instanceof DirectionalLight))
            throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");
        this._cascadeShadowMapper = this._pCastingLight.shadowMapper;
        if (!this._cascadeShadowMapper)
            throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");
        this._cascadeShadowMapper.addEventListener(Event.CHANGE, function (event) { return _this.onCascadeChange(event); });
        this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
    }
    Object.defineProperty(ShadowCascadeMethod.prototype, "baseMethod", {
        /**
         * The shadow map sampling method used to sample individual cascades. These are typically those used in conjunction
         * with a DirectionalShadowMapper.
         *
         * @see ShadowHardMethod
         * @see ShadowSoftMethod
         */
        get: function () {
            return this._baseMethod;
        },
        set: function (value) {
            var _this = this;
            if (this._baseMethod == value)
                return;
            this._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this._baseMethod = value;
            this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        var tempVO = new MethodVO(this._baseMethod);
        this._baseMethod.iInitVO(shaderObject, tempVO);
        methodVO.needsGlobalVertexPos = true;
        methodVO.needsProjection = true;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        var fragmentData = shaderObject.fragmentConstantData;
        var vertexData = shaderObject.vertexConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index] = 1.0;
        fragmentData[index + 1] = 1 / 255.0;
        fragmentData[index + 2] = 1 / 65025.0;
        fragmentData[index + 3] = 1 / 16581375.0;
        fragmentData[index + 6] = .5;
        fragmentData[index + 7] = -.5;
        index = methodVO.vertexConstantsIndex;
        vertexData[index] = .5;
        vertexData[index + 1] = -.5;
        vertexData[index + 2] = 0;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iCleanCompilationData = function () {
        _super.prototype.iCleanCompilationData.call(this);
        this._cascadeProjections = null;
        this._depthMapCoordVaryings = null;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetVertexCode = function (shaderObject, methodVO, registerCache, sharedRegisters) {
        var code = "";
        var dataReg = registerCache.getFreeVertexConstant();
        this.initProjectionsRegs(registerCache);
        methodVO.vertexConstantsIndex = dataReg.index * 4;
        var temp = registerCache.getFreeVertexVectorTemp();
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            code += "m44 " + temp + ", " + sharedRegisters.globalPositionVertex + ", " + this._cascadeProjections[i] + "\n" + "add " + this._depthMapCoordVaryings[i] + ", " + temp + ", " + dataReg + ".zzwz\n";
        }
        return code;
    };
    /**
     * Creates the registers for the cascades' projection coordinates.
     */
    ShadowCascadeMethod.prototype.initProjectionsRegs = function (registerCache) {
        this._cascadeProjections = new Array(this._cascadeShadowMapper.numCascades);
        this._depthMapCoordVaryings = new Array(this._cascadeShadowMapper.numCascades);
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            this._depthMapCoordVaryings[i] = registerCache.getFreeVarying();
            this._cascadeProjections[i] = registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
        }
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetFragmentCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var numCascades = this._cascadeShadowMapper.numCascades;
        var depthMapRegister = registerCache.getFreeTextureReg();
        var decReg = registerCache.getFreeFragmentConstant();
        var dataReg = registerCache.getFreeFragmentConstant();
        var planeDistanceReg = registerCache.getFreeFragmentConstant();
        var planeDistances = Array(planeDistanceReg + ".x", planeDistanceReg + ".y", planeDistanceReg + ".z", planeDistanceReg + ".w");
        var code;
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        methodVO.texturesIndex = depthMapRegister.index;
        var inQuad = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(inQuad, 1);
        var uvCoord = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(uvCoord, 1);
        // assume lowest partition is selected, will be overwritten later otherwise
        code = "mov " + uvCoord + ", " + this._depthMapCoordVaryings[numCascades - 1] + "\n";
        for (var i = numCascades - 2; i >= 0; --i) {
            var uvProjection = this._depthMapCoordVaryings[i];
            // calculate if in texturemap (result == 0 or 1, only 1 for a single partition)
            code += "slt " + inQuad + ".z, " + sharedRegisters.projectionFragment + ".z, " + planeDistances[i] + "\n"; // z = x > minX, w = y > minY
            var temp = registerCache.getFreeFragmentVectorTemp();
            // linearly interpolate between old and new uv coords using predicate value == conditional toggle to new value if predicate == 1 (true)
            code += "sub " + temp + ", " + uvProjection + ", " + uvCoord + "\n" + "mul " + temp + ", " + temp + ", " + inQuad + ".z\n" + "add " + uvCoord + ", " + uvCoord + ", " + temp + "\n";
        }
        registerCache.removeFragmentTempUsage(inQuad);
        code += "div " + uvCoord + ", " + uvCoord + ", " + uvCoord + ".w\n" + "mul " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zw\n" + "add " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zz\n";
        code += this._baseMethod._iGetCascadeFragmentCode(shaderObject, methodVO, decReg, depthMapRegister, uvCoord, targetReg, registerCache, sharedRegisters) + "add " + targetReg + ".w, " + targetReg + ".w, " + dataReg + ".y\n";
        registerCache.removeFragmentTempUsage(uvCoord);
        return code;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        stage.activateTexture(methodVO.texturesIndex, this._pCastingLight.shadowMapper.depthMap, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
        var vertexData = shaderObject.vertexConstantData;
        var vertexIndex = methodVO.vertexConstantsIndex;
        shaderObject.vertexConstantData[methodVO.vertexConstantsIndex + 3] = -1 / (this._cascadeShadowMapper.depth * this._pEpsilon);
        var numCascades = this._cascadeShadowMapper.numCascades;
        vertexIndex += 4;
        for (var k = 0; k < numCascades; ++k) {
            this._cascadeShadowMapper.getDepthProjections(k).copyRawDataTo(vertexData, vertexIndex, true);
            vertexIndex += 16;
        }
        var fragmentData = shaderObject.fragmentConstantData;
        var fragmentIndex = methodVO.fragmentConstantsIndex;
        fragmentData[fragmentIndex + 5] = 1 - this._pAlpha;
        var nearPlaneDistances = this._cascadeShadowMapper._iNearPlaneDistances;
        fragmentIndex += 8;
        for (var i = 0; i < numCascades; ++i)
            fragmentData[fragmentIndex + i] = nearPlaneDistances[i];
        this._baseMethod.iActivateForCascade(shaderObject, methodVO, stage);
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iSetRenderState = function (shaderObject, methodVO, renderable, stage, camera) {
    };
    /**
     * Called when the shadow mappers cascade configuration changes.
     */
    ShadowCascadeMethod.prototype.onCascadeChange = function (event) {
        this.iInvalidateShaderProgram();
    };
    /**
     * Called when the base method's shader code is invalidated.
     */
    ShadowCascadeMethod.prototype.onShaderInvalidated = function (event) {
        this.iInvalidateShaderProgram();
    };
    return ShadowCascadeMethod;
})(ShadowMapMethodBase);
module.exports = ShadowCascadeMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93Q2FzY2FkZU1ldGhvZC50cyJdLCJuYW1lcyI6WyJTaGFkb3dDYXNjYWRlTWV0aG9kIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5jb25zdHJ1Y3RvciIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuYmFzZU1ldGhvZCIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUluaXRWTyIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUluaXRDb25zdGFudHMiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlDbGVhbkNvbXBpbGF0aW9uRGF0YSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUdldFZlcnRleENvZGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmluaXRQcm9qZWN0aW9uc1JlZ3MiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlHZXRGcmFnbWVudENvZGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmlBY3RpdmF0ZSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaVNldFJlbmRlclN0YXRlIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5vbkNhc2NhZGVDaGFuZ2UiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLm9uU2hhZGVySW52YWxpZGF0ZWQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sS0FBSyxXQUFpQiw4QkFBOEIsQ0FBQyxDQUFDO0FBSTdELElBQU8sZ0JBQWdCLFdBQWUsOENBQThDLENBQUMsQ0FBQztBQU10RixJQUFPLGtCQUFrQixXQUFjLGlEQUFpRCxDQUFDLENBQUM7QUFRMUYsSUFBTyxRQUFRLFdBQWlCLDBDQUEwQyxDQUFDLENBQUM7QUFDNUUsSUFBTyxtQkFBbUIsV0FBYyx3REFBd0QsQ0FBQyxDQUFDO0FBR2xHLEFBTUE7Ozs7O0dBREc7SUFDRyxtQkFBbUI7SUFBU0EsVUFBNUJBLG1CQUFtQkEsVUFBNEJBO0lBT3BEQTs7OztPQUlHQTtJQUNIQSxTQVpLQSxtQkFBbUJBLENBWVpBLGdCQUFpQ0E7UUFaOUNDLGlCQW1Q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QUFDQSxDQUFDQTtJQUNyRUEsQ0FBQ0E7SUFFRFQ7O09BRUdBO0lBQ0lBLDZDQUFlQSxHQUF0QkEsVUFBdUJBLFlBQTZCQSxFQUFFQSxRQUFpQkEsRUFBRUEsVUFBeUJBLEVBQUVBLEtBQVdBLEVBQUVBLE1BQWFBO0lBRTlIVSxDQUFDQTtJQUVEVjs7T0FFR0E7SUFDS0EsNkNBQWVBLEdBQXZCQSxVQUF3QkEsS0FBV0E7UUFFbENXLElBQUlBLENBQUNBLHdCQUF3QkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBRURYOztPQUVHQTtJQUNLQSxpREFBbUJBLEdBQTNCQSxVQUE0QkEsS0FBd0JBO1FBRW5EWSxJQUFJQSxDQUFDQSx3QkFBd0JBLEVBQUVBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUNGWiwwQkFBQ0E7QUFBREEsQ0FuUEEsQUFtUENBLEVBblBpQyxtQkFBbUIsRUFtUHBEO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6Im1ldGhvZHMvU2hhZG93Q2FzY2FkZU1ldGhvZC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XHJcbmltcG9ydCBUZXh0dXJlMkRCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlMkRCYXNlXCIpO1xyXG5cclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XHJcbmltcG9ydCBDYXNjYWRlU2hhZG93TWFwcGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ2FzY2FkZVNoYWRvd01hcHBlclwiKTtcclxuXHJcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcblxyXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XHJcbmltcG9ydCBTaGFkaW5nTWV0aG9kRXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9ldmVudHMvU2hhZGluZ01ldGhvZEV2ZW50XCIpO1xyXG5pbXBvcnQgU2hhZGVyTGlnaHRpbmdPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ09iamVjdFwiKTtcclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRGF0YVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XHJcbmltcG9ydCBTaGFkZXJDb21waWxlckhlbHBlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3V0aWxzL1NoYWRlckNvbXBpbGVySGVscGVyXCIpO1xyXG5cclxuaW1wb3J0IE1ldGhvZFZPXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9kYXRhL01ldGhvZFZPXCIpO1xyXG5pbXBvcnQgU2hhZG93TWFwTWV0aG9kQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvbWV0aG9kcy9TaGFkb3dNYXBNZXRob2RCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZG93TWV0aG9kQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9tZXRob2RzL1NoYWRvd01ldGhvZEJhc2VcIik7XHJcblxyXG4vKipcclxuICogU2hhZG93Q2FzY2FkZU1ldGhvZCBpcyBhIHNoYWRvdyBtYXAgbWV0aG9kIHRvIGFwcGx5IGNhc2NhZGUgc2hhZG93IG1hcHBpbmcgb24gbWF0ZXJpYWxzLlxyXG4gKiBNdXN0IGJlIHVzZWQgd2l0aCBhIERpcmVjdGlvbmFsTGlnaHQgd2l0aCBhIENhc2NhZGVTaGFkb3dNYXBwZXIgYXNzaWduZWQgdG8gaXRzIHNoYWRvd01hcHBlciBwcm9wZXJ0eS5cclxuICpcclxuICogQHNlZSBhd2F5LmxpZ2h0cy5DYXNjYWRlU2hhZG93TWFwcGVyXHJcbiAqL1xyXG5jbGFzcyBTaGFkb3dDYXNjYWRlTWV0aG9kIGV4dGVuZHMgU2hhZG93TWFwTWV0aG9kQmFzZVxyXG57XHJcblx0cHJpdmF0ZSBfYmFzZU1ldGhvZDpTaGFkb3dNZXRob2RCYXNlO1xyXG5cdHByaXZhdGUgX2Nhc2NhZGVTaGFkb3dNYXBwZXI6Q2FzY2FkZVNoYWRvd01hcHBlcjtcclxuXHRwcml2YXRlIF9kZXB0aE1hcENvb3JkVmFyeWluZ3M6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50PjtcclxuXHRwcml2YXRlIF9jYXNjYWRlUHJvamVjdGlvbnM6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50PjtcclxuXHJcblx0LyoqXHJcblx0ICogQ3JlYXRlcyBhIG5ldyBTaGFkb3dDYXNjYWRlTWV0aG9kIG9iamVjdC5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBzaGFkb3dNZXRob2RCYXNlIFRoZSBzaGFkb3cgbWFwIHNhbXBsaW5nIG1ldGhvZCB1c2VkIHRvIHNhbXBsZSBpbmRpdmlkdWFsIGNhc2NhZGVzIChmZTogU2hhZG93SGFyZE1ldGhvZCwgU2hhZG93U29mdE1ldGhvZClcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihzaGFkb3dNZXRob2RCYXNlOlNoYWRvd01ldGhvZEJhc2UpXHJcblx0e1xyXG5cdFx0c3VwZXIoc2hhZG93TWV0aG9kQmFzZS5jYXN0aW5nTGlnaHQpO1xyXG5cclxuXHRcdHRoaXMuX2Jhc2VNZXRob2QgPSBzaGFkb3dNZXRob2RCYXNlO1xyXG5cdFx0aWYgKCEodGhpcy5fcENhc3RpbmdMaWdodCBpbnN0YW5jZW9mIERpcmVjdGlvbmFsTGlnaHQpKVxyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJTaGFkb3dDYXNjYWRlTWV0aG9kIGlzIG9ubHkgY29tcGF0aWJsZSB3aXRoIERpcmVjdGlvbmFsTGlnaHRcIik7XHJcblxyXG5cdFx0dGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlciA9IDxDYXNjYWRlU2hhZG93TWFwcGVyPiB0aGlzLl9wQ2FzdGluZ0xpZ2h0LnNoYWRvd01hcHBlcjtcclxuXHJcblx0XHRpZiAoIXRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlNoYWRvd0Nhc2NhZGVNZXRob2QgcmVxdWlyZXMgYSBsaWdodCB0aGF0IGhhcyBhIENhc2NhZGVTaGFkb3dNYXBwZXIgaW5zdGFuY2UgYXNzaWduZWQgdG8gc2hhZG93TWFwcGVyLlwiKTtcclxuXHJcblx0XHR0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnQuQ0hBTkdFLCAoZXZlbnQ6RXZlbnQpID0+IHRoaXMub25DYXNjYWRlQ2hhbmdlKGV2ZW50KSk7XHJcblx0XHR0aGlzLl9iYXNlTWV0aG9kLmFkZEV2ZW50TGlzdGVuZXIoU2hhZGluZ01ldGhvZEV2ZW50LlNIQURFUl9JTlZBTElEQVRFRCwgKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudCkgPT4gdGhpcy5vblNoYWRlckludmFsaWRhdGVkKGV2ZW50KSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgc2hhZG93IG1hcCBzYW1wbGluZyBtZXRob2QgdXNlZCB0byBzYW1wbGUgaW5kaXZpZHVhbCBjYXNjYWRlcy4gVGhlc2UgYXJlIHR5cGljYWxseSB0aG9zZSB1c2VkIGluIGNvbmp1bmN0aW9uXHJcblx0ICogd2l0aCBhIERpcmVjdGlvbmFsU2hhZG93TWFwcGVyLlxyXG5cdCAqXHJcblx0ICogQHNlZSBTaGFkb3dIYXJkTWV0aG9kXHJcblx0ICogQHNlZSBTaGFkb3dTb2Z0TWV0aG9kXHJcblx0ICovXHJcblx0cHVibGljIGdldCBiYXNlTWV0aG9kKCk6U2hhZG93TWV0aG9kQmFzZVxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9iYXNlTWV0aG9kO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBiYXNlTWV0aG9kKHZhbHVlOlNoYWRvd01ldGhvZEJhc2UpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2Jhc2VNZXRob2QgPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl9iYXNlTWV0aG9kLnJlbW92ZUV2ZW50TGlzdGVuZXIoU2hhZGluZ01ldGhvZEV2ZW50LlNIQURFUl9JTlZBTElEQVRFRCwgKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudCkgPT4gdGhpcy5vblNoYWRlckludmFsaWRhdGVkKGV2ZW50KSk7XHJcblxyXG5cdFx0dGhpcy5fYmFzZU1ldGhvZCA9IHZhbHVlO1xyXG5cclxuXHRcdHRoaXMuX2Jhc2VNZXRob2QuYWRkRXZlbnRMaXN0ZW5lcihTaGFkaW5nTWV0aG9kRXZlbnQuU0hBREVSX0lOVkFMSURBVEVELCAoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KSA9PiB0aGlzLm9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQpKTtcclxuXHJcblx0XHR0aGlzLmlJbnZhbGlkYXRlU2hhZGVyUHJvZ3JhbSgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgaUluaXRWTyhzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPKVxyXG5cdHtcclxuXHRcdHZhciB0ZW1wVk86TWV0aG9kVk8gPSBuZXcgTWV0aG9kVk8odGhpcy5fYmFzZU1ldGhvZCk7XHJcblx0XHR0aGlzLl9iYXNlTWV0aG9kLmlJbml0Vk8oc2hhZGVyT2JqZWN0LCB0ZW1wVk8pO1xyXG5cclxuXHRcdG1ldGhvZFZPLm5lZWRzR2xvYmFsVmVydGV4UG9zID0gdHJ1ZTtcclxuXHRcdG1ldGhvZFZPLm5lZWRzUHJvamVjdGlvbiA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpSW5pdENvbnN0YW50cyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8pXHJcblx0e1xyXG5cdFx0dmFyIGZyYWdtZW50RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LmZyYWdtZW50Q29uc3RhbnREYXRhO1xyXG5cdFx0dmFyIHZlcnRleERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC52ZXJ0ZXhDb25zdGFudERhdGE7XHJcblx0XHR2YXIgaW5kZXg6bnVtYmVyID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcclxuXHRcdGZyYWdtZW50RGF0YVtpbmRleF0gPSAxLjA7XHJcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAxXSA9IDEvMjU1LjA7XHJcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAyXSA9IDEvNjUwMjUuMDtcclxuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDNdID0gMS8xNjU4MTM3NS4wO1xyXG5cclxuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDZdID0gLjU7XHJcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyA3XSA9IC0uNTtcclxuXHJcblx0XHRpbmRleCA9IG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4O1xyXG5cdFx0dmVydGV4RGF0YVtpbmRleF0gPSAuNTtcclxuXHRcdHZlcnRleERhdGFbaW5kZXggKyAxXSA9IC0uNTtcclxuXHRcdHZlcnRleERhdGFbaW5kZXggKyAyXSA9IDA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpQ2xlYW5Db21waWxhdGlvbkRhdGEoKVxyXG5cdHtcclxuXHRcdHN1cGVyLmlDbGVhbkNvbXBpbGF0aW9uRGF0YSgpO1xyXG5cdFx0dGhpcy5fY2FzY2FkZVByb2plY3Rpb25zID0gbnVsbDtcclxuXHRcdHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5ncyA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpR2V0VmVydGV4Q29kZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHRcdHZhciBkYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XHJcblxyXG5cdFx0dGhpcy5pbml0UHJvamVjdGlvbnNSZWdzKHJlZ2lzdGVyQ2FjaGUpO1xyXG5cdFx0bWV0aG9kVk8udmVydGV4Q29uc3RhbnRzSW5kZXggPSBkYXRhUmVnLmluZGV4KjQ7XHJcblxyXG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4VmVjdG9yVGVtcCgpO1xyXG5cclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXM7ICsraSkge1xyXG5cdFx0XHRjb2RlICs9IFwibTQ0IFwiICsgdGVtcCArIFwiLCBcIiArIHNoYXJlZFJlZ2lzdGVycy5nbG9iYWxQb3NpdGlvblZlcnRleCArIFwiLCBcIiArIHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9uc1tpXSArIFwiXFxuXCIgK1xyXG5cdFx0XHRcdFwiYWRkIFwiICsgdGhpcy5fZGVwdGhNYXBDb29yZFZhcnlpbmdzW2ldICsgXCIsIFwiICsgdGVtcCArIFwiLCBcIiArIGRhdGFSZWcgKyBcIi56end6XFxuXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIHRoZSByZWdpc3RlcnMgZm9yIHRoZSBjYXNjYWRlcycgcHJvamVjdGlvbiBjb29yZGluYXRlcy5cclxuXHQgKi9cclxuXHRwcml2YXRlIGluaXRQcm9qZWN0aW9uc1JlZ3MocmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlKVxyXG5cdHtcclxuXHRcdHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9ucyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMpO1xyXG5cdFx0dGhpcy5fZGVwdGhNYXBDb29yZFZhcnlpbmdzID0gbmV3IEFycmF5PFNoYWRlclJlZ2lzdGVyRWxlbWVudD4odGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlcyk7XHJcblxyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlczsgKytpKSB7XHJcblx0XHRcdHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5nc1tpXSA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZhcnlpbmcoKTtcclxuXHRcdFx0dGhpcy5fY2FzY2FkZVByb2plY3Rpb25zW2ldID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlHZXRGcmFnbWVudENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xyXG5cdHtcclxuXHRcdHZhciBudW1DYXNjYWRlczpudW1iZXIgPSB0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLm51bUNhc2NhZGVzO1xyXG5cdFx0dmFyIGRlcHRoTWFwUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xyXG5cdFx0dmFyIGRlY1JlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XHJcblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XHJcblx0XHR2YXIgcGxhbmVEaXN0YW5jZVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XHJcblx0XHR2YXIgcGxhbmVEaXN0YW5jZXM6QXJyYXk8c3RyaW5nPiA9IEFycmF5PHN0cmluZz4oIHBsYW5lRGlzdGFuY2VSZWcgKyBcIi54XCIsIHBsYW5lRGlzdGFuY2VSZWcgKyBcIi55XCIsIHBsYW5lRGlzdGFuY2VSZWcgKyBcIi56XCIsIHBsYW5lRGlzdGFuY2VSZWcgKyBcIi53XCIgKTtcclxuXHRcdHZhciBjb2RlOnN0cmluZztcclxuXHJcblx0XHRtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4ID0gZGVjUmVnLmluZGV4KjQ7XHJcblx0XHRtZXRob2RWTy50ZXh0dXJlc0luZGV4ID0gZGVwdGhNYXBSZWdpc3Rlci5pbmRleDtcclxuXHJcblx0XHR2YXIgaW5RdWFkOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMoaW5RdWFkLCAxKTtcclxuXHRcdHZhciB1dkNvb3JkOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModXZDb29yZCwgMSk7XHJcblxyXG5cdFx0Ly8gYXNzdW1lIGxvd2VzdCBwYXJ0aXRpb24gaXMgc2VsZWN0ZWQsIHdpbGwgYmUgb3ZlcndyaXR0ZW4gbGF0ZXIgb3RoZXJ3aXNlXHJcblx0XHRjb2RlID0gXCJtb3YgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdGhpcy5fZGVwdGhNYXBDb29yZFZhcnlpbmdzW251bUNhc2NhZGVzIC0gMV0gKyBcIlxcblwiO1xyXG5cclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gbnVtQ2FzY2FkZXMgLSAyOyBpID49IDA7IC0taSkge1xyXG5cdFx0XHR2YXIgdXZQcm9qZWN0aW9uOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5nc1tpXTtcclxuXHJcblx0XHRcdC8vIGNhbGN1bGF0ZSBpZiBpbiB0ZXh0dXJlbWFwIChyZXN1bHQgPT0gMCBvciAxLCBvbmx5IDEgZm9yIGEgc2luZ2xlIHBhcnRpdGlvbilcclxuXHRcdFx0Y29kZSArPSBcInNsdCBcIiArIGluUXVhZCArIFwiLnosIFwiICsgc2hhcmVkUmVnaXN0ZXJzLnByb2plY3Rpb25GcmFnbWVudCArIFwiLnosIFwiICsgcGxhbmVEaXN0YW5jZXNbaV0gKyBcIlxcblwiOyAvLyB6ID0geCA+IG1pblgsIHcgPSB5ID4gbWluWVxyXG5cclxuXHRcdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XHJcblxyXG5cdFx0XHQvLyBsaW5lYXJseSBpbnRlcnBvbGF0ZSBiZXR3ZWVuIG9sZCBhbmQgbmV3IHV2IGNvb3JkcyB1c2luZyBwcmVkaWNhdGUgdmFsdWUgPT0gY29uZGl0aW9uYWwgdG9nZ2xlIHRvIG5ldyB2YWx1ZSBpZiBwcmVkaWNhdGUgPT0gMSAodHJ1ZSlcclxuXHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHRlbXAgKyBcIiwgXCIgKyB1dlByb2plY3Rpb24gKyBcIiwgXCIgKyB1dkNvb3JkICsgXCJcXG5cIiArXHJcblx0XHRcdFx0XCJtdWwgXCIgKyB0ZW1wICsgXCIsIFwiICsgdGVtcCArIFwiLCBcIiArIGluUXVhZCArIFwiLnpcXG5cIiArXHJcblx0XHRcdFx0XCJhZGQgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdXZDb29yZCArIFwiLCBcIiArIHRlbXAgKyBcIlxcblwiO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UoaW5RdWFkKTtcclxuXHJcblx0XHRjb2RlICs9IFwiZGl2IFwiICsgdXZDb29yZCArIFwiLCBcIiArIHV2Q29vcmQgKyBcIiwgXCIgKyB1dkNvb3JkICsgXCIud1xcblwiICtcclxuXHRcdFx0XCJtdWwgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgdXZDb29yZCArIFwiLnh5LCBcIiArIGRhdGFSZWcgKyBcIi56d1xcblwiICtcclxuXHRcdFx0XCJhZGQgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgdXZDb29yZCArIFwiLnh5LCBcIiArIGRhdGFSZWcgKyBcIi56elxcblwiO1xyXG5cclxuXHRcdGNvZGUgKz0gdGhpcy5fYmFzZU1ldGhvZC5faUdldENhc2NhZGVGcmFnbWVudENvZGUoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgZGVjUmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCB1dkNvb3JkLCB0YXJnZXRSZWcsIHJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVycykgK1xyXG5cdFx0XHRcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyBkYXRhUmVnICsgXCIueVxcblwiO1xyXG5cclxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodXZDb29yZCk7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpQWN0aXZhdGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCBzdGFnZTpTdGFnZSlcclxuXHR7XHJcblx0XHRzdGFnZS5hY3RpdmF0ZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCwgPFRleHR1cmUyREJhc2U+IHRoaXMuX3BDYXN0aW5nTGlnaHQuc2hhZG93TWFwcGVyLmRlcHRoTWFwLCBzaGFkZXJPYmplY3QucmVwZWF0VGV4dHVyZXMsIHNoYWRlck9iamVjdC51c2VTbW9vdGhUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZU1pcG1hcHBpbmcpO1xyXG5cclxuXHRcdHZhciB2ZXJ0ZXhEYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QudmVydGV4Q29uc3RhbnREYXRhO1xyXG5cdFx0dmFyIHZlcnRleEluZGV4Om51bWJlciA9IG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4O1xyXG5cclxuXHRcdHNoYWRlck9iamVjdC52ZXJ0ZXhDb25zdGFudERhdGFbbWV0aG9kVk8udmVydGV4Q29uc3RhbnRzSW5kZXggKyAzXSA9IC0xLyh0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLmRlcHRoKnRoaXMuX3BFcHNpbG9uKTtcclxuXHJcblx0XHR2YXIgbnVtQ2FzY2FkZXM6bnVtYmVyID0gdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlcztcclxuXHRcdHZlcnRleEluZGV4ICs9IDQ7XHJcblx0XHRmb3IgKHZhciBrOm51bWJlciA9IDA7IGsgPCBudW1DYXNjYWRlczsgKytrKSB7XHJcblx0XHRcdHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuZ2V0RGVwdGhQcm9qZWN0aW9ucyhrKS5jb3B5UmF3RGF0YVRvKHZlcnRleERhdGEsIHZlcnRleEluZGV4LCB0cnVlKTtcclxuXHRcdFx0dmVydGV4SW5kZXggKz0gMTY7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGZyYWdtZW50RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LmZyYWdtZW50Q29uc3RhbnREYXRhO1xyXG5cdFx0dmFyIGZyYWdtZW50SW5kZXg6bnVtYmVyID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcclxuXHRcdGZyYWdtZW50RGF0YVtmcmFnbWVudEluZGV4ICsgNV0gPSAxIC0gdGhpcy5fcEFscGhhO1xyXG5cclxuXHRcdHZhciBuZWFyUGxhbmVEaXN0YW5jZXM6QXJyYXk8bnVtYmVyPiA9IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuX2lOZWFyUGxhbmVEaXN0YW5jZXM7XHJcblxyXG5cdFx0ZnJhZ21lbnRJbmRleCArPSA4O1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbnVtQ2FzY2FkZXM7ICsraSlcclxuXHRcdFx0ZnJhZ21lbnREYXRhW2ZyYWdtZW50SW5kZXggKyBpXSA9IG5lYXJQbGFuZURpc3RhbmNlc1tpXTtcclxuXHJcblx0XHR0aGlzLl9iYXNlTWV0aG9kLmlBY3RpdmF0ZUZvckNhc2NhZGUoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgc3RhZ2UpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgaVNldFJlbmRlclN0YXRlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgcmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgc3RhZ2U6U3RhZ2UsIGNhbWVyYTpDYW1lcmEpXHJcblx0e1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2FsbGVkIHdoZW4gdGhlIHNoYWRvdyBtYXBwZXJzIGNhc2NhZGUgY29uZmlndXJhdGlvbiBjaGFuZ2VzLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgb25DYXNjYWRlQ2hhbmdlKGV2ZW50OkV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBDYWxsZWQgd2hlbiB0aGUgYmFzZSBtZXRob2QncyBzaGFkZXIgY29kZSBpcyBpbnZhbGlkYXRlZC5cclxuXHQgKi9cclxuXHRwcml2YXRlIG9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KVxyXG5cdHtcclxuXHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBTaGFkb3dDYXNjYWRlTWV0aG9kOyJdfQ==