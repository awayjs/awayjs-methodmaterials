var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShadowMethodBase = require("awayjs-methodmaterials/lib/methods/ShadowMethodBase");
/**
 * ShadowFilteredMethod provides a softened shadowing technique by bilinearly interpolating shadow comparison
 * results of neighbouring pixels.
 */
var ShadowFilteredMethod = (function (_super) {
    __extends(ShadowFilteredMethod, _super);
    /**
     * Creates a new DiffuseBasicMethod object.
     *
     * @param castingLight The light casting the shadow
     */
    function ShadowFilteredMethod(castingLight) {
        _super.call(this, castingLight);
    }
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        _super.prototype.iInitConstants.call(this, shaderObject, methodVO);
        var fragmentData = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index + 8] = .5;
        var size = this.castingLight.shadowMapper.depthMapSize;
        fragmentData[index + 9] = size;
        fragmentData[index + 10] = 1 / size;
    };
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype._pGetPlanarFragmentCode = function (methodVO, targetReg, regCache, sharedRegisters) {
        var depthMapRegister = regCache.getFreeTextureReg();
        var decReg = regCache.getFreeFragmentConstant();
        var dataReg = regCache.getFreeFragmentConstant();
        // TODO: not used
        dataReg = dataReg;
        var customDataReg = regCache.getFreeFragmentConstant();
        var depthCol = regCache.getFreeFragmentVectorTemp();
        var uvReg;
        var code = "";
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        regCache.addFragmentTempUsages(depthCol, 1);
        uvReg = regCache.getFreeFragmentVectorTemp();
        regCache.addFragmentTempUsages(uvReg, 1);
        code += "mov " + uvReg + ", " + this._pDepthMapCoordReg + "\n" + "tex " + depthCol + ", " + this._pDepthMapCoordReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".z, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "add " + uvReg + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".z\n" + "tex " + depthCol + ", " + uvReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".w, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "mul " + depthCol + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".y\n" + "frc " + depthCol + ".x, " + depthCol + ".x\n" + "sub " + uvReg + ".w, " + uvReg + ".w, " + uvReg + ".z\n" + "mul " + uvReg + ".w, " + uvReg + ".w, " + depthCol + ".x\n" + "add " + targetReg + ".w, " + uvReg + ".z, " + uvReg + ".w\n" + "mov " + uvReg + ".x, " + this._pDepthMapCoordReg + ".x\n" + "add " + uvReg + ".y, " + this._pDepthMapCoordReg + ".y, " + customDataReg + ".z\n" + "tex " + depthCol + ", " + uvReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".z, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "add " + uvReg + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".z\n" + "tex " + depthCol + ", " + uvReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".w, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "mul " + depthCol + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".y\n" + "frc " + depthCol + ".x, " + depthCol + ".x\n" + "sub " + uvReg + ".w, " + uvReg + ".w, " + uvReg + ".z\n" + "mul " + uvReg + ".w, " + uvReg + ".w, " + depthCol + ".x\n" + "add " + uvReg + ".w, " + uvReg + ".z, " + uvReg + ".w\n" + "mul " + depthCol + ".x, " + this._pDepthMapCoordReg + ".y, " + customDataReg + ".y\n" + "frc " + depthCol + ".x, " + depthCol + ".x\n" + "sub " + uvReg + ".w, " + uvReg + ".w, " + targetReg + ".w\n" + "mul " + uvReg + ".w, " + uvReg + ".w, " + depthCol + ".x\n" + "add " + targetReg + ".w, " + targetReg + ".w, " + uvReg + ".w\n";
        regCache.removeFragmentTempUsage(depthCol);
        regCache.removeFragmentTempUsage(uvReg);
        methodVO.texturesIndex = depthMapRegister.index;
        return code;
    };
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype.iActivateForCascade = function (shaderObject, methodVO, stage) {
        var size = this.castingLight.shadowMapper.depthMapSize;
        var index = methodVO.secondaryFragmentConstantsIndex;
        var data = shaderObject.fragmentConstantData;
        data[index] = size;
        data[index + 1] = 1 / size;
    };
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype._iGetCascadeFragmentCode = function (shaderObject, methodVO, decodeRegister, depthTexture, depthProjection, targetRegister, registerCache, sharedRegisters) {
        var code;
        var dataReg = registerCache.getFreeFragmentConstant();
        methodVO.secondaryFragmentConstantsIndex = dataReg.index * 4;
        var temp = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(temp, 1);
        var predicate = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(predicate, 1);
        code = "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".x, " + depthProjection + ".z, " + temp + ".z\n" + "add " + depthProjection + ".x, " + depthProjection + ".x, " + dataReg + ".y\n" + "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".z, " + depthProjection + ".z, " + temp + ".z\n" + "add " + depthProjection + ".y, " + depthProjection + ".y, " + dataReg + ".y\n" + "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".w, " + depthProjection + ".z, " + temp + ".z\n" + "sub " + depthProjection + ".x, " + depthProjection + ".x, " + dataReg + ".y\n" + "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".y, " + depthProjection + ".z, " + temp + ".z\n" + "mul " + temp + ".xy, " + depthProjection + ".xy, " + dataReg + ".x\n" + "frc " + temp + ".xy, " + temp + ".xy\n" + "sub " + depthProjection + ", " + predicate + ".xyzw, " + predicate + ".zwxy\n" + "mul " + depthProjection + ", " + depthProjection + ", " + temp + ".x\n" + "add " + predicate + ".xy, " + predicate + ".xy, " + depthProjection + ".zw\n" + "sub " + predicate + ".y, " + predicate + ".y, " + predicate + ".x\n" + "mul " + predicate + ".y, " + predicate + ".y, " + temp + ".y\n" + "add " + targetRegister + ".w, " + predicate + ".x, " + predicate + ".y\n";
        registerCache.removeFragmentTempUsage(temp);
        registerCache.removeFragmentTempUsage(predicate);
        return code;
    };
    return ShadowFilteredMethod;
})(ShadowMethodBase);
module.exports = ShadowFilteredMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93RmlsdGVyZWRNZXRob2QudHMiXSwibmFtZXMiOlsiU2hhZG93RmlsdGVyZWRNZXRob2QiLCJTaGFkb3dGaWx0ZXJlZE1ldGhvZC5jb25zdHJ1Y3RvciIsIlNoYWRvd0ZpbHRlcmVkTWV0aG9kLmlJbml0Q29uc3RhbnRzIiwiU2hhZG93RmlsdGVyZWRNZXRob2QuX3BHZXRQbGFuYXJGcmFnbWVudENvZGUiLCJTaGFkb3dGaWx0ZXJlZE1ldGhvZC5pQWN0aXZhdGVGb3JDYXNjYWRlIiwiU2hhZG93RmlsdGVyZWRNZXRob2QuX2lHZXRDYXNjYWRlRnJhZ21lbnRDb2RlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFXQSxJQUFPLGdCQUFnQixXQUFlLHFEQUFxRCxDQUFDLENBQUM7QUFFN0YsQUFJQTs7O0dBREc7SUFDRyxvQkFBb0I7SUFBU0EsVUFBN0JBLG9CQUFvQkEsVUFBeUJBO0lBRWxEQTs7OztPQUlHQTtJQUNIQSxTQVBLQSxvQkFBb0JBLENBT2JBLFlBQTZCQTtRQUV4Q0Msa0JBQU1BLFlBQVlBLENBQUNBLENBQUNBO0lBQ3JCQSxDQUFDQTtJQUVERDs7T0FFR0E7SUFDSUEsNkNBQWNBLEdBQXJCQSxVQUFzQkEsWUFBaUNBLEVBQUVBLFFBQWlCQTtRQUV6RUUsZ0JBQUtBLENBQUNBLGNBQWNBLFlBQUNBLFlBQVlBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1FBRTdDQSxJQUFJQSxZQUFZQSxHQUFpQkEsWUFBWUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQTtRQUNuRUEsSUFBSUEsS0FBS0EsR0FBa0JBLFFBQVFBLENBQUNBLHNCQUFzQkEsQ0FBQ0E7UUFDM0RBLFlBQVlBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzdCQSxJQUFJQSxJQUFJQSxHQUFrQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDdEVBLFlBQVlBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQy9CQSxZQUFZQSxDQUFDQSxLQUFLQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQTtJQUNuQ0EsQ0FBQ0E7SUFFREY7O09BRUdBO0lBQ0lBLHNEQUF1QkEsR0FBOUJBLFVBQStCQSxRQUFpQkEsRUFBRUEsU0FBK0JBLEVBQUVBLFFBQTRCQSxFQUFFQSxlQUFrQ0E7UUFFbEpHLElBQUlBLGdCQUFnQkEsR0FBeUJBLFFBQVFBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7UUFDMUVBLElBQUlBLE1BQU1BLEdBQXlCQSxRQUFRQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1FBQ3RFQSxJQUFJQSxPQUFPQSxHQUF5QkEsUUFBUUEsQ0FBQ0EsdUJBQXVCQSxFQUFFQSxDQUFDQTtRQUN2RUEsQUFDQUEsaUJBRGlCQTtRQUNqQkEsT0FBT0EsR0FBR0EsT0FBT0EsQ0FBQ0E7UUFDbEJBLElBQUlBLGFBQWFBLEdBQXlCQSxRQUFRQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1FBQzdFQSxJQUFJQSxRQUFRQSxHQUF5QkEsUUFBUUEsQ0FBQ0EseUJBQXlCQSxFQUFFQSxDQUFDQTtRQUMxRUEsSUFBSUEsS0FBMkJBLENBQUNBO1FBQ2hDQSxJQUFJQSxJQUFJQSxHQUFVQSxFQUFFQSxDQUFDQTtRQUNyQkEsUUFBUUEsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFDQSxDQUFDQSxDQUFDQTtRQUVqREEsUUFBUUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1Q0EsS0FBS0EsR0FBR0EsUUFBUUEsQ0FBQ0EseUJBQXlCQSxFQUFFQSxDQUFDQTtRQUM3Q0EsUUFBUUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV6Q0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxJQUFJQSxHQUU3REEsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxJQUFJQSxHQUFHQSxnQkFBZ0JBLEdBQUdBLHlCQUF5QkEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUV4UEEsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxhQUFhQSxHQUFHQSxNQUFNQSxHQUNuRkEsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsZ0JBQWdCQSxHQUFHQSx5QkFBeUJBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FFdE9BLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsYUFBYUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FFbFVBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxhQUFhQSxHQUFHQSxNQUFNQSxHQUNoSkEsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsZ0JBQWdCQSxHQUFHQSx5QkFBeUJBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FFdE9BLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsYUFBYUEsR0FBR0EsTUFBTUEsR0FDbkZBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLElBQUlBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLEdBQUdBLGdCQUFnQkEsR0FBR0EseUJBQXlCQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBR3RPQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE1BQU1BLEdBQUdBLGFBQWFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBRTlUQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE1BQU1BLEdBQUdBLGFBQWFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLE1B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R0EsTUFBTUEsR0FFbFRBLE1BQU1BLEdBQUdBLGVBQWVBLEdBQUdBLE1BQU1BLEdBQUdBLGVBQWVBLEdBQUdBLE1BQU1BLEdBQUdBLE9BQU9BLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLGVBQWVBLEdBQUdBLElBQUlBLEdBQUdBLFlBQVlBLEdBQUdBLHlCQUF5QkEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsY0FBY0EsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FFbFRBLE1BQU1BLEdBQUdBLGVBQWVBLEdBQUdBLE1BQU1BLEdBQUdBLGVBQWVBLEdBQUdBLE1BQU1BLEdBQUdBLE9BQU9BLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLGVBQWVBLEdBQUdBLElBQUlBLEdBQUdBLFlBQVlBLEdBQUdBLHlCQUF5QkEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsY0FBY0EsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FFbFRBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLE9BQU9BLEdBQUdBLGVBQWVBLEdBQUdBLE9BQU9BLEdBQUdBLE9BQU9BLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLE9BQU9BLEdBQUdBLElBQUlBLEdBQUdBLE9BQU9BLEdBR2pIQSxNQUFNQSxHQUFHQSxlQUFlQSxHQUFHQSxJQUFJQSxHQUFHQSxTQUFTQSxHQUFHQSxTQUFTQSxHQUFHQSxTQUFTQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxlQUFlQSxHQUFHQSxJQUFJQSxHQUFHQSxlQUFlQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUUxSkEsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsT0FBT0EsR0FBR0EsU0FBU0EsR0FBR0EsT0FBT0EsR0FBR0EsZUFBZUEsR0FBR0EsT0FBT0EsR0FFOUVBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLGNBQWNBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLENBQUNBO1FBRXZOQSxhQUFhQSxDQUFDQSx1QkFBdUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzVDQSxhQUFhQSxDQUFDQSx1QkFBdUJBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO1FBQ2pEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNiQSxDQUFDQTtJQUNGTCwyQkFBQ0E7QUFBREEsQ0ExSEEsQUEwSENBLEVBMUhrQyxnQkFBZ0IsRUEwSGxEO0FBRUQsQUFBOEIsaUJBQXJCLG9CQUFvQixDQUFDIiwiZmlsZSI6Im1ldGhvZHMvU2hhZG93RmlsdGVyZWRNZXRob2QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5cbmltcG9ydCBTaGFkZXJMaWdodGluZ09iamVjdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0XCIpO1xuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XG5cbmltcG9ydCBNZXRob2RWT1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvZGF0YS9NZXRob2RWT1wiKTtcbmltcG9ydCBTaGFkb3dNZXRob2RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93TWV0aG9kQmFzZVwiKTtcblxuLyoqXG4gKiBTaGFkb3dGaWx0ZXJlZE1ldGhvZCBwcm92aWRlcyBhIHNvZnRlbmVkIHNoYWRvd2luZyB0ZWNobmlxdWUgYnkgYmlsaW5lYXJseSBpbnRlcnBvbGF0aW5nIHNoYWRvdyBjb21wYXJpc29uXG4gKiByZXN1bHRzIG9mIG5laWdoYm91cmluZyBwaXhlbHMuXG4gKi9cbmNsYXNzIFNoYWRvd0ZpbHRlcmVkTWV0aG9kIGV4dGVuZHMgU2hhZG93TWV0aG9kQmFzZVxue1xuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBEaWZmdXNlQmFzaWNNZXRob2Qgb2JqZWN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gY2FzdGluZ0xpZ2h0IFRoZSBsaWdodCBjYXN0aW5nIHRoZSBzaGFkb3dcblx0ICovXG5cdGNvbnN0cnVjdG9yKGNhc3RpbmdMaWdodDpEaXJlY3Rpb25hbExpZ2h0KVxuXHR7XG5cdFx0c3VwZXIoY2FzdGluZ0xpZ2h0KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlJbml0Q29uc3RhbnRzKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8pXG5cdHtcblx0XHRzdXBlci5pSW5pdENvbnN0YW50cyhzaGFkZXJPYmplY3QsIG1ldGhvZFZPKTtcblxuXHRcdHZhciBmcmFnbWVudERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qaW50Ki8gPSBtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4O1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDhdID0gLjU7XG5cdFx0dmFyIHNpemU6bnVtYmVyIC8qaW50Ki8gPSB0aGlzLmNhc3RpbmdMaWdodC5zaGFkb3dNYXBwZXIuZGVwdGhNYXBTaXplO1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDldID0gc2l6ZTtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAxMF0gPSAxL3NpemU7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfcEdldFBsYW5hckZyYWdtZW50Q29kZShtZXRob2RWTzpNZXRob2RWTywgdGFyZ2V0UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXG5cdHtcblx0XHR2YXIgZGVwdGhNYXBSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xuXHRcdHZhciBkZWNSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdC8vIFRPRE86IG5vdCB1c2VkXG5cdFx0ZGF0YVJlZyA9IGRhdGFSZWc7XG5cdFx0dmFyIGN1c3RvbURhdGFSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHR2YXIgZGVwdGhDb2w6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdHZhciB1dlJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHRtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4ID0gZGVjUmVnLmluZGV4KjQ7XG5cblx0XHRyZWdDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMoZGVwdGhDb2wsIDEpO1xuXG5cdFx0dXZSZWcgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0cmVnQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKHV2UmVnLCAxKTtcblxuXHRcdGNvZGUgKz0gXCJtb3YgXCIgKyB1dlJlZyArIFwiLCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCJcXG5cIiArXG5cblx0XHRcdFwidGV4IFwiICsgZGVwdGhDb2wgKyBcIiwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLCBcIiArIGRlcHRoTWFwUmVnaXN0ZXIgKyBcIiA8MmQsIG5lYXJlc3QsIGNsYW1wPlxcblwiICsgXCJkcDQgXCIgKyBkZXB0aENvbCArIFwiLnosIFwiICsgZGVwdGhDb2wgKyBcIiwgXCIgKyBkZWNSZWcgKyBcIlxcblwiICsgXCJzbHQgXCIgKyB1dlJlZyArIFwiLnosIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi56LCBcIiArIGRlcHRoQ29sICsgXCIuelxcblwiICsgICAvLyAwIGlmIGluIHNoYWRvd1xuXG5cdFx0XHRcImFkZCBcIiArIHV2UmVnICsgXCIueCwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLngsIFwiICsgY3VzdG9tRGF0YVJlZyArIFwiLnpcXG5cIiArIFx0Ly8gKDEsIDApXG5cdFx0XHRcInRleCBcIiArIGRlcHRoQ29sICsgXCIsIFwiICsgdXZSZWcgKyBcIiwgXCIgKyBkZXB0aE1hcFJlZ2lzdGVyICsgXCIgPDJkLCBuZWFyZXN0LCBjbGFtcD5cXG5cIiArIFwiZHA0IFwiICsgZGVwdGhDb2wgKyBcIi56LCBcIiArIGRlcHRoQ29sICsgXCIsIFwiICsgZGVjUmVnICsgXCJcXG5cIiArIFwic2x0IFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueiwgXCIgKyBkZXB0aENvbCArIFwiLnpcXG5cIiArICAgLy8gMCBpZiBpbiBzaGFkb3dcblxuXHRcdFx0XCJtdWwgXCIgKyBkZXB0aENvbCArIFwiLngsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi54LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi55XFxuXCIgKyBcImZyYyBcIiArIGRlcHRoQ29sICsgXCIueCwgXCIgKyBkZXB0aENvbCArIFwiLnhcXG5cIiArIFwic3ViIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLnpcXG5cIiArIFwibXVsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIudywgXCIgKyBkZXB0aENvbCArIFwiLnhcXG5cIiArIFwiYWRkIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLnosIFwiICsgdXZSZWcgKyBcIi53XFxuXCIgK1xuXG5cdFx0XHRcIm1vdiBcIiArIHV2UmVnICsgXCIueCwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLnhcXG5cIiArIFwiYWRkIFwiICsgdXZSZWcgKyBcIi55LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueSwgXCIgKyBjdXN0b21EYXRhUmVnICsgXCIuelxcblwiICtcdC8vICgwLCAxKVxuXHRcdFx0XCJ0ZXggXCIgKyBkZXB0aENvbCArIFwiLCBcIiArIHV2UmVnICsgXCIsIFwiICsgZGVwdGhNYXBSZWdpc3RlciArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIGRlcHRoQ29sICsgXCIueiwgXCIgKyBkZXB0aENvbCArIFwiLCBcIiArIGRlY1JlZyArIFwiXFxuXCIgKyBcInNsdCBcIiArIHV2UmVnICsgXCIueiwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLnosIFwiICsgZGVwdGhDb2wgKyBcIi56XFxuXCIgKyAgIC8vIDAgaWYgaW4gc2hhZG93XG5cblx0XHRcdFwiYWRkIFwiICsgdXZSZWcgKyBcIi54LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueCwgXCIgKyBjdXN0b21EYXRhUmVnICsgXCIuelxcblwiICtcdC8vICgxLCAxKVxuXHRcdFx0XCJ0ZXggXCIgKyBkZXB0aENvbCArIFwiLCBcIiArIHV2UmVnICsgXCIsIFwiICsgZGVwdGhNYXBSZWdpc3RlciArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIGRlcHRoQ29sICsgXCIueiwgXCIgKyBkZXB0aENvbCArIFwiLCBcIiArIGRlY1JlZyArIFwiXFxuXCIgKyBcInNsdCBcIiArIHV2UmVnICsgXCIudywgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLnosIFwiICsgZGVwdGhDb2wgKyBcIi56XFxuXCIgKyAgIC8vIDAgaWYgaW4gc2hhZG93XG5cblx0XHRcdC8vIHJlY2FsY3VsYXRlIGZyYWN0aW9uLCBzaW5jZSB3ZSByYW4gb3V0IG9mIHJlZ2lzdGVycyA6KFxuXHRcdFx0XCJtdWwgXCIgKyBkZXB0aENvbCArIFwiLngsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi54LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi55XFxuXCIgKyBcImZyYyBcIiArIGRlcHRoQ29sICsgXCIueCwgXCIgKyBkZXB0aENvbCArIFwiLnhcXG5cIiArIFwic3ViIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLnpcXG5cIiArIFwibXVsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIudywgXCIgKyBkZXB0aENvbCArIFwiLnhcXG5cIiArIFwiYWRkIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIueiwgXCIgKyB1dlJlZyArIFwiLndcXG5cIiArXG5cblx0XHRcdFwibXVsIFwiICsgZGVwdGhDb2wgKyBcIi54LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueSwgXCIgKyBjdXN0b21EYXRhUmVnICsgXCIueVxcblwiICsgXCJmcmMgXCIgKyBkZXB0aENvbCArIFwiLngsIFwiICsgZGVwdGhDb2wgKyBcIi54XFxuXCIgKyBcInN1YiBcIiArIHV2UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdGFyZ2V0UmVnICsgXCIud1xcblwiICsgXCJtdWwgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIGRlcHRoQ29sICsgXCIueFxcblwiICsgXCJhZGQgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53XFxuXCI7XG5cblx0XHRyZWdDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZShkZXB0aENvbCk7XG5cdFx0cmVnQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodXZSZWcpO1xuXG5cdFx0bWV0aG9kVk8udGV4dHVyZXNJbmRleCA9IGRlcHRoTWFwUmVnaXN0ZXIuaW5kZXg7XG5cblx0XHRyZXR1cm4gY29kZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlBY3RpdmF0ZUZvckNhc2NhZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCBzdGFnZTpTdGFnZSlcblx0e1xuXHRcdHZhciBzaXplOm51bWJlciAvKmludCovID0gdGhpcy5jYXN0aW5nTGlnaHQuc2hhZG93TWFwcGVyLmRlcHRoTWFwU2l6ZTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qaW50Ki8gPSBtZXRob2RWTy5zZWNvbmRhcnlGcmFnbWVudENvbnN0YW50c0luZGV4O1xuXHRcdHZhciBkYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XG5cdFx0ZGF0YVtpbmRleF0gPSBzaXplO1xuXHRcdGRhdGFbaW5kZXggKyAxXSA9IDEvc2l6ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pR2V0Q2FzY2FkZUZyYWdtZW50Q29kZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIGRlY29kZVJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgZGVwdGhUZXh0dXJlOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgZGVwdGhQcm9qZWN0aW9uOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgdGFyZ2V0UmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nO1xuXHRcdHZhciBkYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHRtZXRob2RWTy5zZWNvbmRhcnlGcmFnbWVudENvbnN0YW50c0luZGV4ID0gZGF0YVJlZy5pbmRleCo0O1xuXHRcdHZhciB0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdHJlZ2lzdGVyQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKHRlbXAsIDEpO1xuXHRcdHZhciBwcmVkaWNhdGU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMocHJlZGljYXRlLCAxKTtcblxuXHRcdGNvZGUgPSBcInRleCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIiwgXCIgKyBkZXB0aFRleHR1cmUgKyBcIiA8MmQsIG5lYXJlc3QsIGNsYW1wPlxcblwiICsgXCJkcDQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGVjb2RlUmVnaXN0ZXIgKyBcIlxcblwiICsgXCJzbHQgXCIgKyBwcmVkaWNhdGUgKyBcIi54LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnosIFwiICsgdGVtcCArIFwiLnpcXG5cIiArXG5cblx0XHRcdFwiYWRkIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueCwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIi54LCBcIiArIGRhdGFSZWcgKyBcIi55XFxuXCIgKyBcInRleCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIiwgXCIgKyBkZXB0aFRleHR1cmUgKyBcIiA8MmQsIG5lYXJlc3QsIGNsYW1wPlxcblwiICsgXCJkcDQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGVjb2RlUmVnaXN0ZXIgKyBcIlxcblwiICsgXCJzbHQgXCIgKyBwcmVkaWNhdGUgKyBcIi56LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnosIFwiICsgdGVtcCArIFwiLnpcXG5cIiArXG5cblx0XHRcdFwiYWRkIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueSwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIi55LCBcIiArIGRhdGFSZWcgKyBcIi55XFxuXCIgKyBcInRleCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIiwgXCIgKyBkZXB0aFRleHR1cmUgKyBcIiA8MmQsIG5lYXJlc3QsIGNsYW1wPlxcblwiICsgXCJkcDQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGVjb2RlUmVnaXN0ZXIgKyBcIlxcblwiICsgXCJzbHQgXCIgKyBwcmVkaWNhdGUgKyBcIi53LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnosIFwiICsgdGVtcCArIFwiLnpcXG5cIiArXG5cblx0XHRcdFwic3ViIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueCwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIi54LCBcIiArIGRhdGFSZWcgKyBcIi55XFxuXCIgKyBcInRleCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIiwgXCIgKyBkZXB0aFRleHR1cmUgKyBcIiA8MmQsIG5lYXJlc3QsIGNsYW1wPlxcblwiICsgXCJkcDQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGVjb2RlUmVnaXN0ZXIgKyBcIlxcblwiICsgXCJzbHQgXCIgKyBwcmVkaWNhdGUgKyBcIi55LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnosIFwiICsgdGVtcCArIFwiLnpcXG5cIiArXG5cblx0XHRcdFwibXVsIFwiICsgdGVtcCArIFwiLnh5LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnh5LCBcIiArIGRhdGFSZWcgKyBcIi54XFxuXCIgKyBcImZyYyBcIiArIHRlbXAgKyBcIi54eSwgXCIgKyB0ZW1wICsgXCIueHlcXG5cIiArXG5cblx0XHRcdC8vIHNvbWUgc3RyYW5nZSByZWdpc3RlciBqdWdnbGluZyB0byBwcmV2ZW50IGFnYWwgYnVnZ2luZyBvdXRcblx0XHRcdFwic3ViIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIsIFwiICsgcHJlZGljYXRlICsgXCIueHl6dywgXCIgKyBwcmVkaWNhdGUgKyBcIi56d3h5XFxuXCIgKyBcIm11bCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLCBcIiArIHRlbXAgKyBcIi54XFxuXCIgK1xuXG5cdFx0XHRcImFkZCBcIiArIHByZWRpY2F0ZSArIFwiLnh5LCBcIiArIHByZWRpY2F0ZSArIFwiLnh5LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnp3XFxuXCIgK1xuXG5cdFx0XHRcInN1YiBcIiArIHByZWRpY2F0ZSArIFwiLnksIFwiICsgcHJlZGljYXRlICsgXCIueSwgXCIgKyBwcmVkaWNhdGUgKyBcIi54XFxuXCIgKyBcIm11bCBcIiArIHByZWRpY2F0ZSArIFwiLnksIFwiICsgcHJlZGljYXRlICsgXCIueSwgXCIgKyB0ZW1wICsgXCIueVxcblwiICsgXCJhZGQgXCIgKyB0YXJnZXRSZWdpc3RlciArIFwiLncsIFwiICsgcHJlZGljYXRlICsgXCIueCwgXCIgKyBwcmVkaWNhdGUgKyBcIi55XFxuXCI7XG5cblx0XHRyZWdpc3RlckNhY2hlLnJlbW92ZUZyYWdtZW50VGVtcFVzYWdlKHRlbXApO1xuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UocHJlZGljYXRlKTtcblx0XHRyZXR1cm4gY29kZTtcblx0fVxufVxuXG5leHBvcnQgPSBTaGFkb3dGaWx0ZXJlZE1ldGhvZDsiXX0=