var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderCompilerHelper = require("awayjs-renderergl/lib/utils/ShaderCompilerHelper");
var LightingMethodBase = require("awayjs-methodmaterials/lib/methods/LightingMethodBase");
/**
 * DiffuseBasicMethod provides the default shading method for Lambert (dot3) diffuse lighting.
 */
var DiffuseBasicMethod = (function (_super) {
    __extends(DiffuseBasicMethod, _super);
    /**
     * Creates a new DiffuseBasicMethod object.
     */
    function DiffuseBasicMethod() {
        _super.call(this);
        this._multiply = true;
        this._diffuseColor = 0xffffff;
        this._ambientColor = 0xffffff;
        this._diffuseR = 1;
        this._diffuseG = 1;
        this._diffuseB = 1;
        this._ambientR = 1;
        this._ambientG = 1;
        this._ambientB = 1;
    }
    DiffuseBasicMethod.prototype.iIsUsed = function (shaderObject) {
        if (!shaderObject.numLights)
            return false;
        return true;
    };
    Object.defineProperty(DiffuseBasicMethod.prototype, "multiply", {
        /**
         * Set internally if diffuse color component multiplies or replaces the ambient color
         */
        get: function () {
            return this._multiply;
        },
        set: function (value) {
            if (this._multiply == value)
                return;
            this._multiply = value;
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    DiffuseBasicMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        methodVO.needsUV = this._pUseTexture;
        methodVO.needsNormals = shaderObject.numLights > 0;
    };
    /**
     * Forces the creation of the texture's mipmaps.
     * @param stage The Stage used by the renderer
     */
    DiffuseBasicMethod.prototype.generateMip = function (stage) {
        if (this._pUseTexture)
            stage.activateTexture(0, this._texture, true, true, true);
    };
    Object.defineProperty(DiffuseBasicMethod.prototype, "diffuseColor", {
        /**
         * The color of the diffuse reflection when not using a texture.
         */
        get: function () {
            return this._diffuseColor;
        },
        set: function (value) {
            if (this._diffuseColor == value)
                return;
            this._diffuseColor = value;
            this.updateDiffuse();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DiffuseBasicMethod.prototype, "ambientColor", {
        /**
         * The color of the ambient reflection
         */
        get: function () {
            return this._ambientColor;
        },
        set: function (value) {
            if (this._ambientColor == value)
                return;
            this._ambientColor = value;
            this.updateAmbient();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DiffuseBasicMethod.prototype, "texture", {
        /**
         * The bitmapData to use to define the diffuse reflection color per texel.
         */
        get: function () {
            return this._texture;
        },
        set: function (value) {
            var b = (value != null);
            if (b != this._pUseTexture || (value && this._texture && (value.format != this._texture.format)))
                this.iInvalidateShaderProgram();
            this._pUseTexture = b;
            this._texture = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.dispose = function () {
        this._texture = null;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.copyFrom = function (method) {
        var diff = method;
        this.texture = diff.texture;
        this.multiply = diff.multiply;
        this.diffuseColor = diff.diffuseColor;
        this.ambientColor = diff.ambientColor;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iCleanCompilationData = function () {
        _super.prototype.iCleanCompilationData.call(this);
        this._pTotalLightColorReg = null;
        this._pDiffuseInputRegister = null;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iGetFragmentPreLightingCode = function (shaderObject, methodVO, registerCache, sharedRegisters) {
        var code = "";
        this._pIsFirstLight = true;
        this._pTotalLightColorReg = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(this._pTotalLightColorReg, 1);
        return code;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iGetFragmentCodePerLight = function (shaderObject, methodVO, lightDirReg, lightColReg, registerCache, sharedRegisters) {
        var code = "";
        var t;
        // write in temporary if not first light, so we can add to total diffuse colour
        if (this._pIsFirstLight) {
            t = this._pTotalLightColorReg;
        }
        else {
            t = registerCache.getFreeFragmentVectorTemp();
            registerCache.addFragmentTempUsages(t, 1);
        }
        code += "dp3 " + t + ".x, " + lightDirReg + ", " + sharedRegisters.normalFragment + "\n" + "max " + t + ".w, " + t + ".x, " + sharedRegisters.commons + ".y\n";
        if (shaderObject.usesLightFallOff)
            code += "mul " + t + ".w, " + t + ".w, " + lightDirReg + ".w\n";
        if (this._iModulateMethod != null)
            code += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);
        code += "mul " + t + ", " + t + ".w, " + lightColReg + "\n";
        if (!this._pIsFirstLight) {
            code += "add " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + t + "\n";
            registerCache.removeFragmentTempUsage(t);
        }
        this._pIsFirstLight = false;
        return code;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iGetFragmentCodePerProbe = function (shaderObject, methodVO, cubeMapReg, weightRegister, registerCache, sharedRegisters) {
        var code = "";
        var t;
        // write in temporary if not first light, so we can add to total diffuse colour
        if (this._pIsFirstLight) {
            t = this._pTotalLightColorReg;
        }
        else {
            t = registerCache.getFreeFragmentVectorTemp();
            registerCache.addFragmentTempUsages(t, 1);
        }
        code += "tex " + t + ", " + sharedRegisters.normalFragment + ", " + cubeMapReg + " <cube,linear,miplinear>\n" + "mul " + t + ".xyz, " + t + ".xyz, " + weightRegister + "\n";
        if (this._iModulateMethod != null)
            code += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);
        if (!this._pIsFirstLight) {
            code += "add " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + t + "\n";
            registerCache.removeFragmentTempUsage(t);
        }
        this._pIsFirstLight = false;
        return code;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iGetFragmentPostLightingCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var code = "";
        var albedo;
        var cutOffReg;
        // incorporate input from ambient
        if (sharedRegisters.shadowTarget)
            code += this.pApplyShadow(shaderObject, methodVO, registerCache, sharedRegisters);
        albedo = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(albedo, 1);
        var ambientColorRegister = registerCache.getFreeFragmentConstant();
        methodVO.fragmentConstantsIndex = ambientColorRegister.index * 4;
        if (this._pUseTexture) {
            this._pDiffuseInputRegister = registerCache.getFreeTextureReg();
            methodVO.texturesIndex = this._pDiffuseInputRegister.index;
            code += ShaderCompilerHelper.getTex2DSampleCode(albedo, sharedRegisters, this._pDiffuseInputRegister, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);
        }
        else {
            this._pDiffuseInputRegister = registerCache.getFreeFragmentConstant();
            code += "mov " + albedo + ", " + this._pDiffuseInputRegister + "\n";
        }
        code += "sat " + this._pTotalLightColorReg + ", " + this._pTotalLightColorReg + "\n" + "mul " + albedo + ".xyz, " + albedo + ", " + this._pTotalLightColorReg + "\n";
        if (this._multiply) {
            code += "add " + albedo + ".xyz, " + albedo + ", " + ambientColorRegister + "\n" + "mul " + targetReg + ".xyz, " + targetReg + ", " + albedo + "\n";
        }
        else {
            code += "mul " + targetReg + ".xyz, " + targetReg + ", " + ambientColorRegister + "\n" + "mul " + this._pTotalLightColorReg + ".xyz, " + targetReg + ", " + this._pTotalLightColorReg + "\n" + "sub " + targetReg + ".xyz, " + targetReg + ", " + this._pTotalLightColorReg + "\n" + "add " + targetReg + ".xyz, " + targetReg + ", " + albedo + "\n";
        }
        registerCache.removeFragmentTempUsage(this._pTotalLightColorReg);
        registerCache.removeFragmentTempUsage(albedo);
        return code;
    };
    /**
     * Generate the code that applies the calculated shadow to the diffuse light
     * @param methodVO The MethodVO object for which the compilation is currently happening.
     * @param regCache The register cache the compiler is currently using for the register management.
     */
    DiffuseBasicMethod.prototype.pApplyShadow = function (shaderObject, methodVO, regCache, sharedRegisters) {
        return "mul " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + sharedRegisters.shadowTarget + ".w\n";
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        if (this._pUseTexture) {
            stage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
        }
        else {
            var index = methodVO.fragmentConstantsIndex;
            var data = shaderObject.fragmentConstantData;
            data[index + 4] = this._diffuseR;
            data[index + 5] = this._diffuseG;
            data[index + 6] = this._diffuseB;
            data[index + 7] = 1;
        }
    };
    /**
     * Updates the diffuse color data used by the render state.
     */
    DiffuseBasicMethod.prototype.updateDiffuse = function () {
        this._diffuseR = ((this._diffuseColor >> 16) & 0xff) / 0xff;
        this._diffuseG = ((this._diffuseColor >> 8) & 0xff) / 0xff;
        this._diffuseB = (this._diffuseColor & 0xff) / 0xff;
    };
    /**
     * Updates the ambient color data used by the render state.
     */
    DiffuseBasicMethod.prototype.updateAmbient = function () {
        this._ambientR = ((this._ambientColor >> 16) & 0xff) / 0xff;
        this._ambientG = ((this._ambientColor >> 8) & 0xff) / 0xff;
        this._ambientB = (this._ambientColor & 0xff) / 0xff;
    };
    /**
     * @inheritDoc
     */
    DiffuseBasicMethod.prototype.iSetRenderState = function (shaderObject, methodVO, renderable, stage, camera) {
        //TODO move this to Activate (ambientR/G/B currently calc'd in render state)
        if (shaderObject.numLights > 0) {
            var index = methodVO.fragmentConstantsIndex;
            var data = shaderObject.fragmentConstantData;
            data[index] = shaderObject.ambientR * this._ambientR;
            data[index + 1] = shaderObject.ambientG * this._ambientG;
            data[index + 2] = shaderObject.ambientB * this._ambientB;
            data[index + 3] = 1;
        }
    };
    return DiffuseBasicMethod;
})(LightingMethodBase);
module.exports = DiffuseBasicMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvRGlmZnVzZUJhc2ljTWV0aG9kLnRzIl0sIm5hbWVzIjpbIkRpZmZ1c2VCYXNpY01ldGhvZCIsIkRpZmZ1c2VCYXNpY01ldGhvZC5jb25zdHJ1Y3RvciIsIkRpZmZ1c2VCYXNpY01ldGhvZC5pSXNVc2VkIiwiRGlmZnVzZUJhc2ljTWV0aG9kLm11bHRpcGx5IiwiRGlmZnVzZUJhc2ljTWV0aG9kLmlJbml0Vk8iLCJEaWZmdXNlQmFzaWNNZXRob2QuZ2VuZXJhdGVNaXAiLCJEaWZmdXNlQmFzaWNNZXRob2QuZGlmZnVzZUNvbG9yIiwiRGlmZnVzZUJhc2ljTWV0aG9kLmFtYmllbnRDb2xvciIsIkRpZmZ1c2VCYXNpY01ldGhvZC50ZXh0dXJlIiwiRGlmZnVzZUJhc2ljTWV0aG9kLmRpc3Bvc2UiLCJEaWZmdXNlQmFzaWNNZXRob2QuY29weUZyb20iLCJEaWZmdXNlQmFzaWNNZXRob2QuaUNsZWFuQ29tcGlsYXRpb25EYXRhIiwiRGlmZnVzZUJhc2ljTWV0aG9kLmlHZXRGcmFnbWVudFByZUxpZ2h0aW5nQ29kZSIsIkRpZmZ1c2VCYXNpY01ldGhvZC5pR2V0RnJhZ21lbnRDb2RlUGVyTGlnaHQiLCJEaWZmdXNlQmFzaWNNZXRob2QuaUdldEZyYWdtZW50Q29kZVBlclByb2JlIiwiRGlmZnVzZUJhc2ljTWV0aG9kLmlHZXRGcmFnbWVudFBvc3RMaWdodGluZ0NvZGUiLCJEaWZmdXNlQmFzaWNNZXRob2QucEFwcGx5U2hhZG93IiwiRGlmZnVzZUJhc2ljTWV0aG9kLmlBY3RpdmF0ZSIsIkRpZmZ1c2VCYXNpY01ldGhvZC51cGRhdGVEaWZmdXNlIiwiRGlmZnVzZUJhc2ljTWV0aG9kLnVwZGF0ZUFtYmllbnQiLCJEaWZmdXNlQmFzaWNNZXRob2QuaVNldFJlbmRlclN0YXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFVQSxJQUFPLG9CQUFvQixXQUFhLGtEQUFrRCxDQUFDLENBQUM7QUFLNUYsSUFBTyxr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LENBQUNBLG9CQUFvQkEsQ0FBQ0E7UUFDL0JBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLENBQUNBLEdBQUdBLGFBQWFBLENBQUNBLHlCQUF5QkEsRUFBRUEsQ0FBQ0E7WUFDOUNBLGFBQWFBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0NBLENBQUNBO1FBRURBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUdBLFdBQVdBLEdBQUdBLElBQUlBLEdBQUdBLGVBQWVBLENBQUNBLGNBQWNBLEdBQUdBLElBQUlBLEdBQ3RGQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxlQUFlQSxDQUFDQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUV0RUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQTtZQUNqQ0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsV0FBV0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFakVBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsSUFBSUEsSUFBSUEsQ0FBQ0E7WUFDakNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsWUFBWUEsRUFBRUEsUUFBUUEsRUFBRUEsQ0FBQ0EsRUFBRUEsYUFBYUEsRUFBRUEsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFFMUZBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUdBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBO1FBRTVEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxQkEs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LENBQUNBLG9CQUFvQkEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxJQUFJQSxHQUNuRkEsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUUvRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLG9CQUFvQkEsR0FBR0EsSUFBSUEsR0FDL0VBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLFFBQVFBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO1FBQ25FQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxRQUFRQSxHQUFHQSxTQUFTQSxHQUFHQSxJQUFJQSxHQUFHQSxvQkFBb0JBLEdBQUdBLElBQUlBLEdBQ3JGQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLEdBQUdBLFFBQVFBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsR0FBR0EsSUFBSUEsR0FDbkdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLFFBQVFBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsR0FBR0EsSUFBSUEsR0FDbkZBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLFFBQVFBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO1FBQ25FQSxDQUFDQTtRQUVEQSxhQUFhQSxDQUFDQSx1QkFBdUJBLENB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R0FBR0EsSUFBSUEsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDbkRBLENBQUNBO0lBRURuQjs7T0FFR0E7SUFDSUEsNENBQWVBLEdBQXRCQSxVQUF1QkEsWUFBaUNBLEVBQUVBLFFBQWlCQSxFQUFFQSxVQUF5QkEsRUFBRUEsS0FBV0EsRUFBRUEsTUFBYUE7UUFFaklvQixBQUNBQSw0RUFENEVBO1FBQzVFQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQ0EsSUFBSUEsS0FBS0EsR0FBVUEsUUFBUUEsQ0FBQ0Esc0JBQXNCQSxDQUFDQTtZQUNuREEsSUFBSUEsSUFBSUEsR0FBaUJBLFlBQVlBLENBQUNBLG9CQUFvQkEsQ0FBQ0E7WUFDM0RBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLFlBQVlBLENBQUNBLFFBQVFBLEdBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBO1lBQ25EQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxZQUFZQSxDQUFDQSxRQUFRQSxHQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtZQUN2REEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsWUFBWUEsQ0FBQ0EsUUFBUUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7WUFDdkRBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3JCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUNGcEIseUJBQUNBO0FBQURBLENBcFdBLEFBb1dDQSxFQXBXZ0Msa0JBQWtCLEVBb1dsRDtBQUVELEFBQTRCLGlCQUFuQixrQkFBa0IsQ0FBQyIsImZpbGUiOiJtZXRob2RzL0RpZmZ1c2VCYXNpY01ldGhvZC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVGV4dHVyZTJEQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1RleHR1cmUyREJhc2VcIik7XHJcblxyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuXHJcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xyXG5cclxuaW1wb3J0IFNoYWRlckxpZ2h0aW5nT2JqZWN0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0XCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJIZWxwZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvdXRpbHMvU2hhZGVyQ29tcGlsZXJIZWxwZXJcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XHJcblxyXG5pbXBvcnQgTWV0aG9kVk9cdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9kYXRhL01ldGhvZFZPXCIpO1xyXG5pbXBvcnQgU2hhZGluZ01ldGhvZEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9tZXRob2RzL1NoYWRpbmdNZXRob2RCYXNlXCIpO1xyXG5pbXBvcnQgTGlnaHRpbmdNZXRob2RCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvbWV0aG9kcy9MaWdodGluZ01ldGhvZEJhc2VcIik7XHJcblxyXG4vKipcclxuICogRGlmZnVzZUJhc2ljTWV0aG9kIHByb3ZpZGVzIHRoZSBkZWZhdWx0IHNoYWRpbmcgbWV0aG9kIGZvciBMYW1iZXJ0IChkb3QzKSBkaWZmdXNlIGxpZ2h0aW5nLlxyXG4gKi9cclxuY2xhc3MgRGlmZnVzZUJhc2ljTWV0aG9kIGV4dGVuZHMgTGlnaHRpbmdNZXRob2RCYXNlXHJcbntcclxuXHRwcml2YXRlIF9tdWx0aXBseTpib29sZWFuID0gdHJ1ZTtcclxuXHJcblx0cHVibGljIF9wVXNlVGV4dHVyZTpib29sZWFuO1xyXG5cdHB1YmxpYyBfcFRvdGFsTGlnaHRDb2xvclJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XHJcblx0cHVibGljIF9wRGlmZnVzZUlucHV0UmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xyXG5cclxuXHRwcml2YXRlIF90ZXh0dXJlOlRleHR1cmUyREJhc2U7XHJcblx0cHJpdmF0ZSBfZGlmZnVzZUNvbG9yOm51bWJlciA9IDB4ZmZmZmZmO1xyXG5cdHByaXZhdGUgX2FtYmllbnRDb2xvcjpudW1iZXIgPSAweGZmZmZmZjtcclxuXHRwcml2YXRlIF9kaWZmdXNlUjpudW1iZXIgPSAxO1xyXG5cdHByaXZhdGUgX2RpZmZ1c2VHOm51bWJlciA9IDE7XHJcblx0cHJpdmF0ZSBfZGlmZnVzZUI6bnVtYmVyID0gMTtcclxuXHRwcml2YXRlIF9hbWJpZW50UjpudW1iZXIgPSAxO1xyXG5cdHByaXZhdGUgX2FtYmllbnRHOm51bWJlciA9IDE7XHJcblx0cHJpdmF0ZSBfYW1iaWVudEI6bnVtYmVyID0gMTtcclxuXHJcblx0cHVibGljIF9wSXNGaXJzdExpZ2h0OmJvb2xlYW47XHJcblxyXG5cdC8qKlxyXG5cdCAqIENyZWF0ZXMgYSBuZXcgRGlmZnVzZUJhc2ljTWV0aG9kIG9iamVjdC5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcigpXHJcblx0e1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBpSXNVc2VkKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdGlmICghc2hhZGVyT2JqZWN0Lm51bUxpZ2h0cylcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogU2V0IGludGVybmFsbHkgaWYgZGlmZnVzZSBjb2xvciBjb21wb25lbnQgbXVsdGlwbGllcyBvciByZXBsYWNlcyB0aGUgYW1iaWVudCBjb2xvclxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgbXVsdGlwbHkoKTpib29sZWFuXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX211bHRpcGx5O1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBtdWx0aXBseSh2YWx1ZTpib29sZWFuKVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9tdWx0aXBseSA9PSB2YWx1ZSlcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdHRoaXMuX211bHRpcGx5ID0gdmFsdWU7XHJcblxyXG5cdFx0dGhpcy5pSW52YWxpZGF0ZVNoYWRlclByb2dyYW0oKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBpSW5pdFZPKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8pXHJcblx0e1xyXG5cdFx0bWV0aG9kVk8ubmVlZHNVViA9IHRoaXMuX3BVc2VUZXh0dXJlO1xyXG5cdFx0bWV0aG9kVk8ubmVlZHNOb3JtYWxzID0gc2hhZGVyT2JqZWN0Lm51bUxpZ2h0cyA+IDA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGb3JjZXMgdGhlIGNyZWF0aW9uIG9mIHRoZSB0ZXh0dXJlJ3MgbWlwbWFwcy5cclxuXHQgKiBAcGFyYW0gc3RhZ2UgVGhlIFN0YWdlIHVzZWQgYnkgdGhlIHJlbmRlcmVyXHJcblx0ICovXHJcblx0cHVibGljIGdlbmVyYXRlTWlwKHN0YWdlOlN0YWdlKVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9wVXNlVGV4dHVyZSlcclxuXHRcdFx0c3RhZ2UuYWN0aXZhdGVUZXh0dXJlKDAsIHRoaXMuX3RleHR1cmUsIHRydWUsIHRydWUsIHRydWUpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVGhlIGNvbG9yIG9mIHRoZSBkaWZmdXNlIHJlZmxlY3Rpb24gd2hlbiBub3QgdXNpbmcgYSB0ZXh0dXJlLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgZGlmZnVzZUNvbG9yKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2RpZmZ1c2VDb2xvcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZGlmZnVzZUNvbG9yKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fZGlmZnVzZUNvbG9yID09IHZhbHVlKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fZGlmZnVzZUNvbG9yID0gdmFsdWU7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVEaWZmdXNlKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgY29sb3Igb2YgdGhlIGFtYmllbnQgcmVmbGVjdGlvblxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgYW1iaWVudENvbG9yKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2FtYmllbnRDb2xvcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgYW1iaWVudENvbG9yKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fYW1iaWVudENvbG9yID09IHZhbHVlKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fYW1iaWVudENvbG9yID0gdmFsdWU7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVBbWJpZW50KCk7XHJcblx0fVxyXG5cclxuXHJcblx0LyoqXHJcblx0ICogVGhlIGJpdG1hcERhdGEgdG8gdXNlIHRvIGRlZmluZSB0aGUgZGlmZnVzZSByZWZsZWN0aW9uIGNvbG9yIHBlciB0ZXhlbC5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHRleHR1cmUoKTpUZXh0dXJlMkRCYXNlXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHRleHR1cmUodmFsdWU6VGV4dHVyZTJEQmFzZSlcclxuXHR7XHJcblx0XHR2YXIgYjpib29sZWFuID0gKHZhbHVlICE9IG51bGwpO1xyXG5cclxuXHRcdGlmIChiICE9IHRoaXMuX3BVc2VUZXh0dXJlIHx8ICh2YWx1ZSAmJiB0aGlzLl90ZXh0dXJlICYmICh2YWx1ZS5mb3JtYXQgIT0gdGhpcy5fdGV4dHVyZS5mb3JtYXQpKSlcclxuXHRcdFx0dGhpcy5pSW52YWxpZGF0ZVNoYWRlclByb2dyYW0oKTtcclxuXHJcblx0XHR0aGlzLl9wVXNlVGV4dHVyZSA9IGI7XHJcblx0XHR0aGlzLl90ZXh0dXJlID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBkaXNwb3NlKClcclxuXHR7XHJcblx0XHR0aGlzLl90ZXh0dXJlID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGNvcHlGcm9tKG1ldGhvZDpTaGFkaW5nTWV0aG9kQmFzZSlcclxuXHR7XHJcblx0XHR2YXIgZGlmZjpEaWZmdXNlQmFzaWNNZXRob2QgPSA8RGlmZnVzZUJhc2ljTWV0aG9kPiBtZXRob2Q7XHJcblxyXG5cdFx0dGhpcy50ZXh0dXJlID0gZGlmZi50ZXh0dXJlO1xyXG5cdFx0dGhpcy5tdWx0aXBseSA9IGRpZmYubXVsdGlwbHk7XHJcblx0XHR0aGlzLmRpZmZ1c2VDb2xvciA9IGRpZmYuZGlmZnVzZUNvbG9yO1xyXG5cdFx0dGhpcy5hbWJpZW50Q29sb3IgPSBkaWZmLmFtYmllbnRDb2xvcjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlDbGVhbkNvbXBpbGF0aW9uRGF0YSgpXHJcblx0e1xyXG5cdFx0c3VwZXIuaUNsZWFuQ29tcGlsYXRpb25EYXRhKCk7XHJcblxyXG5cdFx0dGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyA9IG51bGw7XHJcblx0XHR0aGlzLl9wRGlmZnVzZUlucHV0UmVnaXN0ZXIgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgaUdldEZyYWdtZW50UHJlTGlnaHRpbmdDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8sIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHJcblx0XHR0aGlzLl9wSXNGaXJzdExpZ2h0ID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XHJcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnLCAxKTtcclxuXHJcblx0XHRyZXR1cm4gY29kZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlHZXRGcmFnbWVudENvZGVQZXJMaWdodChzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPLCBsaWdodERpclJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGxpZ2h0Q29sUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcclxuXHR7XHJcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xyXG5cdFx0dmFyIHQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xyXG5cclxuXHRcdC8vIHdyaXRlIGluIHRlbXBvcmFyeSBpZiBub3QgZmlyc3QgbGlnaHQsIHNvIHdlIGNhbiBhZGQgdG8gdG90YWwgZGlmZnVzZSBjb2xvdXJcclxuXHRcdGlmICh0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XHJcblx0XHRcdHQgPSB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh0LCAxKTtcclxuXHRcdH1cclxuXHJcblx0XHRjb2RlICs9IFwiZHAzIFwiICsgdCArIFwiLngsIFwiICsgbGlnaHREaXJSZWcgKyBcIiwgXCIgKyBzaGFyZWRSZWdpc3RlcnMubm9ybWFsRnJhZ21lbnQgKyBcIlxcblwiICtcclxuXHRcdFx0XHRcIm1heCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi54LCBcIiArIHNoYXJlZFJlZ2lzdGVycy5jb21tb25zICsgXCIueVxcblwiO1xyXG5cclxuXHRcdGlmIChzaGFkZXJPYmplY3QudXNlc0xpZ2h0RmFsbE9mZilcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53LCBcIiArIGxpZ2h0RGlyUmVnICsgXCIud1xcblwiO1xyXG5cclxuXHRcdGlmICh0aGlzLl9pTW9kdWxhdGVNZXRob2QgIT0gbnVsbClcclxuXHRcdFx0Y29kZSArPSB0aGlzLl9pTW9kdWxhdGVNZXRob2Qoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgdCwgcmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzKTtcclxuXHJcblx0XHRjb2RlICs9IFwibXVsIFwiICsgdCArIFwiLCBcIiArIHQgKyBcIi53LCBcIiArIGxpZ2h0Q29sUmVnICsgXCJcXG5cIjtcclxuXHJcblx0XHRpZiAoIXRoaXMuX3BJc0ZpcnN0TGlnaHQpIHtcclxuXHRcdFx0Y29kZSArPSBcImFkZCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIi54eXosIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLCBcIiArIHQgKyBcIlxcblwiO1xyXG5cdFx0XHRyZWdpc3RlckNhY2hlLnJlbW92ZUZyYWdtZW50VGVtcFVzYWdlKHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX3BJc0ZpcnN0TGlnaHQgPSBmYWxzZTtcclxuXHJcblx0XHRyZXR1cm4gY29kZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlHZXRGcmFnbWVudENvZGVQZXJQcm9iZShzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPLCBjdWJlTWFwUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgd2VpZ2h0UmVnaXN0ZXI6c3RyaW5nLCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xyXG5cdHtcclxuXHRcdHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XHJcblx0XHR2YXIgdDpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XHJcblxyXG5cdFx0Ly8gd3JpdGUgaW4gdGVtcG9yYXJ5IGlmIG5vdCBmaXJzdCBsaWdodCwgc28gd2UgY2FuIGFkZCB0byB0b3RhbCBkaWZmdXNlIGNvbG91clxyXG5cdFx0aWYgKHRoaXMuX3BJc0ZpcnN0TGlnaHQpIHtcclxuXHRcdFx0dCA9IHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWc7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XHJcblx0XHRcdHJlZ2lzdGVyQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKHQsIDEpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvZGUgKz0gXCJ0ZXggXCIgKyB0ICsgXCIsIFwiICsgc2hhcmVkUmVnaXN0ZXJzLm5vcm1hbEZyYWdtZW50ICsgXCIsIFwiICsgY3ViZU1hcFJlZyArIFwiIDxjdWJlLGxpbmVhcixtaXBsaW5lYXI+XFxuXCIgK1xyXG5cdFx0XHRcdFwibXVsIFwiICsgdCArIFwiLnh5eiwgXCIgKyB0ICsgXCIueHl6LCBcIiArIHdlaWdodFJlZ2lzdGVyICsgXCJcXG5cIjtcclxuXHJcblx0XHRpZiAodGhpcy5faU1vZHVsYXRlTWV0aG9kICE9IG51bGwpXHJcblx0XHRcdGNvZGUgKz0gdGhpcy5faU1vZHVsYXRlTWV0aG9kKHNoYWRlck9iamVjdCwgbWV0aG9kVk8sIHQsIHJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVycyk7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XHJcblx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnICsgXCIueHl6LCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIiwgXCIgKyB0ICsgXCJcXG5cIjtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh0KTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9wSXNGaXJzdExpZ2h0ID0gZmFsc2U7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRQb3N0TGlnaHRpbmdDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8sIHRhcmdldFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHJcblx0XHR2YXIgYWxiZWRvOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcclxuXHRcdHZhciBjdXRPZmZSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xyXG5cclxuXHRcdC8vIGluY29ycG9yYXRlIGlucHV0IGZyb20gYW1iaWVudFxyXG5cdFx0aWYgKHNoYXJlZFJlZ2lzdGVycy5zaGFkb3dUYXJnZXQpXHJcblx0XHRcdGNvZGUgKz0gdGhpcy5wQXBwbHlTaGFkb3coc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgcmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzKTtcclxuXHJcblx0XHRhbGJlZG8gPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcclxuXHRcdHJlZ2lzdGVyQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKGFsYmVkbywgMSk7XHJcblxyXG5cdFx0dmFyIGFtYmllbnRDb2xvclJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcclxuXHRcdG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBhbWJpZW50Q29sb3JSZWdpc3Rlci5pbmRleCo0O1xyXG5cclxuXHRcdGlmICh0aGlzLl9wVXNlVGV4dHVyZSkge1xyXG5cdFx0XHR0aGlzLl9wRGlmZnVzZUlucHV0UmVnaXN0ZXIgPSByZWdpc3RlckNhY2hlLmdldEZyZWVUZXh0dXJlUmVnKCk7XHJcblxyXG5cdFx0XHRtZXRob2RWTy50ZXh0dXJlc0luZGV4ID0gdGhpcy5fcERpZmZ1c2VJbnB1dFJlZ2lzdGVyLmluZGV4O1xyXG5cclxuXHRcdFx0Y29kZSArPSBTaGFkZXJDb21waWxlckhlbHBlci5nZXRUZXgyRFNhbXBsZUNvZGUoYWxiZWRvLCBzaGFyZWRSZWdpc3RlcnMsIHRoaXMuX3BEaWZmdXNlSW5wdXRSZWdpc3RlciwgdGhpcy5fdGV4dHVyZSwgc2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzLCBzaGFkZXJPYmplY3QucmVwZWF0VGV4dHVyZXMsIHNoYWRlck9iamVjdC51c2VNaXBtYXBwaW5nKTtcclxuXHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLl9wRGlmZnVzZUlucHV0UmVnaXN0ZXIgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XHJcblxyXG5cdFx0XHRjb2RlICs9IFwibW92IFwiICsgYWxiZWRvICsgXCIsIFwiICsgdGhpcy5fcERpZmZ1c2VJbnB1dFJlZ2lzdGVyICsgXCJcXG5cIjtcclxuXHRcdH1cclxuXHJcblx0XHRjb2RlICs9IFwic2F0IFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIlxcblwiICtcclxuXHRcdFx0XCJtdWwgXCIgKyBhbGJlZG8gKyBcIi54eXosIFwiICsgYWxiZWRvICsgXCIsIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiXFxuXCI7XHJcblxyXG5cdFx0aWYgKHRoaXMuX211bHRpcGx5KSB7XHJcblx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyBhbGJlZG8gKyBcIi54eXosIFwiICsgYWxiZWRvICsgXCIsIFwiICsgYW1iaWVudENvbG9yUmVnaXN0ZXIgKyBcIlxcblwiICtcclxuXHRcdFx0XHRcIm11bCBcIiArIHRhcmdldFJlZyArIFwiLnh5eiwgXCIgKyB0YXJnZXRSZWcgKyBcIiwgXCIgKyBhbGJlZG8gKyBcIlxcblwiO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRhcmdldFJlZyArIFwiLnh5eiwgXCIgKyB0YXJnZXRSZWcgKyBcIiwgXCIgKyBhbWJpZW50Q29sb3JSZWdpc3RlciArIFwiXFxuXCIgK1xyXG5cdFx0XHRcdFwibXVsIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLnh5eiwgXCIgKyB0YXJnZXRSZWcgKyBcIiwgXCIgKyB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnICsgXCJcXG5cIiArXHJcblx0XHRcdFx0XCJzdWIgXCIgKyB0YXJnZXRSZWcgKyBcIi54eXosIFwiICsgdGFyZ2V0UmVnICsgXCIsIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiXFxuXCIgK1xyXG5cdFx0XHRcdFwiYWRkIFwiICsgdGFyZ2V0UmVnICsgXCIueHl6LCBcIiArIHRhcmdldFJlZyArIFwiLCBcIiArIGFsYmVkbyArIFwiXFxuXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnKTtcclxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UoYWxiZWRvKTtcclxuXHJcblx0XHRyZXR1cm4gY29kZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEdlbmVyYXRlIHRoZSBjb2RlIHRoYXQgYXBwbGllcyB0aGUgY2FsY3VsYXRlZCBzaGFkb3cgdG8gdGhlIGRpZmZ1c2UgbGlnaHRcclxuXHQgKiBAcGFyYW0gbWV0aG9kVk8gVGhlIE1ldGhvZFZPIG9iamVjdCBmb3Igd2hpY2ggdGhlIGNvbXBpbGF0aW9uIGlzIGN1cnJlbnRseSBoYXBwZW5pbmcuXHJcblx0ICogQHBhcmFtIHJlZ0NhY2hlIFRoZSByZWdpc3RlciBjYWNoZSB0aGUgY29tcGlsZXIgaXMgY3VycmVudGx5IHVzaW5nIGZvciB0aGUgcmVnaXN0ZXIgbWFuYWdlbWVudC5cclxuXHQgKi9cclxuXHRwdWJsaWMgcEFwcGx5U2hhZG93KHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8sIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xyXG5cdHtcclxuXHRcdHJldHVybiBcIm11bCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIi54eXosIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLCBcIiArIHNoYXJlZFJlZ2lzdGVycy5zaGFkb3dUYXJnZXQgKyBcIi53XFxuXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpQWN0aXZhdGUoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTywgc3RhZ2U6U3RhZ2UpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3BVc2VUZXh0dXJlKSB7XHJcblx0XHRcdHN0YWdlLmFjdGl2YXRlVGV4dHVyZShtZXRob2RWTy50ZXh0dXJlc0luZGV4LCB0aGlzLl90ZXh0dXJlLCBzaGFkZXJPYmplY3QucmVwZWF0VGV4dHVyZXMsIHNoYWRlck9iamVjdC51c2VTbW9vdGhUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZU1pcG1hcHBpbmcpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dmFyIGluZGV4Om51bWJlciA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XHJcblx0XHRcdHZhciBkYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XHJcblx0XHRcdGRhdGFbaW5kZXggKyA0XSA9IHRoaXMuX2RpZmZ1c2VSO1xyXG5cdFx0XHRkYXRhW2luZGV4ICsgNV0gPSB0aGlzLl9kaWZmdXNlRztcclxuXHRcdFx0ZGF0YVtpbmRleCArIDZdID0gdGhpcy5fZGlmZnVzZUI7XHJcblx0XHRcdGRhdGFbaW5kZXggKyA3XSA9IDE7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBVcGRhdGVzIHRoZSBkaWZmdXNlIGNvbG9yIGRhdGEgdXNlZCBieSB0aGUgcmVuZGVyIHN0YXRlLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgdXBkYXRlRGlmZnVzZSgpXHJcblx0e1xyXG5cdFx0dGhpcy5fZGlmZnVzZVIgPSAoKHRoaXMuX2RpZmZ1c2VDb2xvciA+PiAxNikgJiAweGZmKS8weGZmO1xyXG5cdFx0dGhpcy5fZGlmZnVzZUcgPSAoKHRoaXMuX2RpZmZ1c2VDb2xvciA+PiA4KSAmIDB4ZmYpLzB4ZmY7XHJcblx0XHR0aGlzLl9kaWZmdXNlQiA9ICh0aGlzLl9kaWZmdXNlQ29sb3IgJiAweGZmKS8weGZmO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVXBkYXRlcyB0aGUgYW1iaWVudCBjb2xvciBkYXRhIHVzZWQgYnkgdGhlIHJlbmRlciBzdGF0ZS5cclxuXHQgKi9cclxuXHRwcml2YXRlIHVwZGF0ZUFtYmllbnQoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2FtYmllbnRSID0gKCh0aGlzLl9hbWJpZW50Q29sb3IgPj4gMTYpICYgMHhmZikvMHhmZjtcclxuXHRcdHRoaXMuX2FtYmllbnRHID0gKCh0aGlzLl9hbWJpZW50Q29sb3IgPj4gOCkgJiAweGZmKS8weGZmO1xyXG5cdFx0dGhpcy5fYW1iaWVudEIgPSAodGhpcy5fYW1iaWVudENvbG9yICYgMHhmZikvMHhmZjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlTZXRSZW5kZXJTdGF0ZShzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPLCByZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBzdGFnZTpTdGFnZSwgY2FtZXJhOkNhbWVyYSlcclxuXHR7XHJcblx0XHQvL1RPRE8gbW92ZSB0aGlzIHRvIEFjdGl2YXRlIChhbWJpZW50Ui9HL0IgY3VycmVudGx5IGNhbGMnZCBpbiByZW5kZXIgc3RhdGUpXHJcblx0XHRpZiAoc2hhZGVyT2JqZWN0Lm51bUxpZ2h0cyA+IDApIHtcclxuXHRcdFx0dmFyIGluZGV4Om51bWJlciA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XHJcblx0XHRcdHZhciBkYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XHJcblx0XHRcdGRhdGFbaW5kZXhdID0gc2hhZGVyT2JqZWN0LmFtYmllbnRSKnRoaXMuX2FtYmllbnRSO1xyXG5cdFx0XHRkYXRhW2luZGV4ICsgMV0gPSBzaGFkZXJPYmplY3QuYW1iaWVudEcqdGhpcy5fYW1iaWVudEc7XHJcblx0XHRcdGRhdGFbaW5kZXggKyAyXSA9IHNoYWRlck9iamVjdC5hbWJpZW50Qip0aGlzLl9hbWJpZW50QjtcclxuXHRcdFx0ZGF0YVtpbmRleCArIDNdID0gMTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IERpZmZ1c2VCYXNpY01ldGhvZDsiXX0=