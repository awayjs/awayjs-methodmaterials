var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderCompilerHelper = require("awayjs-renderergl/lib/utils/ShaderCompilerHelper");
var LightingMethodBase = require("awayjs-methodmaterials/lib/methods/LightingMethodBase");
/**
 * SpecularBasicMethod provides the default shading method for Blinn-Phong specular highlights (an optimized but approximated
 * version of Phong specularity).
 */
var SpecularBasicMethod = (function (_super) {
    __extends(SpecularBasicMethod, _super);
    /**
     * Creates a new SpecularBasicMethod object.
     */
    function SpecularBasicMethod() {
        _super.call(this);
        this._gloss = 50;
        this._specular = 1;
        this._specularColor = 0xffffff;
        this._iSpecularR = 1;
        this._iSpecularG = 1;
        this._iSpecularB = 1;
    }
    SpecularBasicMethod.prototype.iIsUsed = function (shaderObject) {
        if (!shaderObject.numLights)
            return false;
        return true;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        methodVO.needsUV = this._pUseTexture;
        methodVO.needsNormals = shaderObject.numLights > 0;
        methodVO.needsView = shaderObject.numLights > 0;
    };
    Object.defineProperty(SpecularBasicMethod.prototype, "gloss", {
        /**
         * The sharpness of the specular highlight.
         */
        get: function () {
            return this._gloss;
        },
        set: function (value) {
            this._gloss = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SpecularBasicMethod.prototype, "specular", {
        /**
         * The overall strength of the specular highlights.
         */
        get: function () {
            return this._specular;
        },
        set: function (value) {
            if (value == this._specular)
                return;
            this._specular = value;
            this.updateSpecular();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SpecularBasicMethod.prototype, "specularColor", {
        /**
         * The colour of the specular reflection of the surface.
         */
        get: function () {
            return this._specularColor;
        },
        set: function (value) {
            if (this._specularColor == value)
                return;
            // specular is now either enabled or disabled
            if (this._specularColor == 0 || value == 0)
                this.iInvalidateShaderProgram();
            this._specularColor = value;
            this.updateSpecular();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SpecularBasicMethod.prototype, "texture", {
        /**
         * The bitmapData that encodes the specular highlight strength per texel in the red channel, and the sharpness
         * in the green channel. You can use SpecularBitmapTexture if you want to easily set specular and gloss maps
         * from grayscale images, but prepared images are preferred.
         */
        get: function () {
            return this._texture;
        },
        set: function (value) {
            var b = (value != null);
            if (b != this._pUseTexture || (value && this._texture && (value.format != this._texture.format)))
                this.iInvalidateShaderProgram();
            this._pUseTexture = b;
            this._texture = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.copyFrom = function (method) {
        var m = method;
        var bsm = method;
        var spec = bsm; //SpecularBasicMethod(method);
        this.texture = spec.texture;
        this.specular = spec.specular;
        this.specularColor = spec.specularColor;
        this.gloss = spec.gloss;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iCleanCompilationData = function () {
        _super.prototype.iCleanCompilationData.call(this);
        this._pTotalLightColorReg = null;
        this._pSpecularTextureRegister = null;
        this._pSpecularTexData = null;
        this._pSpecularDataRegister = null;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iGetFragmentPreLightingCode = function (shaderObject, methodVO, registerCache, sharedRegisters) {
        var code = "";
        this._pIsFirstLight = true;
        this._pSpecularDataRegister = registerCache.getFreeFragmentConstant();
        methodVO.fragmentConstantsIndex = this._pSpecularDataRegister.index * 4;
        if (this._pUseTexture) {
            this._pSpecularTexData = registerCache.getFreeFragmentVectorTemp();
            registerCache.addFragmentTempUsages(this._pSpecularTexData, 1);
            this._pSpecularTextureRegister = registerCache.getFreeTextureReg();
            methodVO.texturesIndex = this._pSpecularTextureRegister.index;
            code = ShaderCompilerHelper.getTex2DSampleCode(this._pSpecularTexData, sharedRegisters, this._pSpecularTextureRegister, this._texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);
        }
        else {
            this._pSpecularTextureRegister = null;
        }
        this._pTotalLightColorReg = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(this._pTotalLightColorReg, 1);
        return code;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iGetFragmentCodePerLight = function (shaderObject, methodVO, lightDirReg, lightColReg, registerCache, sharedRegisters) {
        var code = "";
        var t;
        if (this._pIsFirstLight) {
            t = this._pTotalLightColorReg;
        }
        else {
            t = registerCache.getFreeFragmentVectorTemp();
            registerCache.addFragmentTempUsages(t, 1);
        }
        var viewDirReg = sharedRegisters.viewDirFragment;
        var normalReg = sharedRegisters.normalFragment;
        // blinn-phong half vector model
        code += "add " + t + ", " + lightDirReg + ", " + viewDirReg + "\n" + "nrm " + t + ".xyz, " + t + "\n" + "dp3 " + t + ".w, " + normalReg + ", " + t + "\n" + "sat " + t + ".w, " + t + ".w\n";
        if (this._pUseTexture) {
            // apply gloss modulation from texture
            code += "mul " + this._pSpecularTexData + ".w, " + this._pSpecularTexData + ".y, " + this._pSpecularDataRegister + ".w\n" + "pow " + t + ".w, " + t + ".w, " + this._pSpecularTexData + ".w\n";
        }
        else {
            code += "pow " + t + ".w, " + t + ".w, " + this._pSpecularDataRegister + ".w\n";
        }
        // attenuate
        if (shaderObject.usesLightFallOff)
            code += "mul " + t + ".w, " + t + ".w, " + lightDirReg + ".w\n";
        if (this._iModulateMethod != null)
            code += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);
        code += "mul " + t + ".xyz, " + lightColReg + ", " + t + ".w\n";
        if (!this._pIsFirstLight) {
            code += "add " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + t + "\n";
            registerCache.removeFragmentTempUsage(t);
        }
        this._pIsFirstLight = false;
        return code;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iGetFragmentCodePerProbe = function (shaderObject, methodVO, cubeMapReg, weightRegister, registerCache, sharedRegisters) {
        var code = "";
        var t;
        // write in temporary if not first light, so we can add to total diffuse colour
        if (this._pIsFirstLight) {
            t = this._pTotalLightColorReg;
        }
        else {
            t = registerCache.getFreeFragmentVectorTemp();
            registerCache.addFragmentTempUsages(t, 1);
        }
        var normalReg = sharedRegisters.normalFragment;
        var viewDirReg = sharedRegisters.viewDirFragment;
        code += "dp3 " + t + ".w, " + normalReg + ", " + viewDirReg + "\n" + "add " + t + ".w, " + t + ".w, " + t + ".w\n" + "mul " + t + ", " + t + ".w, " + normalReg + "\n" + "sub " + t + ", " + t + ", " + viewDirReg + "\n" + "tex " + t + ", " + t + ", " + cubeMapReg + " <cube," + (shaderObject.useSmoothTextures ? "linear" : "nearest") + ",miplinear>\n" + "mul " + t + ".xyz, " + t + ", " + weightRegister + "\n";
        if (this._iModulateMethod != null)
            code += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);
        if (!this._pIsFirstLight) {
            code += "add " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + t + "\n";
            registerCache.removeFragmentTempUsage(t);
        }
        this._pIsFirstLight = false;
        return code;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iGetFragmentPostLightingCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var code = "";
        if (sharedRegisters.shadowTarget)
            code += "mul " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + sharedRegisters.shadowTarget + ".w\n";
        if (this._pUseTexture) {
            // apply strength modulation from texture
            code += "mul " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + this._pSpecularTexData + ".x\n";
            registerCache.removeFragmentTempUsage(this._pSpecularTexData);
        }
        // apply material's specular reflection
        code += "mul " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ", " + this._pSpecularDataRegister + "\n" + "add " + targetReg + ".xyz, " + targetReg + ", " + this._pTotalLightColorReg + "\n";
        registerCache.removeFragmentTempUsage(this._pTotalLightColorReg);
        return code;
    };
    /**
     * @inheritDoc
     */
    SpecularBasicMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        if (methodVO.texturesIndex >= 0)
            stage.activateTexture(methodVO.texturesIndex, this._texture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
        var index = methodVO.fragmentConstantsIndex;
        var data = shaderObject.fragmentConstantData;
        data[index] = this._iSpecularR;
        data[index + 1] = this._iSpecularG;
        data[index + 2] = this._iSpecularB;
        data[index + 3] = this._gloss;
    };
    /**
     * Updates the specular color data used by the render state.
     */
    SpecularBasicMethod.prototype.updateSpecular = function () {
        this._iSpecularR = ((this._specularColor >> 16) & 0xff) / 0xff * this._specular;
        this._iSpecularG = ((this._specularColor >> 8) & 0xff) / 0xff * this._specular;
        this._iSpecularB = (this._specularColor & 0xff) / 0xff * this._specular;
    };
    return SpecularBasicMethod;
})(LightingMethodBase);
module.exports = SpecularBasicMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU3BlY3VsYXJCYXNpY01ldGhvZC50cyJdLCJuYW1lcyI6WyJTcGVjdWxhckJhc2ljTWV0aG9kIiwiU3BlY3VsYXJCYXNpY01ldGhvZC5jb25zdHJ1Y3RvciIsIlNwZWN1bGFyQmFzaWNNZXRob2QuaUlzVXNlZCIsIlNwZWN1bGFyQmFzaWNNZXRob2QuaUluaXRWTyIsIlNwZWN1bGFyQmFzaWNNZXRob2QuZ2xvc3MiLCJTcGVjdWxhckJhc2ljTWV0aG9kLnNwZWN1bGFyIiwiU3BlY3VsYXJCYXNpY01ldGhvZC5zcGVjdWxhckNvbG9yIiwiU3BlY3VsYXJCYXNpY01ldGhvZC50ZXh0dXJlIiwiU3BlY3VsYXJCYXNpY01ldGhvZC5jb3B5RnJvbSIsIlNwZWN1bGFyQmFzaWNNZXRob2QuaUNsZWFuQ29tcGlsYXRpb25EYXRhIiwiU3BlY3VsYXJCYXNpY01ldGhvZC5pR2V0RnJhZ21lbnRQcmVMaWdodGluZ0NvZGUiLCJTcGVjdWxhckJhc2ljTWV0aG9kLmlHZXRGcmFnbWVudENvZGVQZXJMaWdodCIsIlNwZWN1bGFyQmFzaWNNZXRob2QuaUdldEZyYWdtZW50Q29kZVBlclByb2JlIiwiU3BlY3VsYXJCYXNpY01ldGhvZC5pR2V0RnJhZ21lbnRQb3N0TGlnaHRpbmdDb2RlIiwiU3BlY3VsYXJCYXNpY01ldGhvZC5pQWN0aXZhdGUiLCJTcGVjdWxhckJhc2ljTWV0aG9kLnVwZGF0ZVNwZWN1bGFyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFRQSxJQUFPLG9CQUFvQixXQUFhLGtEQUFrRCxDQUFDLENBQUM7QUFHNUYsSUFBTyxrQkFBa0IsV0FBYSx1REFBdUQsQ0FBQyxDQUFDO0FBRy9GLEFBSUE7OztHQURHO0lBQ0csbUJBQW1CO0lBQVNBLFVBQTVCQSxtQkFBbUJBLFVBQTJCQTtJQWtCbkRBOztPQUVHQTtJQUNIQSxTQXJCS0EsbUJBQW1CQTtRQXVCdkJDLGlCQUFPQSxDQUFDQTtRQWJEQSxXQUFNQSxH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SUEsR0FDaEVBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLFFBQVFBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQ2hDQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUNqREEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFbkNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZCQSxBQUNBQSxzQ0FEc0NBO1lBQ3RDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxNQUFNQSxHQUN2SEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUN0RUEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUNqRkEsQ0FBQ0E7UUFFREEsQUFDQUEsWUFEWUE7UUFDWkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQTtZQUNqQ0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsV0FBV0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFakVBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsSUFBSUEsSUFBSUEsQ0FBQ0E7WUFDakNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsWUFBWUEsRUFBRUEsUUFBUUEsRUFBRUEsQ0FBQ0EsRUFBRUEsYUFBYUEsRUFBRUEsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFFMUZBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLFFBQVFBLEdBQUdBLFdBQVdBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBO1FBRWhFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxQkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3BHQSxhQUFhQSxDQUFDQSx1QkFBdUJBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQzFDQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUU1QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFFRFg7O09BRUdBO0lBQ0lBLHNEQUF3QkEsR0FBL0JBLFVBQWdDQSxZQUFpQ0EsRUFBRUEsUUFBaUJBLEVBQUVBLFVBQWdDQSxFQUFFQSxjQUFxQkEsRUFBRUEsYUFBaUNBLEVBQUVBLGVBQWtDQTtRQUVuTlksSUFBSUEsSUFBSUEsR0FBVUEsRUFBRUEsQ0FBQ0E7UUFDckJBLElBQUlBLENBQXVCQSxDQUFDQTtRQUU1QkEsQUFDQUEsK0VBRCtFQTtRQUMvRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDekJBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0E7UUFDL0JBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLENBQUNBLEdBQUdBLGFBQWFBLENBQUNBLHlCQUF5QkEsRUFBRUEsQ0FBQ0E7WUFDOUNBLGFBQWFBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0NBLENBQUNBO1FBRURBLElBQUlBLFNBQVNBLEdBQXlCQSxlQUFlQSxDQUFDQSxjQUFjQSxDQUFDQTtRQUNyRUEsSUFBSUEsVUFBVUEsR0FBeUJBLGVBQWVBLENBQUNBLGVBQWVBLENBQUNBO1FBRXZFQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxJQUFJQSxHQUFHQSxVQUFVQSxHQUFHQSxJQUFJQSxHQUNoRUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FDN0NBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQ2pEQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFHQSxVQUFVQSxHQUFHQSxJQUFJQSxHQUNoREEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsVUFBVUEsR0FBR0EsU0FBU0EsR0FBR0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsaUJBQWlCQSxHQUFFQSxRQUFRQSxHQUFDQSxTQUFTQSxDQUFDQSxHQUFHQSxlQUFlQSxHQUM5SEEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsR0FBR0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFM0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlB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LENBQUMiLCJmaWxlIjoibWV0aG9kcy9TcGVjdWxhckJhc2ljTWV0aG9kLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUZXh0dXJlMkRCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZTJEQmFzZVwiKTtcclxuXHJcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xyXG5cclxuaW1wb3J0IFNoYWRlckxpZ2h0aW5nT2JqZWN0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0XCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJIZWxwZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvdXRpbHMvU2hhZGVyQ29tcGlsZXJIZWxwZXJcIik7XHJcblxyXG5pbXBvcnQgTWV0aG9kVk9cdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9kYXRhL01ldGhvZFZPXCIpO1xyXG5pbXBvcnQgTGlnaHRpbmdNZXRob2RCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvbWV0aG9kcy9MaWdodGluZ01ldGhvZEJhc2VcIik7XHJcbmltcG9ydCBTaGFkaW5nTWV0aG9kQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZGluZ01ldGhvZEJhc2VcIik7XHJcblxyXG4vKipcclxuICogU3BlY3VsYXJCYXNpY01ldGhvZCBwcm92aWRlcyB0aGUgZGVmYXVsdCBzaGFkaW5nIG1ldGhvZCBmb3IgQmxpbm4tUGhvbmcgc3BlY3VsYXIgaGlnaGxpZ2h0cyAoYW4gb3B0aW1pemVkIGJ1dCBhcHByb3hpbWF0ZWRcclxuICogdmVyc2lvbiBvZiBQaG9uZyBzcGVjdWxhcml0eSkuXHJcbiAqL1xyXG5jbGFzcyBTcGVjdWxhckJhc2ljTWV0aG9kIGV4dGVuZHMgTGlnaHRpbmdNZXRob2RCYXNlXHJcbntcclxuXHRwdWJsaWMgX3BVc2VUZXh0dXJlOmJvb2xlYW47XHJcblx0cHVibGljIF9wVG90YWxMaWdodENvbG9yUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcclxuXHRwdWJsaWMgX3BTcGVjdWxhclRleHR1cmVSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XHJcblx0cHVibGljIF9wU3BlY3VsYXJUZXhEYXRhOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcclxuXHRwdWJsaWMgX3BTcGVjdWxhckRhdGFSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XHJcblxyXG5cdHByaXZhdGUgX3RleHR1cmU6VGV4dHVyZTJEQmFzZTtcclxuXHJcblx0cHJpdmF0ZSBfZ2xvc3M6bnVtYmVyID0gNTA7XHJcblx0cHJpdmF0ZSBfc3BlY3VsYXI6bnVtYmVyID0gMTtcclxuXHRwcml2YXRlIF9zcGVjdWxhckNvbG9yOm51bWJlciA9IDB4ZmZmZmZmO1xyXG5cdHB1YmxpYyBfaVNwZWN1bGFyUjpudW1iZXIgPSAxO1xyXG5cdHB1YmxpYyBfaVNwZWN1bGFyRzpudW1iZXIgPSAxO1xyXG5cdHB1YmxpYyBfaVNwZWN1bGFyQjpudW1iZXIgPSAxO1xyXG5cdHB1YmxpYyBfcElzRmlyc3RMaWdodDpib29sZWFuO1xyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIGEgbmV3IFNwZWN1bGFyQmFzaWNNZXRob2Qgb2JqZWN0LlxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKClcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGlJc1VzZWQoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0KTpib29sZWFuXHJcblx0e1xyXG5cdFx0aWYgKCFzaGFkZXJPYmplY3QubnVtTGlnaHRzKVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpSW5pdFZPKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8pXHJcblx0e1xyXG5cdFx0bWV0aG9kVk8ubmVlZHNVViA9IHRoaXMuX3BVc2VUZXh0dXJlO1xyXG5cdFx0bWV0aG9kVk8ubmVlZHNOb3JtYWxzID0gc2hhZGVyT2JqZWN0Lm51bUxpZ2h0cyA+IDA7XHJcblx0XHRtZXRob2RWTy5uZWVkc1ZpZXcgPSBzaGFkZXJPYmplY3QubnVtTGlnaHRzID4gMDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSBzaGFycG5lc3Mgb2YgdGhlIHNwZWN1bGFyIGhpZ2hsaWdodC5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGdsb3NzKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2dsb3NzO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBnbG9zcyh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fZ2xvc3MgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSBvdmVyYWxsIHN0cmVuZ3RoIG9mIHRoZSBzcGVjdWxhciBoaWdobGlnaHRzLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgc3BlY3VsYXIoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fc3BlY3VsYXI7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHNwZWN1bGFyKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHRpZiAodmFsdWUgPT0gdGhpcy5fc3BlY3VsYXIpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl9zcGVjdWxhciA9IHZhbHVlO1xyXG5cdFx0dGhpcy51cGRhdGVTcGVjdWxhcigpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVGhlIGNvbG91ciBvZiB0aGUgc3BlY3VsYXIgcmVmbGVjdGlvbiBvZiB0aGUgc3VyZmFjZS5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHNwZWN1bGFyQ29sb3IoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fc3BlY3VsYXJDb2xvcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgc3BlY3VsYXJDb2xvcih2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3NwZWN1bGFyQ29sb3IgPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHQvLyBzcGVjdWxhciBpcyBub3cgZWl0aGVyIGVuYWJsZWQgb3IgZGlzYWJsZWRcclxuXHRcdGlmICh0aGlzLl9zcGVjdWxhckNvbG9yID09IDAgfHwgdmFsdWUgPT0gMClcclxuXHRcdFx0dGhpcy5pSW52YWxpZGF0ZVNoYWRlclByb2dyYW0oKTtcclxuXHJcblx0XHR0aGlzLl9zcGVjdWxhckNvbG9yID0gdmFsdWU7XHJcblx0XHR0aGlzLnVwZGF0ZVNwZWN1bGFyKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgYml0bWFwRGF0YSB0aGF0IGVuY29kZXMgdGhlIHNwZWN1bGFyIGhpZ2hsaWdodCBzdHJlbmd0aCBwZXIgdGV4ZWwgaW4gdGhlIHJlZCBjaGFubmVsLCBhbmQgdGhlIHNoYXJwbmVzc1xyXG5cdCAqIGluIHRoZSBncmVlbiBjaGFubmVsLiBZb3UgY2FuIHVzZSBTcGVjdWxhckJpdG1hcFRleHR1cmUgaWYgeW91IHdhbnQgdG8gZWFzaWx5IHNldCBzcGVjdWxhciBhbmQgZ2xvc3MgbWFwc1xyXG5cdCAqIGZyb20gZ3JheXNjYWxlIGltYWdlcywgYnV0IHByZXBhcmVkIGltYWdlcyBhcmUgcHJlZmVycmVkLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgdGV4dHVyZSgpOlRleHR1cmUyREJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgdGV4dHVyZSh2YWx1ZTpUZXh0dXJlMkRCYXNlKVxyXG5cdHtcclxuXHRcdHZhciBiOmJvb2xlYW4gPSAoIHZhbHVlICE9IG51bGwgKTtcclxuXHJcblx0XHRpZiAoYiAhPSB0aGlzLl9wVXNlVGV4dHVyZSB8fCAodmFsdWUgJiYgdGhpcy5fdGV4dHVyZSAmJiAodmFsdWUuZm9ybWF0ICE9IHRoaXMuX3RleHR1cmUuZm9ybWF0KSkpXHJcblx0XHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XHJcblxyXG5cdFx0dGhpcy5fcFVzZVRleHR1cmUgPSBiO1xyXG5cdFx0dGhpcy5fdGV4dHVyZSA9IHZhbHVlO1xyXG5cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGNvcHlGcm9tKG1ldGhvZDpTaGFkaW5nTWV0aG9kQmFzZSlcclxuXHR7XHJcblxyXG5cdFx0dmFyIG06YW55ID0gbWV0aG9kO1xyXG5cdFx0dmFyIGJzbTpTcGVjdWxhckJhc2ljTWV0aG9kID0gPFNwZWN1bGFyQmFzaWNNZXRob2Q+IG1ldGhvZDtcclxuXHJcblx0XHR2YXIgc3BlYzpTcGVjdWxhckJhc2ljTWV0aG9kID0gYnNtOy8vU3BlY3VsYXJCYXNpY01ldGhvZChtZXRob2QpO1xyXG5cdFx0dGhpcy50ZXh0dXJlID0gc3BlYy50ZXh0dXJlO1xyXG5cdFx0dGhpcy5zcGVjdWxhciA9IHNwZWMuc3BlY3VsYXI7XHJcblx0XHR0aGlzLnNwZWN1bGFyQ29sb3IgPSBzcGVjLnNwZWN1bGFyQ29sb3I7XHJcblx0XHR0aGlzLmdsb3NzID0gc3BlYy5nbG9zcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlDbGVhbkNvbXBpbGF0aW9uRGF0YSgpXHJcblx0e1xyXG5cdFx0c3VwZXIuaUNsZWFuQ29tcGlsYXRpb25EYXRhKCk7XHJcblx0XHR0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnID0gbnVsbDtcclxuXHRcdHRoaXMuX3BTcGVjdWxhclRleHR1cmVSZWdpc3RlciA9IG51bGw7XHJcblx0XHR0aGlzLl9wU3BlY3VsYXJUZXhEYXRhID0gbnVsbDtcclxuXHRcdHRoaXMuX3BTcGVjdWxhckRhdGFSZWdpc3RlciA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRQcmVMaWdodGluZ0NvZGUoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTywgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcclxuXHR7XHJcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xyXG5cclxuXHRcdHRoaXMuX3BJc0ZpcnN0TGlnaHQgPSB0cnVlO1xyXG5cclxuXHRcdHRoaXMuX3BTcGVjdWxhckRhdGFSZWdpc3RlciA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcclxuXHRcdG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSB0aGlzLl9wU3BlY3VsYXJEYXRhUmVnaXN0ZXIuaW5kZXgqNDtcclxuXHJcblx0XHRpZiAodGhpcy5fcFVzZVRleHR1cmUpIHtcclxuXHJcblx0XHRcdHRoaXMuX3BTcGVjdWxhclRleERhdGEgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModGhpcy5fcFNwZWN1bGFyVGV4RGF0YSwgMSk7XHJcblx0XHRcdHRoaXMuX3BTcGVjdWxhclRleHR1cmVSZWdpc3RlciA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVRleHR1cmVSZWcoKTtcclxuXHRcdFx0bWV0aG9kVk8udGV4dHVyZXNJbmRleCA9IHRoaXMuX3BTcGVjdWxhclRleHR1cmVSZWdpc3Rlci5pbmRleDtcclxuXHRcdFx0Y29kZSA9IFNoYWRlckNvbXBpbGVySGVscGVyLmdldFRleDJEU2FtcGxlQ29kZSh0aGlzLl9wU3BlY3VsYXJUZXhEYXRhLCBzaGFyZWRSZWdpc3RlcnMsIHRoaXMuX3BTcGVjdWxhclRleHR1cmVSZWdpc3RlciwgdGhpcy5fdGV4dHVyZSwgc2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzLCBzaGFkZXJPYmplY3QucmVwZWF0VGV4dHVyZXMsIHNoYWRlck9iamVjdC51c2VNaXBtYXBwaW5nKTtcclxuXHJcblx0XHR9IGVsc2Uge1xyXG5cclxuXHRcdFx0dGhpcy5fcFNwZWN1bGFyVGV4dHVyZVJlZ2lzdGVyID0gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XHJcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnLCAxKTtcclxuXHJcblx0XHRyZXR1cm4gY29kZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlHZXRGcmFnbWVudENvZGVQZXJMaWdodChzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPLCBsaWdodERpclJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGxpZ2h0Q29sUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcclxuXHR7XHJcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xyXG5cdFx0dmFyIHQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xyXG5cclxuXHRcdGlmICh0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XHJcblx0XHRcdHQgPSB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh0LCAxKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgdmlld0RpclJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBzaGFyZWRSZWdpc3RlcnMudmlld0RpckZyYWdtZW50O1xyXG5cdFx0dmFyIG5vcm1hbFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBzaGFyZWRSZWdpc3RlcnMubm9ybWFsRnJhZ21lbnQ7XHJcblxyXG5cdFx0Ly8gYmxpbm4tcGhvbmcgaGFsZiB2ZWN0b3IgbW9kZWxcclxuXHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0ICsgXCIsIFwiICsgbGlnaHREaXJSZWcgKyBcIiwgXCIgKyB2aWV3RGlyUmVnICsgXCJcXG5cIiArXHJcblx0XHRcdFx0XCJucm0gXCIgKyB0ICsgXCIueHl6LCBcIiArIHQgKyBcIlxcblwiICtcclxuXHRcdFx0XHRcImRwMyBcIiArIHQgKyBcIi53LCBcIiArIG5vcm1hbFJlZyArIFwiLCBcIiArIHQgKyBcIlxcblwiICtcclxuXHRcdFx0XHRcInNhdCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53XFxuXCI7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BVc2VUZXh0dXJlKSB7XHJcblx0XHRcdC8vIGFwcGx5IGdsb3NzIG1vZHVsYXRpb24gZnJvbSB0ZXh0dXJlXHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0aGlzLl9wU3BlY3VsYXJUZXhEYXRhICsgXCIudywgXCIgKyB0aGlzLl9wU3BlY3VsYXJUZXhEYXRhICsgXCIueSwgXCIgKyB0aGlzLl9wU3BlY3VsYXJEYXRhUmVnaXN0ZXIgKyBcIi53XFxuXCIgK1xyXG5cdFx0XHRcdFx0XCJwb3cgXCIgKyB0ICsgXCIudywgXCIgKyB0ICsgXCIudywgXCIgKyB0aGlzLl9wU3BlY3VsYXJUZXhEYXRhICsgXCIud1xcblwiO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y29kZSArPSBcInBvdyBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53LCBcIiArIHRoaXMuX3BTcGVjdWxhckRhdGFSZWdpc3RlciArIFwiLndcXG5cIjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBhdHRlbnVhdGVcclxuXHRcdGlmIChzaGFkZXJPYmplY3QudXNlc0xpZ2h0RmFsbE9mZilcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53LCBcIiArIGxpZ2h0RGlyUmVnICsgXCIud1xcblwiO1xyXG5cclxuXHRcdGlmICh0aGlzLl9pTW9kdWxhdGVNZXRob2QgIT0gbnVsbClcclxuXHRcdFx0Y29kZSArPSB0aGlzLl9pTW9kdWxhdGVNZXRob2Qoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgdCwgcmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzKTtcclxuXHJcblx0XHRjb2RlICs9IFwibXVsIFwiICsgdCArIFwiLnh5eiwgXCIgKyBsaWdodENvbFJlZyArIFwiLCBcIiArIHQgKyBcIi53XFxuXCI7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XHJcblx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnICsgXCIueHl6LCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIiwgXCIgKyB0ICsgXCJcXG5cIjtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh0KTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9wSXNGaXJzdExpZ2h0ID0gZmFsc2U7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRDb2RlUGVyUHJvYmUoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTywgY3ViZU1hcFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHdlaWdodFJlZ2lzdGVyOnN0cmluZywgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcclxuXHR7XHJcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xyXG5cdFx0dmFyIHQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xyXG5cclxuXHRcdC8vIHdyaXRlIGluIHRlbXBvcmFyeSBpZiBub3QgZmlyc3QgbGlnaHQsIHNvIHdlIGNhbiBhZGQgdG8gdG90YWwgZGlmZnVzZSBjb2xvdXJcclxuXHRcdGlmICh0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XHJcblx0XHRcdHQgPSB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh0LCAxKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgbm9ybWFsUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHNoYXJlZFJlZ2lzdGVycy5ub3JtYWxGcmFnbWVudDtcclxuXHRcdHZhciB2aWV3RGlyUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHNoYXJlZFJlZ2lzdGVycy52aWV3RGlyRnJhZ21lbnQ7XHJcblxyXG5cdFx0Y29kZSArPSBcImRwMyBcIiArIHQgKyBcIi53LCBcIiArIG5vcm1hbFJlZyArIFwiLCBcIiArIHZpZXdEaXJSZWcgKyBcIlxcblwiICtcclxuXHRcdFx0XHRcImFkZCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53XFxuXCIgK1xyXG5cdFx0XHRcdFwibXVsIFwiICsgdCArIFwiLCBcIiArIHQgKyBcIi53LCBcIiArIG5vcm1hbFJlZyArIFwiXFxuXCIgK1xyXG5cdFx0XHRcdFwic3ViIFwiICsgdCArIFwiLCBcIiArIHQgKyBcIiwgXCIgKyB2aWV3RGlyUmVnICsgXCJcXG5cIiArXHJcblx0XHRcdFx0XCJ0ZXggXCIgKyB0ICsgXCIsIFwiICsgdCArIFwiLCBcIiArIGN1YmVNYXBSZWcgKyBcIiA8Y3ViZSxcIiArIChzaGFkZXJPYmplY3QudXNlU21vb3RoVGV4dHVyZXM/IFwibGluZWFyXCI6XCJuZWFyZXN0XCIpICsgXCIsbWlwbGluZWFyPlxcblwiICtcclxuXHRcdFx0XHRcIm11bCBcIiArIHQgKyBcIi54eXosIFwiICsgdCArIFwiLCBcIiArIHdlaWdodFJlZ2lzdGVyICsgXCJcXG5cIjtcclxuXHJcblx0XHRpZiAodGhpcy5faU1vZHVsYXRlTWV0aG9kICE9IG51bGwpXHJcblx0XHRcdGNvZGUgKz0gdGhpcy5faU1vZHVsYXRlTWV0aG9kKHNoYWRlck9iamVjdCwgbWV0aG9kVk8sIHQsIHJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVycyk7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XHJcblx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnICsgXCIueHl6LCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIiwgXCIgKyB0ICsgXCJcXG5cIjtcclxuXHRcdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh0KTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9wSXNGaXJzdExpZ2h0ID0gZmFsc2U7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRQb3N0TGlnaHRpbmdDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8sIHRhcmdldFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHJcblx0XHRpZiAoc2hhcmVkUmVnaXN0ZXJzLnNoYWRvd1RhcmdldClcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIi54eXosIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLCBcIiArIHNoYXJlZFJlZ2lzdGVycy5zaGFkb3dUYXJnZXQgKyBcIi53XFxuXCI7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BVc2VUZXh0dXJlKSB7XHJcblx0XHRcdC8vIGFwcGx5IHN0cmVuZ3RoIG1vZHVsYXRpb24gZnJvbSB0ZXh0dXJlXHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnICsgXCIueHl6LCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIiwgXCIgKyB0aGlzLl9wU3BlY3VsYXJUZXhEYXRhICsgXCIueFxcblwiO1xyXG5cdFx0XHRyZWdpc3RlckNhY2hlLnJlbW92ZUZyYWdtZW50VGVtcFVzYWdlKHRoaXMuX3BTcGVjdWxhclRleERhdGEpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGFwcGx5IG1hdGVyaWFsJ3Mgc3BlY3VsYXIgcmVmbGVjdGlvblxyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIi54eXosIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLCBcIiArIHRoaXMuX3BTcGVjdWxhckRhdGFSZWdpc3RlciArIFwiXFxuXCIgK1xyXG5cdFx0XHRcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLnh5eiwgXCIgKyB0YXJnZXRSZWcgKyBcIiwgXCIgKyB0aGlzLl9wVG90YWxMaWdodENvbG9yUmVnICsgXCJcXG5cIjtcclxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyk7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpQWN0aXZhdGUoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTywgc3RhZ2U6U3RhZ2UpXHJcblx0e1xyXG5cdFx0aWYgKG1ldGhvZFZPLnRleHR1cmVzSW5kZXggPj0gMClcclxuXHRcdFx0c3RhZ2UuYWN0aXZhdGVUZXh0dXJlKG1ldGhvZFZPLnRleHR1cmVzSW5kZXgsIHRoaXMuX3RleHR1cmUsIHNoYWRlck9iamVjdC5yZXBlYXRUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzLCBzaGFkZXJPYmplY3QudXNlTWlwbWFwcGluZyk7XHJcblxyXG5cdFx0dmFyIGluZGV4Om51bWJlciA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XHJcblx0XHR2YXIgZGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LmZyYWdtZW50Q29uc3RhbnREYXRhO1xyXG5cdFx0ZGF0YVtpbmRleF0gPSB0aGlzLl9pU3BlY3VsYXJSO1xyXG5cdFx0ZGF0YVtpbmRleCArIDFdID0gdGhpcy5faVNwZWN1bGFyRztcclxuXHRcdGRhdGFbaW5kZXggKyAyXSA9IHRoaXMuX2lTcGVjdWxhckI7XHJcblx0XHRkYXRhW2luZGV4ICsgM10gPSB0aGlzLl9nbG9zcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFVwZGF0ZXMgdGhlIHNwZWN1bGFyIGNvbG9yIGRhdGEgdXNlZCBieSB0aGUgcmVuZGVyIHN0YXRlLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgdXBkYXRlU3BlY3VsYXIoKVxyXG5cdHtcclxuXHRcdHRoaXMuX2lTcGVjdWxhclIgPSAoKCB0aGlzLl9zcGVjdWxhckNvbG9yID4+IDE2KSAmIDB4ZmYpLzB4ZmYqdGhpcy5fc3BlY3VsYXI7XHJcblx0XHR0aGlzLl9pU3BlY3VsYXJHID0gKCggdGhpcy5fc3BlY3VsYXJDb2xvciA+PiA4KSAmIDB4ZmYpLzB4ZmYqdGhpcy5fc3BlY3VsYXI7XHJcblx0XHR0aGlzLl9pU3BlY3VsYXJCID0gKCB0aGlzLl9zcGVjdWxhckNvbG9yICYgMHhmZikvMHhmZip0aGlzLl9zcGVjdWxhcjtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IFNwZWN1bGFyQmFzaWNNZXRob2Q7Il19