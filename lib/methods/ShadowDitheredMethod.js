var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var BitmapData = require("awayjs-core/lib/data/BitmapData");
var BitmapTexture = require("awayjs-core/lib/textures/BitmapTexture");
var ShadowMethodBase = require("awayjs-methodmaterials/lib/methods/ShadowMethodBase");
/**
 * ShadowDitheredMethod provides a soft shadowing technique by randomly distributing sample points differently for each fragment.
 */
var ShadowDitheredMethod = (function (_super) {
    __extends(ShadowDitheredMethod, _super);
    /**
     * Creates a new ShadowDitheredMethod object.
     * @param castingLight The light casting the shadows
     * @param numSamples The amount of samples to take for dithering. Minimum 1, maximum 24.
     */
    function ShadowDitheredMethod(castingLight, numSamples, range) {
        if (numSamples === void 0) { numSamples = 4; }
        if (range === void 0) { range = 1; }
        _super.call(this, castingLight);
        this._depthMapSize = this._pCastingLight.shadowMapper.depthMapSize;
        this.numSamples = numSamples;
        this.range = range;
        ++ShadowDitheredMethod._grainUsages;
        if (!ShadowDitheredMethod._grainTexture)
            this.initGrainTexture();
    }
    Object.defineProperty(ShadowDitheredMethod.prototype, "numSamples", {
        /**
         * The amount of samples to take for dithering. Minimum 1, maximum 24. The actual maximum may depend on the
         * complexity of the shader.
         */
        get: function () {
            return this._numSamples;
        },
        set: function (value /*int*/) {
            this._numSamples = value;
            if (this._numSamples < 1)
                this._numSamples = 1;
            else if (this._numSamples > 24)
                this._numSamples = 24;
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        _super.prototype.iInitVO.call(this, shaderObject, methodVO);
        methodVO.needsProjection = true;
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        _super.prototype.iInitConstants.call(this, shaderObject, methodVO);
        var fragmentData = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index + 8] = 1 / this._numSamples;
    };
    Object.defineProperty(ShadowDitheredMethod.prototype, "range", {
        /**
         * The range in the shadow map in which to distribute the samples.
         */
        get: function () {
            return this._range * 2;
        },
        set: function (value) {
            this._range = value / 2;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Creates a texture containing the dithering noise texture.
     */
    ShadowDitheredMethod.prototype.initGrainTexture = function () {
        ShadowDitheredMethod._grainBitmapData = new BitmapData(64, 64, false);
        var vec = new Array();
        var len = 4096;
        var step = 1 / (this._depthMapSize * this._range);
        var r, g;
        for (var i = 0; i < len; ++i) {
            r = 2 * (Math.random() - .5);
            g = 2 * (Math.random() - .5);
            if (r < 0)
                r -= step;
            else
                r += step;
            if (g < 0)
                g -= step;
            else
                g += step;
            if (r > 1)
                r = 1;
            else if (r < -1)
                r = -1;
            if (g > 1)
                g = 1;
            else if (g < -1)
                g = -1;
            vec[i] = (Math.floor((r * .5 + .5) * 0xff) << 16) | (Math.floor((g * .5 + .5) * 0xff) << 8);
        }
        ShadowDitheredMethod._grainBitmapData.setArray(ShadowDitheredMethod._grainBitmapData.rect, vec);
        ShadowDitheredMethod._grainTexture = new BitmapTexture(ShadowDitheredMethod._grainBitmapData);
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.dispose = function () {
        if (--ShadowDitheredMethod._grainUsages == 0) {
            ShadowDitheredMethod._grainTexture.dispose();
            ShadowDitheredMethod._grainBitmapData.dispose();
            ShadowDitheredMethod._grainTexture = null;
        }
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        _super.prototype.iActivate.call(this, shaderObject, methodVO, stage);
        var data = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        data[index + 9] = (stage.width - 1) / 63;
        data[index + 10] = (stage.height - 1) / 63;
        data[index + 11] = 2 * this._range / this._depthMapSize;
        stage.activateTexture(methodVO.texturesIndex + 1, ShadowDitheredMethod._grainTexture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype._pGetPlanarFragmentCode = function (methodVO, targetReg, regCache, sharedRegisters) {
        var depthMapRegister = regCache.getFreeTextureReg();
        var decReg = regCache.getFreeFragmentConstant();
        var dataReg = regCache.getFreeFragmentConstant();
        var customDataReg = regCache.getFreeFragmentConstant();
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        methodVO.texturesIndex = depthMapRegister.index;
        return this.getSampleCode(customDataReg, depthMapRegister, decReg, targetReg, regCache, sharedRegisters);
    };
    /**
     * Get the actual shader code for shadow mapping
     * @param regCache The register cache managing the registers.
     * @param depthMapRegister The texture register containing the depth map.
     * @param decReg The register containing the depth map decoding data.
     * @param targetReg The target register to add the shadow coverage.
     */
    ShadowDitheredMethod.prototype.getSampleCode = function (customDataReg, depthMapRegister, decReg, targetReg, regCache, sharedRegisters) {
        var code = "";
        var grainRegister = regCache.getFreeTextureReg();
        var uvReg = regCache.getFreeFragmentVectorTemp();
        var numSamples = this._numSamples;
        regCache.addFragmentTempUsages(uvReg, 1);
        var temp = regCache.getFreeFragmentVectorTemp();
        var projectionReg = sharedRegisters.projectionFragment;
        code += "div " + uvReg + ", " + projectionReg + ", " + projectionReg + ".w\n" + "mul " + uvReg + ".xy, " + uvReg + ".xy, " + customDataReg + ".yz\n";
        while (numSamples > 0) {
            if (numSamples == this._numSamples)
                code += "tex " + uvReg + ", " + uvReg + ", " + grainRegister + " <2d,nearest,repeat,mipnone>\n";
            else
                code += "tex " + uvReg + ", " + uvReg + ".zwxy, " + grainRegister + " <2d,nearest,repeat,mipnone>\n";
            // keep grain in uvReg.zw
            code += "sub " + uvReg + ".zw, " + uvReg + ".xy, fc0.xx\n" + "mul " + uvReg + ".zw, " + uvReg + ".zw, " + customDataReg + ".w\n"; // (tex unpack scale and tex scale in one)
            if (numSamples == this._numSamples) {
                // first sample
                code += "add " + uvReg + ".xy, " + uvReg + ".zw, " + this._pDepthMapCoordReg + ".xy\n" + "tex " + temp + ", " + uvReg + ", " + depthMapRegister + " <2d,nearest,clamp,mipnone>\n" + "dp4 " + temp + ".z, " + temp + ", " + decReg + "\n" + "slt " + targetReg + ".w, " + this._pDepthMapCoordReg + ".z, " + temp + ".z\n"; // 0 if in shadow
            }
            else {
                code += this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            }
            if (numSamples > 4)
                code += "add " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".zw\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 1)
                code += "sub " + uvReg + ".xy, " + this._pDepthMapCoordReg + ".xy, " + uvReg + ".zw\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 5)
                code += "sub " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".zw\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 2) {
                code += "neg " + uvReg + ".w, " + uvReg + ".w\n"; // will be rotated 90 degrees when being accessed as wz
                code += "add " + uvReg + ".xy, " + uvReg + ".wz, " + this._pDepthMapCoordReg + ".xy\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            }
            if (numSamples > 6)
                code += "add " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".wz\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 3)
                code += "sub " + uvReg + ".xy, " + this._pDepthMapCoordReg + ".xy, " + uvReg + ".wz\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 7)
                code += "sub " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".wz\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            numSamples -= 8;
        }
        regCache.removeFragmentTempUsage(uvReg);
        code += "mul " + targetReg + ".w, " + targetReg + ".w, " + customDataReg + ".x\n"; // average
        return code;
    };
    /**
     * Adds the code for another tap to the shader code.
     * @param uvReg The uv register for the tap.
     * @param depthMapRegister The texture register containing the depth map.
     * @param decReg The register containing the depth map decoding data.
     * @param targetReg The target register to add the tap comparison result.
     * @param regCache The register cache managing the registers.
     * @return
     */
    ShadowDitheredMethod.prototype.addSample = function (uvReg, depthMapRegister, decReg, targetReg, regCache) {
        var temp = regCache.getFreeFragmentVectorTemp();
        return "tex " + temp + ", " + uvReg + ", " + depthMapRegister + " <2d,nearest,clamp,mipnone>\n" + "dp4 " + temp + ".z, " + temp + ", " + decReg + "\n" + "slt " + temp + ".z, " + this._pDepthMapCoordReg + ".z, " + temp + ".z\n" + "add " + targetReg + ".w, " + targetReg + ".w, " + temp + ".z\n";
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iActivateForCascade = function (shaderObject, methodVO, stage) {
        var data = shaderObject.fragmentConstantData;
        var index = methodVO.secondaryFragmentConstantsIndex;
        data[index] = 1 / this._numSamples;
        data[index + 1] = (stage.width - 1) / 63;
        data[index + 2] = (stage.height - 1) / 63;
        data[index + 3] = 2 * this._range / this._depthMapSize;
        stage.activateTexture(methodVO.texturesIndex + 1, ShadowDitheredMethod._grainTexture, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype._iGetCascadeFragmentCode = function (shaderObject, methodVO, decodeRegister, depthTexture, depthProjection, targetRegister, registerCache, sharedRegisters) {
        this._pDepthMapCoordReg = depthProjection;
        var dataReg = registerCache.getFreeFragmentConstant();
        methodVO.secondaryFragmentConstantsIndex = dataReg.index * 4;
        return this.getSampleCode(dataReg, depthTexture, decodeRegister, targetRegister, registerCache, sharedRegisters);
    };
    return ShadowDitheredMethod;
})(ShadowMethodBase);
module.exports = ShadowDitheredMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvU2hhZG93RGl0aGVyZWRNZXRob2QudHMiXSwibmFtZXMiOlsiU2hhZG93RGl0aGVyZWRNZXRob2QiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5jb25zdHJ1Y3RvciIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLm51bVNhbXBsZXMiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5pSW5pdFZPIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuaUluaXRDb25zdGFudHMiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5yYW5nZSIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLmluaXRHcmFpblRleHR1cmUiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5kaXNwb3NlIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuaUFjdGl2YXRlIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuX3BHZXRQbGFuYXJGcmFnbWVudENvZGUiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5nZXRTYW1wbGVDb2RlIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuYWRkU2FtcGxlIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuaUFjdGl2YXRlRm9yQ2FzY2FkZSIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLl9pR2V0Q2FzY2FkZUZyYWdtZW50Q29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxVQUFVLFdBQWdCLGlDQUFpQyxDQUFDLENBQUM7QUFDcEUsSUFBTyxhQUFhLFdBQWUsd0NBQXdDLENBQUMsQ0FBQztBQWE3RSxJQUFPLGdCQUFnQixXQUFlLHFEQUFxRCxDQUFDLENBQUM7QUFFN0YsQUFHQTs7R0FERztJQUNHLG9CQUFvQjtJQUFTQSxVQUE3QkEsb0JBQW9CQSxVQUF5QkE7SUFTbERBOzs7O09BSUdBO0lBQ0hBLFNBZEtBLG9CQUFvQkEsQ0FjYkEsWUFBNkJBLEVBQUVBLFVBQTZCQSxFQUFFQSxLQUFnQkE7UUFBL0NDLDBCQUE2QkEsR0FBN0JBLGNBQTZCQTtRQUFFQSxx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QSxHQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNyREEsSUFBSUEsQ0FBUUEsRUFBRUEsQ0FBUUEsQ0FBQ0E7UUFFdkJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQW1CQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUM5Q0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBO1lBQzNCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVEEsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0E7WUFBQ0EsSUFBSUE7Z0JBQ2ZBLENBQUNBLElBQUlBLElBQUlBLENBQUNBO1lBQ1hBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNUQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQTtZQUFDQSxJQUFJQTtnQkFDZkEsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUN2QkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDUkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1RBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENB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QUFNQSxFQUFFQSxTQUFTQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtZQUUvSkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xCQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxFQUFFQSxnQkFBZ0JBLEVBQUVBLE1BQU1BLEVBQUVBLFNBQVNBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1lBRTdJQSxFQUFFQSxDQUFDQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDcEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEVBQUVBLHVEQUF1REE7Z0JBQ3pHQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLEtBQUtBLEVBQUVBLGdCQUFnQkEsRUFBRUEsTUFBTUEsRUFBRUEsU0FBU0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7WUFDL0pBLENBQUNBO1lBRURBLEVBQUVBLENBQUNBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNsQkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsRUFBRUEsZ0JBQWdCQSxFQUFFQSxNQUFNQSxFQUFFQSxTQUFTQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFD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QUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBRW5EQSxLQUFLQSxDQUFDQSxlQUFlQSxDQUFDQSxRQUFRQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxFQUFFQSxvQkFBb0JBLENBQUNBLGFBQWFBLEVBQUVBLFlBQVlBLENBQUNBLGNBQWNBLEVBQUVBLFlBQVlBLENBQUNBLGlCQUFpQkEsRUFBRUEsWUFBWUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7SUFDaExBLENBQUNBO0lBRURaOztPQUVHQTtJQUNJQSx1REFBd0JBLEdBQS9CQSxVQUFnQ0EsWUFBNkJBLEVBQUVBLFFBQWlCQSxFQUFFQSxjQUFvQ0EsRUFBRUEsWUFBa0NBLEVBQUVBLGVBQXFDQSxFQUFFQSxjQUFvQ0EsRUFBRUEsYUFBaUNBLEVBQUVBLGVBQWtDQTtRQUU3U2EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxlQUFlQSxDQUFDQTtRQUUxQ0EsSUFBSUEsT0FBT0EsR0FBeUJBLGFBQWFBLENBQUNBLHVCQUF1QkEsRUFBRUEsQ0FBQ0E7UUFDNUVBLFFBQVFBLENBQUNBLCtCQUErQkEsR0FBR0EsT0FBT0EsQ0FBQ0EsS0FBS0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFM0RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLEVBQUVBLFlBQVlBLEVBQUVBLGNBQWNBLEVBQUVBLGNBQWNBLEVBQUVBLGFBQWFBLEVBQUVBLGVBQWVBLENBQUNBLENBQUNBO0lBQ2xIQSxDQUFDQTtJQUNGYiwyQkFBQ0E7QUFBREEsQ0FyUkEsQUFxUkNBLEVBclJrQyxnQkFBZ0IsRUFxUmxEO0FBRUQsQUFBOEIsaUJBQXJCLG9CQUFvQixDQUFDIiwiZmlsZSI6Im1ldGhvZHMvU2hhZG93RGl0aGVyZWRNZXRob2QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJpdG1hcERhdGFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZGF0YS9CaXRtYXBEYXRhXCIpO1xuaW1wb3J0IEJpdG1hcFRleHR1cmVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL0JpdG1hcFRleHR1cmVcIik7XG5cbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuXG5pbXBvcnQgU2hhZGVyTGlnaHRpbmdPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ09iamVjdFwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRGF0YVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xuXG5pbXBvcnQgTWV0aG9kVk9cdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL2RhdGEvTWV0aG9kVk9cIik7XG5pbXBvcnQgU2hhZG93TWV0aG9kQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9tZXRob2RzL1NoYWRvd01ldGhvZEJhc2VcIik7XG5cbi8qKlxuICogU2hhZG93RGl0aGVyZWRNZXRob2QgcHJvdmlkZXMgYSBzb2Z0IHNoYWRvd2luZyB0ZWNobmlxdWUgYnkgcmFuZG9tbHkgZGlzdHJpYnV0aW5nIHNhbXBsZSBwb2ludHMgZGlmZmVyZW50bHkgZm9yIGVhY2ggZnJhZ21lbnQuXG4gKi9cbmNsYXNzIFNoYWRvd0RpdGhlcmVkTWV0aG9kIGV4dGVuZHMgU2hhZG93TWV0aG9kQmFzZVxue1xuXHRwcml2YXRlIHN0YXRpYyBfZ3JhaW5UZXh0dXJlOkJpdG1hcFRleHR1cmU7XG5cdHByaXZhdGUgc3RhdGljIF9ncmFpblVzYWdlczpudW1iZXIgLyppbnQqLztcblx0cHJpdmF0ZSBzdGF0aWMgX2dyYWluQml0bWFwRGF0YTpCaXRtYXBEYXRhO1xuXHRwcml2YXRlIF9kZXB0aE1hcFNpemU6bnVtYmVyIC8qaW50Ki87XG5cdHByaXZhdGUgX3JhbmdlOm51bWJlcjtcblx0cHJpdmF0ZSBfbnVtU2FtcGxlczpudW1iZXIgLyppbnQqLztcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBTaGFkb3dEaXRoZXJlZE1ldGhvZCBvYmplY3QuXG5cdCAqIEBwYXJhbSBjYXN0aW5nTGlnaHQgVGhlIGxpZ2h0IGNhc3RpbmcgdGhlIHNoYWRvd3Ncblx0ICogQHBhcmFtIG51bVNhbXBsZXMgVGhlIGFtb3VudCBvZiBzYW1wbGVzIHRvIHRha2UgZm9yIGRpdGhlcmluZy4gTWluaW11bSAxLCBtYXhpbXVtIDI0LlxuXHQgKi9cblx0Y29uc3RydWN0b3IoY2FzdGluZ0xpZ2h0OkRpcmVjdGlvbmFsTGlnaHQsIG51bVNhbXBsZXM6bnVtYmVyIC8qaW50Ki8gPSA0LCByYW5nZTpudW1iZXIgPSAxKVxuXHR7XG5cdFx0c3VwZXIoY2FzdGluZ0xpZ2h0KTtcblxuXHRcdHRoaXMuX2RlcHRoTWFwU2l6ZSA9IHRoaXMuX3BDYXN0aW5nTGlnaHQuc2hhZG93TWFwcGVyLmRlcHRoTWFwU2l6ZTtcblxuXHRcdHRoaXMubnVtU2FtcGxlcyA9IG51bVNhbXBsZXM7XG5cdFx0dGhpcy5yYW5nZSA9IHJhbmdlO1xuXG5cdFx0KytTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5Vc2FnZXM7XG5cblx0XHRpZiAoIVNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpblRleHR1cmUpXG5cdFx0XHR0aGlzLmluaXRHcmFpblRleHR1cmUoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGUgYW1vdW50IG9mIHNhbXBsZXMgdG8gdGFrZSBmb3IgZGl0aGVyaW5nLiBNaW5pbXVtIDEsIG1heGltdW0gMjQuIFRoZSBhY3R1YWwgbWF4aW11bSBtYXkgZGVwZW5kIG9uIHRoZVxuXHQgKiBjb21wbGV4aXR5IG9mIHRoZSBzaGFkZXIuXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IG51bVNhbXBsZXMoKTpudW1iZXIgLyppbnQqL1xuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX251bVNhbXBsZXM7XG5cdH1cblxuXHRwdWJsaWMgc2V0IG51bVNhbXBsZXModmFsdWU6bnVtYmVyIC8qaW50Ki8pXG5cdHtcblx0XHR0aGlzLl9udW1TYW1wbGVzID0gdmFsdWU7XG5cdFx0aWYgKHRoaXMuX251bVNhbXBsZXMgPCAxKVxuXHRcdFx0dGhpcy5fbnVtU2FtcGxlcyA9IDE7IGVsc2UgaWYgKHRoaXMuX251bVNhbXBsZXMgPiAyNClcblx0XHRcdHRoaXMuX251bVNhbXBsZXMgPSAyNDtcblx0XHR0aGlzLmlJbnZhbGlkYXRlU2hhZGVyUHJvZ3JhbSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUluaXRWTyhzaGFkZXJPYmplY3Q6U2hhZGVyTGlnaHRpbmdPYmplY3QsIG1ldGhvZFZPOk1ldGhvZFZPKVxuXHR7XG5cdFx0c3VwZXIuaUluaXRWTyhzaGFkZXJPYmplY3QsIG1ldGhvZFZPKTtcblxuXHRcdG1ldGhvZFZPLm5lZWRzUHJvamVjdGlvbiA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpSW5pdENvbnN0YW50cyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8pXG5cdHtcblx0XHRzdXBlci5pSW5pdENvbnN0YW50cyhzaGFkZXJPYmplY3QsIG1ldGhvZFZPKTtcblxuXHRcdHZhciBmcmFnbWVudERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qaW50Ki8gPSBtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4O1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDhdID0gMS90aGlzLl9udW1TYW1wbGVzO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoZSByYW5nZSBpbiB0aGUgc2hhZG93IG1hcCBpbiB3aGljaCB0byBkaXN0cmlidXRlIHRoZSBzYW1wbGVzLlxuXHQgKi9cblx0cHVibGljIGdldCByYW5nZSgpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3JhbmdlKjI7XG5cdH1cblxuXHRwdWJsaWMgc2V0IHJhbmdlKHZhbHVlOm51bWJlcilcblx0e1xuXHRcdHRoaXMuX3JhbmdlID0gdmFsdWUvMjtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgdGV4dHVyZSBjb250YWluaW5nIHRoZSBkaXRoZXJpbmcgbm9pc2UgdGV4dHVyZS5cblx0ICovXG5cdHByaXZhdGUgaW5pdEdyYWluVGV4dHVyZSgpXG5cdHtcblx0XHRTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5CaXRtYXBEYXRhID0gbmV3IEJpdG1hcERhdGEoNjQsIDY0LCBmYWxzZSk7XG5cdFx0dmFyIHZlYzpBcnJheTxudW1iZXI+IC8qdWludCovID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblx0XHR2YXIgbGVuOm51bWJlciAvKnVpbnQqLyA9IDQwOTY7XG5cdFx0dmFyIHN0ZXA6bnVtYmVyID0gMS8odGhpcy5fZGVwdGhNYXBTaXplKnRoaXMuX3JhbmdlKTtcblx0XHR2YXIgcjpudW1iZXIsIGc6bnVtYmVyO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgLyp1aW50Ki8gPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdHIgPSAyKihNYXRoLnJhbmRvbSgpIC0gLjUpO1xuXHRcdFx0ZyA9IDIqKE1hdGgucmFuZG9tKCkgLSAuNSk7XG5cdFx0XHRpZiAociA8IDApXG5cdFx0XHRcdHIgLT0gc3RlcDsgZWxzZVxuXHRcdFx0XHRyICs9IHN0ZXA7XG5cdFx0XHRpZiAoZyA8IDApXG5cdFx0XHRcdGcgLT0gc3RlcDsgZWxzZVxuXHRcdFx0XHRnICs9IHN0ZXA7XG5cdFx0XHRpZiAociA+IDEpXG5cdFx0XHRcdHIgPSAxOyBlbHNlIGlmIChyIDwgLTEpXG5cdFx0XHRcdHIgPSAtMTtcblx0XHRcdGlmIChnID4gMSlcblx0XHRcdFx0ZyA9IDE7IGVsc2UgaWYgKGcgPCAtMSlcblx0XHRcdFx0ZyA9IC0xO1xuXHRcdFx0dmVjW2ldID0gKE1hdGguZmxvb3IoKHIqLjUgKyAuNSkqMHhmZikgPDwgMTYpIHwgKE1hdGguZmxvb3IoKGcqLjUgKyAuNSkqMHhmZikgPDwgOCk7XG5cdFx0fVxuXG5cdFx0U2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluQml0bWFwRGF0YS5zZXRBcnJheShTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5CaXRtYXBEYXRhLnJlY3QsIHZlYyk7XG5cdFx0U2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluVGV4dHVyZSA9IG5ldyBCaXRtYXBUZXh0dXJlKFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpbkJpdG1hcERhdGEpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgZGlzcG9zZSgpXG5cdHtcblx0XHRpZiAoLS1TaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5Vc2FnZXMgPT0gMCkge1xuXHRcdFx0U2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluVGV4dHVyZS5kaXNwb3NlKCk7XG5cdFx0XHRTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5CaXRtYXBEYXRhLmRpc3Bvc2UoKTtcblx0XHRcdFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpblRleHR1cmUgPSBudWxsO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlBY3RpdmF0ZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0c3VwZXIuaUFjdGl2YXRlKHNoYWRlck9iamVjdCwgbWV0aG9kVk8sIHN0YWdlKTtcblxuXHRcdHZhciBkYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XG5cdFx0dmFyIGluZGV4Om51bWJlciAvKnVpbnQqLyA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XG5cdFx0ZGF0YVtpbmRleCArIDldID0gKHN0YWdlLndpZHRoIC0gMSkvNjM7XG5cdFx0ZGF0YVtpbmRleCArIDEwXSA9IChzdGFnZS5oZWlnaHQgLSAxKS82Mztcblx0XHRkYXRhW2luZGV4ICsgMTFdID0gMip0aGlzLl9yYW5nZS90aGlzLl9kZXB0aE1hcFNpemU7XG5cblx0XHRzdGFnZS5hY3RpdmF0ZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCArIDEsIFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpblRleHR1cmUsIHNoYWRlck9iamVjdC5yZXBlYXRUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzLCBzaGFkZXJPYmplY3QudXNlTWlwbWFwcGluZyk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfcEdldFBsYW5hckZyYWdtZW50Q29kZShtZXRob2RWTzpNZXRob2RWTywgdGFyZ2V0UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXG5cdHtcblx0XHR2YXIgZGVwdGhNYXBSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xuXHRcdHZhciBkZWNSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBjdXN0b21EYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ0NhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cblx0XHRtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4ID0gZGVjUmVnLmluZGV4KjQ7XG5cdFx0bWV0aG9kVk8udGV4dHVyZXNJbmRleCA9IGRlcHRoTWFwUmVnaXN0ZXIuaW5kZXg7XG5cblx0XHRyZXR1cm4gdGhpcy5nZXRTYW1wbGVDb2RlKGN1c3RvbURhdGFSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIGRlY1JlZywgdGFyZ2V0UmVnLCByZWdDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgdGhlIGFjdHVhbCBzaGFkZXIgY29kZSBmb3Igc2hhZG93IG1hcHBpbmdcblx0ICogQHBhcmFtIHJlZ0NhY2hlIFRoZSByZWdpc3RlciBjYWNoZSBtYW5hZ2luZyB0aGUgcmVnaXN0ZXJzLlxuXHQgKiBAcGFyYW0gZGVwdGhNYXBSZWdpc3RlciBUaGUgdGV4dHVyZSByZWdpc3RlciBjb250YWluaW5nIHRoZSBkZXB0aCBtYXAuXG5cdCAqIEBwYXJhbSBkZWNSZWcgVGhlIHJlZ2lzdGVyIGNvbnRhaW5pbmcgdGhlIGRlcHRoIG1hcCBkZWNvZGluZyBkYXRhLlxuXHQgKiBAcGFyYW0gdGFyZ2V0UmVnIFRoZSB0YXJnZXQgcmVnaXN0ZXIgdG8gYWRkIHRoZSBzaGFkb3cgY292ZXJhZ2UuXG5cdCAqL1xuXHRwcml2YXRlIGdldFNhbXBsZUNvZGUoY3VzdG9tRGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGRlcHRoTWFwUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCBkZWNSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XG5cdFx0dmFyIGdyYWluUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZVRleHR1cmVSZWcoKTtcblx0XHR2YXIgdXZSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdHZhciBudW1TYW1wbGVzOm51bWJlciAvKmludCovID0gdGhpcy5fbnVtU2FtcGxlcztcblx0XHRyZWdDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModXZSZWcsIDEpO1xuXG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXG5cdFx0dmFyIHByb2plY3Rpb25SZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLnByb2plY3Rpb25GcmFnbWVudDtcblxuXHRcdGNvZGUgKz0gXCJkaXYgXCIgKyB1dlJlZyArIFwiLCBcIiArIHByb2plY3Rpb25SZWcgKyBcIiwgXCIgKyBwcm9qZWN0aW9uUmVnICsgXCIud1xcblwiICsgXCJtdWwgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIueHksIFwiICsgY3VzdG9tRGF0YVJlZyArIFwiLnl6XFxuXCI7XG5cblx0XHR3aGlsZSAobnVtU2FtcGxlcyA+IDApIHtcblx0XHRcdGlmIChudW1TYW1wbGVzID09IHRoaXMuX251bVNhbXBsZXMpXG5cdFx0XHRcdGNvZGUgKz0gXCJ0ZXggXCIgKyB1dlJlZyArIFwiLCBcIiArIHV2UmVnICsgXCIsIFwiICsgZ3JhaW5SZWdpc3RlciArIFwiIDwyZCxuZWFyZXN0LHJlcGVhdCxtaXBub25lPlxcblwiO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHRjb2RlICs9IFwidGV4IFwiICsgdXZSZWcgKyBcIiwgXCIgKyB1dlJlZyArIFwiLnp3eHksIFwiICsgZ3JhaW5SZWdpc3RlciArIFwiIDwyZCxuZWFyZXN0LHJlcGVhdCxtaXBub25lPlxcblwiO1xuXG5cdFx0XHQvLyBrZWVwIGdyYWluIGluIHV2UmVnLnp3XG5cdFx0XHRjb2RlICs9IFwic3ViIFwiICsgdXZSZWcgKyBcIi56dywgXCIgKyB1dlJlZyArIFwiLnh5LCBmYzAueHhcXG5cIiArIC8vIHV2LS41XG5cdFx0XHRcdFwibXVsIFwiICsgdXZSZWcgKyBcIi56dywgXCIgKyB1dlJlZyArIFwiLnp3LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi53XFxuXCI7IC8vICh0ZXggdW5wYWNrIHNjYWxlIGFuZCB0ZXggc2NhbGUgaW4gb25lKVxuXG5cdFx0XHRpZiAobnVtU2FtcGxlcyA9PSB0aGlzLl9udW1TYW1wbGVzKSB7XG5cdFx0XHRcdC8vIGZpcnN0IHNhbXBsZVxuXHRcdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnp3LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueHlcXG5cIiArXG5cdFx0XHRcdFx0XCJ0ZXggXCIgKyB0ZW1wICsgXCIsIFwiICsgdXZSZWcgKyBcIiwgXCIgKyBkZXB0aE1hcFJlZ2lzdGVyICsgXCIgPDJkLG5lYXJlc3QsY2xhbXAsbWlwbm9uZT5cXG5cIiArXG5cdFx0XHRcdFx0XCJkcDQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGVjUmVnICsgXCJcXG5cIiArXG5cdFx0XHRcdFx0XCJzbHQgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueiwgXCIgKyB0ZW1wICsgXCIuelxcblwiOyAvLyAwIGlmIGluIHNoYWRvd1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29kZSArPSB0aGlzLmFkZFNhbXBsZSh1dlJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG51bVNhbXBsZXMgPiA0KVxuXHRcdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIuendcXG5cIiArIHRoaXMuYWRkU2FtcGxlKHV2UmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCBkZWNSZWcsIHRhcmdldFJlZywgcmVnQ2FjaGUpO1xuXG5cdFx0XHRpZiAobnVtU2FtcGxlcyA+IDEpXG5cdFx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi56d1xcblwiICsgdGhpcy5hZGRTYW1wbGUodXZSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIGRlY1JlZywgdGFyZ2V0UmVnLCByZWdDYWNoZSk7XG5cblx0XHRcdGlmIChudW1TYW1wbGVzID4gNSlcblx0XHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnp3XFxuXCIgKyB0aGlzLmFkZFNhbXBsZSh1dlJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlKTtcblxuXHRcdFx0aWYgKG51bVNhbXBsZXMgPiAyKSB7XG5cdFx0XHRcdGNvZGUgKz0gXCJuZWcgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53XFxuXCI7IC8vIHdpbGwgYmUgcm90YXRlZCA5MCBkZWdyZWVzIHdoZW4gYmVpbmcgYWNjZXNzZWQgYXMgd3pcblx0XHRcdFx0Y29kZSArPSBcImFkZCBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi53eiwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLnh5XFxuXCIgKyB0aGlzLmFkZFNhbXBsZSh1dlJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG51bVNhbXBsZXMgPiA2KVxuXHRcdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIud3pcXG5cIiArIHRoaXMuYWRkU2FtcGxlKHV2UmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCBkZWNSZWcsIHRhcmdldFJlZywgcmVnQ2FjaGUpO1xuXG5cdFx0XHRpZiAobnVtU2FtcGxlcyA+IDMpXG5cdFx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi53elxcblwiICsgdGhpcy5hZGRTYW1wbGUodXZSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIGRlY1JlZywgdGFyZ2V0UmVnLCByZWdDYWNoZSk7XG5cblx0XHRcdGlmIChudW1TYW1wbGVzID4gNylcblx0XHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnd6XFxuXCIgKyB0aGlzLmFkZFNhbXBsZSh1dlJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlKTtcblxuXHRcdFx0bnVtU2FtcGxlcyAtPSA4O1xuXHRcdH1cblxuXHRcdHJlZ0NhY2hlLnJlbW92ZUZyYWdtZW50VGVtcFVzYWdlKHV2UmVnKTtcblx0XHRjb2RlICs9IFwibXVsIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi54XFxuXCI7IC8vIGF2ZXJhZ2Vcblx0XHRyZXR1cm4gY29kZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGRzIHRoZSBjb2RlIGZvciBhbm90aGVyIHRhcCB0byB0aGUgc2hhZGVyIGNvZGUuXG5cdCAqIEBwYXJhbSB1dlJlZyBUaGUgdXYgcmVnaXN0ZXIgZm9yIHRoZSB0YXAuXG5cdCAqIEBwYXJhbSBkZXB0aE1hcFJlZ2lzdGVyIFRoZSB0ZXh0dXJlIHJlZ2lzdGVyIGNvbnRhaW5pbmcgdGhlIGRlcHRoIG1hcC5cblx0ICogQHBhcmFtIGRlY1JlZyBUaGUgcmVnaXN0ZXIgY29udGFpbmluZyB0aGUgZGVwdGggbWFwIGRlY29kaW5nIGRhdGEuXG5cdCAqIEBwYXJhbSB0YXJnZXRSZWcgVGhlIHRhcmdldCByZWdpc3RlciB0byBhZGQgdGhlIHRhcCBjb21wYXJpc29uIHJlc3VsdC5cblx0ICogQHBhcmFtIHJlZ0NhY2hlIFRoZSByZWdpc3RlciBjYWNoZSBtYW5hZ2luZyB0aGUgcmVnaXN0ZXJzLlxuXHQgKiBAcmV0dXJuXG5cdCAqL1xuXHRwcml2YXRlIGFkZFNhbXBsZSh1dlJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGRlcHRoTWFwUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCBkZWNSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlKTpzdHJpbmdcblx0e1xuXHRcdHZhciB0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ0NhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcblxuXHRcdHJldHVybiBcInRleCBcIiArIHRlbXAgKyBcIiwgXCIgKyB1dlJlZyArIFwiLCBcIiArIGRlcHRoTWFwUmVnaXN0ZXIgKyBcIiA8MmQsbmVhcmVzdCxjbGFtcCxtaXBub25lPlxcblwiICtcblx0XHRcdFwiZHA0IFwiICsgdGVtcCArIFwiLnosIFwiICsgdGVtcCArIFwiLCBcIiArIGRlY1JlZyArIFwiXFxuXCIgK1xuXHRcdFx0XCJzbHQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLnosIFwiICsgdGVtcCArIFwiLnpcXG5cIiArIC8vIDAgaWYgaW4gc2hhZG93XG5cdFx0XHRcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyB0ZW1wICsgXCIuelxcblwiO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUFjdGl2YXRlRm9yQ2FzY2FkZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0dmFyIGRhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qdWludCovID0gbWV0aG9kVk8uc2Vjb25kYXJ5RnJhZ21lbnRDb25zdGFudHNJbmRleDtcblx0XHRkYXRhW2luZGV4XSA9IDEvdGhpcy5fbnVtU2FtcGxlcztcblx0XHRkYXRhW2luZGV4ICsgMV0gPSAoc3RhZ2Uud2lkdGggLSAxKS82Mztcblx0XHRkYXRhW2luZGV4ICsgMl0gPSAoc3RhZ2UuaGVpZ2h0IC0gMSkvNjM7XG5cdFx0ZGF0YVtpbmRleCArIDNdID0gMip0aGlzLl9yYW5nZS90aGlzLl9kZXB0aE1hcFNpemU7XG5cblx0XHRzdGFnZS5hY3RpdmF0ZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCArIDEsIFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpblRleHR1cmUsIHNoYWRlck9iamVjdC5yZXBlYXRUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzLCBzaGFkZXJPYmplY3QudXNlTWlwbWFwcGluZyk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaUdldENhc2NhZGVGcmFnbWVudENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCBkZWNvZGVSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGRlcHRoVGV4dHVyZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGRlcHRoUHJvamVjdGlvbjpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHRhcmdldFJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnID0gZGVwdGhQcm9qZWN0aW9uO1xuXG5cdFx0dmFyIGRhdGFSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdG1ldGhvZFZPLnNlY29uZGFyeUZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBkYXRhUmVnLmluZGV4KjQ7XG5cblx0XHRyZXR1cm4gdGhpcy5nZXRTYW1wbGVDb2RlKGRhdGFSZWcsIGRlcHRoVGV4dHVyZSwgZGVjb2RlUmVnaXN0ZXIsIHRhcmdldFJlZ2lzdGVyLCByZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnMpO1xuXHR9XG59XG5cbmV4cG9ydCA9IFNoYWRvd0RpdGhlcmVkTWV0aG9kOyJdfQ==