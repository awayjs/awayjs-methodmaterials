var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderCompilerHelper = require("awayjs-renderergl/lib/utils/ShaderCompilerHelper");
var EffectMethodBase = require("awayjs-methodmaterials/lib/methods/EffectMethodBase");
/**
 * EffectFresnelEnvMapMethod provides a method to add fresnel-based reflectivity to an object using cube maps, which gets
 * stronger as the viewing angle becomes more grazing.
 */
var EffectFresnelEnvMapMethod = (function (_super) {
    __extends(EffectFresnelEnvMapMethod, _super);
    /**
     * Creates a new <code>EffectFresnelEnvMapMethod</code> object.
     *
     * @param envMap The environment map containing the reflected scene.
     * @param alpha The reflectivity of the material.
     */
    function EffectFresnelEnvMapMethod(envMap, alpha) {
        if (alpha === void 0) { alpha = 1; }
        _super.call(this);
        this._fresnelPower = 5;
        this._normalReflectance = 0;
        this._cubeTexture = envMap;
        this._alpha = alpha;
    }
    /**
     * @inheritDoc
     */
    EffectFresnelEnvMapMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        methodVO.needsNormals = true;
        methodVO.needsView = true;
        methodVO.needsUV = this._mask != null;
    };
    /**
     * @inheritDoc
     */
    EffectFresnelEnvMapMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        shaderObject.fragmentConstantData[methodVO.fragmentConstantsIndex + 3] = 1;
    };
    Object.defineProperty(EffectFresnelEnvMapMethod.prototype, "mask", {
        /**
         * An optional texture to modulate the reflectivity of the surface.
         */
        get: function () {
            return this._mask;
        },
        set: function (value) {
            if (Boolean(value) != Boolean(this._mask) || (value && this._mask && (value.format != this._mask.format))) {
                this.iInvalidateShaderProgram();
            }
            this._mask = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EffectFresnelEnvMapMethod.prototype, "fresnelPower", {
        /**
         * The power used in the Fresnel equation. Higher values make the fresnel effect more pronounced. Defaults to 5.
         */
        get: function () {
            return this._fresnelPower;
        },
        set: function (value) {
            this._fresnelPower = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EffectFresnelEnvMapMethod.prototype, "envMap", {
        /**
         * The cubic environment map containing the reflected scene.
         */
        get: function () {
            return this._cubeTexture;
        },
        set: function (value) {
            this._cubeTexture = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EffectFresnelEnvMapMethod.prototype, "alpha", {
        /**
         * The reflectivity of the surface.
         */
        get: function () {
            return this._alpha;
        },
        set: function (value) {
            this._alpha = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EffectFresnelEnvMapMethod.prototype, "normalReflectance", {
        /**
         * The minimum amount of reflectance, ie the reflectance when the view direction is normal to the surface or light direction.
         */
        get: function () {
            return this._normalReflectance;
        },
        set: function (value) {
            this._normalReflectance = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    EffectFresnelEnvMapMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        var data = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        data[index] = this._alpha;
        data[index + 1] = this._normalReflectance;
        data[index + 2] = this._fresnelPower;
        stage.activateCubeTexture(methodVO.texturesIndex, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
        if (this._mask)
            stage.activateTexture(methodVO.texturesIndex + 1, this._mask, shaderObject.repeatTextures, shaderObject.useSmoothTextures, shaderObject.useMipmapping);
    };
    /**
     * @inheritDoc
     */
    EffectFresnelEnvMapMethod.prototype.iGetFragmentCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var dataRegister = registerCache.getFreeFragmentConstant();
        var temp = registerCache.getFreeFragmentVectorTemp();
        var code = "";
        var cubeMapReg = registerCache.getFreeTextureReg();
        var viewDirReg = sharedRegisters.viewDirFragment;
        var normalReg = sharedRegisters.normalFragment;
        methodVO.texturesIndex = cubeMapReg.index;
        methodVO.fragmentConstantsIndex = dataRegister.index * 4;
        registerCache.addFragmentTempUsages(temp, 1);
        var temp2 = registerCache.getFreeFragmentVectorTemp();
        // r = V - 2(V.N)*N
        code += "dp3 " + temp + ".w, " + viewDirReg + ".xyz, " + normalReg + ".xyz\n" + "add " + temp + ".w, " + temp + ".w, " + temp + ".w\n" + "mul " + temp + ".xyz, " + normalReg + ".xyz, " + temp + ".w\n" + "sub " + temp + ".xyz, " + temp + ".xyz, " + viewDirReg + ".xyz\n" + ShaderCompilerHelper.getTexCubeSampleCode(temp, cubeMapReg, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping, temp) + "sub " + temp2 + ".w, " + temp + ".w, fc0.x\n" + "kil " + temp2 + ".w\n" + "sub " + temp + ", " + temp + ", " + targetReg + "\n";
        // calculate fresnel term
        code += "dp3 " + viewDirReg + ".w, " + viewDirReg + ".xyz, " + normalReg + ".xyz\n" + "sub " + viewDirReg + ".w, " + dataRegister + ".w, " + viewDirReg + ".w\n" + "pow " + viewDirReg + ".w, " + viewDirReg + ".w, " + dataRegister + ".z\n" + "sub " + normalReg + ".w, " + dataRegister + ".w, " + viewDirReg + ".w\n" + "mul " + normalReg + ".w, " + dataRegister + ".y, " + normalReg + ".w\n" + "add " + viewDirReg + ".w, " + viewDirReg + ".w, " + normalReg + ".w\n" + "mul " + viewDirReg + ".w, " + dataRegister + ".x, " + viewDirReg + ".w\n";
        if (this._mask) {
            var maskReg = registerCache.getFreeTextureReg();
            code += ShaderCompilerHelper.getTex2DSampleCode(temp2, sharedRegisters, maskReg, this._mask, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping) + "mul " + viewDirReg + ".w, " + temp2 + ".x, " + viewDirReg + ".w\n";
        }
        // blend
        code += "mul " + temp + ", " + temp + ", " + viewDirReg + ".w\n" + "add " + targetReg + ", " + targetReg + ", " + temp + "\n";
        registerCache.removeFragmentTempUsage(temp);
        return code;
    };
    return EffectFresnelEnvMapMethod;
})(EffectMethodBase);
module.exports = EffectFresnelEnvMapMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL21ldGhvZHMvRWZmZWN0RnJlc25lbEVudk1hcE1ldGhvZC50cyJdLCJuYW1lcyI6WyJFZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kIiwiRWZmZWN0RnJlc25lbEVudk1hcE1ldGhvZC5jb25zdHJ1Y3RvciIsIkVmZmVjdEZyZXNuZWxFbnZNYXBNZXRob2QuaUluaXRWTyIsIkVmZmVjdEZyZXNuZWxFbnZNYXBNZXRob2QuaUluaXRDb25zdGFudHMiLCJFZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kLm1hc2siLCJFZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kLmZyZXNuZWxQb3dlciIsIkVmZmVjdEZyZXNuZWxFbnZNYXBNZXRob2QuZW52TWFwIiwiRWZmZWN0RnJlc25lbEVudk1hcE1ldGhvZC5hbHBoYSIsIkVmZmVjdEZyZXNuZWxFbnZNYXBNZXRob2Qubm9ybWFsUmVmbGVjdGFuY2UiLCJFZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kLmlBY3RpdmF0ZSIsIkVmZmVjdEZyZXNuZWxFbnZNYXBNZXRob2QuaUdldEZyYWdtZW50Q29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBU0EsSUFBTyxvQkFBb0IsV0FBYyxrREFBa0QsQ0FBQyxDQUFDO0FBRzdGLElBQU8sZ0JBQWdCLFdBQWUscURBQXFELENBQUMsQ0FBQztBQUU3RixBQUlBOzs7R0FERztJQUNHLHlCQUF5QjtJQUFTQSxVQUFsQ0EseUJBQXlCQSxVQUF5QkE7SUFRdkRBOzs7OztPQUtHQTtJQUNIQSxTQWRLQSx5QkFBeUJBLENBY2xCQSxNQUFzQkEsRUFBRUEsS0FBZ0JBO1FBQWhCQyxxQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFFbkRBLGlCQUFPQSxDQUFDQTtRQWJEQSxrQkFBYUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDekJBLHVCQUFrQkEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFjckNBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLE1BQU1BLENBQUNBO1FBQzNC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QWFBLEdBQzlDQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUN2QkEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFeERBLEFBQ0FBLHlCQUR5QkE7UUFDekJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLFVBQVVBLEdBQUdBLE1BQU1BLEdBQUdBLFVBQVVBLEdBQUdBLFFBQVFBLEdBQUdBLFNBQVNBLEdBQUdBLFFBQVFBLEdBQ2pGQSxNQUFNQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxHQUFHQSxZQUFZQSxHQUFHQSxNQUFNQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxHQUMxRUEsTUFBTUEsR0FBR0EsVUFBVUEsR0FBR0EsTUFBTUEsR0FBR0EsVUFBVUEsR0FBR0EsTUFBTUEsR0FBR0EsWUFBWUEsR0FBR0EsTUFBTUEsR0FDMUVBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLFlBQVlBLEdBQUdBLE1BQU1BLEdBQUdBLFVBQVVBLEdBQUdBLE1BQU1BLEdBQ3pFQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxZQUFZQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUN4RUEsTUFBTUEsR0FBR0EsVUFBVUEsR0FBR0EsTUFBTUEsR0FBR0EsVUFBVUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FHdkVBLE1BQU1BLEdBQUdBLFVBQVVBLEdBQUdBLE1BQU1BLEdBQUdBLFlBQVlBLEdBQUdBLE1BQU1BLEdBQUdBLFVBQVVBLEdBQUdBLE1BQU1BLENBQUNBO1FBRTdFQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQkEsSUFBSUEsT0FBT0EsR0FBeUJBLGFBQWFBLENBQUNBLGlCQUFpQkEsRUFBRUEsQ0FBQ0E7WUFDdEVBLElBQUlBLElBQUlBLG9CQUFvQkEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxLQUFLQSxFQUFFQSxlQUFlQSxFQUFFQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxZQUFZQSxDQUFDQSxpQkFBaUJBLEVBQUVBLFlBQVlBLENBQUNBLGNBQWNBLEVBQUVBLFlBQVlBLENBQUNBLGFBQWFBLENBQUNBLEdBQ3BMQSxNQUFNQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxVQUFVQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUN0RUEsQ0FBQ0E7UUFFREEsQUFDQUEsUUFEUUE7UUFDUkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsVUFBVUEsR0FBR0EsTUFBTUEsR0FDOURBLE1BQU1BLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBRTdEQSxhQUFhQSxDQUFDQSx1QkFBdUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBRTVDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNiQSxDQUFDQTtJQUNGVixnQ0FBQ0E7QUFBREEsQ0FuTEEsQUFtTENBLEVBbkx1QyxnQkFBZ0IsRUFtTHZEO0FBRUQsQUFBbUMsaUJBQTFCLHlCQUF5QixDQUFDIiwiZmlsZSI6Im1ldGhvZHMvRWZmZWN0RnJlc25lbEVudk1hcE1ldGhvZC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ3ViZVRleHR1cmVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9DdWJlVGV4dHVyZUJhc2VcIik7XHJcbmltcG9ydCBUZXh0dXJlMkRCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlMkRCYXNlXCIpO1xyXG5cclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuXHJcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckRhdGFcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJIZWxwZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi91dGlscy9TaGFkZXJDb21waWxlckhlbHBlclwiKTtcclxuXHJcbmltcG9ydCBNZXRob2RWT1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvZGF0YS9NZXRob2RWT1wiKTtcclxuaW1wb3J0IEVmZmVjdE1ldGhvZEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvbWV0aG9kcy9FZmZlY3RNZXRob2RCYXNlXCIpO1xyXG5cclxuLyoqXHJcbiAqIEVmZmVjdEZyZXNuZWxFbnZNYXBNZXRob2QgcHJvdmlkZXMgYSBtZXRob2QgdG8gYWRkIGZyZXNuZWwtYmFzZWQgcmVmbGVjdGl2aXR5IHRvIGFuIG9iamVjdCB1c2luZyBjdWJlIG1hcHMsIHdoaWNoIGdldHNcclxuICogc3Ryb25nZXIgYXMgdGhlIHZpZXdpbmcgYW5nbGUgYmVjb21lcyBtb3JlIGdyYXppbmcuXHJcbiAqL1xyXG5jbGFzcyBFZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kIGV4dGVuZHMgRWZmZWN0TWV0aG9kQmFzZVxyXG57XHJcblx0cHJpdmF0ZSBfY3ViZVRleHR1cmU6Q3ViZVRleHR1cmVCYXNlO1xyXG5cdHByaXZhdGUgX2ZyZXNuZWxQb3dlcjpudW1iZXIgPSA1O1xyXG5cdHByaXZhdGUgX25vcm1hbFJlZmxlY3RhbmNlOm51bWJlciA9IDA7XHJcblx0cHJpdmF0ZSBfYWxwaGE6bnVtYmVyO1xyXG5cdHByaXZhdGUgX21hc2s6VGV4dHVyZTJEQmFzZTtcclxuXHJcblx0LyoqXHJcblx0ICogQ3JlYXRlcyBhIG5ldyA8Y29kZT5FZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kPC9jb2RlPiBvYmplY3QuXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gZW52TWFwIFRoZSBlbnZpcm9ubWVudCBtYXAgY29udGFpbmluZyB0aGUgcmVmbGVjdGVkIHNjZW5lLlxyXG5cdCAqIEBwYXJhbSBhbHBoYSBUaGUgcmVmbGVjdGl2aXR5IG9mIHRoZSBtYXRlcmlhbC5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihlbnZNYXA6Q3ViZVRleHR1cmVCYXNlLCBhbHBoYTpudW1iZXIgPSAxKVxyXG5cdHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0dGhpcy5fY3ViZVRleHR1cmUgPSBlbnZNYXA7XHJcblx0XHR0aGlzLl9hbHBoYSA9IGFscGhhO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgaUluaXRWTyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8pXHJcblx0e1xyXG5cdFx0bWV0aG9kVk8ubmVlZHNOb3JtYWxzID0gdHJ1ZTtcclxuXHRcdG1ldGhvZFZPLm5lZWRzVmlldyA9IHRydWU7XHJcblx0XHRtZXRob2RWTy5uZWVkc1VWID0gdGhpcy5fbWFzayAhPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgaUluaXRDb25zdGFudHMoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPKVxyXG5cdHtcclxuXHRcdHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YVttZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4ICsgM10gPSAxO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQW4gb3B0aW9uYWwgdGV4dHVyZSB0byBtb2R1bGF0ZSB0aGUgcmVmbGVjdGl2aXR5IG9mIHRoZSBzdXJmYWNlLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgbWFzaygpOlRleHR1cmUyREJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fbWFzaztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgbWFzayh2YWx1ZTpUZXh0dXJlMkRCYXNlKVxyXG5cdHtcclxuXHRcdGlmIChCb29sZWFuKHZhbHVlKSAhPSBCb29sZWFuKHRoaXMuX21hc2spIHx8XHJcblx0XHRcdCh2YWx1ZSAmJiB0aGlzLl9tYXNrICYmICh2YWx1ZS5mb3JtYXQgIT0gdGhpcy5fbWFzay5mb3JtYXQpKSkge1xyXG5cdFx0XHR0aGlzLmlJbnZhbGlkYXRlU2hhZGVyUHJvZ3JhbSgpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5fbWFzayA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVGhlIHBvd2VyIHVzZWQgaW4gdGhlIEZyZXNuZWwgZXF1YXRpb24uIEhpZ2hlciB2YWx1ZXMgbWFrZSB0aGUgZnJlc25lbCBlZmZlY3QgbW9yZSBwcm9ub3VuY2VkLiBEZWZhdWx0cyB0byA1LlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgZnJlc25lbFBvd2VyKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2ZyZXNuZWxQb3dlcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgZnJlc25lbFBvd2VyKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHR0aGlzLl9mcmVzbmVsUG93ZXIgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSBjdWJpYyBlbnZpcm9ubWVudCBtYXAgY29udGFpbmluZyB0aGUgcmVmbGVjdGVkIHNjZW5lLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgZW52TWFwKCk6Q3ViZVRleHR1cmVCYXNlXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2N1YmVUZXh0dXJlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBlbnZNYXAodmFsdWU6Q3ViZVRleHR1cmVCYXNlKVxyXG5cdHtcclxuXHRcdHRoaXMuX2N1YmVUZXh0dXJlID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgcmVmbGVjdGl2aXR5IG9mIHRoZSBzdXJmYWNlLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgYWxwaGEoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fYWxwaGE7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IGFscGhhKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHR0aGlzLl9hbHBoYSA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVGhlIG1pbmltdW0gYW1vdW50IG9mIHJlZmxlY3RhbmNlLCBpZSB0aGUgcmVmbGVjdGFuY2Ugd2hlbiB0aGUgdmlldyBkaXJlY3Rpb24gaXMgbm9ybWFsIHRvIHRoZSBzdXJmYWNlIG9yIGxpZ2h0IGRpcmVjdGlvbi5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IG5vcm1hbFJlZmxlY3RhbmNlKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX25vcm1hbFJlZmxlY3RhbmNlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBub3JtYWxSZWZsZWN0YW5jZSh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0dGhpcy5fbm9ybWFsUmVmbGVjdGFuY2UgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGlBY3RpdmF0ZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHN0YWdlOlN0YWdlKVxyXG5cdHtcclxuXHRcdHZhciBkYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XHJcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qaW50Ki8gPSBtZXRob2RWTy5mcmFnbWVudENvbnN0YW50c0luZGV4O1xyXG5cdFx0ZGF0YVtpbmRleF0gPSB0aGlzLl9hbHBoYTtcclxuXHRcdGRhdGFbaW5kZXggKyAxXSA9IHRoaXMuX25vcm1hbFJlZmxlY3RhbmNlO1xyXG5cdFx0ZGF0YVtpbmRleCArIDJdID0gdGhpcy5fZnJlc25lbFBvd2VyO1xyXG5cclxuXHRcdHN0YWdlLmFjdGl2YXRlQ3ViZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCwgdGhpcy5fY3ViZVRleHR1cmUsIHNoYWRlck9iamVjdC51c2VTbW9vdGhUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZU1pcG1hcHBpbmcpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9tYXNrKVxyXG5cdFx0XHRzdGFnZS5hY3RpdmF0ZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCArIDEsIHRoaXMuX21hc2ssIHNoYWRlck9iamVjdC5yZXBlYXRUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzLCBzaGFkZXJPYmplY3QudXNlTWlwbWFwcGluZyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgdGFyZ2V0UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcclxuXHR7XHJcblx0XHR2YXIgZGF0YVJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcclxuXHRcdHZhciB0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHRcdHZhciBjdWJlTWFwUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVRleHR1cmVSZWcoKTtcclxuXHRcdHZhciB2aWV3RGlyUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHNoYXJlZFJlZ2lzdGVycy52aWV3RGlyRnJhZ21lbnQ7XHJcblx0XHR2YXIgbm9ybWFsUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHNoYXJlZFJlZ2lzdGVycy5ub3JtYWxGcmFnbWVudDtcclxuXHJcblx0XHRtZXRob2RWTy50ZXh0dXJlc0luZGV4ID0gY3ViZU1hcFJlZy5pbmRleDtcclxuXHRcdG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBkYXRhUmVnaXN0ZXIuaW5kZXgqNDtcclxuXHJcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh0ZW1wLCAxKTtcclxuXHRcdHZhciB0ZW1wMjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcclxuXHJcblx0XHQvLyByID0gViAtIDIoVi5OKSpOXHJcblx0XHRjb2RlICs9IFwiZHAzIFwiICsgdGVtcCArIFwiLncsIFwiICsgdmlld0RpclJlZyArIFwiLnh5eiwgXCIgKyBub3JtYWxSZWcgKyBcIi54eXpcXG5cIiArXHJcblx0XHRcdFx0XCJhZGQgXCIgKyB0ZW1wICsgXCIudywgXCIgKyB0ZW1wICsgXCIudywgXCIgKyB0ZW1wICsgXCIud1xcblwiICtcclxuXHRcdFx0XHRcIm11bCBcIiArIHRlbXAgKyBcIi54eXosIFwiICsgbm9ybWFsUmVnICsgXCIueHl6LCBcIiArIHRlbXAgKyBcIi53XFxuXCIgK1xyXG5cdFx0XHRcdFwic3ViIFwiICsgdGVtcCArIFwiLnh5eiwgXCIgKyB0ZW1wICsgXCIueHl6LCBcIiArIHZpZXdEaXJSZWcgKyBcIi54eXpcXG5cIiArXHJcblx0XHRcdFNoYWRlckNvbXBpbGVySGVscGVyLmdldFRleEN1YmVTYW1wbGVDb2RlKHRlbXAsIGN1YmVNYXBSZWcsIHRoaXMuX2N1YmVUZXh0dXJlLCBzaGFkZXJPYmplY3QudXNlU21vb3RoVGV4dHVyZXMsIHNoYWRlck9iamVjdC51c2VNaXBtYXBwaW5nLCB0ZW1wKSArXHJcblx0XHRcdFx0XCJzdWIgXCIgKyB0ZW1wMiArIFwiLncsIFwiICsgdGVtcCArIFwiLncsIGZjMC54XFxuXCIgKyAgICAgICAgICAgICAgIFx0Ly8gLS41XHJcblx0XHRcdFx0XCJraWwgXCIgKyB0ZW1wMiArIFwiLndcXG5cIiArXHQvLyB1c2VkIGZvciByZWFsIHRpbWUgcmVmbGVjdGlvbiBtYXBwaW5nIC0gaWYgYWxwaGEgaXMgbm90IDEgKG1vY2sgdGV4dHVyZSkga2lsIG91dHB1dFxyXG5cdFx0XHRcdFwic3ViIFwiICsgdGVtcCArIFwiLCBcIiArIHRlbXAgKyBcIiwgXCIgKyB0YXJnZXRSZWcgKyBcIlxcblwiO1xyXG5cclxuXHRcdC8vIGNhbGN1bGF0ZSBmcmVzbmVsIHRlcm1cclxuXHRcdGNvZGUgKz0gXCJkcDMgXCIgKyB2aWV3RGlyUmVnICsgXCIudywgXCIgKyB2aWV3RGlyUmVnICsgXCIueHl6LCBcIiArIG5vcm1hbFJlZyArIFwiLnh5elxcblwiICsgIC8vIGRvdChWLCBIKVxyXG5cdFx0XHRcdFwic3ViIFwiICsgdmlld0RpclJlZyArIFwiLncsIFwiICsgZGF0YVJlZ2lzdGVyICsgXCIudywgXCIgKyB2aWV3RGlyUmVnICsgXCIud1xcblwiICsgICAgICAgLy8gYmFzZSA9IDEtZG90KFYsIEgpXHJcblx0XHRcdFx0XCJwb3cgXCIgKyB2aWV3RGlyUmVnICsgXCIudywgXCIgKyB2aWV3RGlyUmVnICsgXCIudywgXCIgKyBkYXRhUmVnaXN0ZXIgKyBcIi56XFxuXCIgKyAgICAgICAvLyBleHAgPSBwb3coYmFzZSwgNSlcclxuXHRcdFx0XHRcInN1YiBcIiArIG5vcm1hbFJlZyArIFwiLncsIFwiICsgZGF0YVJlZ2lzdGVyICsgXCIudywgXCIgKyB2aWV3RGlyUmVnICsgXCIud1xcblwiICsgICAgICAgIC8vIDEgLSBleHBcclxuXHRcdFx0XHRcIm11bCBcIiArIG5vcm1hbFJlZyArIFwiLncsIFwiICsgZGF0YVJlZ2lzdGVyICsgXCIueSwgXCIgKyBub3JtYWxSZWcgKyBcIi53XFxuXCIgKyAgICAgICAgIC8vIGYwKigxIC0gZXhwKVxyXG5cdFx0XHRcdFwiYWRkIFwiICsgdmlld0RpclJlZyArIFwiLncsIFwiICsgdmlld0RpclJlZyArIFwiLncsIFwiICsgbm9ybWFsUmVnICsgXCIud1xcblwiICsgICAgICAgICAgLy8gZXhwICsgZjAqKDEgLSBleHApXHJcblxyXG5cdFx0XHRcdC8vIHRvdGFsIGFscGhhXHJcblx0XHRcdFx0XCJtdWwgXCIgKyB2aWV3RGlyUmVnICsgXCIudywgXCIgKyBkYXRhUmVnaXN0ZXIgKyBcIi54LCBcIiArIHZpZXdEaXJSZWcgKyBcIi53XFxuXCI7XHJcblxyXG5cdFx0aWYgKHRoaXMuX21hc2spIHtcclxuXHRcdFx0dmFyIG1hc2tSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xyXG5cdFx0XHRjb2RlICs9IFNoYWRlckNvbXBpbGVySGVscGVyLmdldFRleDJEU2FtcGxlQ29kZSh0ZW1wMiwgc2hhcmVkUmVnaXN0ZXJzLCBtYXNrUmVnLCB0aGlzLl9tYXNrLCBzaGFkZXJPYmplY3QudXNlU21vb3RoVGV4dHVyZXMsIHNoYWRlck9iamVjdC5yZXBlYXRUZXh0dXJlcywgc2hhZGVyT2JqZWN0LnVzZU1pcG1hcHBpbmcpICtcclxuXHRcdFx0XHRcIm11bCBcIiArIHZpZXdEaXJSZWcgKyBcIi53LCBcIiArIHRlbXAyICsgXCIueCwgXCIgKyB2aWV3RGlyUmVnICsgXCIud1xcblwiO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGJsZW5kXHJcblx0XHRjb2RlICs9IFwibXVsIFwiICsgdGVtcCArIFwiLCBcIiArIHRlbXAgKyBcIiwgXCIgKyB2aWV3RGlyUmVnICsgXCIud1xcblwiICtcclxuXHRcdFx0XHRcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLCBcIiArIHRhcmdldFJlZyArIFwiLCBcIiArIHRlbXAgKyBcIlxcblwiO1xyXG5cclxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodGVtcCk7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBFZmZlY3RGcmVzbmVsRW52TWFwTWV0aG9kOyJdfQ==