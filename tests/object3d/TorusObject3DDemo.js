"use strict";
var Sampler2D_1 = require("awayjs-core/lib/image/Sampler2D");
var URLLoader_1 = require("awayjs-core/lib/net/URLLoader");
var URLLoaderDataFormat_1 = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var URLLoaderEvent_1 = require("awayjs-core/lib/events/URLLoaderEvent");
var ParserUtils_1 = require("awayjs-core/lib/parsers/ParserUtils");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var Debug_1 = require("awayjs-core/lib/utils/Debug");
var View_1 = require("awayjs-display/lib/View");
var PointLight_1 = require("awayjs-display/lib/display/PointLight");
var ElementsType_1 = require("awayjs-display/lib/graphics/ElementsType");
var StaticLightPicker_1 = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var PrimitiveTorusPrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveTorusPrefab");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial_1 = require("awayjs-methodmaterials/lib/MethodMaterial");
var TorusObject3DDemo = (function () {
    function TorusObject3DDemo() {
        var _this = this;
        this.t = 0;
        this.tPos = 0;
        this.radius = 1000;
        this.follow = true;
        Debug_1.default.THROW_ERRORS = false;
        Debug_1.default.LOG_PI_ERRORS = false;
        this.sprites = new Array();
        this.light = new PointLight_1.default();
        this.view = new View_1.default(new DefaultRenderer_1.default());
        this.pointLight = new PointLight_1.default();
        this.lightPicker = new StaticLightPicker_1.default([this.pointLight]);
        this.view.scene.addChild(this.pointLight);
        var perspectiveLens = this.view.camera.projection;
        perspectiveLens.fieldOfView = 75;
        this.view.camera.z = 0;
        this.view.backgroundColor = 0x000000;
        this.view.backgroundAlpha = 1;
        this.view.scene.addChild(this.light);
        this.raf = new RequestAnimationFrame_1.default(this.tick, this);
        this.raf.start();
        this.onResize();
        document.onmousedown = function (event) { return _this.followObject(event); };
        window.onresize = function (event) { return _this.onResize(event); };
        this.loadResources();
    }
    TorusObject3DDemo.prototype.loadResources = function () {
        var _this = this;
        var urlRequest = new URLRequest_1.default("assets/custom_uv_horizontal.png");
        var urlLoader = new URLLoader_1.default();
        urlLoader.dataFormat = URLLoaderDataFormat_1.default.BLOB;
        urlLoader.addEventListener(URLLoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.imageCompleteHandler(event); });
        urlLoader.load(urlRequest);
    };
    TorusObject3DDemo.prototype.imageCompleteHandler = function (event) {
        var _this = this;
        var urlLoader = event.target;
        this._image = ParserUtils_1.default.blobToImage(urlLoader.data);
        this._image.onload = function (event) { return _this.onImageLoadComplete(event); };
    };
    TorusObject3DDemo.prototype.onImageLoadComplete = function (event) {
        var matTx = new MethodMaterial_1.default(ParserUtils_1.default.imageToBitmapImage2D(this._image));
        matTx.style.sampler = new Sampler2D_1.default(true, true, true);
        matTx.lightPicker = this.lightPicker;
        var torus = new PrimitiveTorusPrefab_1.default(matTx, ElementsType_1.default.TRIANGLE, 150, 50, 32, 32, false);
        var l = 10;
        //var radius:number = 1000;
        for (var c = 0; c < l; c++) {
            var t = Math.PI * 2 * c / l;
            var sprite = torus.getNewObject();
            sprite.x = Math.cos(t) * this.radius;
            sprite.y = 0;
            sprite.z = Math.sin(t) * this.radius;
            this.view.scene.addChild(sprite);
            this.sprites.push(sprite);
        }
    };
    TorusObject3DDemo.prototype.tick = function (dt) {
        this.tPos += .02;
        for (var c = 0; c < this.sprites.length; c++) {
            var objPos = Math.PI * 2 * c / this.sprites.length;
            this.t += .005;
            var s = 1.2 + Math.sin(this.t + objPos);
            this.sprites[c].rotationY += 2 * (c / this.sprites.length);
            this.sprites[c].rotationX += 2 * (c / this.sprites.length);
            this.sprites[c].rotationZ += 2 * (c / this.sprites.length);
            this.sprites[c].scaleX = this.sprites[c].scaleY = this.sprites[c].scaleZ = s;
            this.sprites[c].x = Math.cos(objPos + this.tPos) * this.radius;
            this.sprites[c].y = Math.sin(this.t) * 500;
            this.sprites[c].z = Math.sin(objPos + this.tPos) * this.radius;
            if (this.follow && c == 0)
                this.view.camera.lookAt(this.sprites[c].transform.position);
        }
        //this.view.camera.y = Math.sin( this.tPos ) * 1500;
        this.view.camera.y = Math.sin(this.tPos) * 1500;
        this.view.render();
    };
    TorusObject3DDemo.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    TorusObject3DDemo.prototype.followObject = function (e) {
        this.follow = !this.follow;
    };
    return TorusObject3DDemo;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9iamVjdDNkL1RvcnVzT2JqZWN0M0REZW1vLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQkFBMEIsaUNBQWlDLENBQUMsQ0FBQTtBQUM1RCwwQkFBMEIsK0JBQStCLENBQUMsQ0FBQTtBQUMxRCxvQ0FBa0MseUNBQXlDLENBQUMsQ0FBQTtBQUM1RSwyQkFBMkIsZ0NBQWdDLENBQUMsQ0FBQTtBQUM1RCwrQkFBOEIsdUNBQXVDLENBQUMsQ0FBQTtBQUN0RSw0QkFBNEIscUNBQXFDLENBQUMsQ0FBQTtBQUVsRSxzQ0FBbUMsNkNBQTZDLENBQUMsQ0FBQTtBQUNqRixzQkFBdUIsNkJBQTZCLENBQUMsQ0FBQTtBQUVyRCxxQkFBdUIseUJBQXlCLENBQUMsQ0FBQTtBQUVqRCwyQkFBMkIsdUNBQXVDLENBQUMsQ0FBQTtBQUNuRSw2QkFBNkIsMENBQTBDLENBQUMsQ0FBQTtBQUN4RSxrQ0FBZ0MsNkRBQTZELENBQUMsQ0FBQTtBQUM5RixxQ0FBbUMsaURBQWlELENBQUMsQ0FBQTtBQUVyRixnQ0FBK0IsdUNBQXVDLENBQUMsQ0FBQTtBQUV2RSwrQkFBOEIsMkNBQTJDLENBQUMsQ0FBQTtBQUUxRTtJQWtCQztRQWxCRCxpQkF5SUM7UUFqSVEsTUFBQyxHQUFVLENBQUMsQ0FBQztRQUNiLFNBQUksR0FBVSxDQUFDLENBQUM7UUFDaEIsV0FBTSxHQUFVLElBQUksQ0FBQztRQUNyQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBUzdCLGVBQUssQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBQzNCLGVBQUssQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBRTVCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQVUsQ0FBQztRQUNuQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksb0JBQVUsRUFBRSxDQUFDO1FBQzlCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxjQUFJLENBQUMsSUFBSSx5QkFBZSxFQUFFLENBQUMsQ0FBQztRQUM1QyxJQUFJ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QUFDLE1BQU0sQ0FBQztZQUVsRCxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQztZQUNmLElBQUksQ0FBQyxHQUFVLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUM7WUFFL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQzdFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQzdELElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFDLEdBQUcsQ0FBQztZQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUU3RCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RCxDQUFDO1FBRUQsb0RBQW9EO1FBRXBELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7UUFFaEQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRU0sb0NBQVEsR0FBZixVQUFnQixLQUFvQjtRQUFwQixxQkFBb0IsR0FBcEIsWUFBb0I7UUFFbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVoQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDdkMsQ0FBQztJQUVNLHdDQUFZLEdBQW5CLFVBQW9CLENBQUM7UUFFcEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDNUIsQ0FBQztJQUNGLHdCQUFDO0FBQUQsQ0F6SUEsQUF5SUMsSUFBQSIsImZpbGUiOiJvYmplY3QzZC9Ub3J1c09iamVjdDNERGVtby5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTYW1wbGVyMkRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9TYW1wbGVyMkRcIjtcbmltcG9ydCBVUkxMb2FkZXJcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMTG9hZGVyXCI7XG5pbXBvcnQgVVJMTG9hZGVyRGF0YUZvcm1hdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlckRhdGFGb3JtYXRcIjtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIjtcbmltcG9ydCBVUkxMb2FkZXJFdmVudFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvVVJMTG9hZGVyRXZlbnRcIjtcbmltcG9ydCBQYXJzZXJVdGlsc1x0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyVXRpbHNcIjtcbmltcG9ydCBQZXJzcGVjdGl2ZVByb2plY3Rpb25cdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9QZXJzcGVjdGl2ZVByb2plY3Rpb25cIjtcbmltcG9ydCBSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIjtcbmltcG9ydCBEZWJ1Z1x0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvdXRpbHMvRGVidWdcIjtcblxuaW1wb3J0IFZpZXdcdFx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvVmlld1wiO1xuaW1wb3J0IFNwcml0ZVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9TcHJpdGVcIjtcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9Qb2ludExpZ2h0XCI7XG5pbXBvcnQgRWxlbWVudHNUeXBlXHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZ3JhcGhpY3MvRWxlbWVudHNUeXBlXCI7XG5pbXBvcnQgU3RhdGljTGlnaHRQaWNrZXJcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9saWdodHBpY2tlcnMvU3RhdGljTGlnaHRQaWNrZXJcIjtcbmltcG9ydCBQcmltaXRpdmVUb3J1c1ByZWZhYlx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVUb3J1c1ByZWZhYlwiO1xuXG5pbXBvcnQgRGVmYXVsdFJlbmRlcmVyXHRcdFx0XHRmcm9tIFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0RlZmF1bHRSZW5kZXJlclwiO1xuXG5pbXBvcnQgTWV0aG9kTWF0ZXJpYWxcdFx0XHRcdGZyb20gXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9NZXRob2RNYXRlcmlhbFwiO1xuXG5jbGFzcyBUb3J1c09iamVjdDNERGVtb1xue1xuXHRwcml2YXRlIHZpZXc6VmlldztcblxuXHRwcml2YXRlIGxpZ2h0OlBvaW50TGlnaHQ7XG5cdHByaXZhdGUgcmFmOlJlcXVlc3RBbmltYXRpb25GcmFtZTtcblx0cHJpdmF0ZSBzcHJpdGVzOkFycmF5PFNwcml0ZT47XG5cblx0cHJpdmF0ZSB0Om51bWJlciA9IDA7XG5cdHByaXZhdGUgdFBvczpudW1iZXIgPSAwO1xuXHRwcml2YXRlIHJhZGl1czpudW1iZXIgPSAxMDAwO1xuXHRwcml2YXRlIGZvbGxvdzpib29sZWFuID0gdHJ1ZTtcblxuXHRwcml2YXRlIHBvaW50TGlnaHQ6UG9pbnRMaWdodDtcblx0cHJpdmF0ZSBsaWdodFBpY2tlcjpTdGF0aWNMaWdodFBpY2tlcjtcblxuXHRwcml2YXRlIF9pbWFnZTpIVE1MSW1hZ2VFbGVtZW50O1xuXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdERlYnVnLlRIUk9XX0VSUk9SUyA9IGZhbHNlO1xuXHRcdERlYnVnLkxPR19QSV9FUlJPUlMgPSBmYWxzZTtcblxuXHRcdHRoaXMuc3ByaXRlcyA9IG5ldyBBcnJheTxTcHJpdGU+KCk7XG5cdFx0dGhpcy5saWdodCA9IG5ldyBQb2ludExpZ2h0KCk7XG5cdFx0dGhpcy52aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcigpKTtcblx0XHR0aGlzLnBvaW50TGlnaHQgPSBuZXcgUG9pbnRMaWdodCgpO1xuXHRcdHRoaXMubGlnaHRQaWNrZXIgPSBuZXcgU3RhdGljTGlnaHRQaWNrZXIoW3RoaXMucG9pbnRMaWdodF0pO1xuXG5cdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMucG9pbnRMaWdodCk7XG5cblx0XHR2YXIgcGVyc3BlY3RpdmVMZW5zOlBlcnNwZWN0aXZlUHJvamVjdGlvbiA9IDxQZXJzcGVjdGl2ZVByb2plY3Rpb24+IHRoaXMudmlldy5jYW1lcmEucHJvamVjdGlvbjtcblx0XHRwZXJzcGVjdGl2ZUxlbnMuZmllbGRPZlZpZXcgPSA3NTtcblxuXHRcdHRoaXMudmlldy5jYW1lcmEueiA9IDA7XG5cdFx0dGhpcy52aWV3LmJhY2tncm91bmRDb2xvciA9IDB4MDAwMDAwO1xuXHRcdHRoaXMudmlldy5iYWNrZ3JvdW5kQWxwaGEgPSAxO1xuXG5cdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMubGlnaHQpO1xuXG5cdFx0dGhpcy5yYWYgPSBuZXcgUmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMudGljaywgdGhpcyk7XG5cdFx0dGhpcy5yYWYuc3RhcnQoKTtcblx0XHR0aGlzLm9uUmVzaXplKCk7XG5cblx0XHRkb2N1bWVudC5vbm1vdXNlZG93biA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLmZvbGxvd09iamVjdChldmVudCk7XG5cblx0XHR3aW5kb3cub25yZXNpemUgPSAoZXZlbnQ6VUlFdmVudCkgPT4gdGhpcy5vblJlc2l6ZShldmVudCk7XG5cblx0XHR0aGlzLmxvYWRSZXNvdXJjZXMoKTtcblx0fVxuXG5cdHByaXZhdGUgbG9hZFJlc291cmNlcygpXG5cdHtcblx0XHR2YXIgdXJsUmVxdWVzdDpVUkxSZXF1ZXN0ID0gbmV3IFVSTFJlcXVlc3QoXCJhc3NldHMvY3VzdG9tX3V2X2hvcml6b250YWwucG5nXCIpO1xuXHRcdHZhciB1cmxMb2FkZXI6VVJMTG9hZGVyID0gbmV3IFVSTExvYWRlcigpO1xuXHRcdHVybExvYWRlci5kYXRhRm9ybWF0ID0gVVJMTG9hZGVyRGF0YUZvcm1hdC5CTE9CO1xuXHRcdHVybExvYWRlci5hZGRFdmVudExpc3RlbmVyKFVSTExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpVUkxMb2FkZXJFdmVudCkgPT4gdGhpcy5pbWFnZUNvbXBsZXRlSGFuZGxlcihldmVudCkpO1xuXHRcdHVybExvYWRlci5sb2FkKHVybFJlcXVlc3QpO1xuXHR9XG5cblx0cHJpdmF0ZSBpbWFnZUNvbXBsZXRlSGFuZGxlcihldmVudDpVUkxMb2FkZXJFdmVudClcblx0e1xuXHRcdHZhciB1cmxMb2FkZXI6VVJMTG9hZGVyID0gZXZlbnQudGFyZ2V0O1xuXG5cdFx0dGhpcy5faW1hZ2UgPSBQYXJzZXJVdGlscy5ibG9iVG9JbWFnZSh1cmxMb2FkZXIuZGF0YSk7XG5cdFx0dGhpcy5faW1hZ2Uub25sb2FkID0gKGV2ZW50OkV2ZW50KSA9PiB0aGlzLm9uSW1hZ2VMb2FkQ29tcGxldGUoZXZlbnQpO1xuXG5cdH1cblxuXHRwcml2YXRlIG9uSW1hZ2VMb2FkQ29tcGxldGUoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHR2YXIgbWF0VHg6TWV0aG9kTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoUGFyc2VyVXRpbHMuaW1hZ2VUb0JpdG1hcEltYWdlMkQodGhpcy5faW1hZ2UpKTtcblx0XHRtYXRUeC5zdHlsZS5zYW1wbGVyID0gbmV3IFNhbXBsZXIyRCh0cnVlLCB0cnVlLCB0cnVlKTtcblx0XHRtYXRUeC5saWdodFBpY2tlciA9ICB0aGlzLmxpZ2h0UGlja2VyO1xuXG5cdFx0dmFyIHRvcnVzOlByaW1pdGl2ZVRvcnVzUHJlZmFiID0gbmV3IFByaW1pdGl2ZVRvcnVzUHJlZmFiKG1hdFR4LCBFbGVtZW50c1R5cGUuVFJJQU5HTEUsIDE1MCwgNTAsIDMyLCAzMiwgZmFsc2UpO1xuXG5cdFx0dmFyIGw6bnVtYmVyID0gMTA7XG5cdFx0Ly92YXIgcmFkaXVzOm51bWJlciA9IDEwMDA7XG5cblx0XHRmb3IgKHZhciBjIDogbnVtYmVyID0gMDsgYyA8IGwgOyBjKyspIHtcblxuXHRcdFx0dmFyIHQgOiBudW1iZXI9TWF0aC5QSSAqIDIgKiBjIC8gbDtcblxuXHRcdFx0dmFyIHNwcml0ZTpTcHJpdGUgPSA8U3ByaXRlPiB0b3J1cy5nZXROZXdPYmplY3QoKTtcblx0XHRcdHNwcml0ZS54ID0gTWF0aC5jb3ModCkqdGhpcy5yYWRpdXM7XG5cdFx0XHRzcHJpdGUueSA9IDA7XG5cdFx0XHRzcHJpdGUueiA9IE1hdGguc2luKHQpKnRoaXMucmFkaXVzO1xuXG5cdFx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQoc3ByaXRlKTtcblx0XHRcdHRoaXMuc3ByaXRlcy5wdXNoKHNwcml0ZSk7XG5cblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHRpY2soZHQ6bnVtYmVyKVxuXHR7XG5cdFx0dGhpcy50UG9zICs9IC4wMjtcblxuXHRcdGZvciAodmFyIGM6bnVtYmVyID0gMCA7IGMgPCB0aGlzLnNwcml0ZXMubGVuZ3RoIDsgYyArKykge1xuXHRcdFx0dmFyIG9ialBvczpudW1iZXI9TWF0aC5QSSoyKmMvdGhpcy5zcHJpdGVzLmxlbmd0aDtcblxuXHRcdFx0dGhpcy50ICs9IC4wMDU7XG5cdFx0XHR2YXIgczpudW1iZXIgPSAxLjIgKyBNYXRoLnNpbih0aGlzLnQgKyBvYmpQb3MpO1xuXG5cdFx0XHR0aGlzLnNwcml0ZXNbY10ucm90YXRpb25ZICs9IDIqKGMvdGhpcy5zcHJpdGVzLmxlbmd0aCk7XG5cdFx0XHR0aGlzLnNwcml0ZXNbY10ucm90YXRpb25YICs9IDIqKGMvdGhpcy5zcHJpdGVzLmxlbmd0aCk7XG5cdFx0XHR0aGlzLnNwcml0ZXNbY10ucm90YXRpb25aICs9IDIqKGMvdGhpcy5zcHJpdGVzLmxlbmd0aCk7XG5cdFx0XHR0aGlzLnNwcml0ZXNbY10uc2NhbGVYID0gdGhpcy5zcHJpdGVzW2NdLnNjYWxlWSA9IHRoaXMuc3ByaXRlc1tjXS5zY2FsZVogPSBzO1xuXHRcdFx0dGhpcy5zcHJpdGVzW2NdLnggPSBNYXRoLmNvcyhvYmpQb3MgKyB0aGlzLnRQb3MpKnRoaXMucmFkaXVzO1xuXHRcdFx0dGhpcy5zcHJpdGVzW2NdLnkgPSBNYXRoLnNpbih0aGlzLnQpKjUwMDtcblx0XHRcdHRoaXMuc3ByaXRlc1tjXS56ID0gTWF0aC5zaW4ob2JqUG9zICsgdGhpcy50UG9zKSp0aGlzLnJhZGl1cztcblxuXHRcdFx0aWYgKHRoaXMuZm9sbG93ICYmIGMgPT0gMClcblx0XHRcdFx0dGhpcy52aWV3LmNhbWVyYS5sb29rQXQodGhpcy5zcHJpdGVzW2NdLnRyYW5zZm9ybS5wb3NpdGlvbik7XG5cdFx0fVxuXG5cdFx0Ly90aGlzLnZpZXcuY2FtZXJhLnkgPSBNYXRoLnNpbiggdGhpcy50UG9zICkgKiAxNTAwO1xuXG5cdFx0dGhpcy52aWV3LmNhbWVyYS55ID0gTWF0aC5zaW4odGhpcy50UG9zKSAqIDE1MDA7XG5cblx0XHR0aGlzLnZpZXcucmVuZGVyKCk7XG5cdH1cblxuXHRwdWJsaWMgb25SZXNpemUoZXZlbnQ6VUlFdmVudCA9IG51bGwpXG5cdHtcblx0XHR0aGlzLnZpZXcueSA9IDA7XG5cdFx0dGhpcy52aWV3LnggPSAwO1xuXG5cdFx0dGhpcy52aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5cdFx0dGhpcy52aWV3LmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblx0fVxuXG5cdHB1YmxpYyBmb2xsb3dPYmplY3QoZSlcblx0e1xuXHRcdHRoaXMuZm9sbG93ID0gIXRoaXMuZm9sbG93O1xuXHR9XG59Il0sInNvdXJjZVJvb3QiOiIuL3Rlc3RzIn0=
