var Sampler2D = require("awayjs-core/lib/image/Sampler2D");
var URLLoaderEvent = require("awayjs-core/lib/events/URLLoaderEvent");
var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");
var Debug = require("awayjs-core/lib/utils/Debug");
var View = require("awayjs-display/lib/containers/View");
var PrimitivePlanePrefab = require("awayjs-display/lib/prefabs/PrimitivePlanePrefab");
var DefaultRenderer = require("awayjs-renderergl/lib/DefaultRenderer");
var BasicMaterial = require("awayjs-display/lib/materials/BasicMaterial");
var URLLoader = require("awayjs-core/lib/net/URLLoader");
var URLLoaderDataFormat = require("awayjs-core/lib/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var ParserUtils = require("awayjs-core/lib/parsers/ParserUtils");
var ElementsType = require("awayjs-display/lib/graphics/ElementsType");
var MipMapSoftwareTest = (function () {
    function MipMapSoftwareTest() {
        var _this = this;
        this.c = 100;
        var pngURLRequest = new URLRequest('assets/dots.png');
        this.pngLoader = new URLLoader();
        this.pngLoader.dataFormat = URLLoaderDataFormat.BLOB;
        this.pngLoader.addEventListener(URLLoaderEvent.LOAD_COMPLETE, function (event) { return _this.pngLoaderComplete(event); });
        this.pngLoader.load(pngURLRequest);
    }
    MipMapSoftwareTest.prototype.pngLoaderComplete = function (event) {
        var _this = this;
        var imageLoader = event.target;
        this.image = ParserUtils.blobToImage(imageLoader.data);
        this.image.onload = function (event) { return _this.onLoadComplete(event); };
    };
    MipMapSoftwareTest.prototype.onLoadComplete = function (event) {
        var _this = this;
        Debug.LOG_PI_ERRORS = false;
        Debug.THROW_ERRORS = false;
        var defaultRenderer = new DefaultRenderer(null, false, "baseline", "software");
        defaultRenderer.antiAlias = 2;
        this.view = new View(defaultRenderer);
        //this.view = new View(new DefaultRenderer(null, false, "baseline"));
        this.raf = new RequestAnimationFrame(this.render, this);
        this.view.backgroundColor = 0x222222;
        window.onresize = function (event) { return _this.onResize(event); };
        this.initMeshes();
        this.raf.start();
        this.onResize();
    };
    MipMapSoftwareTest.prototype.initMeshes = function () {
        //var material:BasicMaterial = new BasicMaterial(DefaultMaterialManager.getDefaultTexture());
        var material = new BasicMaterial(ParserUtils.imageToBitmapImage2D(this.image));
        material.style.sampler = new Sampler2D(true, true, true);
        var plane = new PrimitivePlanePrefab(material, ElementsType.TRIANGLE, 1000, 1000, 1000);
        //var plane:PrimitiveCubePrefab = new PrimitiveCubePrefab();
        plane.material = material;
        var mesh = plane.getNewObject();
        mesh.y = -100;
        this.view.scene.addChild(mesh);
    };
    MipMapSoftwareTest.prototype.render = function () {
        if (this.c > 10) {
            this.c = 0;
            this.view.render();
        }
        this.c++;
    };
    MipMapSoftwareTest.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    return MipMapSoftwareTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvZnR3YXJlL01pcE1hcFNvZnR3YXJlVGVzdC50cyJdLCJuYW1lcyI6WyJNaXBNYXBTb2Z0d2FyZVRlc3QiLCJNaXBNYXBTb2Z0d2FyZVRlc3QuY29uc3RydWN0b3IiLCJNaXBNYXBTb2Z0d2FyZVRlc3QucG5nTG9hZGVyQ29tcGxldGUiLCJNaXBNYXBTb2Z0d2FyZVRlc3Qub25Mb2FkQ29tcGxldGUiLCJNaXBNYXBTb2Z0d2FyZVRlc3QuaW5pdE1lc2hlcyIsIk1pcE1hcFNvZnR3YXJlVGVzdC5yZW5kZXIiLCJNaXBNYXBTb2Z0d2FyZVRlc3Qub25SZXNpemUiXSwibWFwcGluZ3MiOiJBQUNBLElBQU8sU0FBUyxXQUFlLGlDQUFpQyxDQUFDLENBQUM7QUFDbEUsSUFBTyxjQUFjLFdBQWMsdUNBQXVDLENBQUMsQ0FBQztBQUM1RSxJQUFPLHFCQUFxQixXQUFrQiw2Q0FBNkMsQ0FBQyxDQUFDO0FBQzdGLElBQU8sS0FBSyxXQUFrQyw2QkFBNkIsQ0FBQyxDQUFDO0FBRTdFLElBQU8sSUFBSSxXQUFzQyxvQ0FBb0MsQ0FBQyxDQUFDO0FBVXZGLElBQU8sb0JBQW9CLFdBQXNCLGlEQUFpRCxDQUFDLENBQUM7QUFJcEcsSUFBTyxlQUFlLFdBQTBCLHVDQUF1QyxDQUFDLENBQUM7QUFHekYsSUFBTyxhQUFhLFdBQTBCLDRDQUE0QyxDQUFDLENBQUM7QUFDNUYsSUFBTyxTQUFTLFdBQWUsK0JBQStCLENBQUMsQ0FBQztBQUNoRSxJQUFPLG1CQUFtQixXQUFhLHlDQUF5QyxDQUFDLENBQUM7QUFDbEYsSUFBTyxVQUFVLFdBQWUsZ0NBQWdDLENBQUMsQ0FBQztBQUNsRSxJQUFPLFdBQVcsV0FBZSxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ3hFLElBQU8sWUFBWSxXQUEyQiwwQ0FBMEMsQ0FBQyxDQUFDO0FBRTFGLElBQU0sa0JBQWtCO0lBT3BCQSxTQVBFQSxrQkFBa0JBO1FBQXhCQyxpQkF3RUNBO1FBakJXQSxNQUFDQSxHQUFVQSxHQUFHQSxDQUFDQTtRQTlDbkJBLElB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QUFBIiwiZmlsZSI6InNvZnR3YXJlL01pcE1hcFNvZnR3YXJlVGVzdC5qcyIsInNvdXJjZVJvb3QiOiIuL3Rlc3RzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEICAgICAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgU2FtcGxlcjJEXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9TYW1wbGVyMkRcIik7XG5pbXBvcnQgVVJMTG9hZGVyRXZlbnRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvVVJMTG9hZGVyRXZlbnRcIik7XG5pbXBvcnQgUmVxdWVzdEFuaW1hdGlvbkZyYW1lICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCIpO1xuaW1wb3J0IERlYnVnICAgICAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0RlYnVnXCIpO1xuXG5pbXBvcnQgVmlldyAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9WaWV3XCIpO1xuaW1wb3J0IE1lc2ggICAgICAgICAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL01lc2hcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodCAgICAgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvRGlyZWN0aW9uYWxMaWdodFwiKTtcbmltcG9ydCBEZWZhdWx0TWF0ZXJpYWxNYW5hZ2VyICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWFuYWdlcnMvRGVmYXVsdE1hdGVyaWFsTWFuYWdlclwiKTtcbmltcG9ydCBTdGF0aWNMaWdodFBpY2tlciAgICAgICAgICAgID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvbGlnaHRwaWNrZXJzL1N0YXRpY0xpZ2h0UGlja2VyXCIpO1xuaW1wb3J0IFByaW1pdGl2ZVByZWZhYkJhc2UgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVQcmVmYWJCYXNlXCIpO1xuaW1wb3J0IFByaW1pdGl2ZUNhcHN1bGVQcmVmYWIgICAgICAgID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUNhcHN1bGVQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlQ29uZVByZWZhYiAgICAgICAgICAgID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUNvbmVQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlQ3ViZVByZWZhYiAgICAgICAgICAgID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUN1YmVQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlQ3lsaW5kZXJQcmVmYWIgICAgICAgID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUN5bGluZGVyUHJlZmFiXCIpO1xuaW1wb3J0IFByaW1pdGl2ZVBsYW5lUHJlZmFiICAgICAgICAgICAgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlUGxhbmVQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlU3BoZXJlUHJlZmFiICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVTcGhlcmVQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlVG9ydXNQcmVmYWIgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVUb3J1c1ByZWZhYlwiKTtcblxuaW1wb3J0IERlZmF1bHRSZW5kZXJlciAgICAgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRGVmYXVsdFJlbmRlcmVyXCIpO1xuXG5pbXBvcnQgTWV0aG9kTWF0ZXJpYWwgICAgICAgICAgICAgICAgPSByZXF1aXJlKFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvTWV0aG9kTWF0ZXJpYWxcIik7XG5pbXBvcnQgQmFzaWNNYXRlcmlhbCAgICAgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL0Jhc2ljTWF0ZXJpYWxcIik7XG5pbXBvcnQgVVJMTG9hZGVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMTG9hZGVyXCIpO1xuaW1wb3J0IFVSTExvYWRlckRhdGFGb3JtYXRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlckRhdGFGb3JtYXRcIik7XG5pbXBvcnQgVVJMUmVxdWVzdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIik7XG5pbXBvcnQgUGFyc2VyVXRpbHNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3BhcnNlcnMvUGFyc2VyVXRpbHNcIik7XG5pbXBvcnQgRWxlbWVudHNUeXBlICAgICAgICAgICAgICAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZ3JhcGhpY3MvRWxlbWVudHNUeXBlXCIpO1xuXG5jbGFzcyBNaXBNYXBTb2Z0d2FyZVRlc3Qge1xuXG4gICAgcHJpdmF0ZSB2aWV3OlZpZXc7XG4gICAgcHJpdmF0ZSByYWY6UmVxdWVzdEFuaW1hdGlvbkZyYW1lO1xuICAgIHByaXZhdGUgcG5nTG9hZGVyICAgOiBVUkxMb2FkZXI7XG4gICAgcHJpdmF0ZSBpbWFnZTpIVE1MSW1hZ2VFbGVtZW50O1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG5cbiAgICAgICAgdmFyIHBuZ1VSTFJlcXVlc3Q6VVJMUmVxdWVzdCA9IG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvZG90cy5wbmcnKTtcblxuICAgICAgICB0aGlzLnBuZ0xvYWRlciA9IG5ldyBVUkxMb2FkZXIoKTtcbiAgICAgICAgdGhpcy5wbmdMb2FkZXIuZGF0YUZvcm1hdCA9IFVSTExvYWRlckRhdGFGb3JtYXQuQkxPQjtcbiAgICAgICAgdGhpcy5wbmdMb2FkZXIuYWRkRXZlbnRMaXN0ZW5lcihVUkxMb2FkZXJFdmVudC5MT0FEX0NPTVBMRVRFLCAoZXZlbnQ6VVJMTG9hZGVyRXZlbnQpID0+IHRoaXMucG5nTG9hZGVyQ29tcGxldGUoZXZlbnQpKTtcbiAgICAgICAgdGhpcy5wbmdMb2FkZXIubG9hZChwbmdVUkxSZXF1ZXN0KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBuZ0xvYWRlckNvbXBsZXRlKGV2ZW50OlVSTExvYWRlckV2ZW50KSB7XG4gICAgICAgIHZhciBpbWFnZUxvYWRlcjpVUkxMb2FkZXIgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSBQYXJzZXJVdGlscy5ibG9iVG9JbWFnZShpbWFnZUxvYWRlci5kYXRhKTtcbiAgICAgICAgdGhpcy5pbWFnZS5vbmxvYWQgPSAoZXZlbnQpID0+IHRoaXMub25Mb2FkQ29tcGxldGUoZXZlbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25Mb2FkQ29tcGxldGUoZXZlbnQpIHtcbiAgICAgICAgRGVidWcuTE9HX1BJX0VSUk9SUyA9IGZhbHNlO1xuICAgICAgICBEZWJ1Zy5USFJPV19FUlJPUlMgPSBmYWxzZTtcblxuICAgICAgICB2YXIgZGVmYXVsdFJlbmRlcmVyOkRlZmF1bHRSZW5kZXJlciA9IG5ldyBEZWZhdWx0UmVuZGVyZXIobnVsbCwgZmFsc2UsIFwiYmFzZWxpbmVcIiwgXCJzb2Z0d2FyZVwiKTtcbiAgICAgICAgZGVmYXVsdFJlbmRlcmVyLmFudGlBbGlhcyA9IDI7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyBWaWV3KGRlZmF1bHRSZW5kZXJlcik7XG4gICAgICAgIC8vdGhpcy52aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcihudWxsLCBmYWxzZSwgXCJiYXNlbGluZVwiKSk7XG4gICAgICAgIHRoaXMucmFmID0gbmV3IFJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlciwgdGhpcyk7XG5cbiAgICAgICAgdGhpcy52aWV3LmJhY2tncm91bmRDb2xvciA9IDB4MjIyMjIyO1xuXG4gICAgICAgIHdpbmRvdy5vbnJlc2l6ZSA9IChldmVudDpVSUV2ZW50KSA9PiB0aGlzLm9uUmVzaXplKGV2ZW50KTtcblxuICAgICAgICB0aGlzLmluaXRNZXNoZXMoKTtcbiAgICAgICAgdGhpcy5yYWYuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5vblJlc2l6ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdE1lc2hlcygpOnZvaWQge1xuICAgICAgICAvL3ZhciBtYXRlcmlhbDpCYXNpY01hdGVyaWFsID0gbmV3IEJhc2ljTWF0ZXJpYWwoRGVmYXVsdE1hdGVyaWFsTWFuYWdlci5nZXREZWZhdWx0VGV4dHVyZSgpKTtcbiAgICAgICAgdmFyIG1hdGVyaWFsOkJhc2ljTWF0ZXJpYWwgPSBuZXcgQmFzaWNNYXRlcmlhbChQYXJzZXJVdGlscy5pbWFnZVRvQml0bWFwSW1hZ2UyRCh0aGlzLmltYWdlKSk7XG4gICAgICAgIG1hdGVyaWFsLnN0eWxlLnNhbXBsZXIgPSBuZXcgU2FtcGxlcjJEKHRydWUsIHRydWUsIHRydWUpO1xuICAgICAgICB2YXIgcGxhbmU6UHJpbWl0aXZlUGxhbmVQcmVmYWIgPSBuZXcgUHJpbWl0aXZlUGxhbmVQcmVmYWIobWF0ZXJpYWwsIEVsZW1lbnRzVHlwZS5UUklBTkdMRSwgMTAwMCwxMDAwLDEwMDApO1xuICAgICAgICAvL3ZhciBwbGFuZTpQcmltaXRpdmVDdWJlUHJlZmFiID0gbmV3IFByaW1pdGl2ZUN1YmVQcmVmYWIoKTtcbiAgICAgICAgcGxhbmUubWF0ZXJpYWwgPSBtYXRlcmlhbDtcblxuICAgICAgICB2YXIgbWVzaDpNZXNoID0gPE1lc2g+cGxhbmUuZ2V0TmV3T2JqZWN0KCk7XG4gICAgICAgIG1lc2gueSA9IC0xMDA7XG4gICAgICAgIHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZChtZXNoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGM6bnVtYmVyID0gMTAwO1xuXG4gICAgcHJpdmF0ZSByZW5kZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLmMgPiAxMCkge1xuICAgICAgICAgICAgdGhpcy5jID0gMDtcbiAgICAgICAgICAgIHRoaXMudmlldy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmMrKztcbiAgICB9XG5cbiAgICBwdWJsaWMgb25SZXNpemUoZXZlbnQ6VUlFdmVudCA9IG51bGwpIHtcbiAgICAgICAgdGhpcy52aWV3LnkgPSAwO1xuICAgICAgICB0aGlzLnZpZXcueCA9IDA7XG5cbiAgICAgICAgdGhpcy52aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHRoaXMudmlldy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgfVxufSJdfQ==